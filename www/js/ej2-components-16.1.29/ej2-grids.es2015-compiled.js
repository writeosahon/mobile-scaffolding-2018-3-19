'use strict';System.register(['@syncfusion/ej2-base','@syncfusion/ej2-data','@syncfusion/ej2-popups','@syncfusion/ej2-buttons','@syncfusion/ej2-inputs','@syncfusion/ej2-dropdowns','@syncfusion/ej2-calendars','@syncfusion/ej2-navigations','@syncfusion/ej2-excel-export','@syncfusion/ej2-pdf-export'],function(_export,_context){"use strict";var Browser,ChildProperty,Collection,Complex,Component,Draggable,Droppable,Event,EventHandler,Internationalization,KeyboardEvents,L10n,NotifyPropertyChanges,Property,addClass,append,attributes,classList,closest,_compile,createElement,debounce,detach,extend,formatUnit,getEnumValue,getValue,isNullOrUndefined,isUndefined,matches,merge,print,remove,removeClass,_setCulture,setStyleAttribute,setValue,DataManager,DataUtil,Deferred,Predicate,Query,UrlAdaptor,Dialog,Tooltip,calculatePosition,calculateRelativeBasedPosition,createSpinner,_hideSpinner,_showSpinner,Button,CheckBox,RadioButton,createCheckBox,FormValidator,Input,NumericTextBox,AutoComplete,DropDownList,DatePicker,ContextMenu,Toolbar,Workbook,PdfBitmap,PdfBorders,PdfColor,PdfCompositeField,PdfDocument,PdfFontFamily,PdfFontStyle,PdfGrid,PdfPageCountField,PdfPageNumberField,PdfPageOrientation,PdfPageSettings,PdfPageTemplateElement,PdfPen,PdfSolidBrush,PdfStandardFont,PdfStringFormat,PdfTextAlignment,PdfVerticalAlignment,PointF,RectangleF,SizeF,_slicedToArray,_get,_typeof,_createClass,ValueFormatter,Column,uid,scrollWidth,rowHeight,created,destroyed,load,rowDataBound,queryCellInfo,actionBegin,actionComplete,actionFailure,dataBound,rowSelecting,rowSelected,rowDeselecting,rowDeselected,cellSelecting,cellSelected,cellDeselecting,cellDeselected,columnDragStart,columnDrag,columnDrop,rowDragStart,rowDrag,rowDrop,beforePrint,printComplete,detailDataBound,toolbarClick,batchAdd,batchCancel,batchDelete,beforeBatchAdd,beforeBatchDelete,beforeBatchSave,beginEdit,cellEdit,cellSave,endAdd,endDelete,endEdit,recordDoubleClick,recordClick,beforeDataBound,beforeOpenColumnChooser,_resizeStart,onResize,resizeStop,checkBoxChange,beforeCopy,filterChoiceRequest,filterAfterOpen,filterBeforeOpen,initialLoad,initialEnd,dataReady,contentReady,uiUpdate,onEmpty,inBoundModelChanged,modelChanged,colGroupRefresh,headerRefreshed,pageBegin,pageComplete,sortBegin,sortComplete,filterBegin,filterComplete,searchBegin,searchComplete,reorderBegin,reorderComplete,rowDragAndDropBegin,rowDragAndDropComplete,groupBegin,groupComplete,ungroupBegin,ungroupComplete,rowSelectionBegin,rowSelectionComplete,columnSelectionBegin,columnSelectionComplete,cellSelectionBegin,cellSelectionComplete,beforeCellFocused,cellFocused,keyPressed,click,_destroy,columnVisibilityChanged,scroll,columnWidthChanged,columnPositionChanged,rowDragAndDrop,rowsAdded,rowsRemoved,columnDragStop,headerDrop,dataSourceModified,refreshComplete,refreshVirtualBlock,dblclick,toolbarRefresh,bulkSave,autoCol,tooltipDestroy,updateData,editBegin,editComplete,addBegin,addComplete,saveComplete,deleteBegin,deleteComplete,preventBatch,dialogDestroy,crudAction,addDeleteAction,destroyForm,doubleTap,beforeExcelExport,excelExportComplete,excelQueryCellInfo,beforePdfExport,pdfExportComplete,pdfQueryCellInfo,accessPredicate,contextMenuClick,freezeRender,freezeRefresh,contextMenuOpen,columnMenuClick,columnMenuOpen,filterOpen,filterDialogCreated,filterMenuClose,initForeignKeyColumn,getForeignKeyData,generateQuery,showEmptyGrid,foreignKeyData,dataStateChange,dataSourceChanged,rtlUpdated,CellType,RenderType,ToolbarItem,CheckBoxFilter,Data,Row,Cell,CellMergeRender,RowRenderer,RowModelGenerator,SummaryModelGenerator,GroupSummaryModelGenerator,CaptionSummaryModelGenerator,GroupModelGenerator,ContentRender,HeaderRender,CellRenderer,AriaService,config,HeaderCellRenderer,StackedHeaderCellRenderer,IndentCellRenderer,GroupCaptionCellRenderer,GroupCaptionEmptyCellRenderer,ExpandCellRenderer,HeaderIndentCellRenderer,DetailHeaderIndentCellRenderer,DetailExpandCellRenderer,Render,CellRendererFactory,ServiceLocator,RendererFactory,ColumnWidthService,FocusStrategy,Matrix,ContentFocus,HeaderFocus,FixedContentFocus,FixedHeaderFocus,SearchBox,__decorate$1,PageSettings,Selection,Search,ShowHide,Scroll,Print,__decorate$2,AggregateColumn,AggregateRow,Clipboard,__decorate,SortDescriptor,SortSettings,Predicate$1,FilterSettings,SelectionSettings,SearchSettings,RowDropSettings,TextWrapSettings,GroupSettings,EditSettings,Grid,Sort,NumericContainer,PagerMessage,__decorate$3,Pager,PagerDropDown,ExternalMessage,Page,keyActions,FilterCellRenderer,FlMenuOptrUI,StringFilterUI,NumberFilterUI,BooleanFilterUI,DateFilterUI,FilterMenuRenderer,ExcelFilter,Filter,resizeClassList,Resize,Reorder,RowDD,Group,DetailRow,Toolbar$1,FooterRenderer,SummaryCellRenderer,Aggregate,InterSectionObserver,VirtualRowModelGenerator,VirtualContentRenderer,VirtualHeaderRenderer,VirtualElementHandler,VirtualScroll,InlineEditRender,BatchEditRender,DialogEditRender,EditRender,BooleanEditCell,DropDownEditCell,NumericEditCell,DefaultEditCell,NormalEdit,InlineEdit,BatchEdit,DialogEdit,DatePickerEditCell,Edit,Global,ColumnChooser,ExportHelper,ExportValueFormatter,ExcelExport,PdfExport,CommandColumnRenderer,CommandColumn,menuClass,ContextMenu$1,FreezeRowModelGenerator,FreezeContentRender,FreezeRender,Freeze,ColumnMenu,ForeignKey;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}//https://typescript.codeplex.com/discussions/401501
/**
 * Function to check whether target object implement specific interface
 * @param  {Object} target
 * @param  {string} checkFor
 * @returns no
 * @hidden
 */function doesImplementInterface(target,checkFor){/* tslint:disable:no-any */return target.prototype&&checkFor in target.prototype;}/**
 * Function to get value from provided data
 * @param  {string} field
 * @param  {Object} data
 * @param  {IColumn} column
 * @hidden
 */function valueAccessor(field,data,column){field=isNullOrUndefined(field)?'':field;return getValue(field,data);}/**
 * The function used to update Dom using requestAnimationFrame.
 * @param  {Function} fn - Function that contains the actual action
 * @return {Promise<T>}
 * @hidden
 */function getUpdateUsingRaf(updateFunction,callBack){requestAnimationFrame(function(){try{callBack(null,updateFunction());}catch(e){callBack(e);}});}/**
 * @hidden
 */function iterateArrayOrObject(collection,predicate){var result=[];for(var i=0,len=collection.length;i<len;i++){var pred=predicate(collection[i],i);if(!isNullOrUndefined(pred)){result.push(pred);}}return result;}/** @hidden */function templateCompiler(template){if(template){try{if(document.querySelectorAll(template).length){return _compile(document.querySelector(template).innerHTML.trim());}}catch(e){return _compile(template);}}return undefined;}/** @hidden */function setStyleAndAttributes(node,customAttributes){var copyAttr={};var literals=['style','class'];//Dont touch the original object - make a copy
extend(copyAttr,customAttributes,{});if('style'in copyAttr){setStyleAttribute(node,copyAttr[literals[0]]);delete copyAttr[literals[0]];}if('class'in copyAttr){addClass([node],copyAttr[literals[1]]);delete copyAttr[literals[1]];}attributes(node,copyAttr);}/** @hidden */function extend$1(copied,first,second,exclude){var moved=extend(copied,first,second);Object.keys(moved).forEach(function(value,index){if(exclude.indexOf(value)!==-1){delete moved[value];}});return moved;}/** @hidden */function prepareColumns(columns,autoWidth){for(var c=0,len=columns.length;c<len;c++){var column=void 0;if(typeof columns[c]==='string'){column=new Column({field:columns[c]});}else if(!(columns[c]instanceof Column)){if(!columns[c].columns){column=new Column(columns[c]);}else{column=new Column(columns[c]);columns[c].columns=prepareColumns(columns[c].columns);}}else{column=columns[c];}column.headerText=isNullOrUndefined(column.headerText)?column.foreignKeyValue||column.field||'':column.headerText;column.foreignKeyField=column.foreignKeyField||column.field;column.valueAccessor=column.valueAccessor||valueAccessor;column.width=autoWidth&&isNullOrUndefined(column.width)?200:column.width;if(isNullOrUndefined(column.visible)){column.visible=true;}columns[c]=column;}return columns;}/** @hidden */function setCssInGridPopUp(popUp,e,className){var popUpSpan=popUp.querySelector('span');var position=popUp.parentElement.getBoundingClientRect();var targetPosition=e.target.getBoundingClientRect();var isBottomTail=void 0;popUpSpan.className=className;popUp.style.display='';isBottomTail=(isNullOrUndefined(e.clientY)?e.changedTouches[0].clientY:e.clientY)>popUp.offsetHeight+10;popUp.style.top=targetPosition.top-position.top+(isBottomTail?-(popUp.offsetHeight+10):popUp.offsetHeight+10)+'px';//10px for tail element
popUp.style.left=getPopupLeftPosition(popUp,e,targetPosition,position.left)+'px';if(isBottomTail){popUp.querySelector('.e-downtail').style.display='';popUp.querySelector('.e-uptail').style.display='none';}else{popUp.querySelector('.e-downtail').style.display='none';popUp.querySelector('.e-uptail').style.display='';}}/** @hidden */function getPopupLeftPosition(popup,e,targetPosition,left){var width=popup.offsetWidth/2;var x=getPosition(e).x;if(x-targetPosition.left<width){return targetPosition.left-left;}else if(targetPosition.right-x<width){return targetPosition.right-left-width*2;}else{return x-left-width;}}/** @hidden */function getActualProperties(obj){if(obj instanceof ChildProperty){return getValue('properties',obj);}else{return obj;}}/** @hidden */function parentsUntil(elem,selector,isID){var parent=elem;while(parent){if(isID?parent.id===selector:parent.classList.contains(selector)){break;}parent=parent.parentElement;}return parent;}/** @hidden */function getElementIndex(element,elements){var index=-1;for(var i=0,len=elements.length;i<len;i++){if(elements[i].isEqualNode(element)){index=i;break;}}return index;}/** @hidden */function inArray(value,collection){for(var i=0,len=collection.length;i<len;i++){if(collection[i]===value){return i;}}return-1;}/** @hidden */function getActualPropFromColl(collection){var coll=[];for(var i=0,len=collection.length;i<len;i++){if(collection[i].hasOwnProperty('properties')){coll.push(collection[i].properties);}else{coll.push(collection[i]);}}return coll;}/** @hidden */function removeElement(target,selector){var elements=[].slice.call(target.querySelectorAll(selector));for(var i=0;i<elements.length;i++){remove(elements[i]);}}/** @hidden */function getPosition(e){var position={};position.x=isNullOrUndefined(e.clientX)?e.changedTouches[0].clientX:e.clientX;position.y=isNullOrUndefined(e.clientY)?e.changedTouches[0].clientY:e.clientY;return position;}/** @hidden */function getUid(prefix){return prefix+uid++;}/** @hidden */function appendChildren(elem,children){for(var i=0,len=children.length;i<len;i++){if(len===children.length){elem.appendChild(children[i]);}else{elem.appendChild(children[0]);}}return elem;}/** @hidden */function parents(elem,selector,isID){var parent=elem;var parents=[];while(parent){if(isID?parent.id===selector:parent.classList.contains(selector)){parents.push(parent);}parent=parent.parentElement;}return parents;}/** @hidden */function calculateAggregate(type,data,column,context){if(type==='Custom'){return column.customAggregate?column.customAggregate.call(context,data,column):'';}return DataUtil.aggregates[type.toLowerCase()](data,column.field);}/** @hidden *//** @hidden */function _getScrollBarWidth(){if(scrollWidth!==null){return scrollWidth;}var divNode=document.createElement('div');var value=0;divNode.style.cssText='width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;';document.body.appendChild(divNode);value=divNode.offsetWidth-divNode.clientWidth|0;document.body.removeChild(divNode);return scrollWidth=value;}/** @hidden *//** @hidden */function _getRowHeight(element){if(rowHeight!==undefined){return rowHeight;}var table=createElement('table',{className:'e-table',styles:'visibility: hidden'});table.innerHTML='<tr><td class="e-rowcell">A<td></tr>';element.appendChild(table);var rect=table.querySelector('td').getBoundingClientRect();element.removeChild(table);rowHeight=Math.ceil(rect.height);return rowHeight;}/** @hidden */function isEditable(col,type,elem){var row=parentsUntil(elem,'e-row');var isOldRow=!row?true:row&&!row.classList.contains('e-insertedrow');if(type==='beginEdit'&&isOldRow){if(col.isIdentity||col.isPrimaryKey||!col.allowEditing){return false;}return true;}else if(type==='add'&&col.isIdentity&&col.isPrimaryKey){return false;}else{if(isOldRow&&!col.allowEditing&&!col.isIdentity&&!col.isPrimaryKey){return false;}return true;}}/** @hidden */function _isActionPrevent(inst){var dlg=inst.element.querySelector('#'+inst.element.id+'EditConfirm');return inst.editSettings.mode==='Batch'&&inst.element.querySelectorAll('.e-updatedtd').length&&inst.editSettings.showConfirmDialog&&(dlg?dlg.classList.contains('e-popup-close'):true);}/** @hidden */function wrap(elem,action){var clName='e-wrap';elem=elem instanceof Array?elem:[elem];for(var i=0;i<elem.length;i++){action?elem[i].classList.add(clName):elem[i].classList.remove(clName);}}function changeButtonType(target){var elements=[].slice.call(target.querySelectorAll('button'));var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=elements[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var button=_step.value;attributes(button,{type:'button'});}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}/** @hidden */function setFormatter(serviceLocator,column){var fmtr=serviceLocator.getService('valueFormatter');switch(column.type){case'date':column.setFormatter(fmtr.getFormatFunction({type:'date',skeleton:column.format}));column.setParser(fmtr.getParserFunction({type:'date',skeleton:column.format}));break;case'datetime':column.setFormatter(fmtr.getFormatFunction({type:'dateTime',skeleton:column.format}));column.setParser(fmtr.getParserFunction({type:'dateTime',skeleton:column.format}));break;case'number':column.setFormatter(fmtr.getFormatFunction({format:column.format}));column.setParser(fmtr.getParserFunction({format:column.format}));break;}}/** @hidden */function addRemoveActiveClasses(cells,add){for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){args[_key-2]=arguments[_key];}for(var i=0,len=cells.length;i<len;i++){if(add){classList(cells[i],[].concat(args),[]);cells[i].setAttribute('aria-selected','true');}else{classList(cells[i],[],[].concat(args));cells[i].removeAttribute('aria-selected');}}}/** @hidden */function distinctStringValues(result){var temp={};var res=[];for(var i=0;i<result.length;i++){if(!(result[i]in temp)){res.push(result[i].toString());temp[result[i]]=1;}}return res;}/** @hidden */function getFilterMenuPostion(target,dialogObj,grid){var elementVisible=dialogObj.element.style.display;dialogObj.element.style.display='block';var dlgWidth=dialogObj.width;var newpos=void 0;if(!grid.enableRtl){newpos=calculateRelativeBasedPosition(target,dialogObj.element);dialogObj.element.style.display=elementVisible;dialogObj.element.style.top=newpos.top+target.getBoundingClientRect().height-5+'px';var leftPos=newpos.left-dlgWidth+target.clientWidth;if(leftPos<1){dialogObj.element.style.left=dlgWidth+leftPos-16+'px';// right calculation
}else{dialogObj.element.style.left=leftPos+-4+'px';}}else{newpos=calculatePosition(target,'left','bottom');dialogObj.element.style.top=newpos.top+target.getBoundingClientRect().height-35+'px';dialogObj.element.style.display=elementVisible;var _leftPos=newpos.left-dlgWidth+target.clientWidth;if(_leftPos<1){dialogObj.element.style.left=dlgWidth+_leftPos+-16+'px';}else{dialogObj.element.style.left=_leftPos-16+'px';}}}/** @hidden */function getZIndexCalcualtion(args,dialogObj){args.popup.element.style.zIndex=(dialogObj.zIndex+1).toString();}/** @hidden */function toogleCheckbox(elem){var span=elem.querySelector('.e-frame');span.classList.contains('e-check')?classList(span,['e-uncheck'],['e-check']):classList(span,['e-check'],['e-uncheck']);}/** @hidden */function createCboxWithWrap(uid,elem,className){var div=createElement('div',{className:className});div.appendChild(elem);div.setAttribute('uid',uid);return div;}/** @hidden */function removeAddCboxClasses(elem,checked){removeClass([elem],['e-check','e-stop','e-uncheck']);if(checked){elem.classList.add('e-check');}else{elem.classList.add('e-uncheck');}}/**
 * Refresh the Row model's foreign data.
 * @param row - Grid Row model object.
 * @param columns - Foreign columns array.
 * @param data - Updated Row data.
 * @hidden
 */function refreshForeignData(row,columns,data){columns.forEach(function(col){setValue(col.field,getForeignData(col,data),row.foreignKeyData);});row.cells.forEach(function(cell){if(cell.isForeignKey){setValue('foreignKeyData',getValue(cell.column.field,row.foreignKeyData),cell);}});}/**
 * Get the foreign data for the corresponding cell value.
 * @param column - Foreign Key column
 * @param data - Row data.
 * @param lValue - cell value.
 * @param foreignData - foreign data source.
 * @hidden
 */function getForeignData(column,data,lValue,foreignKeyData){var fField=column.foreignKeyField;var key=lValue||valueAccessor(column.field,data,column)||'';var query=new Query();var fdata=foreignKeyData||column.dataSource instanceof DataManager&&column.dataSource.dataSource.offline?column.dataSource.dataSource.json:column.columnData;if(key.getDay){query.where(getDatePredicate({field:fField,operator:'equal',value:key,matchCase:false}));}else{query.where(fField,'==',key,false);}return new DataManager(fdata).executeLocal(query);}/**
 * To use to get the column's object by the foreign key value.
 * @param foreignKeyValue - Defines ForeignKeyValue.
 * @param columns - Array of column object.
 * @hidden
 */function getColumnByForeignKeyValue(foreignKeyValue,columns){var column=void 0;return columns.some(function(col){column=col;return col.foreignKeyValue===foreignKeyValue;})&&column;}/**
 * @hidden
 * @param filterObject - Defines predicate model object
 */function getDatePredicate(filterObject){var datePredicate=void 0;var prevDate=void 0;var nextDate=void 0;var prevObj=extend({},getActualProperties(filterObject));var nextObj=extend({},getActualProperties(filterObject));var value=new Date(filterObject.value);if(filterObject.operator==='equal'||filterObject.operator==='notequal'){prevDate=new Date(value.setHours(0)-1);nextDate=new Date(value.setHours(24));prevObj.value=prevDate;nextObj.value=nextDate;if(filterObject.operator==='equal'){prevObj.operator='greaterthan';nextObj.operator='lessthan';}else if(filterObject.operator==='notequal'){prevObj.operator='lessthanorequal';nextObj.operator='greaterthanorequal';}var predicateSt=new Predicate(prevObj.field,prevObj.operator,prevObj.value,false);var predicateEnd=new Predicate(nextObj.field,nextObj.operator,nextObj.value,false);datePredicate=filterObject.operator==='equal'?predicateSt.and(predicateEnd):predicateSt.or(predicateEnd);}else{if(typeof prevObj.value==='string'){prevObj.value=new Date(prevObj.value);}var predicates=new Predicate(prevObj.field,prevObj.operator,prevObj.value,false);datePredicate=predicates;}filterObject.ejpredicate=datePredicate;return datePredicate;}/**
 * @hidden
 */function renderMovable(ele,frzCols){var mEle=ele.cloneNode(true);for(var i=0;i<frzCols;i++){mEle.removeChild(mEle.children[0]);}for(var _i=frzCols,len=ele.childElementCount;_i<len;_i++){ele.removeChild(ele.children[ele.childElementCount-1]);}return mEle;}/** @hidden *//**
 * @hidden
 */function setStateAndProperties(target,attribute,value,remove$$1){if(remove$$1){target.removeAttribute(attribute);return;}if(target){target.setAttribute(attribute,value);}}/**
 * @private
 */function summaryIterator(aggregates,callback){aggregates.forEach(function(row){row.columns.forEach(function(column){callback(column,row);});});}/**
 * InterSectionObserver - class watch whether it enters the viewport.
 * @hidden
 */return{setters:[function(_syncfusionEj2Base){Browser=_syncfusionEj2Base.Browser;ChildProperty=_syncfusionEj2Base.ChildProperty;Collection=_syncfusionEj2Base.Collection;Complex=_syncfusionEj2Base.Complex;Component=_syncfusionEj2Base.Component;Draggable=_syncfusionEj2Base.Draggable;Droppable=_syncfusionEj2Base.Droppable;Event=_syncfusionEj2Base.Event;EventHandler=_syncfusionEj2Base.EventHandler;Internationalization=_syncfusionEj2Base.Internationalization;KeyboardEvents=_syncfusionEj2Base.KeyboardEvents;L10n=_syncfusionEj2Base.L10n;NotifyPropertyChanges=_syncfusionEj2Base.NotifyPropertyChanges;Property=_syncfusionEj2Base.Property;addClass=_syncfusionEj2Base.addClass;append=_syncfusionEj2Base.append;attributes=_syncfusionEj2Base.attributes;classList=_syncfusionEj2Base.classList;closest=_syncfusionEj2Base.closest;_compile=_syncfusionEj2Base.compile;createElement=_syncfusionEj2Base.createElement;debounce=_syncfusionEj2Base.debounce;detach=_syncfusionEj2Base.detach;extend=_syncfusionEj2Base.extend;formatUnit=_syncfusionEj2Base.formatUnit;getEnumValue=_syncfusionEj2Base.getEnumValue;getValue=_syncfusionEj2Base.getValue;isNullOrUndefined=_syncfusionEj2Base.isNullOrUndefined;isUndefined=_syncfusionEj2Base.isUndefined;matches=_syncfusionEj2Base.matches;merge=_syncfusionEj2Base.merge;print=_syncfusionEj2Base.print;remove=_syncfusionEj2Base.remove;removeClass=_syncfusionEj2Base.removeClass;_setCulture=_syncfusionEj2Base.setCulture;setStyleAttribute=_syncfusionEj2Base.setStyleAttribute;setValue=_syncfusionEj2Base.setValue;},function(_syncfusionEj2Data){DataManager=_syncfusionEj2Data.DataManager;DataUtil=_syncfusionEj2Data.DataUtil;Deferred=_syncfusionEj2Data.Deferred;Predicate=_syncfusionEj2Data.Predicate;Query=_syncfusionEj2Data.Query;UrlAdaptor=_syncfusionEj2Data.UrlAdaptor;},function(_syncfusionEj2Popups){Dialog=_syncfusionEj2Popups.Dialog;Tooltip=_syncfusionEj2Popups.Tooltip;calculatePosition=_syncfusionEj2Popups.calculatePosition;calculateRelativeBasedPosition=_syncfusionEj2Popups.calculateRelativeBasedPosition;createSpinner=_syncfusionEj2Popups.createSpinner;_hideSpinner=_syncfusionEj2Popups.hideSpinner;_showSpinner=_syncfusionEj2Popups.showSpinner;},function(_syncfusionEj2Buttons){Button=_syncfusionEj2Buttons.Button;CheckBox=_syncfusionEj2Buttons.CheckBox;RadioButton=_syncfusionEj2Buttons.RadioButton;createCheckBox=_syncfusionEj2Buttons.createCheckBox;},function(_syncfusionEj2Inputs){FormValidator=_syncfusionEj2Inputs.FormValidator;Input=_syncfusionEj2Inputs.Input;NumericTextBox=_syncfusionEj2Inputs.NumericTextBox;},function(_syncfusionEj2Dropdowns){AutoComplete=_syncfusionEj2Dropdowns.AutoComplete;DropDownList=_syncfusionEj2Dropdowns.DropDownList;},function(_syncfusionEj2Calendars){DatePicker=_syncfusionEj2Calendars.DatePicker;},function(_syncfusionEj2Navigations){ContextMenu=_syncfusionEj2Navigations.ContextMenu;Toolbar=_syncfusionEj2Navigations.Toolbar;},function(_syncfusionEj2ExcelExport){Workbook=_syncfusionEj2ExcelExport.Workbook;},function(_syncfusionEj2PdfExport){PdfBitmap=_syncfusionEj2PdfExport.PdfBitmap;PdfBorders=_syncfusionEj2PdfExport.PdfBorders;PdfColor=_syncfusionEj2PdfExport.PdfColor;PdfCompositeField=_syncfusionEj2PdfExport.PdfCompositeField;PdfDocument=_syncfusionEj2PdfExport.PdfDocument;PdfFontFamily=_syncfusionEj2PdfExport.PdfFontFamily;PdfFontStyle=_syncfusionEj2PdfExport.PdfFontStyle;PdfGrid=_syncfusionEj2PdfExport.PdfGrid;PdfPageCountField=_syncfusionEj2PdfExport.PdfPageCountField;PdfPageNumberField=_syncfusionEj2PdfExport.PdfPageNumberField;PdfPageOrientation=_syncfusionEj2PdfExport.PdfPageOrientation;PdfPageSettings=_syncfusionEj2PdfExport.PdfPageSettings;PdfPageTemplateElement=_syncfusionEj2PdfExport.PdfPageTemplateElement;PdfPen=_syncfusionEj2PdfExport.PdfPen;PdfSolidBrush=_syncfusionEj2PdfExport.PdfSolidBrush;PdfStandardFont=_syncfusionEj2PdfExport.PdfStandardFont;PdfStringFormat=_syncfusionEj2PdfExport.PdfStringFormat;PdfTextAlignment=_syncfusionEj2PdfExport.PdfTextAlignment;PdfVerticalAlignment=_syncfusionEj2PdfExport.PdfVerticalAlignment;PointF=_syncfusionEj2PdfExport.PointF;RectangleF=_syncfusionEj2PdfExport.RectangleF;SizeF=_syncfusionEj2PdfExport.SizeF;}],execute:function(){_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();_get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};_typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();ValueFormatter=function(){function ValueFormatter(cultureName){_classCallCheck(this,ValueFormatter);this.intl=new Internationalization();if(!isNullOrUndefined(cultureName)){this.intl.culture=cultureName;}}_createClass(ValueFormatter,[{key:'getFormatFunction',value:function getFormatFunction(format){if(format.type){return this.intl.getDateFormat(format);}else{return this.intl.getNumberFormat(format);}}},{key:'getParserFunction',value:function getParserFunction(format){if(format.type){return this.intl.getDateParser(format);}else{return this.intl.getNumberParser(format);}}},{key:'fromView',value:function fromView(value,format,type){if(type==='date'||type==='datetime'||type==='number'){return format(value);}else{return value;}}},{key:'toView',value:function toView(value,format){var result=value;if(!isNullOrUndefined(format)&&!isNullOrUndefined(value)){result=format(value);}return result;}},{key:'setCulture',value:function setCulture(cultureName){if(!isNullOrUndefined(cultureName)){_setCulture(cultureName);}}}]);return ValueFormatter;}();_export('Column',Column=function(){function Column(options){var _this=this;_classCallCheck(this,Column);/**
         * If `allowSorting` set to false, then it disables sorting option of a particular column.
         * By default all columns are sortable.
         * @default true
         */this.allowSorting=true;/**
         * If `allowResizing` is set to false, it disables resize option of a particular column.
         * By default all the columns can be resized.
         * @default true
         */this.allowResizing=true;/**
         * If `allowFiltering` set to false, then it disables filtering option and filter bar element of a particular column.
         * By default all columns are filterable.
         * @default true
         */this.allowFiltering=true;/**
         * If `allowGrouping` set to false, then it disables grouping of a particular column.
         * By default all columns are groupable.
         * @default true
         */this.allowGrouping=true;/**
         * If `showColumnMenu` set to false, then it disable the column menu of a particular column.
         * By default column menu will show for all columns
         * @default true
         */this.showColumnMenu=true;/**
         * If `enableGroupByFormat` set to true, then it groups the particular column by formatted values.
         * @default true
         */this.enableGroupByFormat=false;/**
         * If `allowEditing` set to false, then it disables editing of a particular column.
         * By default all columns are editable.
         * @default true
         */this.allowEditing=true;/**
         *  It is used to customize the default filter options for a specific columns.
         * * type -  Specifies the filter type as menu or checkbox.
         * * ui - to render custom component for specific column it has following functions.
         * * ui.create – It is used for creating custom components.
         * * ui.read -  It is used for read the value from the component.
         * * ui.write - It is used to apply component model as dynamically.
         * {% codeBlock src="grid/filter-menu-api/index.ts" %}{% endcodeBlock %}
         *
         * > Check the [`Filter UI`](./filtering.html#custom-component-in-filter-menu) for its customization.
         *  @default null
         */this.filter={};/**
         * If `showInColumnChooser` set to false, then hide the particular column in column chooser.
         *  By default all columns are displayed in column Chooser.
         * @default true
         */this.showInColumnChooser=true;/**
         * Defines the `IEditCell` object to customize default edit cell.
         * @default {}
         */this.edit={};this.sortDirection='Descending';merge(this,options);this.uid=getUid('grid-column');var valueFormatter=new ValueFormatter();if(options.format&&(options.format.skeleton||options.format.format)){this.setFormatter(valueFormatter.getFormatFunction(options.format));this.setParser(valueFormatter.getParserFunction(options.format));}if(!this.field){this.allowFiltering=false;this.allowGrouping=false;this.allowSorting=false;}if(this.commands&&!this.textAlign){this.textAlign='Right';}if(this.template||this.commandsTemplate){this.templateFn=templateCompiler(this.template||this.commandsTemplate);}if(this.filter.itemTemplate){this.fltrTemplateFn=templateCompiler(this.filter.itemTemplate);}if(this.isForeignColumn()&&isNullOrUndefined(this.editType)){this.editType='dropdownedit';this.edit.params={dataSource:this.dataSource,query:new Query(),fields:{value:this.foreignKeyField||this.field,text:this.foreignKeyValue}};}if(this.sortComparer){var a=this.sortComparer;this.sortComparer=function comparer(x,y){if(this.sortDirection==='Descending'){var z=x;x=y;y=z;}return a(x,y);};}if(!this.sortComparer&&this.isForeignColumn()){this.sortComparer=function(x,y){x=getValue(_this.foreignKeyValue,getForeignData(_this,{},x)[0]);y=getValue(_this.foreignKeyValue,getForeignData(_this,{},y)[0]);return _this.sortDirection==='Descending'?DataUtil.fnDescending(x,y):DataUtil.fnAscending(x,y);};}}/** @hidden */_createClass(Column,[{key:'getSortDirection',value:function getSortDirection(){return this.sortDirection;}},{key:'setSortDirection',value:function setSortDirection(direction){this.sortDirection=direction;}},{key:'setProperties',value:function setProperties(column){//Angular two way binding
var keys=Object.keys(column);for(var i=0;i<keys.length;i++){this[keys[i]]=column[keys[i]];}}},{key:'isForeignColumn',value:function isForeignColumn(){return!!(this.dataSource&&this.foreignKeyValue);}},{key:'getFormatter',value:function getFormatter(){return this.formatFn;}},{key:'setFormatter',value:function setFormatter(value){this.formatFn=value;}},{key:'getParser',value:function getParser(){return this.parserFn;}},{key:'setParser',value:function setParser(value){this.parserFn=value;}},{key:'getColumnTemplate',value:function getColumnTemplate(){return this.templateFn;}},{key:'getFilterItemTemplate',value:function getFilterItemTemplate(){return this.fltrTemplateFn;}},{key:'getDomSetter',value:function getDomSetter(){return this.disableHtmlEncode?'textContent':'innerHTML';}}]);return Column;}());uid=0;scrollWidth=null;rowHeight=void 0;_export('created',created='create');_export('destroyed',destroyed='destroy');_export('load',load='load');_export('rowDataBound',rowDataBound='rowDataBound');_export('queryCellInfo',queryCellInfo='queryCellInfo');_export('actionBegin',actionBegin='actionBegin');_export('actionComplete',actionComplete='actionComplete');_export('actionFailure',actionFailure='actionFailure');_export('dataBound',dataBound='dataBound');_export('rowSelecting',rowSelecting='rowSelecting');_export('rowSelected',rowSelected='rowSelected');_export('rowDeselecting',rowDeselecting='rowDeselecting');_export('rowDeselected',rowDeselected='rowDeselected');_export('cellSelecting',cellSelecting='cellSelecting');_export('cellSelected',cellSelected='cellSelected');_export('cellDeselecting',cellDeselecting='cellDeselecting');_export('cellDeselected',cellDeselected='cellDeselected');_export('columnDragStart',columnDragStart='columnDragStart');_export('columnDrag',columnDrag='columnDrag');_export('columnDrop',columnDrop='columnDrop');_export('rowDragStart',rowDragStart='rowDragStart');_export('rowDrag',rowDrag='rowDrag');_export('rowDrop',rowDrop='rowDrop');_export('beforePrint',beforePrint='beforePrint');_export('printComplete',printComplete='printComplete');_export('detailDataBound',detailDataBound='detailDataBound');_export('toolbarClick',toolbarClick='toolbarClick');_export('batchAdd',batchAdd='batchAdd');_export('batchCancel',batchCancel='batchCancel');_export('batchDelete',batchDelete='batchDelete');_export('beforeBatchAdd',beforeBatchAdd='beforeBatchAdd');_export('beforeBatchDelete',beforeBatchDelete='beforeBatchDelete');_export('beforeBatchSave',beforeBatchSave='beforeBatchSave');_export('beginEdit',beginEdit='beginEdit');_export('cellEdit',cellEdit='cellEdit');_export('cellSave',cellSave='cellSave');_export('endAdd',endAdd='endAdd');_export('endDelete',endDelete='endDelete');_export('endEdit',endEdit='endEdit');_export('recordDoubleClick',recordDoubleClick='recordDoubleClick');_export('recordClick',recordClick='recordClick');_export('beforeDataBound',beforeDataBound='beforeDataBound');_export('beforeOpenColumnChooser',beforeOpenColumnChooser='beforeOpenColumnChooser');_export('resizeStart',_resizeStart='resizeStart');_export('onResize',onResize='resizing');_export('resizeStop',resizeStop='resizeStop');_export('checkBoxChange',checkBoxChange='checkBoxChange');_export('beforeCopy',beforeCopy='beforeCopy');_export('filterChoiceRequest',filterChoiceRequest='filterchoicerequest');_export('filterAfterOpen',filterAfterOpen='filterafteropen');_export('filterBeforeOpen',filterBeforeOpen='filterbeforeopen');_export('initialLoad',initialLoad='initial-load');_export('initialEnd',initialEnd='initial-end');_export('dataReady',dataReady='data-ready');_export('contentReady',contentReady='content-ready');_export('uiUpdate',uiUpdate='ui-update');_export('onEmpty',onEmpty='on-empty');_export('inBoundModelChanged',inBoundModelChanged='inbound-model-changed');_export('modelChanged',modelChanged='model-changed');_export('colGroupRefresh',colGroupRefresh='colgroup-refresh');_export('headerRefreshed',headerRefreshed='header-refreshed');_export('pageBegin',pageBegin='paging-begin');_export('pageComplete',pageComplete='paging-complete');_export('sortBegin',sortBegin='sorting-begin');_export('sortComplete',sortComplete='sorting-complete');_export('filterBegin',filterBegin='filtering-begin');_export('filterComplete',filterComplete='filtering-complete');_export('searchBegin',searchBegin='searching-begin');_export('searchComplete',searchComplete='searching-complete');_export('reorderBegin',reorderBegin='reorder-begin');_export('reorderComplete',reorderComplete='reorder-complete');_export('rowDragAndDropBegin',rowDragAndDropBegin='rowdraganddrop-begin');_export('rowDragAndDropComplete',rowDragAndDropComplete='rowdraganddrop-complete');_export('groupBegin',groupBegin='grouping-begin');_export('groupComplete',groupComplete='grouping-complete');_export('ungroupBegin',ungroupBegin='ungrouping-begin');_export('ungroupComplete',ungroupComplete='ungrouping-complete');_export('rowSelectionBegin',rowSelectionBegin='rowselecting');_export('rowSelectionComplete',rowSelectionComplete='rowselected');_export('columnSelectionBegin',columnSelectionBegin='columnselecting');_export('columnSelectionComplete',columnSelectionComplete='columnselected');_export('cellSelectionBegin',cellSelectionBegin='cellselecting');_export('cellSelectionComplete',cellSelectionComplete='cellselected');_export('beforeCellFocused',beforeCellFocused='beforecellfocused');_export('cellFocused',cellFocused='cellfocused');_export('keyPressed',keyPressed='key-pressed');_export('click',click='click');_export('destroy',_destroy='destroy');_export('columnVisibilityChanged',columnVisibilityChanged='column-visible-changed');_export('scroll',scroll='scroll');_export('columnWidthChanged',columnWidthChanged='column-width-changed');_export('columnPositionChanged',columnPositionChanged='column-position-changed');_export('rowDragAndDrop',rowDragAndDrop='row-drag-and-drop');_export('rowsAdded',rowsAdded='rows-added');_export('rowsRemoved',rowsRemoved='rows-removed');_export('columnDragStop',columnDragStop='column-drag-stop');_export('headerDrop',headerDrop='header-drop');_export('dataSourceModified',dataSourceModified='datasource-modified');_export('refreshComplete',refreshComplete='refresh-complete');_export('refreshVirtualBlock',refreshVirtualBlock='refresh-virtual-block');_export('dblclick',dblclick='dblclick');_export('toolbarRefresh',toolbarRefresh='toolbar-refresh');_export('bulkSave',bulkSave='bulk-save');_export('autoCol',autoCol='auto-col');_export('tooltipDestroy',tooltipDestroy='tooltip-destroy');_export('updateData',updateData='update-data');_export('editBegin',editBegin='edit-begin');_export('editComplete',editComplete='edit-complete');_export('addBegin',addBegin='add-begin');_export('addComplete',addComplete='add-complete');_export('saveComplete',saveComplete='save-complete');_export('deleteBegin',deleteBegin='delete-begin');_export('deleteComplete',deleteComplete='delete-complete');_export('preventBatch',preventBatch='prevent-batch');_export('dialogDestroy',dialogDestroy='dialog-destroy');_export('crudAction',crudAction='crud-Action');_export('addDeleteAction',addDeleteAction='add-delete-Action');_export('destroyForm',destroyForm='destroy-form');_export('doubleTap',doubleTap='double-tap');_export('beforeExcelExport',beforeExcelExport='beforeExcelExport');_export('excelExportComplete',excelExportComplete='excelExportComplete');_export('excelQueryCellInfo',excelQueryCellInfo='excelQueryCellInfo');_export('beforePdfExport',beforePdfExport='beforePdfExport');_export('pdfExportComplete',pdfExportComplete='pdfExportComplete');_export('pdfQueryCellInfo',pdfQueryCellInfo='pdfQueryCellInfo');_export('accessPredicate',accessPredicate='access-predicate');_export('contextMenuClick',contextMenuClick='contextMenuClick');_export('freezeRender',freezeRender='freezerender');_export('freezeRefresh',freezeRefresh='freezerefresh');_export('contextMenuOpen',contextMenuOpen='contextMenuOpen');_export('columnMenuClick',columnMenuClick='columnMenuClick');_export('columnMenuOpen',columnMenuOpen='columnMenuOpen');_export('filterOpen',filterOpen='filterOpen');_export('filterDialogCreated',filterDialogCreated='filterDialogCreated');_export('filterMenuClose',filterMenuClose='filter-menu-close');_export('initForeignKeyColumn',initForeignKeyColumn='initForeignKeyColumn');_export('getForeignKeyData',getForeignKeyData='getForeignKeyData');_export('generateQuery',generateQuery='generateQuery');_export('showEmptyGrid',showEmptyGrid='showEmptyGrid');_export('foreignKeyData',foreignKeyData='foreignKeyData');_export('dataStateChange',dataStateChange='dataStateChange');_export('dataSourceChanged',dataSourceChanged='dataSourceChanged');_export('rtlUpdated',rtlUpdated='rtl-updated');(function(CellType){/**  Defines CellType as Data */CellType[CellType["Data"]=0]="Data";/**  Defines CellType as Header */CellType[CellType["Header"]=1]="Header";/**  Defines CellType as Summary */CellType[CellType["Summary"]=2]="Summary";/**  Defines CellType as GroupSummary */CellType[CellType["GroupSummary"]=3]="GroupSummary";/**  Defines CellType as CaptionSummary */CellType[CellType["CaptionSummary"]=4]="CaptionSummary";/**  Defines CellType as Filter */CellType[CellType["Filter"]=5]="Filter";/**  Defines CellType as Indent */CellType[CellType["Indent"]=6]="Indent";/**  Defines CellType as GroupCaption */CellType[CellType["GroupCaption"]=7]="GroupCaption";/**  Defines CellType as GroupCaptionEmpty */CellType[CellType["GroupCaptionEmpty"]=8]="GroupCaptionEmpty";/**  Defines CellType as Expand */CellType[CellType["Expand"]=9]="Expand";/**  Defines CellType as HeaderIndent */CellType[CellType["HeaderIndent"]=10]="HeaderIndent";/**  Defines CellType as StackedHeader */CellType[CellType["StackedHeader"]=11]="StackedHeader";/**  Defines CellType as DetailHeader */CellType[CellType["DetailHeader"]=12]="DetailHeader";/**  Defines CellType as DetailExpand */CellType[CellType["DetailExpand"]=13]="DetailExpand";/**  Defines CellType as CommandColumn */CellType[CellType["CommandColumn"]=14]="CommandColumn";})(CellType||_export('CellType',CellType={}));/**
 * Defines types of Render
 * @hidden
 */(function(RenderType){/**  Defines RenderType as Header */RenderType[RenderType["Header"]=0]="Header";/**  Defines RenderType as Content */RenderType[RenderType["Content"]=1]="Content";/**  Defines RenderType as Summary */RenderType[RenderType["Summary"]=2]="Summary";})(RenderType||_export('RenderType',RenderType={}));/**
 * Defines Predefined toolbar items.
 * @hidden
 */(function(ToolbarItem){ToolbarItem[ToolbarItem["Add"]=0]="Add";ToolbarItem[ToolbarItem["Edit"]=1]="Edit";ToolbarItem[ToolbarItem["Update"]=2]="Update";ToolbarItem[ToolbarItem["Delete"]=3]="Delete";ToolbarItem[ToolbarItem["Cancel"]=4]="Cancel";ToolbarItem[ToolbarItem["Print"]=5]="Print";ToolbarItem[ToolbarItem["Search"]=6]="Search";ToolbarItem[ToolbarItem["ColumnChooser"]=7]="ColumnChooser";ToolbarItem[ToolbarItem["PdfExport"]=8]="PdfExport";ToolbarItem[ToolbarItem["ExcelExport"]=9]="ExcelExport";ToolbarItem[ToolbarItem["CsvExport"]=10]="CsvExport";ToolbarItem[ToolbarItem["WordExport"]=11]="WordExport";})(ToolbarItem||_export('ToolbarItem',ToolbarItem={}));/* tslint:disable-next-line:max-line-length *//**
 * @hidden
 * `CheckBoxFilter` module is used to handle filtering action.
 */_export('CheckBoxFilter',CheckBoxFilter=function(){/**
     * Constructor for checkbox filtering module
     * @hidden
     */function CheckBoxFilter(parent,filterSettings,serviceLocator){_classCallCheck(this,CheckBoxFilter);this.existingPredicate={};this.filterState=true;this.defaultConstants={Search:'Search',OK:'OK',Cancel:'Cancel',Filter:'Filter',Clear:'Clear',SelectAll:'Select All',Blanks:'Blanks',True:'True',False:'False',NoResult:'No Matches Found'};this.values={};this.cBoxTrue=createCheckBox(false,{checked:true,label:' '});this.cBoxFalse=createCheckBox(false,{checked:false,label:' '});this.parent=parent;this.id=this.parent.element.id;this.serviceLocator=serviceLocator;this.filterSettings=filterSettings;this.valueFormatter=new ValueFormatter(this.parent.locale);this.initLocale(this.defaultConstants);this.cBoxTrue.insertBefore(createElement('input',{className:'e-chk-hidden',attrs:{type:'checkbox'}}),this.cBoxTrue.firstChild);this.cBoxFalse.insertBefore(createElement('input',{className:'e-chk-hidden',attrs:{'type':'checkbox'}}),this.cBoxFalse.firstChild);this.cBoxFalse.querySelector('.e-frame').classList.add('e-uncheck');if(this.parent.enableRtl){addClass([this.cBoxTrue,this.cBoxFalse],['e-rtl']);}}_createClass(CheckBoxFilter,[{key:'initLocale',value:function initLocale(constants){this.localeObj=new L10n(this.getModuleName(),this.defaultConstants,this.parent.locale||'en-US');}},{key:'destroy',value:function destroy(){this.closeDialog();}},{key:'wireEvents',value:function wireEvents(){EventHandler.add(this.dlg,'click',this.clickHandler,this);EventHandler.add(this.dlg.querySelector('.e-searchinput'),'keyup',this.searchBoxKeyUp,this);}},{key:'unWireEvents',value:function unWireEvents(){EventHandler.remove(this.dlg,'click',this.clickHandler);var elem=this.dlg.querySelector('.e-searchinput');if(elem){EventHandler.remove(elem,'keyup',this.searchBoxKeyUp);}}},{key:'searchBoxClick',value:function searchBoxClick(e){var target=e.target;if(target.classList.contains('e-searchclear')){this.sInput.value='';this.refreshCheckboxes();this.updateSearchIcon();this.sInput.focus();}}},{key:'searchBoxKeyUp',value:function searchBoxKeyUp(e){this.refreshCheckboxes();this.updateSearchIcon();}},{key:'updateSearchIcon',value:function updateSearchIcon(){if(this.sInput.value.length){classList(this.sIcon,['e-chkcancel-icon'],['e-search-icon']);}else{classList(this.sIcon,['e-search-icon'],['e-chkcancel-icon']);}}},{key:'getLocalizedLabel',value:function getLocalizedLabel(key){return this.localeObj.getConstant(key);}},{key:'updateDataSource',value:function updateDataSource(){var dataSource=this.options.dataSource;if(!(dataSource instanceof DataManager)){for(var i=0;i<dataSource.length;i++){if((typeof dataSource==='undefined'?'undefined':_typeof(dataSource))!=='object'){var obj={};obj[this.options.field]=dataSource[i];dataSource[i]=obj;}}}}},{key:'updateModel',value:function updateModel(options){this.options=options;this.existingPredicate=options.actualPredicate||{};this.options.dataSource=options.dataSource;this.updateDataSource();this.options.type=options.type||'string';this.options.format=options.format||'';this.options.filteredColumns=options.filteredColumns||this.parent.filterSettings.columns;this.options.sortedColumns=options.sortedColumns||this.parent.sortSettings.columns;this.options.query=options.query||new Query();this.options.allowCaseSensitive=options.allowCaseSensitive||false;this.values={};this.isFiltered=options.filteredColumns.length;extend(this.defaultConstants,options.localizedStrings);}},{key:'getAndSetChkElem',value:function getAndSetChkElem(options){this.dlg=createElement('div',{id:this.id+this.options.type+'_excelDlg',className:'e-checkboxfilter e-filter-popup'});this.sBox=createElement('div',{className:'e-searchcontainer'});if(!options.hideSearchbox){this.sInput=createElement('input',{id:this.id+'_SearchBox',className:'e-searchinput'});this.sIcon=createElement('span',{className:'e-searchclear e-search-icon e-icons e-input-group-icon',attrs:{type:'text',placeholder:this.getLocalizedLabel('Search')}});this.searchBox=createElement('span',{className:'e-searchbox e-fields'});this.searchBox.appendChild(this.sInput);this.sBox.appendChild(this.searchBox);Input.createInput({element:this.sInput,floatLabelType:'Never',properties:{placeholder:this.getLocalizedLabel('Search')}});this.searchBox.querySelector('.e-input-group').appendChild(this.sIcon);}this.spinner=createElement('div',{className:'e-spinner'});//for spinner
this.cBox=createElement('div',{id:this.id+this.options.type+'_CheckBoxList',className:'e-checkboxlist e-fields'});this.spinner.appendChild(this.cBox);this.sBox.appendChild(this.spinner);return this.sBox;}},{key:'showDialog',value:function showDialog(options){var args={requestType:filterBeforeOpen,filterModel:this,columnName:this.options.field,columnType:this.options.type,cancel:false};this.parent.trigger(actionBegin,args);if(args.cancel){return;}this.dialogObj=new Dialog({visible:false,content:this.sBox,close:this.closeDialog.bind(this),width:!isNullOrUndefined(parentsUntil(options.target,'e-bigger'))||this.parent.element.classList.contains('e-device')?260:255,target:this.parent.element,animationSettings:{effect:'None'},buttons:[{click:this.btnClick.bind(this),buttonModel:{content:this.getLocalizedLabel(this.isExcel?'OK':'Filter'),cssClass:'e-primary',isPrimary:true}},{click:this.btnClick.bind(this),buttonModel:{cssClass:'e-flat',content:this.getLocalizedLabel(this.isExcel?'Cancel':'Clear')}}],created:this.dialogCreated.bind(this),open:this.dialogOpen.bind(this)});this.dialogObj.appendTo(this.dlg);this.dialogObj.element.style.maxHeight='800px';this.dialogObj.show();this.wireEvents();createSpinner({target:this.spinner});_showSpinner(this.spinner);this.getAllData();}},{key:'dialogCreated',value:function dialogCreated(e){if(!Browser.isDevice){getFilterMenuPostion(this.options.target,this.dialogObj,this.parent);}else{this.dialogObj.position={X:'center',Y:'center'};}this.parent.notify(filterDialogCreated,e);}},{key:'openDialog',value:function openDialog(options){this.updateModel(options);this.getAndSetChkElem(options);this.showDialog(options);}},{key:'closeDialog',value:function closeDialog(){if(this.dialogObj&&!this.dialogObj.isDestroyed){this.parent.notify(filterMenuClose,{field:this.options.field});this.dialogObj.destroy();this.unWireEvents();remove(this.dlg);this.dlg=null;}}},{key:'clearFilter',value:function clearFilter(){this.options.handler({action:'clear-filter',field:this.options.field});}},{key:'btnClick',value:function btnClick(e){if(this.filterState){if(e.target.tagName.toLowerCase()==='input'){var args={action:'filtering',filterCollection:{field:this.options.field,operator:this.options.column.type==='date'||this.options.column.type==='datetime'?'equal':'contains',value:e.target.value,matchCase:false,type:this.options.column.type},field:this.options.field};e.target.value?this.options.handler(args):this.closeDialog();}else{var text=e.target.firstChild.textContent.toLowerCase();if(this.getLocalizedLabel(this.isExcel?'OK':'Filter').toLowerCase()===text){this.fltrBtnHandler();}else if(this.getLocalizedLabel('Clear').toLowerCase()===text){this.clearFilter();}}this.closeDialog();}else if(!(e.target.tagName.toLowerCase()==='input')){this.clearFilter();this.closeDialog();}}},{key:'fltrBtnHandler',value:function fltrBtnHandler(){var checked=[].slice.call(this.cBox.querySelectorAll('.e-check:not(.e-selectall)'));var optr='equal';var caseSen=this.options.type==='string'?this.options.allowCaseSensitive:true;var defaults={field:this.options.field,predicate:'or',operator:optr,matchCase:caseSen,ignoreAccent:this.parent.filterSettings.ignoreAccent};var isNotEqual=this.itemsCnt!==checked.length&&this.itemsCnt-checked.length<checked.length;if(isNotEqual){optr='notequal';checked=[].slice.call(this.cBox.querySelectorAll('.e-uncheck:not(.e-selectall)'));defaults.predicate='and';defaults.operator='notequal';}var value=void 0;var fObj=void 0;var coll=[];var searchInput=this.searchBox.querySelector('.e-searchinput');if(checked.length!==this.itemsCnt||searchInput.value&&searchInput.value!==''){for(var i=0;i<checked.length;i++){value=this.values[parentsUntil(checked[i],'e-ftrchk').getAttribute('uid')];fObj=extend({},{value:value},defaults);if(value&&!value.toString().length){fObj.operator=isNotEqual?'notequal':'equal';}coll.push(fObj);}this.initiateFilter(coll);}else{this.clearFilter();}}},{key:'initiateFilter',value:function initiateFilter(fColl){var firstVal=fColl[0];var predicate=void 0;if(!isNullOrUndefined(firstVal)){predicate=firstVal.ejpredicate?firstVal.ejpredicate:new Predicate(firstVal.field,firstVal.operator,firstVal.value,!firstVal.matchCase,firstVal.ignoreAccent);for(var j=1;j<fColl.length;j++){predicate=fColl[j].ejpredicate!==undefined?predicate[fColl[j].predicate](fColl[j].ejpredicate):predicate[fColl[j].predicate](fColl[j].field,fColl[j].operator,fColl[j].value,!fColl[j].matchCase,fColl[j].ignoreAccent);}var args={action:'filtering',filterCollection:fColl,field:this.options.field,ejpredicate:Predicate.or(predicate)};this.options.handler(args);}}},{key:'refreshCheckboxes',value:function refreshCheckboxes(){var val=this.sInput.value;var query=this.options.query.clone();var parsed=this.options.type!=='string'&&parseFloat(val)?parseFloat(val):val;var operator='contains';var matchCase=true;var ignoreAccent=this.parent.filterSettings.ignoreAccent;parsed=parsed===''||parsed===undefined?undefined:parsed;var predicte=void 0;if(this.options.type==='boolean'){if(parsed!==undefined&&this.getLocalizedLabel('True').toLowerCase().indexOf(parsed.toLowerCase())!==-1){parsed='true';}else if(parsed!==undefined&&this.getLocalizedLabel('False').toLowerCase().indexOf(parsed.toLowerCase())!==-1){parsed='false';}}predicte=new Predicate(this.options.field,operator,parsed,matchCase,ignoreAccent);if(this.options.type==='date'||this.options.type==='datetime'){parsed=this.valueFormatter.fromView(val,this.options.parserFn,this.options.type);operator='equal';if(isNullOrUndefined(parsed)&&val.length){return;}predicte=getDatePredicate({field:this.options.field,operator:operator,value:parsed,matchCase:matchCase,ignoreAccent:ignoreAccent});}if(val.length){query.where(predicte);}this.processDataSource(query);}},{key:'getPredicateFromCols',value:function getPredicateFromCols(columns){var predicates=CheckBoxFilter.getPredicate(columns);var predicateList=[];var fPredicate={};var foreignColumn=this.parent.getForeignKeyColumns();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Object.keys(predicates)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var prop=_step2.value;var col=getColumnByForeignKeyValue(prop,foreignColumn);if(col){this.parent.notify(generateQuery,{predicate:fPredicate,column:col});if(fPredicate.predicate.predicates.length){predicateList.push(Predicate.or(fPredicate.predicate.predicates));}}else{predicateList.push(predicates[prop]);}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}return predicateList.length&&Predicate.and(predicateList);}},{key:'getAllData',value:function getAllData(){var _this2=this;var query=new Query();query.requiresCount();//consider take query
this.options.dataSource=this.options.dataSource instanceof DataManager?this.options.dataSource:new DataManager(this.options.dataSource);var allPromise=[];var runArray=[];if(this.options.column.isForeignColumn()){allPromise.push(this.options.column.dataSource.executeQuery(new Query()));runArray.push(function(data){return _this2.foreignKeyData=data;});}allPromise.push(this.options.dataSource.executeQuery(query));runArray.push(this.dataSuccess.bind(this));var i=0;Promise.all(allPromise).then(function(e){e.forEach(function(data){runArray[i++](data.result);});});}},{key:'dataSuccess',value:function dataSuccess(e){this.fullData=e;var query=new Query();if(this.options.filteredColumns.length){var cols=[];for(var i=0;i<this.options.filteredColumns.length;i++){if(!(this.options.filteredColumns[i].field===this.options.field||this.options.filteredColumns[i].field===this.options.foreignKeyValue)){cols.push(this.options.filteredColumns[i]);}}var predicate=this.getPredicateFromCols(cols);if(predicate){query.where(predicate);}}// query.select(this.options.field);
var result=new DataManager(this.fullData).executeLocal(query);var col=this.options.column;var res=CheckBoxFilter.getDistinct(result,this.options.field,col,this.foreignKeyData);this.filteredData=res.records;this.processDataSource(null,true);this.dialogObj.element.querySelector('.e-searchinput').focus();var args={requestType:filterAfterOpen,filterModel:this,columnName:this.options.field,columnType:this.options.type};this.parent.trigger(actionComplete,args);}},{key:'processDataSource',value:function processDataSource(query,isInitial){_showSpinner(this.spinner);query=query?query:this.options.query.clone();query.requiresCount();var args={requestType:filterChoiceRequest,filterModel:this,query:query,dataSource:this.filteredData};this.parent.trigger(actionBegin,args);var result=new DataManager(args.dataSource).executeLocal(args.query);var res=result;this.updateResult();this.createFilterItems(res.result,isInitial);}},{key:'updateResult',value:function updateResult(){this.result={};var predicate=this.getPredicateFromCols(this.options.filteredColumns);var query=new Query();if(predicate){query.where(predicate);}var result=new DataManager(this.fullData).executeLocal(query);var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=result[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var res=_step3.value;this.result[getValue(this.options.field,res)]=true;}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}}},{key:'clickHandler',value:function clickHandler(e){var target=e.target;var elem=parentsUntil(target,'e-checkbox-wrapper');if(parentsUntil(target,'e-searchbox')){this.searchBoxClick(e);}if(elem){var selectAll=elem.querySelector('.e-selectall');if(selectAll){this.updateAllCBoxes(!selectAll.classList.contains('e-check'));}else{toogleCheckbox(elem.parentElement);}this.updateIndeterminatenBtn();elem.querySelector('.e-chk-hidden').focus();}}},{key:'updateAllCBoxes',value:function updateAllCBoxes(checked){var cBoxes=[].slice.call(this.cBox.querySelectorAll('.e-frame'));var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=cBoxes[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var cBox=_step4.value;removeAddCboxClasses(cBox,checked);}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}}},{key:'dialogOpen',value:function dialogOpen(){if(this.parent.element.classList.contains('e-device')){this.dialogObj.element.querySelector('.e-input-group').classList.remove('e-input-focus');this.dialogObj.element.querySelector('.e-btn').focus();}}},{key:'createCheckbox',value:function createCheckbox(value,checked){var elem=checked?this.cBoxTrue.cloneNode(true):this.cBoxFalse.cloneNode(true);var label=elem.querySelector('.e-label');label.innerHTML=!isNullOrUndefined(value)&&value.toString().length?value:this.getLocalizedLabel('Blanks');if(this.options.template){label.innerHTML='';var args={};args[this.options.field]=value;appendChildren(label,this.options.template(args));}return elem;}},{key:'updateIndeterminatenBtn',value:function updateIndeterminatenBtn(){var cnt=this.cBox.children.length-1;var className=[];var elem=this.cBox.querySelector('.e-selectall');var selected=this.cBox.querySelectorAll('.e-check:not(.e-selectall)').length;var btn=this.dlg.querySelector('.e-footer-content').querySelector('.e-btn').ej2_instances[0];btn.disabled=false;if(cnt===selected){className=['e-check'];}else if(selected){className=['e-stop'];}else{className=['e-uncheck'];btn.disabled=true;}this.filterState=!btn.disabled;btn.dataBind();removeClass([elem],['e-check','e-stop','e-uncheck']);addClass([elem],className);}},{key:'createFilterItems',value:function createFilterItems(data,isInitial){var cBoxes=createElement('div');var btn=this.dlg.querySelector('.e-footer-content').querySelector('.e-btn').ej2_instances[0];this.itemsCnt=data.length;if(data.length){var selectAll=createCboxWithWrap(getUid('cbox'),this.createCheckbox(this.getLocalizedLabel('SelectAll'),false),'e-ftrchk');selectAll.querySelector('.e-frame').classList.add('e-selectall');cBoxes.appendChild(selectAll);var predicate=new Predicate('field','equal',this.options.field);if(this.options.foreignKeyValue){predicate=predicate.or('field','equal',this.options.foreignKeyValue);}var isColFiltered=new DataManager(this.options.filteredColumns).executeLocal(new Query().where(predicate)).length;for(var i=0;i<data.length;i++){var _uid=getUid('cbox');this.values[_uid]=getValue('ejValue',data[i]);var value=this.valueFormatter.toView(getValue(this.options.field,data[i]),this.options.formatFn);cBoxes.appendChild(createCboxWithWrap(_uid,this.createCheckbox(value,this.getCheckedState(isColFiltered,this.values[_uid])),'e-ftrchk'));}this.cBox.innerHTML=cBoxes.innerHTML;this.updateIndeterminatenBtn();btn.disabled=false;}else{cBoxes.appendChild(createElement('span',{innerHTML:this.getLocalizedLabel('NoResult')}));this.cBox.innerHTML=cBoxes.innerHTML;btn.disabled=true;}this.filterState=!btn.disabled;btn.dataBind();var args={requestType:filterChoiceRequest,filterModel:this,dataSource:data};this.parent.trigger(actionComplete,args);_hideSpinner(this.spinner);}},{key:'getCheckedState',value:function getCheckedState(isColFiltered,value){if(!this.isFiltered||!isColFiltered){return true;}else{return this.result[value];}}},{key:'getModuleName',value:function getModuleName(){return'checkboxFilter';}}],[{key:'getDistinct',value:function getDistinct(json,field,column,foreignKeyData$$1){var len=json.length;var result=[];var value=void 0;var ejValue='ejValue';var lookup={};var isForeignKey=column&&column.isForeignColumn();while(len--){value=json[len];value=getValue(field,value);//local remote diff, check with mdu           
if(!isNullOrUndefined(value)){if(!(value in lookup)){var obj={};obj[ejValue]=value;lookup[value]=true;value=isForeignKey?getValue(column.foreignKeyValue,getForeignData(column,{},value,foreignKeyData$$1)[0]):value;setValue(field,isNullOrUndefined(value)?null:value,obj);result.push(obj);}}}return DataUtil.group(DataUtil.sort(result,field,DataUtil.fnAscending),'ejValue');}},{key:'getPredicate',value:function getPredicate(columns){var cols=CheckBoxFilter.getDistinct(columns,'field').records;var collection=[];var pred={};for(var i=0;i<cols.length;i++){collection=new DataManager(columns).executeLocal(new Query().where('field','equal',cols[i].field));if(collection.length!==0){pred[cols[i].field]=CheckBoxFilter.generatePredicate(collection);}}return pred;}},{key:'generatePredicate',value:function generatePredicate(cols){var len=cols?cols.length:0;var predicate=void 0;var first=void 0;first=CheckBoxFilter.updateDateFilter(cols[0]);first.ignoreAccent=!isNullOrUndefined(first.ignoreAccent)?first.ignoreAccent:false;if(first.type==='date'||first.type==='datetime'){predicate=getDatePredicate(first);}else{predicate=first.ejpredicate?first.ejpredicate:new Predicate(first.field,first.operator,first.value,!CheckBoxFilter.getCaseValue(first),first.ignoreAccent);}for(var p=1;p<len;p++){cols[p]=CheckBoxFilter.updateDateFilter(cols[p]);if(len>2&&p>1&&cols[p].predicate==='or'){if(cols[p].type==='date'||cols[p].type==='datetime'){predicate.predicates.push(getDatePredicate(cols[p]));}else{predicate.predicates.push(new Predicate(cols[p].field,cols[p].operator,cols[p].value,!CheckBoxFilter.getCaseValue(cols[p]),cols[p].ignoreAccent));}}else{if(cols[p].type==='date'||cols[p].type==='datetime'){predicate=predicate[cols[p].predicate](getDatePredicate(cols[p]),cols[p].ignoreAccent);}else{predicate=cols[p].ejpredicate?predicate[cols[p].predicate](cols[p].ejpredicate):predicate[cols[p].predicate](cols[p].field,cols[p].operator,cols[p].value,CheckBoxFilter.getCaseValue(cols[p]),cols[p].ignoreAccent);}}}return predicate||null;}},{key:'getCaseValue',value:function getCaseValue(filter){if(isNullOrUndefined(filter.matchCase)){return true;}else{return filter.matchCase;}}},{key:'updateDateFilter',value:function updateDateFilter(filter){if(filter.type==='date'||filter.type==='datetime'||filter.value instanceof Date){filter.type=filter.type||'date';}return filter;}}]);return CheckBoxFilter;}());_export('Data',Data=function(){/**
     * Constructor for data module.
     * @hidden
     */function Data(parent,serviceLocator){_classCallCheck(this,Data);this.dataState={isPending:false,resolver:null,group:[]};this.parent=parent;this.serviceLocator=serviceLocator;this.initDataManager();if(this.parent.isDestroyed){return;}this.parent.on(rowsAdded,this.addRows,this);this.parent.on(rowsRemoved,this.removeRows,this);this.parent.on(dataSourceModified,this.initDataManager,this);this.parent.on(_destroy,this.destroy,this);this.parent.on(updateData,this.crudActions,this);this.parent.on(addDeleteAction,this.getData,this);}/**
     * The function used to initialize dataManager and external query
     * @return {void}
     */_createClass(Data,[{key:'initDataManager',value:function initDataManager(){var gObj=this.parent;this.dataManager=gObj.dataSource instanceof DataManager?gObj.dataSource:isNullOrUndefined(gObj.dataSource)?new DataManager():new DataManager(gObj.dataSource);gObj.query=gObj.query instanceof Query?gObj.query:new Query();}},{key:'generateQuery',value:function generateQuery(skipPage){var gObj=this.parent;var query=gObj.query.clone();this.filterQuery(query);this.searchQuery(query);this.aggregateQuery(query);this.sortQuery(query);this.pageQuery(query,skipPage);this.groupQuery(query);return query;}},{key:'aggregateQuery',value:function aggregateQuery(query,isForeign){this.parent.aggregates.forEach(function(row){row.columns.forEach(function(column){var types=column.type instanceof Array?column.type:[column.type];types.forEach(function(type){return query.aggregate(type.toLowerCase(),column.field);});});});return query;}},{key:'pageQuery',value:function pageQuery(query,skipPage){var gObj=this.parent;if((gObj.allowPaging||gObj.enableVirtualization)&&skipPage!==true){gObj.pageSettings.currentPage=Math.max(1,gObj.pageSettings.currentPage);if(gObj.pageSettings.pageCount<=0){gObj.pageSettings.pageCount=8;}if(gObj.pageSettings.pageSize<=0){gObj.pageSettings.pageSize=12;}query.page(gObj.pageSettings.currentPage,gObj.pageSettings.pageSize);}return query;}},{key:'groupQuery',value:function groupQuery(query){var gObj=this.parent;if(gObj.allowGrouping&&gObj.groupSettings.columns.length){var columns=gObj.groupSettings.columns;for(var i=0,len=columns.length;i<len;i++){var column=this.getColumnByField(columns[i]);var isGrpFmt=column.enableGroupByFormat;var format=column.format;if(isGrpFmt){query.group(columns[i],this.formatGroupColumn.bind(this),format);}else{query.group(columns[i],null);}}}return query;}},{key:'sortQuery',value:function sortQuery(query){var gObj=this.parent;if((gObj.allowSorting||gObj.allowGrouping)&&gObj.sortSettings.columns.length){var columns=gObj.sortSettings.columns;var sortGrp=[];for(var i=columns.length-1;i>-1;i--){var col=this.getColumnByField(columns[i].field);col.setSortDirection(columns[i].direction);var fn=col.sortComparer&&!this.isRemote()?col.sortComparer.bind(col):columns[i].direction;if(gObj.groupSettings.columns.indexOf(columns[i].field)===-1){query.sortBy(col.field,fn);}else{sortGrp.push({direction:fn,field:col.field});}}for(var _i2=0,len=sortGrp.length;_i2<len;_i2++){query.sortBy(sortGrp[_i2].field,sortGrp[_i2].direction);}}return query;}},{key:'searchQuery',value:function searchQuery(query){var _this3=this;var sSettings=this.parent.searchSettings;var fields=sSettings.fields.length?sSettings.fields:this.parent.getColumns().map(function(f){return f.field;});var predicateList=[];if(this.parent.searchSettings.key.length){if(this.parent.getForeignKeyColumns().length){fields.forEach(function(columnName){var column=_this3.getColumnByField(columnName);var sQuery=new Query();if(column.isForeignColumn()){predicateList=_this3.fGeneratePredicate(column,predicateList);}else{predicateList.push(new Predicate(column.field,sSettings.operator,sSettings.key,sSettings.ignoreCase,_this3.parent.filterSettings.ignoreAccent));}});query.where(Predicate.or(predicateList));}else{query.search(sSettings.key,fields,sSettings.operator,sSettings.ignoreCase,this.parent.filterSettings.ignoreAccent);}}return query;}},{key:'filterQuery',value:function filterQuery(query,column,skipFoerign){var gObj=this.parent;var predicateList=[];var actualFilter=[];var foreignColumn=this.parent.getForeignKeyColumns();if(gObj.allowFiltering&&gObj.filterSettings.columns.length){var columns=column?column:gObj.filterSettings.columns;var colType={};var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=gObj.columns[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var col=_step5.value;colType[col.field]=col.filter.type?col.filter.type:gObj.filterSettings.type;}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}var checkBoxCols=[];var defaultFltrCols=[];var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=columns[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _col=_step6.value;if(colType[_col.field]==='CheckBox'||colType[_col.field]==='Excel'){checkBoxCols.push(_col);}else{defaultFltrCols.push(_col);}}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}if(checkBoxCols.length){var excelPredicate=CheckBoxFilter.getPredicate(checkBoxCols);var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=Object.keys(excelPredicate)[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var prop=_step7.value;var _col2=getColumnByForeignKeyValue(prop,foreignColumn);if(_col2&&!skipFoerign){predicateList=this.fGeneratePredicate(_col2,predicateList);actualFilter.push(_col2);}else{predicateList.push(excelPredicate[prop]);}}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return();}}finally{if(_didIteratorError7){throw _iteratorError7;}}}}if(defaultFltrCols.length){var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=defaultFltrCols[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var _col3=_step8.value;var _column=this.getColumnByField(_col3.field)||getColumnByForeignKeyValue(_col3.field,this.parent.getForeignKeyColumns());var sType=_column.type;if(getColumnByForeignKeyValue(_col3.field,foreignColumn)&&!skipFoerign){actualFilter.push(_col3);predicateList=this.fGeneratePredicate(_column,predicateList);}else{if(sType!=='date'&&sType!=='datetime'){predicateList.push(new Predicate(_col3.field,_col3.operator,_col3.value,!_col3.matchCase,this.parent.filterSettings.ignoreAccent));}else{predicateList.push(getDatePredicate(_col3));}}}}catch(err){_didIteratorError8=true;_iteratorError8=err;}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return();}}finally{if(_didIteratorError8){throw _iteratorError8;}}}}if(predicateList.length){query.where(Predicate.and(predicateList));}else{this.parent.notify(showEmptyGrid,{});}}return query;}},{key:'fGeneratePredicate',value:function fGeneratePredicate(col,predicateList){var fPredicate={};if(col){this.parent.notify(generateQuery,{predicate:fPredicate,column:col});if(fPredicate.predicate.predicates.length){predicateList.push(fPredicate.predicate);}}return predicateList;}},{key:'getData',value:function getData(){var _this4=this;var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{requestType:''};var query=arguments[1];var key=this.getKey(args.foreignKeyData&&Object.keys(args.foreignKeyData).length?args.foreignKeyData:this.parent.getPrimaryKeyFieldNames());if(this.parent.dataSource&&'result'in this.parent.dataSource){var def=this.eventPromise(args,query,key);return def.promise;}else{switch(args.requestType){case'delete':query=query?query:this.generateQuery();this.dataManager.remove(key,args.data[0],null,query);break;case'save':query=query?query:this.generateQuery();args.index=isNullOrUndefined(args.index)?0:args.index;this.dataManager.insert(args.data,null,query,args.index);break;}if(this.dataManager.ready){var deferred=new Deferred();var ready=this.dataManager.ready;ready.then(function(e){_this4.dataManager.executeQuery(query).then(function(result){deferred.resolve(result);});}).catch(function(e){deferred.reject(e);});return deferred.promise;}else{return this.dataManager.executeQuery(query);}}}},{key:'formatGroupColumn',value:function formatGroupColumn(value,field){var gObj=this.parent;var serviceLocator=this.serviceLocator;var column=this.getColumnByField(field);var date=value;if(!column.type){column.type=date.getDay?date.getHours()>0||date.getMinutes()>0||date.getSeconds()>0||date.getMilliseconds()>0?'datetime':'date':typeof value==='undefined'?'undefined':_typeof(value);}if(isNullOrUndefined(column.getFormatter())){setFormatter(serviceLocator,column);}var formatVal=ValueFormatter.prototype.toView(value,column.getFormatter());return formatVal;}},{key:'crudActions',value:function crudActions(args){var query=this.generateQuery();var promise=null;var pr='promise';var key=this.getKey(args.foreignKeyData&&Object.keys(args.foreignKeyData).length?args.foreignKeyData:this.parent.getPrimaryKeyFieldNames());if(this.parent.dataSource&&'result'in this.parent.dataSource){this.eventPromise(args,query,key);}switch(args.requestType){case'save':promise=this.dataManager.update(key,args.data,null,this.generateQuery());break;}args[pr]=promise;this.parent.notify(crudAction,args);}},{key:'saveChanges',value:function saveChanges(changes,key){var query=this.generateQuery().requiresCount();if('result'in this.parent.dataSource){var state=void 0;state=this.getStateEventArgument(query);var deff=new Deferred();var args={requestType:'batchsave',changes:changes,key:key,query:query,endEdit:deff.resolve};this.setState({isPending:true,resolver:deff.resolve});this.parent.trigger(dataSourceChanged,args);return deff.promise;}else{var promise=this.dataManager.saveChanges(changes,key,null,this.generateQuery().requiresCount());return promise;}}},{key:'getKey',value:function getKey(keys){if(keys&&keys.length){return keys[0];}return undefined;}},{key:'isRemote',value:function isRemote(){return this.dataManager.dataSource.offline!==true&&this.dataManager.dataSource.url!==undefined;}},{key:'addRows',value:function addRows(e){for(var i=e.records.length;i>0;i--){this.dataManager.dataSource.json.splice(e.toIndex,0,e.records[i-1]);}}},{key:'removeRows',value:function removeRows(e){var json=this.dataManager.dataSource.json;this.dataManager.dataSource.json=json.filter(function(value,index){return e.records.indexOf(value)===-1;});}},{key:'getColumnByField',value:function getColumnByField(field){var col=void 0;return this.parent.columnModel.some(function(column){col=column;return column.field===field;})&&col;}},{key:'destroy',value:function destroy(){if(this.parent.isDestroyed){return;}this.parent.off(rowsAdded,this.addRows);this.parent.off(rowsRemoved,this.removeRows);this.parent.off(dataSourceModified,this.initDataManager);this.parent.off(dataSourceModified,this.destroy);this.parent.off(updateData,this.crudActions);this.parent.off(addDeleteAction,this.getData);}},{key:'getState',value:function getState(){return this.dataState;}},{key:'setState',value:function setState(state){return this.dataState=state;}},{key:'getStateEventArgument',value:function getStateEventArgument(query){var adaptr=new UrlAdaptor();var dm=new DataManager({url:'',adaptor:new UrlAdaptor()});var state=adaptr.processQuery(dm,query);return JSON.parse(state.data);}},{key:'eventPromise',value:function eventPromise(args,query,key){var _this5=this;var state=void 0;var dataArgs=args;state=this.getStateEventArgument(query);var def=new Deferred();var deff=new Deferred();if(args.requestType!==undefined&&args.requestType!=='refresh'){state.action=args;if(args.requestType==='save'||args.requestType==='delete'){var editArgs=args;editArgs.key=key;editArgs.state=state;this.setState({isPending:true,resolver:deff.resolve});dataArgs.endEdit=deff.resolve;this.parent.trigger(dataSourceChanged,editArgs);deff.promise.then(function(e){_this5.setState({isPending:true,resolver:def.resolve,group:state.group});_this5.parent.trigger(dataStateChange,state);});}else{this.setState({isPending:true,resolver:def.resolve,group:state.group});this.parent.trigger(dataStateChange,state);}}else{this.setState({});def.resolve(this.parent.dataSource);}return def;}}]);return Data;}());Row=function(){function Row(options){_classCallCheck(this,Row);merge(this,options);}_createClass(Row,[{key:'clone',value:function clone(){var row=new Row({});merge(row,this);row.cells=this.cells.map(function(cell){return cell.clone();});return row;}}]);return Row;}();Cell=function(){function Cell(options){_classCallCheck(this,Cell);this.isSpanned=false;merge(this,options);}_createClass(Cell,[{key:'clone',value:function clone(){var cell=new Cell({});merge(cell,this);return cell;}}]);return Cell;}();CellMergeRender=function(){function CellMergeRender(serviceLocator,parent){_classCallCheck(this,CellMergeRender);this.serviceLocator=serviceLocator;this.parent=parent;}_createClass(CellMergeRender,[{key:'render',value:function render(cellArgs,row,i,td){var cellRendererFact=this.serviceLocator.getService('cellRendererFactory');var cellRenderer=cellRendererFact.getCellRenderer(row.cells[i].cellType||CellType.Data);var span=row.cells[i].cellSpan?row.cells[i].cellSpan:cellArgs.colSpan+i<=row.cells.length?cellArgs.colSpan:row.cells.length-i;var visible=0;for(var j=i+1;j<i+span&&j<row.cells.length;j++){if(row.cells[j].visible===false){visible++;}else{row.cells[j].isSpanned=true;}}if(visible>0){for(var _j=i+span;_j<i+span+visible&&_j<row.cells.length;_j++){row.cells[_j].isSpanned=true;}if(i+span+visible>=row.cells.length){span-=i+span+visible-row.cells.length;}}if(row.cells[i].cellSpan){row.data[cellArgs.column.field]=row.cells[i].spanText;td=cellRenderer.render(row.cells[i],row.data,{'index':!isNullOrUndefined(row.index)?row.index.toString():''});}if(span>1){attributes(td,{'colSpan':span.toString(),'aria-colSpan':span.toString()});}if(this.parent.enableColumnVirtualization&&!row.cells[i].cellSpan&&!this.containsKey(cellArgs.column.field,cellArgs.data[cellArgs.column.field])){this.backupMergeCells(cellArgs.column.field,cellArgs.data[cellArgs.column.field],cellArgs.colSpan);}return td;}},{key:'backupMergeCells',value:function backupMergeCells(fName,data,span){this.setMergeCells(this.generteKey(fName,data),span);}},{key:'generteKey',value:function generteKey(fname,data){return fname+'__'+data.toString();}},{key:'splitKey',value:function splitKey(key){return key.split('__');}},{key:'containsKey',value:function containsKey(fname,data){return this.getMergeCells().hasOwnProperty(this.generteKey(fname,data));}},{key:'getMergeCells',value:function getMergeCells(){return this.parent.mergeCells;}},{key:'setMergeCells',value:function setMergeCells(key,span){this.parent.mergeCells[key]=span;}},{key:'updateVirtualCells',value:function updateVirtualCells(rows){var mCells=this.getMergeCells();var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=Object.keys(mCells)[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var key=_step9.value;var value=mCells[key];var merge$$1=this.splitKey(key);var columnIndex=this.getIndexFromAllColumns(merge$$1[0]);var vColumnIndices=this.parent.getColumnIndexesInView();var span=value-(vColumnIndices[0]-columnIndex);if(columnIndex<vColumnIndices[0]&&span>1){var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=rows[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var row=_step10.value;if(row.data[merge$$1[0]].toString()===merge$$1[1].toString()){row.cells[0].cellSpan=span;row.cells[0].spanText=merge$$1[1];break;}}}catch(err){_didIteratorError10=true;_iteratorError10=err;}finally{try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return();}}finally{if(_didIteratorError10){throw _iteratorError10;}}}}}}catch(err){_didIteratorError9=true;_iteratorError9=err;}finally{try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return();}}finally{if(_didIteratorError9){throw _iteratorError9;}}}return rows;}},{key:'getIndexFromAllColumns',value:function getIndexFromAllColumns(field){var index=iterateArrayOrObject(this.parent.getVisibleColumns(),function(item,index){if(item.field===field){return index;}return undefined;})[0];return index;}}]);return CellMergeRender;}();_export('RowRenderer',RowRenderer=function(){function RowRenderer(serviceLocator,cellType,parent){_classCallCheck(this,RowRenderer);this.element=createElement('tr',{attrs:{role:'row'}});this.cellType=cellType;this.serviceLocator=serviceLocator;this.parent=parent;}/**
     * Function to render the row content based on Column[] and data.
     * @param  {Column[]} columns
     * @param  {Object} data?
     * @param  {{[x:string]:Object}} attributes?
     * @param  {string} rowTemplate?
     */_createClass(RowRenderer,[{key:'render',value:function render(row,columns,attributes$$1,rowTemplate,cloneNode){return this.refreshRow(row,columns,attributes$$1,rowTemplate,cloneNode);}},{key:'refresh',value:function refresh(row,columns,isChanged,attributes$$1,rowTemplate){if(isChanged){row.data=extend({},row.changes);this.refreshMergeCells(row);}var node=this.parent.element.querySelector('[data-uid='+row.uid+']');var tr=this.refreshRow(row,columns,attributes$$1,rowTemplate);var cells=[].slice.call(tr.cells);node.innerHTML='';var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=cells[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var cell=_step11.value;node.appendChild(cell);}}catch(err){_didIteratorError11=true;_iteratorError11=err;}finally{try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return();}}finally{if(_didIteratorError11){throw _iteratorError11;}}}}},{key:'refreshRow',value:function refreshRow(row,columns,attributes$$1,rowTemplate,cloneNode){var tr=!isNullOrUndefined(cloneNode)?cloneNode:this.element.cloneNode();var rowArgs={data:row.data};var cellArgs={data:row.data};var attrCopy=extend({},attributes$$1,{});var chekBoxEnable=this.parent.getColumns().filter(function(col){return col.type==='checkbox'&&col.field;})[0];var value=false;if(chekBoxEnable){value=getValue(chekBoxEnable.field,rowArgs.data);}if(row.isDataRow){row.isSelected=this.parent.getSelectedRowIndexes().indexOf(row.index)>-1||value;}if(row.isDataRow&&this.parent.isCheckBoxSelection&&this.parent.checkAllRows==='Check'&&this.parent.enableVirtualization){row.isSelected=true;if(this.parent.getSelectedRowIndexes().indexOf(row.index)===-1){this.parent.getSelectedRowIndexes().push(row.index);}}this.buildAttributeFromRow(tr,row);attributes(tr,attrCopy);setStyleAndAttributes(tr,row.attributes);var cellRendererFact=this.serviceLocator.getService('cellRendererFactory');for(var i=0,len=row.cells.length;i<len;i++){var cell=row.cells[i];cell.isSelected=row.isSelected;var cellRenderer=cellRendererFact.getCellRenderer(row.cells[i].cellType||CellType.Data);var attrs={'index':!isNullOrUndefined(row.index)?row.index.toString():''};if(row.isExpand&&row.cells[i].cellType===CellType.DetailExpand){attrs['class']='e-detailrowexpand';}var td=cellRenderer.render(row.cells[i],row.data,attrs);if(row.cells[i].cellType!==CellType.Filter){if(row.cells[i].cellType===CellType.Data||row.cells[i].cellType===CellType.CommandColumn){this.parent.trigger(queryCellInfo,extend(cellArgs,{cell:td,column:cell.column,colSpan:1,foreignKeyData:row.cells[i].foreignKeyData}));if(cellArgs.colSpan>1||row.cells[i].cellSpan>1){var cellMerge=new CellMergeRender(this.serviceLocator,this.parent);td=cellMerge.render(cellArgs,row,i,td);}}if(!row.cells[i].isSpanned){tr.appendChild(td);}}}var args={row:tr,rowHeight:this.parent.rowHeight};if(row.isDataRow){this.parent.trigger(rowDataBound,extend(rowArgs,args));}if(this.parent.enableVirtualization){rowArgs.rowHeight=this.parent.rowHeight;}if(rowArgs.rowHeight){tr.style.height=rowArgs.rowHeight+'px';}else if(this.parent.rowHeight){tr.style.height=this.parent.rowHeight+'px';}if(row.cssClass){tr.classList.add(row.cssClass);}return tr;}},{key:'refreshMergeCells',value:function refreshMergeCells(row){var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=row.cells[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var cell=_step12.value;cell.isSpanned=false;}}catch(err){_didIteratorError12=true;_iteratorError12=err;}finally{try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return();}}finally{if(_didIteratorError12){throw _iteratorError12;}}}return row;}},{key:'buildAttributeFromRow',value:function buildAttributeFromRow(tr,row){var attr={};var prop={'rowindex':'aria-rowindex','dataUID':'data-uid','ariaSelected':'aria-selected'};var classes=[];if(row.isDataRow){classes.push('e-row');}if(row.isAltRow){classes.push('e-altrow');}if(!isNullOrUndefined(row.index)){attr[prop.rowindex]=row.index;}if(row.rowSpan){attr.rowSpan=row.rowSpan;}if(row.uid){attr[prop.dataUID]=row.uid;}if(row.isSelected){attr[prop.ariaSelected]=true;}if(row.visible===false){classes.push('e-hide');}attr.class=classes;setStyleAndAttributes(tr,attr);}}]);return RowRenderer;}());_export('RowModelGenerator',RowModelGenerator=function(){/**
     * Constructor for header renderer module
     */function RowModelGenerator(parent){_classCallCheck(this,RowModelGenerator);this.parent=parent;}_createClass(RowModelGenerator,[{key:'generateRows',value:function generateRows(data,args){var rows=[];var startIndex=this.parent.enableVirtualization?args.startIndex:0;for(var i=0,len=Object.keys(data).length;i<len;i++,startIndex++){rows[i]=this.generateRow(data[i],startIndex);}return rows;}},{key:'ensureColumns',value:function ensureColumns(){//TODO: generate dummy column for group, detail here;
var cols=[];if(this.parent.detailTemplate||this.parent.childGrid){cols.push(this.generateCell({},null,CellType.DetailExpand));}return cols;}},{key:'generateRow',value:function generateRow(data,index,cssClass,indent){var options={};options.foreignKeyData={};options.uid=getUid('grid-row');options.data=data;options.index=index;options.indent=indent;options.isDataRow=true;options.isExpand=false;options.cssClass=cssClass;options.isAltRow=this.parent.enableAltRow?index%2!==0:false;options.isSelected=this.parent.getSelectedRowIndexes().indexOf(index)>-1;this.refreshForeignKeyRow(options);var cells=this.ensureColumns();var row=new Row(options);row.cells=cells.concat(this.generateCells(options));return row;}},{key:'refreshForeignKeyRow',value:function refreshForeignKeyRow(options){this.parent.getForeignKeyColumns().forEach(function(col){setValue(col.field,getForeignData(col,options.data),options.foreignKeyData);});}},{key:'generateCells',value:function generateCells(options){var _this6=this;var dummies=this.parent.getColumns();var tmp=[];dummies.forEach(function(dummy,index){return tmp.push(_this6.generateCell(dummy,options.uid,isNullOrUndefined(dummy.commands)?undefined:CellType.CommandColumn,null,index,options.foreignKeyData));});return tmp;}},{key:'generateCell',value:function generateCell(column,rowId,cellType,colSpan,oIndex,foreignKeyData){var opt={'visible':column.visible,'isDataCell':!isNullOrUndefined(column.field||column.template),'isTemplate':!isNullOrUndefined(column.template),'rowID':rowId,'column':column,'cellType':!isNullOrUndefined(cellType)?cellType:CellType.Data,'colSpan':colSpan,'commands':column.commands,'isForeignKey':column.isForeignColumn&&column.isForeignColumn(),'foreignKeyData':column.isForeignColumn&&column.isForeignColumn()&&getValue(column.field,foreignKeyData)};if(opt.isDataCell||opt.column.type==='checkbox'){opt.index=this.parent.getColumnIndexByField(column.field);}return new Cell(opt);}},{key:'refreshRows',value:function refreshRows(input){var _this7=this;input.forEach(function(row){_this7.refreshForeignKeyRow(row);row.cells=_this7.generateCells(row);});return input;}}]);return RowModelGenerator;}());SummaryModelGenerator=function(){/**
     * Constructor for Summary row model generator
     */function SummaryModelGenerator(parent){_classCallCheck(this,SummaryModelGenerator);this.parent=parent;}_createClass(SummaryModelGenerator,[{key:'getData',value:function getData(){var _this8=this;var rows=[];this.parent.aggregates.slice().forEach(function(row){var columns=row.columns.filter(function(column){return!(column.footerTemplate||column.groupFooterTemplate||column.groupCaptionTemplate)||_this8.columnSelector(column);});if(columns.length){rows.push({columns:columns});}});return rows;}},{key:'columnSelector',value:function columnSelector(column){return column.footerTemplate!==undefined;}},{key:'getColumns',value:function getColumns(start,end){var columns=[];if(this.parent.allowGrouping){this.parent.groupSettings.columns.forEach(function(value){return columns.push(new Column({}));});}if(this.parent.detailTemplate){columns.push(new Column({}));}columns.push.apply(columns,_toConsumableArray(this.parent.getColumns()));return isNullOrUndefined(start)?columns:columns.slice(start,end);}},{key:'generateRows',value:function generateRows(input,args,start,end){var _this9=this;if(this.parent.currentViewData.length===0){return[];}var data=this.buildSummaryData(input,args);var rows=[];this.getData().forEach(function(row,index){rows.push(_this9.getGeneratedRow(row,data[index],args?args.level:undefined,start,end));});return rows;}},{key:'getGeneratedRow',value:function getGeneratedRow(summaryRow,data,raw,start,end){var _this10=this;var tmp=[];var indents=this.getIndentByLevel(raw);var indentLength=this.parent.groupSettings.columns.length+(this.parent.detailTemplate?1:0);this.getColumns(start,end).forEach(function(value,index){return tmp.push(_this10.getGeneratedCell(value,summaryRow,index>=indentLength?_this10.getCellType():CellType.Indent,indents[index]));});var row=new Row({data:data,attributes:{class:'e-summaryrow'}});row.cells=tmp;row.visible=tmp.some(function(cell){return cell.isDataCell&&cell.visible;});return row;}},{key:'getGeneratedCell',value:function getGeneratedCell(column,summaryRow,cellType,indent){//Get the summary column by display
var sColumn=summaryRow.columns.filter(function(scolumn){return scolumn.columnName===column.field;})[0];var attrs={'style':{'textAlign':column.textAlign}};if(indent){attrs.class=indent;}var opt={'visible':column.visible,'isDataCell':!isNullOrUndefined(sColumn),'isTemplate':sColumn&&!isNullOrUndefined(sColumn.footerTemplate||sColumn.groupFooterTemplate||sColumn.groupCaptionTemplate),'column':sColumn||{},'attributes':attrs,'cellType':cellType};return new Cell(opt);}},{key:'buildSummaryData',value:function buildSummaryData(data,args){var _this11=this;var dummy=[];var summaryRows=this.getData();var single={};summaryRows.forEach(function(row){single={};row.columns.forEach(function(column){single=_this11.setTemplate(column,args&&args.aggregates?args:data,single);});dummy.push(single);});return dummy;}},{key:'getIndentByLevel',value:function getIndentByLevel(data){return this.parent.groupSettings.columns.map(function(){return'e-indentcelltop';});}},{key:'setTemplate',value:function setTemplate(column,data,single){var _this12=this;var types=column.type;var helper={};var formatFn=column.getFormatter()||function(){return function(a){return a;};}();var group=data;if(!(types instanceof Array)){types=[column.type];}types.forEach(function(type){var key=column.field+' - '+type.toLowerCase();var disp=column.columnName;var val=group.aggregates&&!isNullOrUndefined(group.aggregates[key])?group.aggregates[key]:calculateAggregate(type,group.aggregates?group:data,column,_this12.parent);single[disp]=single[disp]||{};single[disp][key]=val;single[disp][type]=formatFn(val);if(group.field){single[disp].field=group.field;single[disp].key=group.key;}});helper.format=column.getFormatter();column.setTemplate(helper);return single;}},{key:'getCellType',value:function getCellType(){return CellType.Summary;}}]);return SummaryModelGenerator;}();GroupSummaryModelGenerator=function(_SummaryModelGenerato){_inherits(GroupSummaryModelGenerator,_SummaryModelGenerato);function GroupSummaryModelGenerator(){_classCallCheck(this,GroupSummaryModelGenerator);return _possibleConstructorReturn(this,(GroupSummaryModelGenerator.__proto__||Object.getPrototypeOf(GroupSummaryModelGenerator)).apply(this,arguments));}_createClass(GroupSummaryModelGenerator,[{key:'columnSelector',value:function columnSelector(column){return column.groupFooterTemplate!==undefined;}},{key:'getIndentByLevel',value:function getIndentByLevel(){var level=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.parent.groupSettings.columns.length;return this.parent.groupSettings.columns.map(function(v,indx){return indx<=level-1?'':'e-indentcelltop';});}},{key:'getCellType',value:function getCellType(){return CellType.GroupSummary;}}]);return GroupSummaryModelGenerator;}(SummaryModelGenerator);CaptionSummaryModelGenerator=function(_SummaryModelGenerato2){_inherits(CaptionSummaryModelGenerator,_SummaryModelGenerato2);function CaptionSummaryModelGenerator(){_classCallCheck(this,CaptionSummaryModelGenerator);return _possibleConstructorReturn(this,(CaptionSummaryModelGenerator.__proto__||Object.getPrototypeOf(CaptionSummaryModelGenerator)).apply(this,arguments));}_createClass(CaptionSummaryModelGenerator,[{key:'columnSelector',value:function columnSelector(column){return column.groupCaptionTemplate!==undefined;}},{key:'getData',value:function getData(){var initVal={columns:[]};return[_get(CaptionSummaryModelGenerator.prototype.__proto__||Object.getPrototypeOf(CaptionSummaryModelGenerator.prototype),'getData',this).call(this).reduce(function(prev,cur){prev.columns=[].concat(_toConsumableArray(prev.columns),_toConsumableArray(cur.columns));return prev;},initVal)];}},{key:'isEmpty',value:function isEmpty(){return(this.getData()[0].columns||[]).length===0;}},{key:'getCellType',value:function getCellType(){return CellType.CaptionSummary;}}]);return CaptionSummaryModelGenerator;}(SummaryModelGenerator);_export('GroupModelGenerator',GroupModelGenerator=function(_RowModelGenerator){_inherits(GroupModelGenerator,_RowModelGenerator);function GroupModelGenerator(parent){_classCallCheck(this,GroupModelGenerator);var _this15=_possibleConstructorReturn(this,(GroupModelGenerator.__proto__||Object.getPrototypeOf(GroupModelGenerator)).call(this,parent));_this15.rows=[];_this15.index=0;_this15.parent=parent;_this15.summaryModelGen=new GroupSummaryModelGenerator(parent);_this15.captionModelGen=new CaptionSummaryModelGenerator(parent);return _this15;}_createClass(GroupModelGenerator,[{key:'generateRows',value:function generateRows(data,args){if(this.parent.groupSettings.columns.length===0){return _get(GroupModelGenerator.prototype.__proto__||Object.getPrototypeOf(GroupModelGenerator.prototype),'generateRows',this).call(this,data,args);}this.rows=[];this.index=this.parent.enableVirtualization?(this.parent.pageSettings.currentPage-1)*data.records.length:0;for(var i=0,len=data.length;i<len;i++){this.getGroupedRecords(0,data[i],data.level);}this.index=0;return this.rows;}},{key:'getGroupedRecords',value:function getGroupedRecords(index,data,raw){var level=raw;if(isNullOrUndefined(data.items)){if(isNullOrUndefined(data.GroupGuid)){this.rows=this.rows.concat(this.generateDataRows(data,index));}else{for(var j=0,len=data.length;j<len;j++){this.getGroupedRecords(index,data[j],data.level);}}}else{this.rows=this.rows.concat(this.generateCaptionRow(data,index));if(data.items&&data.items.length){this.getGroupedRecords(index+1,data.items,data.items.level);}if(this.parent.aggregates.length){var _rows;(_rows=this.rows).push.apply(_rows,_toConsumableArray(this.summaryModelGen.generateRows(data,{level:level})));}}}},{key:'getCaptionRowCells',value:function getCaptionRowCells(field,indent,data){var _this16=this;var cells=[];var visibles=[];var column=this.parent.getColumnByField(field);var indexes=this.parent.getColumnIndexesInView();if(this.parent.enableColumnVirtualization){column=this.parent.columns.filter(function(c){return c.field===field;})[0];}var groupedLen=this.parent.groupSettings.columns.length;var gObj=this.parent;if(!this.parent.enableColumnVirtualization||indexes.indexOf(indent)!==-1){for(var i=0;i<indent;i++){cells.push(this.generateIndentCell());}cells.push(this.generateCell({},null,CellType.Expand));}indent=this.parent.enableColumnVirtualization?1:this.parent.getVisibleColumns().length+groupedLen+(gObj.detailTemplate||gObj.childGrid?1:0)-indent+(this.parent.getVisibleColumns().length?-1:0);//Captionsummary cells will be added here.    
if(this.parent.aggregates.length&&!this.captionModelGen.isEmpty()){var captionCells=this.captionModelGen.generateRows(data)[0];extend(data,captionCells.data);var cIndex=0;captionCells.cells.some(function(cell,index){cIndex=index;return cell.visible&&cell.isDataCell;});visibles=captionCells.cells.slice(cIndex).filter(function(cell){return cell.visible;});if(captionCells.visible&&visibles[0].column.field===this.parent.getVisibleColumns()[0].field){visibles=visibles.slice(1);}if(this.parent.getVisibleColumns().length===1){visibles=[];}indent=indent-visibles.length;}var cols=!this.parent.enableColumnVirtualization?[column]:this.parent.getColumns();var wFlag=true;cols.forEach(function(col,index){var tmpFlag=wFlag&&indexes.indexOf(indent)!==-1;if(tmpFlag){wFlag=false;}var cellType=!_this16.parent.enableColumnVirtualization||tmpFlag?CellType.GroupCaption:CellType.GroupCaptionEmpty;indent=_this16.parent.enableColumnVirtualization&&cellType===CellType.GroupCaption?indent+groupedLen:indent;cells.push(_this16.generateCell(column,null,cellType,indent));});cells.push.apply(cells,_toConsumableArray(visibles));return cells;}},{key:'generateCaptionRow',value:function generateCaptionRow(data,indent){var options={};var col=this.parent.getColumnByField(data.field);options.data=extend({},data);if(col){options.data.field=data.field;}options.isDataRow=false;var row=new Row(options);row.indent=indent;this.getForeignKeyData(row);row.cells=this.getCaptionRowCells(data.field,indent,row.data);return row;}},{key:'getForeignKeyData',value:function getForeignKeyData(row){var data=row.data;var col=this.parent.getColumnByField(data.field);if(col&&col.isForeignColumn&&col.isForeignColumn()){setValue('foreignKey',col.valueAccessor(col.foreignKeyValue,getForeignData(col,{},data.key)[0],col),row.data);}}},{key:'generateDataRows',value:function generateDataRows(data,indent){var rows=[];var indexes=this.parent.getColumnIndexesInView();for(var i=0,len=data.length;i<len;i++){rows[i]=this.generateRow(data[i],this.index,i?undefined:'e-firstchildrow',indent);for(var j=0;j<indent;j++){if(this.parent.enableColumnVirtualization&&indexes.indexOf(indent)===-1){continue;}rows[i].cells.unshift(this.generateIndentCell());}this.index++;}return rows;}},{key:'generateIndentCell',value:function generateIndentCell(){return this.generateCell({},null,CellType.Indent);}},{key:'refreshRows',value:function refreshRows(input){var _this17=this;var indexes=this.parent.getColumnIndexesInView();input.forEach(function(row){if(row.isDataRow){row.cells=_this17.generateCells(row);for(var j=0;j<row.indent;j++){if(_this17.parent.enableColumnVirtualization&&indexes.indexOf(row.indent)===-1){continue;}row.cells.unshift(_this17.generateIndentCell());}}else{var cRow=_this17.generateCaptionRow(row.data,row.indent);row.cells=cRow.cells;}});return input;}}]);return GroupModelGenerator;}(RowModelGenerator));_export('ContentRender',ContentRender=function(){/**
     * Constructor for content renderer module
     */function ContentRender(parent,serviceLocator){var _this18=this;_classCallCheck(this,ContentRender);this.rows=[];this.freezeRows=[];this.movableRows=[];this.isLoaded=true;this.drop=function(e){_this18.parent.notify(columnDrop,{target:e.target,droppedElement:e.droppedElement});remove(e.droppedElement);};this.rafCallback=function(args){var arg=args;return function(){_this18.ariaService.setBusy(_this18.getPanel().firstChild,false);if(_this18.parent.isDestroyed){return;}var rows=_this18.rows.slice(0);if(_this18.parent.getFrozenColumns()!==0){rows=args.isFrozen?_this18.freezeRows:_this18.movableRows;}_this18.parent.notify(contentReady,{rows:rows,args:arg});if(_this18.isLoaded){_this18.parent.trigger(dataBound,{});if(_this18.parent.allowTextWrap){_this18.parent.notify(freezeRender,{case:'textwrap'});}}if(arg){var action=(arg.requestType||'').toLowerCase()+'-complete';_this18.parent.notify(action,arg);}_this18.parent.hideSpinner();};};this.parent=parent;this.serviceLocator=serviceLocator;this.ariaService=this.serviceLocator.getService('ariaService');this.generator=this.getModelGenerator();if(this.parent.isDestroyed){return;}this.parent.on(columnVisibilityChanged,this.setVisible,this);this.parent.on(colGroupRefresh,this.colGroupRefresh,this);this.parent.on(uiUpdate,this.enableAfterRender,this);}/**
     * The function is used to render grid content div
     */_createClass(ContentRender,[{key:'renderPanel',value:function renderPanel(){var gObj=this.parent;var div=createElement('div',{className:'e-gridcontent'});var innerDiv=createElement('div',{className:'e-content'});this.ariaService.setOptions(innerDiv,{busy:false});div.appendChild(innerDiv);this.setPanel(div);gObj.element.appendChild(div);}},{key:'renderTable',value:function renderTable(){var contentDiv=this.getPanel();contentDiv.appendChild(this.createContentTable('_content_table'));this.setTable(contentDiv.querySelector('.e-table'));this.ariaService.setOptions(this.getTable(),{multiselectable:this.parent.selectionSettings.type==='Multiple'});this.initializeContentDrop();if(this.parent.frozenRows){this.parent.getHeaderContent().classList.add('e-frozenhdrcont');}}},{key:'createContentTable',value:function createContentTable(id){var innerDiv=this.getPanel().firstChild;var table=createElement('table',{className:'e-table',attrs:{cellspacing:'0.25px',role:'grid',id:this.parent.element.id+id}});this.setColGroup(this.parent.element.querySelector('.e-gridheader').querySelector('colgroup').cloneNode(true));table.appendChild(this.getColGroup());table.appendChild(createElement('tbody'));innerDiv.appendChild(table);return innerDiv;}},{key:'splitRows',value:function splitRows(idx){if(this.parent.getFrozenColumns()){if(idx===0){this.freezeRows=this.rows;this.freezeRowElements=this.rowElements;}else{this.movableRows=this.rows;}}}},{key:'refreshContentRows',value:function refreshContentRows(){var _this19=this;var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var gObj=this.parent;if(gObj.currentViewData.length===0){return;}var dataSource=gObj.currentViewData;var frag=document.createDocumentFragment();var hdrfrag=document.createDocumentFragment();var columns=gObj.getColumns();var tr=void 0;var hdrTbody=void 0;var frzCols=gObj.getFrozenColumns();var row=new RowRenderer(this.serviceLocator,null,this.parent);this.rowElements=[];this.rows=[];var modelData=this.generator.generateRows(dataSource,args);var idx=modelData[0].cells[0].index;var fCont=this.getPanel().querySelector('.e-frozencontent');var mCont=this.getPanel().querySelector('.e-movablecontent');var cont=this.getPanel().querySelector('.e-content');if(this.parent.enableColumnVirtualization){var cellMerge=new CellMergeRender(this.serviceLocator,this.parent);cellMerge.updateVirtualCells(modelData);}if(frzCols&&idx>=frzCols){this.tbody=mCont.querySelector('tbody');}else{this.tbody=this.getTable().querySelector('tbody');}for(var i=0,len=modelData.length;i<len;i++){if(!gObj.rowTemplate){tr=row.render(modelData[i],columns);}else{var elements=gObj.getRowTemplate()(extend({index:i},dataSource[i]),gObj,'rowTemplate');for(var j=0;j<elements.length;j++){var isTR=elements[j].nodeName.toLowerCase()==='tr';if(isTR||elements[j].querySelectorAll&&elements[j].querySelectorAll('tr').length){tr=isTR?elements[j]:elements[j].querySelector('tr');}}}if(gObj.frozenRows&&i<gObj.frozenRows){hdrfrag.appendChild(tr);}else{frag.appendChild(tr);}this.rows.push(modelData[i]);if(modelData[i].isDataRow){//detailrowvisible 
var td=tr.querySelectorAll('.e-rowcell:not(.e-hide)')[0];if(td){td.classList.add('e-detailrowvisible');}this.rowElements.push(tr);}this.ariaService.setOptions(this.getTable(),{colcount:gObj.getColumns().length.toString()});}this.splitRows(idx);if(gObj.frozenRows){hdrTbody=frzCols?gObj.getHeaderContent().querySelector(idx===0?'.e-frozenheader':'.e-movableheader').querySelector('tbody'):gObj.getHeaderTable().querySelector('tbody');hdrTbody.innerHTML='';hdrTbody.appendChild(hdrfrag);}if(gObj.frozenRows&&idx===0&&cont.offsetHeight===Number(gObj.height)){cont.style.height=cont.offsetHeight-hdrTbody.offsetHeight+'px';}if(frzCols&&idx===0){this.getPanel().firstChild.style.overflowY='hidden';}args.rows=this.rows.slice(0);args.isFrozen=this.parent.getFrozenColumns()!==0&&!args.isFrozen;getUpdateUsingRaf(function(){remove(_this19.tbody);_this19.tbody=createElement('tbody');if(frzCols){_this19.tbody.appendChild(frag);if(idx===0){_this19.isLoaded=false;fCont.querySelector('table').appendChild(_this19.tbody);}else{if(_this19.tbody.childElementCount<1){_this19.tbody.appendChild(createElement('tr').appendChild(createElement('td')));}_this19.isLoaded=true;mCont.querySelector('table').appendChild(_this19.tbody);fCont.style.height=mCont.offsetHeight-_getScrollBarWidth()+'px';mCont.style.overflowY=_this19.parent.height!=='auto'?'scroll':'auto';fCont.style.borderRightWidth='1px';}}else{_this19.appendContent(_this19.tbody,frag,args);}if(frzCols&&idx===0){_this19.refreshContentRows(extend({},args));}},this.rafCallback(extend({},args)));}},{key:'appendContent',value:function appendContent(tbody,frag,args){tbody.appendChild(frag);this.getTable().appendChild(tbody);}},{key:'getPanel',value:function getPanel(){return this.contentPanel;}},{key:'setPanel',value:function setPanel(panel){this.contentPanel=panel;}},{key:'getTable',value:function getTable(){return this.contentTable;}},{key:'setTable',value:function setTable(table){this.contentTable=table;}},{key:'getRows',value:function getRows(){return this.parent.getFrozenColumns()?this.freezeRows:this.rows;}},{key:'getMovableRows',value:function getMovableRows(){return this.movableRows;}},{key:'getRowElements',value:function getRowElements(){return this.parent.getFrozenColumns()?this.freezeRowElements:this.rowElements;}},{key:'getMovableRowElements',value:function getMovableRowElements(){return this.rowElements;}},{key:'setRowElements',value:function setRowElements(elements){this.rowElements=elements;}},{key:'getColGroup',value:function getColGroup(){return this.colgroup;}},{key:'setColGroup',value:function setColGroup(colGroup){return this.colgroup=colGroup;}},{key:'setVisible',value:function setVisible(columns){var gObj=this.parent;var frzCols=gObj.getFrozenColumns();var rows=[];if(frzCols){var fRows=this.freezeRows;var mRows=this.movableRows;var rowLen=fRows.length;var cellLen=void 0;for(var i=0,row;i<rowLen;i++){cellLen=mRows[i].cells.length;row=fRows[i].clone();for(var j=0;j<cellLen;j++){row.cells.push(mRows[i].cells[j]);}rows.push(row);}}else{rows=this.getRows();}var testRow=void 0;rows.some(function(r){if(r.isDataRow){testRow=r;}return r.isDataRow;});for(var c=0,clen=columns.length;c<clen;c++){var column=columns[c];var idx=this.parent.getNormalizedColumnIndex(column.uid);//used canSkip method to skip unwanted visible toggle operation. 
if(this.canSkip(column,testRow,idx)){continue;}var displayVal=column.visible===true?'':'none';if(frzCols){if(idx<frzCols){setStyleAttribute(this.getColGroup().childNodes[idx],{'display':displayVal});}else{var mTable=gObj.getContent().querySelector('.e-movablecontent').querySelector('colgroup');setStyleAttribute(mTable.childNodes[idx-frzCols],{'display':displayVal});}}else{setStyleAttribute(this.getColGroup().childNodes[idx],{'display':displayVal});}}this.refreshContentRows({requestType:'refresh'});}},{key:'colGroupRefresh',value:function colGroupRefresh(){if(this.getColGroup()){var colGroup=this.parent.element.querySelector('.e-gridheader').querySelector('colgroup').cloneNode(true);this.getTable().replaceChild(colGroup,this.getColGroup());this.setColGroup(colGroup);}}},{key:'initializeContentDrop',value:function initializeContentDrop(){var gObj=this.parent;var drop=new Droppable(gObj.getContent(),{accept:'.e-dragclone',drop:this.drop});}},{key:'canSkip',value:function canSkip(column,row,index){/**
         * Skip the toggle visiblity operation when one of the following success
         * 1. Grid has empty records
         * 2. column visible property is unchanged
         * 3. cell`s isVisible property is same as column`s visible property.
         */return isNullOrUndefined(row)||//(1)
isNullOrUndefined(column.visible)||//(2)    
row.cells[index].visible===column.visible;//(3)
}},{key:'getModelGenerator',value:function getModelGenerator(){return this.generator=this.parent.allowGrouping?new GroupModelGenerator(this.parent):new RowModelGenerator(this.parent);}},{key:'renderEmpty',value:function renderEmpty(tbody){this.getTable().appendChild(tbody);if(this.parent.frozenRows){this.parent.getHeaderContent().querySelector('tbody').innerHTML='';}}},{key:'setSelection',value:function setSelection(uid,set,clearAll){if(this.parent.getFrozenColumns()){this.getMovableRows().filter(function(row){return clearAll||uid===row.uid;}).forEach(function(row){return row.isSelected=set;});}this.getRows().filter(function(row){return clearAll||uid===row.uid;}).forEach(function(row){row.isSelected=set;row.cells.forEach(function(cell){return cell.isSelected=set;});});}},{key:'getRowByIndex',value:function getRowByIndex(index){return this.parent.getDataRows()[index];}},{key:'getVirtualRowIndex',value:function getVirtualRowIndex(index){return index;}},{key:'getMovableRowByIndex',value:function getMovableRowByIndex(index){return this.parent.getMovableDataRows()[index];}},{key:'enableAfterRender',value:function enableAfterRender(e){if(e.module==='group'&&e.enable){this.generator=this.getModelGenerator();}}}]);return ContentRender;}());_export('HeaderRender',HeaderRender=function(){/**
     * Constructor for header renderer module
     */function HeaderRender(parent,serviceLocator){var _this20=this;_classCallCheck(this,HeaderRender);this.frzIdx=0;this.helper=function(e){var gObj=_this20.parent;var target=e.sender.target;var parentEle=parentsUntil(target,'e-headercell');if(!(gObj.allowReordering||gObj.allowGrouping)||!isNullOrUndefined(parentEle)&&parentEle.querySelectorAll('.e-checkselectall').length>0){return false;}var visualElement=createElement('div',{className:'e-cloneproperties e-dragclone e-headerclone'});var element=target.classList.contains('e-headercell')?target:parentEle;if(!element||!gObj.allowReordering&&element.classList.contains('e-stackedheadercell')){return false;}var height=element.offsetHeight;var headercelldiv=element.querySelector('.e-headercelldiv');var col=void 0;if(headercelldiv){col=gObj.getColumnByUid(headercelldiv.getAttribute('e-mappinguid'));_this20.column=col;visualElement.setAttribute('e-mappinguid',_this20.column.uid);}if(col&&!isNullOrUndefined(col.headerTemplate)){if(col.headerTemplate.indexOf('#')!==-1){visualElement.innerHTML=document.querySelector(col.headerTemplate).innerHTML.trim();}else{visualElement.innerHTML=col.headerTemplate;}}else{visualElement.textContent=headercelldiv?col.headerText:element.firstElementChild.innerHTML;}visualElement.style.width=element.offsetWidth+'px';visualElement.style.height=element.offsetHeight+'px';visualElement.style.lineHeight=(height-6).toString()+'px';gObj.element.appendChild(visualElement);return visualElement;};this.dragStart=function(e){var gObj=_this20.parent;gObj.element.querySelector('.e-gridpopup').style.display='none';gObj.notify(columnDragStart,{target:e.target,column:_this20.column,event:e.event});};this.drag=function(e){var gObj=_this20.parent;var target=e.target;if(target){var closest$$1=closest(target,'.e-grid');var cloneElement=_this20.parent.element.querySelector('.e-cloneproperties');if(!closest$$1||closest$$1.getAttribute('id')!==gObj.element.getAttribute('id')){classList(cloneElement,['e-notallowedcur'],['e-defaultcur']);if(gObj.allowReordering){gObj.element.querySelector('.e-reorderuparrow').style.display='none';gObj.element.querySelector('.e-reorderdownarrow').style.display='none';}return;}gObj.notify(columnDrag,{target:e.target,column:_this20.column,event:e.event});}};this.dragStop=function(e){var gObj=_this20.parent;var cancel=void 0;gObj.element.querySelector('.e-gridpopup').style.display='none';if(!parentsUntil(e.target,'e-headercell')&&!parentsUntil(e.target,'e-groupdroparea')||!gObj.allowReordering&&parentsUntil(e.target,'e-headercell')||!e.helper.getAttribute('e-mappinguid')&&parentsUntil(e.target,'e-groupdroparea')){remove(e.helper);cancel=true;}gObj.notify(columnDragStop,{target:e.target,event:e.event,column:_this20.column,cancel:cancel});};this.drop=function(e){var gObj=_this20.parent;var uid=e.droppedElement.getAttribute('e-mappinguid');var closest$$1=closest(e.target,'.e-grid');remove(e.droppedElement);if(closest$$1&&closest$$1.getAttribute('id')!==gObj.element.getAttribute('id')||!(gObj.allowReordering||gObj.allowGrouping)){return;}gObj.notify(headerDrop,{target:e.target,uid:uid});};this.parent=parent;this.serviceLocator=serviceLocator;this.ariaService=this.serviceLocator.getService('ariaService');this.widthService=this.serviceLocator.getService('widthService');if(this.parent.isDestroyed){return;}this.parent.on(columnVisibilityChanged,this.setVisible,this);this.parent.on(columnPositionChanged,this.colPosRefresh,this);}/**
     * The function is used to render grid header div
     */_createClass(HeaderRender,[{key:'renderPanel',value:function renderPanel(){var div=createElement('div',{className:'e-gridheader'});var innerDiv=createElement('div',{className:'e-headercontent'});div.appendChild(innerDiv);this.setPanel(div);this.parent.element.appendChild(div);}},{key:'renderTable',value:function renderTable(){var headerDiv=this.getPanel();headerDiv.appendChild(this.createHeaderTable());this.setTable(headerDiv.querySelector('.e-table'));if(!this.parent.getFrozenColumns()){this.initializeHeaderDrag();this.initializeHeaderDrop();}this.parent.notify(headerRefreshed,{rows:this.rows,args:{isFrozen:this.parent.getFrozenColumns()!==0}});}},{key:'getPanel',value:function getPanel(){return this.headerPanel;}},{key:'setPanel',value:function setPanel(panel){this.headerPanel=panel;}},{key:'getTable',value:function getTable(){return this.headerTable;}},{key:'setTable',value:function setTable(table){this.headerTable=table;}},{key:'getColGroup',value:function getColGroup(){return this.colgroup;}},{key:'setColGroup',value:function setColGroup(colGroup){return this.colgroup=colGroup;}},{key:'getRows',value:function getRows(){var table=this.getTable();return table.tHead.rows;}},{key:'createHeaderTable',value:function createHeaderTable(){var table=this.createTable();var innerDiv=this.getPanel().firstChild;innerDiv.appendChild(table);return innerDiv;}},{key:'createTable',value:function createTable(){var gObj=this.parent;var columns=gObj.getColumns();var table=createElement('table',{className:'e-table',attrs:{cellspacing:'0.25px',role:'grid'}});var innerDiv=this.getPanel().firstChild;var findHeaderRow=this.createHeaderContent();var thead=findHeaderRow.thead;var tbody=createElement('tbody',{className:this.parent.frozenRows?'':'e-hide'});this.caption=createElement('caption',{innerHTML:this.parent.element.id+'_header_table',className:'e-hide'});var colGroup=createElement('colgroup');var rowBody=createElement('tr');var bodyCell=void 0;var rows=this.rows=findHeaderRow.rows;var rowRenderer=new RowRenderer(this.serviceLocator,CellType.Header);for(var i=0,len=rows.length;i<len;i++){for(var j=0,_len2=rows[i].cells.length;j<_len2;j++){var cell=rows[i].cells[j];bodyCell=createElement('td');rowBody.appendChild(bodyCell);}}if(gObj.allowFiltering||gObj.allowSorting||gObj.allowGrouping){table.classList.add('e-sortfilter');}this.updateColGroup(colGroup);tbody.appendChild(rowBody);table.appendChild(this.setColGroup(colGroup));table.appendChild(thead);table.appendChild(tbody);table.appendChild(this.caption);this.ariaService.setOptions(table,{colcount:gObj.getColumns().length.toString()});return table;}},{key:'createHeaderContent',value:function createHeaderContent(){var gObj=this.parent;var columns=gObj.getColumns();var thead=createElement('thead');var colHeader=createElement('tr',{className:'e-columnheader'});var rowRenderer=new RowRenderer(this.serviceLocator,CellType.Header,gObj);rowRenderer.element=colHeader;var rows=[];var headerRow=void 0;this.colDepth=this.getObjDepth();for(var i=0,len=this.colDepth;i<len;i++){rows[i]=this.generateRow(i);rows[i].cells=[];}rows=this.ensureColumns(rows);rows=this.getHeaderCells(rows);for(var _i3=0,_len3=this.colDepth;_i3<_len3;_i3++){headerRow=rowRenderer.render(rows[_i3],columns);if(this.parent.rowHeight){headerRow.style.height=this.parent.rowHeight+'px';}thead.appendChild(headerRow);}var findHeaderRow={thead:thead,rows:rows};return findHeaderRow;}},{key:'updateColGroup',value:function updateColGroup(colGroup){var cols=this.parent.getColumns();var col=void 0;var indexes=this.parent.getColumnIndexesInView();if(this.parent.allowGrouping){for(var i=0,len=this.parent.groupSettings.columns.length;i<len;i++){if(this.parent.enableColumnVirtualization&&indexes.indexOf(i)===-1){continue;}col=createElement('col');colGroup.appendChild(col);}}if(this.parent.detailTemplate||this.parent.childGrid){col=createElement('col');colGroup.appendChild(col);}for(var _i4=0,_len4=cols.length;_i4<_len4;_i4++){col=createElement('col');if(cols[_i4].visible===false){setStyleAttribute(col,{'display':'none'});}colGroup.appendChild(col);}return colGroup;}},{key:'ensureColumns',value:function ensureColumns(rows){//TODO: generate dummy column for group, detail, stacked row here; ensureColumns here
var gObj=this.parent;var indexes=this.parent.getColumnIndexesInView();for(var i=0,len=rows.length;i<len;i++){if(gObj.allowGrouping){for(var c=0,_len5=gObj.groupSettings.columns.length;c<_len5;c++){if(this.parent.enableColumnVirtualization&&indexes.indexOf(c)===-1){continue;}rows[i].cells.push(this.generateCell({},CellType.HeaderIndent));}}if(gObj.detailTemplate||gObj.childGrid){rows[i].cells.push(this.generateCell({},CellType.DetailHeader));}}return rows;}},{key:'getHeaderCells',value:function getHeaderCells(rows){var thead=this.parent.getHeaderTable()&&this.parent.getHeaderTable().querySelector('thead');var cols=this.parent.enableColumnVirtualization?this.parent.getColumns():this.parent.columns;this.frzIdx=0;for(var i=0,len=cols.length;i<len;i++){rows=this.appendCells(cols[i],rows,0,i===0,false,i===len-1,thead);}return rows;}},{key:'appendCells',value:function appendCells(cols,rows,index,isFirstObj,isFirstCol,isLastCol,isMovable){var lastCol=isLastCol?'e-lastcell':'';var frzCols=this.parent.getFrozenColumns();if(!cols.columns){if(!frzCols||frzCols&&(!isMovable&&(this.frzIdx<this.parent.frozenColumns||cols.isFrozen)||isMovable&&this.frzIdx>=this.parent.frozenColumns&&!cols.isFrozen)){rows[index].cells.push(this.generateCell(cols,CellType.Header,this.colDepth-index,(isFirstObj?'':isFirstCol?'e-firstcell':'')+lastCol,index,this.parent.getColumnIndexByUid(cols.uid)));}this.frzIdx++;}else{var colSpan=this.getCellCnt(cols,0);if(colSpan){var frzObj=this.refreshFrozenHdr(cols.columns,{isPartial:false,isComp:true,cnt:0});if(!frzCols||frzCols&&(!isMovable&&(this.parent.frozenColumns-this.frzIdx>0||frzObj.isPartial)||isMovable&&colSpan+this.frzIdx>this.parent.frozenColumns&&!frzObj.isComp)){rows[index].cells.push(new Cell({cellType:CellType.StackedHeader,column:cols,colSpan:this.getColSpan(colSpan,isMovable,frzObj.cnt)}));}}for(var i=0,len=cols.columns.length;i<len;i++){rows=this.appendCells(cols.columns[i],rows,index+1,isFirstObj,i===0,i===len-1&&isLastCol,isMovable);}}return rows;}},{key:'refreshFrozenHdr',value:function refreshFrozenHdr(cols,frzObj){for(var i=0;i<cols.length;i++){if(cols[i].columns){frzObj=this.refreshFrozenHdr(cols[i].columns,frzObj);}else{if(cols[i].isFrozen){frzObj.isPartial=true;frzObj.cnt++;}frzObj.isComp=frzObj.isComp&&(cols[i].isFrozen||this.parent.getColumnIndexByField(cols[i].field)<this.parent.frozenColumns);}}return frzObj;}},{key:'getColSpan',value:function getColSpan(colSpan,isMovable,frozenCnt){var frzCol=this.parent.frozenColumns;if(this.parent.getFrozenColumns()&&this.frzIdx+colSpan>frzCol){if(isMovable){colSpan=colSpan-(frzCol>this.frzIdx?frzCol-this.frzIdx:0)-frozenCnt;}else{colSpan=colSpan-(colSpan-(frzCol>this.frzIdx?frzCol+frozenCnt-this.frzIdx:frozenCnt));}}return colSpan;}},{key:'generateRow',value:function generateRow(index){return new Row({});}},{key:'generateCell',value:function generateCell(column,cellType,rowSpan,className,rowIndex,colIndex){var opt={'visible':column.visible,'isDataCell':false,'isTemplate':!isNullOrUndefined(column.headerTemplate),'rowID':'','column':column,'cellType':cellType,'rowSpan':rowSpan,'className':className,'index':rowIndex,'colIndex':colIndex};if(!opt.rowSpan||opt.rowSpan<2){delete opt.rowSpan;}return new Cell(opt);}},{key:'setVisible',value:function setVisible(columns){var gObj=this.parent;var rows=[].slice.call(this.getRows());//NodeList -> Array        
var displayVal='';var idx=void 0;var frzCols=gObj.getFrozenColumns();for(var c=0,clen=columns.length;c<clen;c++){var column=columns[c];idx=gObj.getNormalizedColumnIndex(column.uid);if(column.visible===false){displayVal='none';}if(frzCols){if(idx<frzCols){setStyleAttribute(this.getColGroup().children[idx],{'display':displayVal});}else{var mTblColGrp=gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup');setStyleAttribute(mTblColGrp.children[idx-frzCols],{'display':displayVal});}}else{setStyleAttribute(this.getColGroup().children[idx],{'display':displayVal});}this.refreshUI();}}},{key:'colPosRefresh',value:function colPosRefresh(){this.refreshUI();}},{key:'refreshUI',value:function refreshUI(){var headerDiv=this.getPanel();var table=this.getTable();var frzCols=this.parent.getFrozenColumns();remove(this.getTable());table.removeChild(table.firstChild);table.removeChild(table.childNodes[0]);var colGroup=createElement('colgroup');var findHeaderRow=this.createHeaderContent();this.rows=findHeaderRow.rows;table.insertBefore(findHeaderRow.thead,table.firstChild);this.updateColGroup(colGroup);table.insertBefore(this.setColGroup(colGroup),table.firstChild);this.setTable(table);this.appendContent(table);this.parent.notify(colGroupRefresh,{});this.widthService.setWidthToColumns();if(!frzCols){this.initializeHeaderDrag();}var rows=[].slice.call(headerDiv.querySelectorAll('tr.e-columnheader'));var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=rows[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var row=_step13.value;var gCells=[].slice.call(row.querySelectorAll('.e-grouptopleftcell'));if(gCells.length){gCells[gCells.length-1].classList.add('e-lastgrouptopleftcell');}}}catch(err){_didIteratorError13=true;_iteratorError13=err;}finally{try{if(!_iteratorNormalCompletion13&&_iterator13.return){_iterator13.return();}}finally{if(_didIteratorError13){throw _iteratorError13;}}}if(!frzCols){this.parent.notify(headerRefreshed,{rows:this.rows,args:{isFrozen:this.parent.getFrozenColumns()!==0}});}if(this.parent.allowTextWrap&&this.parent.textWrapSettings.wrapMode==='Header'){wrap(rows,true);}}},{key:'appendContent',value:function appendContent(table){this.getPanel().firstChild.appendChild(table);}},{key:'getObjDepth',value:function getObjDepth(){var max=0;var cols=this.parent.columns;for(var i=0,len=cols.length;i<len;i++){var depth=this.checkDepth(cols[i],0);if(max<depth){max=depth;}}return max+1;}},{key:'checkDepth',value:function checkDepth(col,index){if(col.columns){index++;for(var i=0,len=col.columns.length;i<len;i++){index=this.checkDepth(col.columns[i],index);}}return index;}},{key:'getCellCnt',value:function getCellCnt(col,cnt){if(col.columns){for(var i=0,len=col.columns.length;i<len;i++){cnt=this.getCellCnt(col.columns[i],cnt);}}else{if(col.visible){cnt++;}}return cnt;}},{key:'initializeHeaderDrag',value:function initializeHeaderDrag(){var gObj=this.parent;if(!(this.parent.allowReordering||this.parent.allowGrouping&&this.parent.groupSettings.showDropArea)){return;}var headerRows=[].slice.call(gObj.getHeaderContent().querySelectorAll('.e-columnheader'));for(var i=0,len=headerRows.length;i<len;i++){var drag=new Draggable(headerRows[i],{dragTarget:'.e-headercell',distance:5,helper:this.helper,dragStart:this.dragStart,drag:this.drag,dragStop:this.dragStop,abort:'.e-rhandler'});}}},{key:'initializeHeaderDrop',value:function initializeHeaderDrop(){var gObj=this.parent;var drop=new Droppable(gObj.getHeaderContent(),{accept:'.e-dragclone',drop:this.drop});}}]);return HeaderRender;}());_export('CellRenderer',CellRenderer=function(){function CellRenderer(parent,locator){_classCallCheck(this,CellRenderer);this.element=createElement('TD',{className:'e-rowcell',attrs:{role:'gridcell',tabindex:'-1'}});this.rowChkBox=createElement('input',{className:'e-checkselect',attrs:{'type':'checkbox'}});this.localizer=locator.getService('localization');this.formatter=locator.getService('valueFormatter');this.parent=parent;}/**
     * Function to return the wrapper for the TD content
     * @returns string
     */_createClass(CellRenderer,[{key:'getGui',value:function getGui(){return'';}},{key:'format',value:function format(column,value,data){if(!isNullOrUndefined(column.format)){value=this.formatter.toView(value,column.getFormatter());}return isNullOrUndefined(value)?'':value.toString();}},{key:'evaluate',value:function evaluate(node,cell,data,attributes$$1,fData){var result=void 0;if(cell.column.template){var literals=['index'];var dummyData=extend({},data,_defineProperty({},foreignKeyData,fData));result=cell.column.getColumnTemplate()(extend({'index':attributes$$1[literals[0]]},dummyData),this.parent,'template');appendChildren(node,result);node.setAttribute('aria-label',node.innerText+' is template cell'+' column header '+cell.column.headerText);return false;}return true;}},{key:'invokeFormatter',value:function invokeFormatter(column,value,data){if(!isNullOrUndefined(column.formatter)){if(doesImplementInterface(column.formatter,'getValue')){var formatter=column.formatter;value=new formatter().getValue(column,data);}else if(typeof column.formatter==='function'){value=column.formatter(column,data);}else{value=column.formatter.getValue(column,data);}}return value;}},{key:'render',value:function render(cell,data,attributes$$1){return this.refreshCell(cell,data,attributes$$1);}},{key:'refreshTD',value:function refreshTD(td,cell,data,attributes$$1){var node=this.refreshCell(cell,data,attributes$$1);td.innerHTML='';var elements=[].slice.call(node.childNodes);var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=elements[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var elem=_step14.value;td.appendChild(elem);}}catch(err){_didIteratorError14=true;_iteratorError14=err;}finally{try{if(!_iteratorNormalCompletion14&&_iterator14.return){_iterator14.return();}}finally{if(_didIteratorError14){throw _iteratorError14;}}}}},{key:'refreshCell',value:function refreshCell(cell,data,attributes$$1){var node=this.element.cloneNode();var column=cell.column;var fData=void 0;if(cell.isForeignKey){fData=cell.foreignKeyData[0];}//Prepare innerHtml
var innerHtml=this.getGui();var value=cell.isForeignKey?this.getValue(column.foreignKeyValue,fData,column):this.getValue(column.field,data,column);if(column.type==='date'&&!isNullOrUndefined(value)){value=new Date(value);}value=this.format(column,value,data);innerHtml=value.toString();if(column.type==='boolean'){if(column.displayAsCheckBox){node.classList.add('e-checkbox');innerHtml='<input type="checkbox" disabled '+'/>';}else{var localeStr=value!=='true'&&value!=='false'?null:value==='true'?'True':'False';innerHtml=localeStr?this.localizer.getConstant(localeStr):innerHtml;}}var fromFormatter=this.invokeFormatter(column,value,data);innerHtml=!isNullOrUndefined(column.formatter)?isNullOrUndefined(fromFormatter)?'':fromFormatter.toString():innerHtml;node.setAttribute('aria-label',(innerHtml===''?'empty':innerHtml)+' column header '+cell.column.headerText);if(!isNullOrUndefined(cell.column.headerText)){node.setAttribute('aria-label',innerHtml+' column header '+cell.column.headerText);}if(this.evaluate(node,cell,data,attributes$$1,fData)&&column.type!=='checkbox'){this.appendHtml(node,innerHtml,column.getDomSetter?column.getDomSetter():'innerHTML');}else if(column.type==='checkbox'){node.classList.add('e-gridchkbox');node.setAttribute('aria-label','checkbox');if(this.parent.selectionSettings.persistSelection){value=value==='true';}else{value=false;}var checkWrap=createCheckBox(false,{checked:value,label:' '});checkWrap.insertBefore(this.rowChkBox.cloneNode(),checkWrap.firstChild);node.appendChild(checkWrap);}if(this.parent.checkAllRows==='Check'&&this.parent.enableVirtualization){cell.isSelected=true;}this.setAttributes(node,cell,attributes$$1);if(column.type==='boolean'){var obj=new CheckBox({disabled:true,checked:isNaN(parseInt(value,10))?value==='true':parseInt(value,10)>0});obj.appendTo(node.firstElementChild);node.setAttribute('aria-label',obj.checked+' column header '+cell.column.headerText);}return node;}},{key:'appendHtml',value:function appendHtml(node,innerHtml){var property=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'innerHTML';node[property]=innerHtml;return node;}},{key:'setAttributes',value:function setAttributes(node,cell,attributes$$1){var column=cell.column;this.buildAttributeFromCell(node,cell,column.type==='checkbox');setStyleAndAttributes(node,attributes$$1);setStyleAndAttributes(node,cell.attributes);if(column.customAttributes){setStyleAndAttributes(node,column.customAttributes);}if(column.textAlign){node.style.textAlign=column.textAlign;}if(column.clipMode==='Clip'){node.classList.add('e-gridclip');}else if(column.clipMode==='EllipsisWithTooltip'){node.classList.add('e-ellipsistooltip');}}},{key:'buildAttributeFromCell',value:function buildAttributeFromCell(node,cell,isCheckBoxType){var attr={};var prop={'colindex':'aria-colindex'};var classes=[];if(cell.colSpan){attr.colSpan=cell.colSpan;}if(cell.rowSpan){attr.rowSpan=cell.rowSpan;}if(cell.isTemplate){classes.push('e-templatecell');}if(cell.isSelected){classes.push.apply(classes,['e-selectionbackground','e-active']);if(isCheckBoxType){node.querySelector('.e-frame').classList.add('e-check');}}if(!isNullOrUndefined(cell.index)){attr[prop.colindex]=cell.index;}if(!cell.visible){classes.push('e-hide');}attr.class=classes;setStyleAndAttributes(node,attr);}},{key:'getValue',value:function getValue(field,data,column){return column.valueAccessor(field,data,column);}}]);return CellRenderer;}());AriaService=function(){function AriaService(){_classCallCheck(this,AriaService);}_createClass(AriaService,[{key:'setOptions',value:function setOptions(target,options){var props=Object.keys(options);props.forEach(function(name){return setStateAndProperties(target,config[name],options[name]);});}},{key:'setExpand',value:function setExpand(target,expand){setStateAndProperties(target,config.expand,expand);}},{key:'setSort',value:function setSort(target,direction){setStateAndProperties(target,config.sort,direction,typeof direction==='boolean');}},{key:'setBusy',value:function setBusy(target,isBusy){setStateAndProperties(target,config.busy,isBusy);setStateAndProperties(target,config.invalid,null,true);}},{key:'setGrabbed',value:function setGrabbed(target,isGrabbed,remove$$1){setStateAndProperties(target,config.grabbed,isGrabbed,remove$$1);}},{key:'setDropTarget',value:function setDropTarget(target,isTarget){setStateAndProperties(target,config.dropeffect,'copy',!isTarget);}}]);return AriaService;}();config={expand:'aria-expanded',role:'role',selected:'aria-selected',multiselectable:'aria-multiselectable',sort:'aria-sort',busy:'aria-busy',invalid:'aria-invalid',grabbed:'aria-grabbed',dropeffect:'aria-dropeffect',haspopup:'aria-haspopup',level:'aria-level',colcount:'aria-colcount'};_export('HeaderCellRenderer',HeaderCellRenderer=function(_CellRenderer){_inherits(HeaderCellRenderer,_CellRenderer);function HeaderCellRenderer(){_classCallCheck(this,HeaderCellRenderer);var _this21=_possibleConstructorReturn(this,(HeaderCellRenderer.__proto__||Object.getPrototypeOf(HeaderCellRenderer)).apply(this,arguments));_this21.element=createElement('TH',{className:'e-headercell',attrs:{role:'columnheader',tabindex:'-1'}});_this21.ariaService=new AriaService();_this21.hTxtEle=createElement('span',{className:'e-headertext'});_this21.sortEle=createElement('div',{className:'e-sortfilterdiv e-icons'});_this21.gui=createElement('div');_this21.chkAllBox=createElement('input',{className:'e-checkselectall',attrs:{'type':'checkbox'}});return _this21;}/**
     * Function to return the wrapper for the TH content.
     * @returns string
     */_createClass(HeaderCellRenderer,[{key:'getGui',value:function getGui(){return this.gui.cloneNode();}},{key:'render',value:function render(cell,data,attributes$$1){var node=this.element.cloneNode();var fltrMenuEle=createElement('div',{className:'e-filtermenudiv e-icons e-icon-filter'});return this.prepareHeader(cell,node,fltrMenuEle);}},{key:'refresh',value:function refresh(cell,node){this.clean(node);var fltrMenuEle=createElement('div',{className:'e-filtermenudiv e-icons e-icon-filter'});return this.prepareHeader(cell,node,fltrMenuEle);}},{key:'clean',value:function clean(node){node.innerHTML='';}},{key:'prepareHeader',value:function prepareHeader(cell,node,fltrMenuEle){var column=cell.column;var ariaAttr={};//Prepare innerHtml
var innerDIV=this.getGui();attributes(innerDIV,{'e-mappinguid':column.uid,'class':'e-headercelldiv'});if(column.type!=='checkbox'){var value=column.headerText;var headerText=this.hTxtEle.cloneNode();//TODO: Header Template support.
headerText[column.getDomSetter()]=value;innerDIV.appendChild(headerText);}else{column.editType='booleanedit';var checkAllWrap=createCheckBox(false,{checked:false,label:' '});checkAllWrap.insertBefore(this.chkAllBox.cloneNode(),checkAllWrap.firstChild);innerDIV.appendChild(checkAllWrap);innerDIV.classList.add('e-headerchkcelldiv');}this.buildAttributeFromCell(node,cell);this.appendHtml(node,innerDIV);node.appendChild(this.sortEle.cloneNode());if(this.parent.allowFiltering&&this.parent.filterSettings.type!=='FilterBar'&&column.allowFiltering&&!isNullOrUndefined(column.field)&&!(this.parent.showColumnMenu&&column.showColumnMenu)){attributes(fltrMenuEle,{'e-mappinguid':'e-flmenu-'+column.uid});node.classList.add('e-fltr-icon');var matchFlColumns=[];if(this.parent.filterSettings.columns.length&&this.parent.filterSettings.columns.length!==matchFlColumns.length){for(var index=0;index<this.parent.columns.length;index++){for(var count=0;count<this.parent.filterSettings.columns.length;count++){if(this.parent.filterSettings.columns[count].field===column.field){fltrMenuEle.classList.add('e-filtered');matchFlColumns.push(column.field);break;}}}}node.appendChild(fltrMenuEle.cloneNode());}if(cell.className){node.classList.add(cell.className);}if(column.customAttributes){setStyleAndAttributes(node,column.customAttributes);}if(column.allowSorting){ariaAttr.sort='none';}if(column.allowGrouping){ariaAttr.grabbed=false;}node=this.extendPrepareHeader(column,node);if(!isNullOrUndefined(column.headerTemplate)){if(column.headerTemplate.indexOf('#')!==-1){innerDIV.innerHTML=document.querySelector(column.headerTemplate).innerHTML.trim();}else{innerDIV.innerHTML=column.headerTemplate;}}this.ariaService.setOptions(node,ariaAttr);if(!isNullOrUndefined(column.headerTextAlign)||!isNullOrUndefined(column.textAlign)){var alignment=column.headerTextAlign||column.textAlign;innerDIV.style.textAlign=alignment;if(alignment==='Right'||alignment==='Left'){node.classList.add(alignment==='Right'?'e-rightalign':'e-leftalign');}else if(alignment==='Center'){node.classList.add('e-centeralign');}}if(column.clipMode==='Clip'){node.classList.add('e-gridclip');}else if(column.clipMode==='EllipsisWithTooltip'){node.classList.add('e-ellipsistooltip');}node.setAttribute('aria-rowspan',(!isNullOrUndefined(cell.rowSpan)?cell.rowSpan:1).toString());node.setAttribute('aria-colspan','1');return node;}},{key:'extendPrepareHeader',value:function extendPrepareHeader(column,node){if(this.parent.showColumnMenu&&column.showColumnMenu&&!isNullOrUndefined(column.field)){var element=createElement('div',{className:'e-icons e-columnmenu'});var matchFilteredColumns=[];if(this.parent.filterSettings.columns.length&&this.parent.filterSettings.columns.length!==matchFilteredColumns.length){for(var i=0;i<this.parent.columns.length;i++){for(var j=0;j<this.parent.filterSettings.columns.length;j++){if(this.parent.filterSettings.columns[j].field===column.field){element.classList.add('e-filtered');matchFilteredColumns.push(column.field);break;}}}}node.classList.add('e-fltr-icon');node.appendChild(element);}if(this.parent.allowResizing){var handler=createElement('div');handler.className=column.allowResizing?'e-rhandler e-rcursor':'e-rsuppress';node.appendChild(handler);}return node;}},{key:'appendHtml',value:function appendHtml(node,innerHtml){node.appendChild(innerHtml);return node;}}]);return HeaderCellRenderer;}(CellRenderer));_export('StackedHeaderCellRenderer',StackedHeaderCellRenderer=function(_CellRenderer2){_inherits(StackedHeaderCellRenderer,_CellRenderer2);function StackedHeaderCellRenderer(){_classCallCheck(this,StackedHeaderCellRenderer);var _this22=_possibleConstructorReturn(this,(StackedHeaderCellRenderer.__proto__||Object.getPrototypeOf(StackedHeaderCellRenderer)).apply(this,arguments));_this22.element=createElement('TH',{className:'e-headercell e-stackedheadercell',attrs:{role:'columnheader',tabindex:'-1'}});return _this22;}/**
     * Function to render the cell content based on Column object.
     * @param  {Column} column
     * @param  {Object} data
     * @param  {Element}
     */_createClass(StackedHeaderCellRenderer,[{key:'render',value:function render(cell,data,attributes$$1){var node=this.element.cloneNode();var div=createElement('div',{className:'e-stackedheadercelldiv'});node.appendChild(div);div.innerHTML=cell.column.headerText;if(cell.column.toolTip){node.setAttribute('title',cell.column.toolTip);}if(!isNullOrUndefined(cell.column.textAlign)){div.style.textAlign=cell.column.textAlign;}node.setAttribute('colspan',cell.colSpan.toString());node.setAttribute('aria-colspan',cell.colSpan.toString());node.setAttribute('aria-rowspan','1');return node;}}]);return StackedHeaderCellRenderer;}(CellRenderer));_export('IndentCellRenderer',IndentCellRenderer=function(_CellRenderer3){_inherits(IndentCellRenderer,_CellRenderer3);function IndentCellRenderer(){_classCallCheck(this,IndentCellRenderer);var _this23=_possibleConstructorReturn(this,(IndentCellRenderer.__proto__||Object.getPrototypeOf(IndentCellRenderer)).apply(this,arguments));_this23.element=createElement('TD',{className:'e-indentcell'});return _this23;}/**
     * Function to render the indent cell
     * @param  {Cell} cell
     * @param  {Object} data
     */_createClass(IndentCellRenderer,[{key:'render',value:function render(cell,data){var node=this.element.cloneNode();setStyleAndAttributes(node,cell.attributes);return node;}}]);return IndentCellRenderer;}(CellRenderer));_export('GroupCaptionCellRenderer',GroupCaptionCellRenderer=function(_CellRenderer4){_inherits(GroupCaptionCellRenderer,_CellRenderer4);function GroupCaptionCellRenderer(){_classCallCheck(this,GroupCaptionCellRenderer);var _this24=_possibleConstructorReturn(this,(GroupCaptionCellRenderer.__proto__||Object.getPrototypeOf(GroupCaptionCellRenderer)).apply(this,arguments));_this24.element=createElement('TD',{className:'e-groupcaption',attrs:{role:'gridcell',tabindex:'-1'}});return _this24;}/**
     * Function to render the cell content based on Column object.
     * @param  {Cell} cell
     * @param  {Object} data
     */_createClass(GroupCaptionCellRenderer,[{key:'render',value:function render(cell,data){var node=this.element.cloneNode();var gObj=this.parent;var result=void 0;var fKeyValue=void 0;if(cell.isForeignKey){fKeyValue=this.format(cell.column,cell.column.valueAccessor('foreignKey',data,cell.column));}var value=cell.isForeignKey?fKeyValue:cell.column.enableGroupByFormat?data.key:this.format(cell.column,cell.column.valueAccessor('key',data,cell.column));if(!isNullOrUndefined(gObj.groupSettings.captionTemplate)){if(gObj.groupSettings.captionTemplate.indexOf('#')!==-1){result=templateCompiler(document.querySelector(gObj.groupSettings.captionTemplate).innerHTML.trim())(data);}else{result=templateCompiler(gObj.groupSettings.captionTemplate)(data);}appendChildren(node,result);}else{node.innerHTML=cell.column.headerText+': '+value+' - '+data.count+' '+(data.count<2?this.localizer.getConstant('Item'):this.localizer.getConstant('Items'));}node.setAttribute('colspan',cell.colSpan.toString());node.setAttribute('aria-label',node.innerHTML+' is groupcaption cell');node.setAttribute('title',node.innerHTML);return node;}}]);return GroupCaptionCellRenderer;}(CellRenderer));_export('GroupCaptionEmptyCellRenderer',GroupCaptionEmptyCellRenderer=function(_CellRenderer5){_inherits(GroupCaptionEmptyCellRenderer,_CellRenderer5);function GroupCaptionEmptyCellRenderer(){_classCallCheck(this,GroupCaptionEmptyCellRenderer);var _this25=_possibleConstructorReturn(this,(GroupCaptionEmptyCellRenderer.__proto__||Object.getPrototypeOf(GroupCaptionEmptyCellRenderer)).apply(this,arguments));_this25.element=createElement('TD',{className:'e-groupcaption'});return _this25;}/**
     * Function to render the cell content based on Column object.
     * @param  {Cell} cell
     * @param  {Object} data
     */_createClass(GroupCaptionEmptyCellRenderer,[{key:'render',value:function render(cell,data){var node=this.element.cloneNode();node.innerHTML='&nbsp;';node.setAttribute('colspan',cell.colSpan.toString());return node;}}]);return GroupCaptionEmptyCellRenderer;}(CellRenderer));ExpandCellRenderer=function(_IndentCellRenderer){_inherits(ExpandCellRenderer,_IndentCellRenderer);function ExpandCellRenderer(){_classCallCheck(this,ExpandCellRenderer);return _possibleConstructorReturn(this,(ExpandCellRenderer.__proto__||Object.getPrototypeOf(ExpandCellRenderer)).apply(this,arguments));}_createClass(ExpandCellRenderer,[{key:'render',value:function render(cell,data){var node=this.element.cloneNode();node.className='e-recordplusexpand';node.setAttribute('ej-mappingname',data.field);node.setAttribute('ej-mappingvalue',data.key);node.setAttribute('aria-expanded','true');node.setAttribute('tabindex','-1');node.appendChild(createElement('div',{className:'e-icons e-gdiagonaldown e-icon-gdownarrow'}));return node;}}]);return ExpandCellRenderer;}(IndentCellRenderer);HeaderIndentCellRenderer=function(_CellRenderer6){_inherits(HeaderIndentCellRenderer,_CellRenderer6);function HeaderIndentCellRenderer(){_classCallCheck(this,HeaderIndentCellRenderer);var _this27=_possibleConstructorReturn(this,(HeaderIndentCellRenderer.__proto__||Object.getPrototypeOf(HeaderIndentCellRenderer)).apply(this,arguments));_this27.element=createElement('TH',{className:'e-grouptopleftcell'});return _this27;}/**
     * Function to render the indent cell
     * @param  {Cell} cell
     * @param  {Object} data
     */_createClass(HeaderIndentCellRenderer,[{key:'render',value:function render(cell,data){var node=this.element.cloneNode();node.appendChild(createElement('div',{className:'e-headercelldiv e-emptycell',innerHTML:'&nbsp;'}));return node;}}]);return HeaderIndentCellRenderer;}(CellRenderer);DetailHeaderIndentCellRenderer=function(_CellRenderer7){_inherits(DetailHeaderIndentCellRenderer,_CellRenderer7);function DetailHeaderIndentCellRenderer(){_classCallCheck(this,DetailHeaderIndentCellRenderer);var _this28=_possibleConstructorReturn(this,(DetailHeaderIndentCellRenderer.__proto__||Object.getPrototypeOf(DetailHeaderIndentCellRenderer)).apply(this,arguments));_this28.element=createElement('TH',{className:'e-detailheadercell'});return _this28;}/**
     * Function to render the detail indent cell
     * @param  {Cell} cell
     * @param  {Object} data
     */_createClass(DetailHeaderIndentCellRenderer,[{key:'render',value:function render(cell,data){var node=this.element.cloneNode();node.appendChild(createElement('div',{className:'e-emptycell'}));return node;}}]);return DetailHeaderIndentCellRenderer;}(CellRenderer);DetailExpandCellRenderer=function(_CellRenderer8){_inherits(DetailExpandCellRenderer,_CellRenderer8);function DetailExpandCellRenderer(){_classCallCheck(this,DetailExpandCellRenderer);var _this29=_possibleConstructorReturn(this,(DetailExpandCellRenderer.__proto__||Object.getPrototypeOf(DetailExpandCellRenderer)).apply(this,arguments));_this29.element=createElement('TD',{className:'e-detailrowcollapse',attrs:{'aria-expanded':'false',role:'gridcell',tabindex:'-1'}});return _this29;}/**
     * Function to render the detail expand cell
     */_createClass(DetailExpandCellRenderer,[{key:'render',value:function render(cell,data,attributes$$1){var node=this.element.cloneNode();if(attributes$$1&&!isNullOrUndefined(attributes$$1['class'])){node.className='';node.className=attributes$$1['class'];node.appendChild(createElement('div',{className:'e-icons e-dtdiagonaldown e-icon-gdownarrow'}));}else{node.appendChild(createElement('div',{className:'e-icons e-dtdiagonalright e-icon-grightarrow'}));}return node;}}]);return DetailExpandCellRenderer;}(CellRenderer);_export('Render',Render=function(){/**
     * Constructor for render module
     */function Render(parent,locator){_classCallCheck(this,Render);this.emptyGrid=false;this.parent=parent;this.locator=locator;this.data=new Data(parent,locator);this.l10n=locator.getService('localization');this.ariaService=this.locator.getService('ariaService');this.renderer=this.locator.getService('rendererFactory');this.addEventListener();}/**
     * To initialize grid header, content and footer rendering
     */_createClass(Render,[{key:'render',value:function render(){var gObj=this.parent;this.headerRenderer=this.renderer.getRenderer(RenderType.Header);this.contentRenderer=this.renderer.getRenderer(RenderType.Content);this.headerRenderer.renderPanel();this.contentRenderer.renderPanel();if(gObj.getColumns().length){this.headerRenderer.renderTable();this.contentRenderer.renderTable();this.emptyRow(false);}this.refreshDataManager();}},{key:'refresh',value:function refresh(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{requestType:'refresh'};this.parent.notify(e.requestType+'-begin',e);this.parent.trigger(actionBegin,e);if(e.cancel){return;}this.refreshDataManager(e);}},{key:'refreshComplete',value:function refreshComplete(e){this.parent.trigger(actionComplete,e);}},{key:'refreshDataManager',value:function refreshDataManager(){var _this30=this;var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(args.requestType!=='virtualscroll'){this.parent.showSpinner();}this.parent.isEdit=false;this.emptyGrid=false;var dataManager=void 0;var isFActon=this.isNeedForeignAction();this.ariaService.setBusy(this.parent.getContent().firstChild,true);if(isFActon){var deffered=new Deferred();dataManager=this.getFData(deffered);}if(!dataManager){dataManager=this.data.getData(args,this.data.generateQuery().requiresCount()).catch(function(e){_this30.parent.trigger(actionFailure,e);return e;});}else{dataManager=dataManager.then(function(e){var query=_this30.data.generateQuery().requiresCount();if(_this30.emptyGrid){var def=new Deferred();def.resolve({result:[],count:0});return def.promise;}return _this30.data.getData(args,query);}).catch(function(e){_this30.parent.trigger(actionFailure,e);return e;});}if(this.parent.getForeignKeyColumns().length&&(!isFActon||this.parent.searchSettings.key.length)){var _deffered=new Deferred();dataManager=dataManager.then(function(e){_this30.parent.notify(getForeignKeyData,{dataManager:dataManager,result:e,promise:_deffered});return _deffered.promise;});}if(this.parent.groupSettings.disablePageWiseAggregates&&this.parent.groupSettings.columns.length){dataManager=dataManager.then(function(e){return _this30.validateGroupRecords(e);});}dataManager.then(function(e){return _this30.dataManagerSuccess(e,args);}).catch(function(e){return _this30.dataManagerFailure(e);});}},{key:'getFData',value:function getFData(deferred){this.parent.notify(getForeignKeyData,{isComplex:true,promise:deferred});return deferred.promise;}},{key:'isNeedForeignAction',value:function isNeedForeignAction(){var gObj=this.parent;return!!(gObj.allowFiltering&&gObj.filterSettings.columns.length||gObj.searchSettings.key.length)&&this.foreignKey(this.parent.getForeignKeyColumns());}},{key:'foreignKey',value:function foreignKey(columns){var _this31=this;return columns.some(function(col){var fbool=false;fbool=_this31.parent.filterSettings.columns.some(function(value){return col.foreignKeyValue===value.field;});return!!(fbool||_this31.parent.searchSettings.key.length);});}},{key:'sendBulkRequest',value:function sendBulkRequest(args){var _this32=this;var promise=this.data.saveChanges(args.changes,this.parent.getPrimaryKeyFieldNames()[0]);if(this.data.dataManager.dataSource.offline){this.refreshDataManager({requestType:'batchsave'});return;}else{promise.then(function(e){return _this32.dmSuccess(e,args);}).catch(function(e){return _this32.dmFailure(e);});}}},{key:'dmSuccess',value:function dmSuccess(e,args){this.dataManagerSuccess(e,args);}},{key:'dmFailure',value:function dmFailure(e){this.dataManagerFailure(e);}},{key:'renderEmptyRow',value:function renderEmptyRow(){this.emptyRow(true);}},{key:'emptyRow',value:function emptyRow(isTrigger){var gObj=this.parent;var tbody=this.contentRenderer.getTable().querySelector('tbody');var tr=void 0;remove(tbody);tbody=createElement('tbody');tr=createElement('tr',{className:'e-emptyrow'});tr.appendChild(createElement('td',{innerHTML:this.l10n.getConstant('EmptyRecord'),attrs:{colspan:gObj.getColumns().length.toString()}}));tbody.appendChild(tr);this.contentRenderer.renderEmpty(tbody);if(isTrigger){this.parent.trigger(dataBound,{});this.parent.notify(onEmpty,{rows:[new Row({isDataRow:true,cells:[new Cell({isDataCell:true,visible:true})]})]});}}},{key:'updateColumnType',value:function updateColumnType(record){var columns=this.parent.getColumns();var value=void 0;var data=record&&record.items?record.items[0]:record;var fmtr=this.locator.getService('valueFormatter');for(var i=0,len=columns.length;i<len;i++){value=columns[i].isForeignColumn()?getValue(columns[i].foreignKeyValue||'',columns[i].columnData[0]):getValue(columns[i].field||'',data);if(!isNullOrUndefined(value)){this.isColTypeDef=true;if(!columns[i].type){columns[i].type=value.getDay?value.getHours()>0||value.getMinutes()>0||value.getSeconds()>0||value.getMilliseconds()>0?'datetime':'date':typeof value==='undefined'?'undefined':_typeof(value);}}else{columns[i].type=columns[i].type||null;}var valueFormatter=new ValueFormatter();if(columns[i].format&&(columns[i].format.skeleton||columns[i].format.format)){columns[i].setFormatter(valueFormatter.getFormatFunction(columns[i].format));columns[i].setParser(valueFormatter.getParserFunction(columns[i].format));}if(typeof columns[i].format==='string'){setFormatter(this.locator,columns[i]);}else if(!columns[i].format&&columns[i].type==='number'){columns[i].setParser(fmtr.getParserFunction({format:'n2'}));}}}},{key:'dataManagerSuccess',value:function dataManagerSuccess(e,args){var gObj=this.parent;gObj.trigger(beforeDataBound,e);var len=Object.keys(e.result).length;if(this.parent.isDestroyed){return;}this.parent.notify(tooltipDestroy,{});gObj.currentViewData=e.result;if(!len&&e.count&&gObj.allowPaging){gObj.pageSettings.totalRecordsCount=e.count;gObj.pageSettings.currentPage=Math.ceil(e.count/gObj.pageSettings.pageSize);gObj.dataBind();return;}if(!gObj.getColumns().length&&len){this.updatesOnInitialRender(e);}if(!this.isColTypeDef&&gObj.getCurrentViewRecords()){this.updateColumnType(gObj.getCurrentViewRecords()[0]);}this.parent.notify(dataReady,extend({count:e.count,result:e.result,aggregates:e.aggregates},args));if(gObj.groupSettings.columns.length||args&&args.requestType==='ungrouping'){this.headerRenderer.refreshUI();}if(len){this.contentRenderer.refreshContentRows(args);}else{if(!gObj.getColumns().length){gObj.element.innerHTML='';alert(this.l10n.getConstant('EmptyDataSourceError'));//ToDO: change this alert as dialog
return;}this.contentRenderer.setRowElements([]);this.renderEmptyRow();if(args){var action=(args.requestType||'').toLowerCase()+'-complete';this.parent.notify(action,args);}this.parent.hideSpinner();}this.parent.notify(toolbarRefresh,{});}},{key:'dataManagerFailure',value:function dataManagerFailure(e){this.ariaService.setOptions(this.parent.getContent().firstChild,{busy:false,invalid:true});this.parent.trigger(actionFailure,{error:e});this.parent.currentViewData=[];this.renderEmptyRow();this.parent.hideSpinner();}},{key:'updatesOnInitialRender',value:function updatesOnInitialRender(e){this.buildColumns(e.result[0]);prepareColumns(this.parent.columns);this.headerRenderer.renderTable();this.contentRenderer.renderTable();this.parent.notify(autoCol,{});}},{key:'buildColumns',value:function buildColumns(record){var columns=Object.keys(record);var cols=[];for(var i=0,len=columns.length;i<len;i++){cols[i]={'field':columns[i]};if(this.parent.enableColumnVirtualization){cols[i].width=!isNullOrUndefined(cols[i].width)?cols[i].width:200;}}this.parent.columns=cols;}},{key:'instantiateRenderer',value:function instantiateRenderer(){this.renderer.addRenderer(RenderType.Header,new HeaderRender(this.parent,this.locator));this.renderer.addRenderer(RenderType.Content,new ContentRender(this.parent,this.locator));var cellrender=this.locator.getService('cellRendererFactory');cellrender.addCellRenderer(CellType.Header,new HeaderCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.Data,new CellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.StackedHeader,new StackedHeaderCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.Indent,new IndentCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.GroupCaption,new GroupCaptionCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.GroupCaptionEmpty,new GroupCaptionEmptyCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.Expand,new ExpandCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.HeaderIndent,new HeaderIndentCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.StackedHeader,new StackedHeaderCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.DetailHeader,new DetailHeaderIndentCellRenderer(this.parent,this.locator));cellrender.addCellRenderer(CellType.DetailExpand,new DetailExpandCellRenderer(this.parent,this.locator));}},{key:'addEventListener',value:function addEventListener(){var _this33=this;if(this.parent.isDestroyed){return;}this.parent.on(initialLoad,this.instantiateRenderer,this);this.parent.on(modelChanged,this.refresh,this);this.parent.on(refreshComplete,this.refreshComplete,this);this.parent.on(bulkSave,this.sendBulkRequest,this);this.parent.on(showEmptyGrid,function(){_this33.emptyGrid=true;},this);}},{key:'validateGroupRecords',value:function validateGroupRecords(e){var _this34=this;var index=e.result.length-1;if(index<0){return Promise.resolve(e);}var group0=e.result[0];var groupN=e.result[index];var predicate=[];var addWhere=function addWhere(input){[group0,groupN].forEach(function(group){return predicate.push(new Predicate('field','==',group.field).and(_this34.getPredicate('key','equal',group.key)));});input.where(Predicate.or(predicate));};var query=new Query();addWhere(query);var curDm=new DataManager(e.result);var curFilter=curDm.executeLocal(query);var newQuery=this.data.generateQuery(true);var rPredicate=[];if(this.data.isRemote()){[group0,groupN].forEach(function(group){return rPredicate.push(_this34.getPredicate(group.field,'equal',group.key));});newQuery.where(Predicate.or(rPredicate));}else{addWhere(newQuery);}var deferred=new Deferred();this.data.getData({},newQuery).then(function(r){_this34.updateGroupInfo(curFilter,r.result);deferred.resolve(e);}).catch(function(e){return deferred.reject(e);});return deferred.promise;}},{key:'getPredicate',value:function getPredicate(key,operator,value){if(value instanceof Date){return getDatePredicate({field:key,operator:operator,value:value});}return new Predicate(key,operator,value);}},{key:'updateGroupInfo',value:function updateGroupInfo(current,untouched){var _this35=this;var dm=new DataManager(untouched);current.forEach(function(element,index,array){var uGroup=dm.executeLocal(new Query().where(new Predicate('field','==',element.field).and(_this35.getPredicate('key','equal',element.key))))[0];element.count=uGroup.count;var itemGroup=element.items;var uGroupItem=uGroup.items;if(itemGroup.GroupGuid){element.items=_this35.updateGroupInfo(element.items,uGroup.items);}_this35.parent.aggregates.forEach(function(row){return row.columns.forEach(function(column){var types=column.type instanceof Array?column.type:[column.type];types.forEach(function(type){var key=column.field+' - '+type;element.aggregates[key]=calculateAggregate(type,itemGroup.level?uGroupItem.records:uGroup.items,column);});});});});return current;}}]);return Render;}());_export('CellRendererFactory',CellRendererFactory=function(){function CellRendererFactory(){_classCallCheck(this,CellRendererFactory);this.cellRenderMap={};}_createClass(CellRendererFactory,[{key:'addCellRenderer',value:function addCellRenderer(name,type){name=typeof name==='string'?name:getEnumValue(CellType,name);if(isNullOrUndefined(this.cellRenderMap[name])){this.cellRenderMap[name]=type;}}},{key:'getCellRenderer',value:function getCellRenderer(name){name=typeof name==='string'?name:getEnumValue(CellType,name);if(isNullOrUndefined(this.cellRenderMap[name])){throw'The cellRenderer '+name+' is not found';}else{return this.cellRenderMap[name];}}}]);return CellRendererFactory;}());_export('ServiceLocator',ServiceLocator=function(){function ServiceLocator(){_classCallCheck(this,ServiceLocator);this.services={};}_createClass(ServiceLocator,[{key:'register',value:function register(name,type){if(isNullOrUndefined(this.services[name])){this.services[name]=type;}}},{key:'getService',value:function getService(name){if(isNullOrUndefined(this.services[name])){throw'The service '+name+' is not registered';}return this.services[name];}}]);return ServiceLocator;}());RendererFactory=function(){function RendererFactory(){_classCallCheck(this,RendererFactory);this.rendererMap={};}_createClass(RendererFactory,[{key:'addRenderer',value:function addRenderer(name,type){var rName=getEnumValue(RenderType,name);if(isNullOrUndefined(this.rendererMap[rName])){this.rendererMap[rName]=type;}}},{key:'getRenderer',value:function getRenderer(name){var rName=getEnumValue(RenderType,name);if(isNullOrUndefined(this.rendererMap[rName])){throw'The renderer '+rName+' is not found';}else{return this.rendererMap[rName];}}}]);return RendererFactory;}();ColumnWidthService=function(){function ColumnWidthService(parent){_classCallCheck(this,ColumnWidthService);this.parent=parent;}_createClass(ColumnWidthService,[{key:'setWidthToColumns',value:function setWidthToColumns(){var _this36=this;var i=0;var indexes=this.parent.getColumnIndexesInView();var wFlag=true;if(this.parent.allowGrouping){for(var len=this.parent.groupSettings.columns.length;i<len;i++){if(this.parent.enableColumnVirtualization&&indexes.indexOf(i)===-1){wFlag=false;continue;}this.setColumnWidth(new Column({width:'30px'}),i);}}if(this.parent.detailTemplate||this.parent.childGrid){this.setColumnWidth(new Column({width:'30px'}),i);}this.parent.getColumns().forEach(function(column,index){_this36.setColumnWidth(column,wFlag?undefined:index);});}},{key:'setColumnWidth',value:function setColumnWidth(column,index,module){var columnIndex=isNullOrUndefined(index)?this.parent.getNormalizedColumnIndex(column.uid):index;var cWidth=this.getWidth(column);if(cWidth!==null){this.setWidth(cWidth,columnIndex);if(this.parent.allowResizing&&module==='resize'||this.parent.getFrozenColumns()&&this.parent.allowResizing){this.setWidthToTable();}this.parent.notify(columnWidthChanged,{index:columnIndex,width:cWidth,column:column,module:module});}}},{key:'setWidth',value:function setWidth(width,index){var header=this.parent.getHeaderTable();var content=this.parent.getContentTable();var fWidth=formatUnit(width);var headerCol=void 0;var frzCols=this.parent.getFrozenColumns();var mHdr=this.parent.getHeaderContent().querySelector('.e-movableheader');if(frzCols&&index>=frzCols&&mHdr&&mHdr.querySelector('colgroup')){headerCol=mHdr.querySelector('colgroup').children[index-frzCols];}else{headerCol=header.querySelector('colgroup').children[index];}if(headerCol){headerCol.style.width=fWidth;}var contentCol=void 0;if(frzCols&&index>=frzCols){contentCol=this.parent.getContent().querySelector('.e-movablecontent').querySelector('colgroup').children[index-frzCols];}else{contentCol=content.querySelector('colgroup').children[index];}if(contentCol){contentCol.style.width=fWidth;}var edit=content.querySelector('.e-table.e-inline-edit');if(edit){edit.querySelector('colgroup').children[index].style.width=fWidth;}}},{key:'getSiblingsHeight',value:function getSiblingsHeight(element){var previous=this.getHeightFromDirection(element,'previous');var next=this.getHeightFromDirection(element,'next');return previous+next;}},{key:'getHeightFromDirection',value:function getHeightFromDirection(element,direction){var sibling=element[direction+'ElementSibling'];var result=0;var classList$$1=['e-gridheader','e-gridfooter','e-groupdroparea','e-gridpager','e-toolbar'];while(sibling){if(classList$$1.some(function(value){return sibling.classList.contains(value);})){result+=sibling.offsetHeight;}sibling=sibling[direction+'ElementSibling'];}return result;}},{key:'getWidth',value:function getWidth(column){if(isNullOrUndefined(column.width)&&this.parent.allowResizing){column.width=200;}if(!column.width){return null;}var width=parseInt(column.width.toString(),10);if(column.minWidth&&width<parseInt(column.minWidth.toString(),10)){return column.minWidth;}else if(column.maxWidth&&width>parseInt(column.maxWidth.toString(),10)){return column.maxWidth;}else{return column.width;}}},{key:'getTableWidth',value:function getTableWidth(columns){var tWidth=0;var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=columns[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){var column=_step15.value;var cWidth=this.getWidth(column);if(column.visible!==false&&cWidth!==null){tWidth+=parseInt(cWidth.toString(),10);}}}catch(err){_didIteratorError15=true;_iteratorError15=err;}finally{try{if(!_iteratorNormalCompletion15&&_iterator15.return){_iterator15.return();}}finally{if(_didIteratorError15){throw _iteratorError15;}}}return tWidth;}},{key:'setWidthToFrozenTable',value:function setWidthToFrozenTable(){var columns=this.parent.getColumns();columns.splice(this.parent.getFrozenColumns(),columns.length);var freezeWidth=formatUnit(this.getTableWidth(columns));this.parent.getHeaderTable().style.width=freezeWidth;this.parent.getContentTable().style.width=freezeWidth;}},{key:'setWidthToMovableTable',value:function setWidthToMovableTable(){var columns=this.parent.getColumns();columns.splice(0,this.parent.getFrozenColumns());var movableWidth=formatUnit(this.getTableWidth(columns));if(this.parent.getHeaderContent().querySelector('.e-movableheader').firstElementChild){this.parent.getHeaderContent().querySelector('.e-movableheader').firstElementChild.style.width=movableWidth;}this.parent.getContent().querySelector('.e-movablecontent').firstElementChild.style.width=movableWidth;}},{key:'setWidthToTable',value:function setWidthToTable(){var tWidth=formatUnit(this.getTableWidth(this.parent.getColumns()));if(this.parent.getFrozenColumns()){this.setWidthToFrozenTable();this.setWidthToMovableTable();}else{this.parent.getHeaderTable().style.width=tWidth;this.parent.getContentTable().style.width=tWidth;}var edit=this.parent.element.querySelector('.e-table.e-inline-edit');if(edit){edit.style.width=tWidth;}}}]);return ColumnWidthService;}();FocusStrategy=function(){function FocusStrategy(parent){_classCallCheck(this,FocusStrategy);this.currentInfo={};this.oneTime=true;this.swap={};this.forget=true;this.skipFocus=true;this.focusByClick=false;this.prevIndexes={};this.parent=parent;this.addEventListener();}_createClass(FocusStrategy,[{key:'focusCheck',value:function focusCheck(e){var target=e.target;this.focusByClick=true;this.skipFocus=target.classList.contains('e-grid');}},{key:'onFocus',value:function onFocus(){if(this.parent.isDestroyed||Browser.isDevice||this.parent.enableVirtualization){return;}this.setActive(this.parent.frozenRows===0,this.parent.frozenColumns!==0);var current=this.getContent().matrix.get(0,-1,[0,1],null,this.getContent().validator());this.getContent().matrix.select(current[0],current[1]);if(this.skipFocus){this.focus();this.skipFocus=false;}}},{key:'passiveFocus',value:function passiveFocus(e){if(this.parent.isDestroyed){return;}if(e.target&&e.target.classList.contains('e-detailcell')){this.currentInfo.skipAction=false;addClass([this.currentInfo.element],['e-focused','e-focus']);}}},{key:'onBlur',value:function onBlur(e){if(this.parent.isEdit||e&&(!e.relatedTarget||closest(e.relatedTarget,'.e-grid'))){return;}this.removeFocus();this.skipFocus=false;this.currentInfo.skipAction=false;if(this.getContent().getFocusInfo().elementToFocus){this.getContent().getFocusInfo().elementToFocus.tabIndex=0;}}},{key:'onClick',value:function onClick(e,force){var isContent=!isNullOrUndefined(closest(e.target,'.e-gridcontent'));var isHeader=!isNullOrUndefined(closest(e.target,'.e-gridheader'));isContent=isContent&&isHeader?!isContent:isContent;var isFrozen=!isNullOrUndefined(closest(e.target,'.e-frozencontent'))||!isNullOrUndefined(closest(e.target,'.e-frozenheader'));if(!isContent&&isNullOrUndefined(closest(e.target,'.e-gridheader'))||e.target.classList.contains('e-content')){return;}this.setActive(isContent,isFrozen);if(!isContent&&isNullOrUndefined(closest(e.target,'.e-gridheader'))||e.target.classList.contains('e-filtermenudiv')){this.clearOutline();return;}var beforeArgs={cancel:false,byKey:false,byClick:!isNullOrUndefined(e.target),clickArgs:e};this.parent.notify(beforeCellFocused,beforeArgs);if(beforeArgs.cancel||closest(e.target,'.e-inline-edit')){return;}this.setActive(isContent,isFrozen);if(this.getContent()){var returnVal=this.getContent().onClick(e,force);if(returnVal===false){return;}this.focus();}}},{key:'onKeyPress',value:function onKeyPress(e){if(this.skipOn(e)){return;}var beforeArgs={cancel:false,byKey:true,byClick:false,keyArgs:e};this.parent.notify(beforeCellFocused,beforeArgs);if(beforeArgs.cancel){return;}var bValue=this.getContent().matrix.current;this.currentInfo.outline=true;var swapInfo=this.getContent().jump(e.action,bValue);this.swap=swapInfo;if(swapInfo.swap){this.setActive(!swapInfo.toHeader,swapInfo.toFrozen);this.getContent().matrix.current=this.getContent().getNextCurrent(bValue,swapInfo,this.active,e.action);this.prevIndexes={};}this.setActiveByKey(e.action,this.getContent());var returnVal=this.getContent().onKeyPress(e);if(returnVal===false){this.clearIndicator();return;}e.preventDefault();this.focus(e);}},{key:'skipOn',value:function skipOn(e){var target=e.target;if(!target){return false;}if(this.currentInfo.skipAction){this.clearIndicator();return true;}if(['pageUp','pageDown'].indexOf(e.action)>-1){this.clearIndicator();return true;}return e.action==='delete'||this.parent.editSettings.mode!=='Batch'&&(this.parent.isEdit||['insert','f2'].indexOf(e.action)>-1)||closest(document.activeElement,'.e-filterbarcell')!==null||closest(document.activeElement,'#'+this.parent.element.id+'_searchbar')!==null&&['enter','leftArrow','rightArrow','shiftLeft','shiftRight','ctrlPlusA'].indexOf(e.action)>-1||closest(target,'.e-gridcontent')===null&&closest(target,'.e-gridheader')===null||e.action==='space'&&!target.classList.contains('e-gridchkbox')&&closest(target,'.e-gridchkbox')===null&&closest(target,'.e-headerchkcelldiv')===null;}},{key:'getFocusedElement',value:function getFocusedElement(){return this.currentInfo.elementToFocus;}},{key:'getContent',value:function getContent(){return this.active||this.content;}},{key:'setActive',value:function setActive(content,isFrozen){this.active=content?isFrozen?this.fContent:this.content:isFrozen?this.fHeader:this.header;}},{key:'setFocusedElement',value:function setFocusedElement(element){var _this37=this;this.currentInfo.elementToFocus=element;setTimeout(function(){return _this37.currentInfo.elementToFocus.focus();},0);}},{key:'focus',value:function focus(e){this.removeFocus();this.addFocus(this.getContent().getFocusInfo(),e);}},{key:'removeFocus',value:function removeFocus(e){if(!this.currentInfo.element){return;}removeClass([this.currentInfo.element,this.currentInfo.elementToFocus],['e-focused','e-focus']);this.currentInfo.element.tabIndex=-1;}},{key:'addFocus',value:function addFocus(info,e){this.currentInfo=info;this.currentInfo.outline=info.outline&&!isNullOrUndefined(e);if(!info.element){return;}var isFocused=info.elementToFocus.classList.contains('e-focus');if(isFocused){return;}if(this.currentInfo.outline){addClass([info.element],['e-focused']);}addClass([info.elementToFocus],['e-focus']);info.element.tabIndex=0;if(!isFocused){this.setFocusedElement(info.elementToFocus);}this.parent.notify(cellFocused,{element:info.elementToFocus,parent:info.element,indexes:this.getContent().matrix.current,byKey:!isNullOrUndefined(e),byClick:isNullOrUndefined(e),keyArgs:e,isJump:this.swap.swap,container:this.getContent().getInfo(e),outline:!isNullOrUndefined(e),swapInfo:this.swap});var _getContent$matrix$cu=_slicedToArray(this.getContent().matrix.current,2),rowIndex=_getContent$matrix$cu[0],cellIndex=_getContent$matrix$cu[1];this.prevIndexes={rowIndex:rowIndex,cellIndex:cellIndex};this.focusByClick=false;}},{key:'refreshMatrix',value:function refreshMatrix(content){var _this38=this;return function(e){if(content&&e.args&&e.args.isFrozen&&!_this38.fContent){_this38.fContent=new FixedContentFocus(_this38.parent);}else if(content&&!_this38.content){_this38.content=new ContentFocus(_this38.parent);}if(!content&&e.args&&e.args.isFrozen&&!_this38.fHeader){_this38.fHeader=new FixedHeaderFocus(_this38.parent);}else if(!content&&!_this38.header){_this38.header=new HeaderFocus(_this38.parent);}var cFocus=content?e.args&&e.args.isFrozen?_this38.fContent:_this38.content:e.args&&e.args.isFrozen?_this38.fHeader:_this38.header;var rows=content?e.rows.slice(_this38.parent.frozenRows):e.rows;var updateRow=content?e.rows.slice(0,_this38.parent.frozenRows):e.rows;var matrix=cFocus.matrix.generate(updateRow,cFocus.selector);cFocus.matrix.generate(rows,cFocus.selector);cFocus.generateRows(updateRow,{matrix:matrix,handlerInstance:e.args&&e.args.isFrozen?_this38.fHeader:_this38.header});if(!Browser.isDevice&&!_this38.focusByClick&&e&&e.args&&e.args.requestType==='paging'){_this38.skipFocus=false;_this38.parent.element.focus();}};}},{key:'addEventListener',value:function addEventListener(){var _this39=this;if(this.parent.isDestroyed){return;}EventHandler.add(this.parent.element,'mousedown',this.focusCheck,this);EventHandler.add(this.parent.element,'focus',this.onFocus,this);this.parent.element.addEventListener('focus',this.passiveHandler=function(e){return _this39.passiveFocus(e);},true);EventHandler.add(this.parent.element,'focusout',this.onBlur,this);this.parent.on(keyPressed,this.onKeyPress,this);this.parent.on(click,this.onClick,this);this.parent.on(contentReady,this.refreshMatrix(true),this);this.parent.on(headerRefreshed,this.refreshMatrix(),this);this.parent.on('close-edit',this.restoreFocus,this);['start-edit','start-add'].forEach(function(evt){return _this39.parent.on(evt,_this39.clearIndicator,_this39);});['sorting'].forEach(function(action){return _this39.parent.on(action+'-complete',_this39.restoreFocus,_this39);});this.parent.on(batchAdd,this.refreshMatrix(true),this);this.parent.on(batchCancel,this.refreshMatrix(true),this);this.parent.on(batchDelete,this.refreshMatrix(true),this);this.parent.on(detailDataBound,this.refreshMatrix(true),this);this.parent.on(onEmpty,this.refreshMatrix(true),this);this.parent.on(cellFocused,this.internalCellFocus,this);}},{key:'removeEventListener',value:function removeEventListener(){var _this40=this;if(this.parent.isDestroyed){return;}EventHandler.remove(this.parent.element,'mousedown',this.focusCheck);EventHandler.remove(this.parent.element,'focus',this.onFocus);EventHandler.remove(this.parent.element,'focusout',this.onBlur);this.parent.element.removeEventListener('focus',this.passiveHandler,true);this.parent.off(keyPressed,this.onKeyPress);this.parent.off(click,this.onClick);this.parent.off(contentReady,this.refreshMatrix(true));this.parent.off(headerRefreshed,this.refreshMatrix());this.parent.off('close-edit',this.restoreFocus);['start-edit','start-add'].forEach(function(evt){return _this40.parent.off(evt,_this40.clearOutline);});['sorting'].forEach(function(action){return _this40.parent.off(action+'-complete',_this40.restoreFocus);});this.parent.off(batchAdd,this.refreshMatrix(true));this.parent.off(batchDelete,this.refreshMatrix(true));this.parent.off(batchCancel,this.refreshMatrix(true));this.parent.off(detailDataBound,this.refreshMatrix(true));this.parent.off(onEmpty,this.refreshMatrix(true));this.parent.off(cellFocused,this.internalCellFocus);}},{key:'destroy',value:function destroy(){this.removeEventListener();}},{key:'restoreFocus',value:function restoreFocus(){this.addFocus(this.getContent().getFocusInfo());}},{key:'clearOutline',value:function clearOutline(){this.getContent().matrix.current=this.getContent().matrix.get(0,-1,[0,1],'downArrow',this.getContent().validator());this.clearIndicator();}},{key:'clearIndicator',value:function clearIndicator(){if(!this.currentInfo.element||!this.currentInfo.elementToFocus){return;}removeClass([this.currentInfo.element,this.currentInfo.elementToFocus],['e-focus','e-focused']);}},{key:'getPrevIndexes',value:function getPrevIndexes(){var forget=this.forget;this.forget=false;return forget?{rowIndex:null,cellIndex:null}:this.prevIndexes;}},{key:'forgetPrevious',value:function forgetPrevious(){this.forget=true;}},{key:'setActiveByKey',value:function setActiveByKey(action,active){var _this41=this;if(this.parent.frozenColumns===0&&this.parent.frozenRows===0){return;}var info=void 0;var actions={'home':function home(){return{toHeader:!info.isContent,toFrozen:true};},'end':function end(){return{toHeader:!info.isContent,toFrozen:false};},'ctrlHome':function ctrlHome(){return{toHeader:true,toFrozen:_this41.parent.frozenColumns!==0};},'ctrlEnd':function ctrlEnd(){return{toHeader:false,toFrozen:false};}};if(!(action in actions)){return;}info=active.getInfo();var swap=actions[action]();this.setActive(!swap.toHeader,swap.toFrozen);this.getContent().matrix.current=active.matrix.current;}},{key:'internalCellFocus',value:function internalCellFocus(e){if(!(e.byKey&&e.container.isContent&&e.keyArgs.action==='enter'&&(e.parent.classList.contains('e-detailcell')||e.parent.classList.contains('e-unboundcell')||e.parent.classList.contains('e-templatecell')))){return;}this.clearIndicator();var focusEle=this.getContent().getFocusable(this.getFocusedElement());this.setFocusedElement(focusEle);this.currentInfo.skipAction=true;}}]);return FocusStrategy;}();Matrix=function(){function Matrix(){_classCallCheck(this,Matrix);this.matrix=[];this.current=[];}_createClass(Matrix,[{key:'set',value:function set(rowIndex,columnIndex,allow){rowIndex=Math.max(0,Math.min(rowIndex,this.rows));columnIndex=Math.max(0,Math.min(columnIndex,this.columns));this.matrix[rowIndex]=this.matrix[rowIndex]||[];this.matrix[rowIndex][columnIndex]=allow?1:0;}},{key:'get',value:function get(rowIndex,columnIndex,navigator,action,validator){var tmp=columnIndex;if(rowIndex+navigator[0]<0){return[rowIndex,columnIndex];}rowIndex=Math.max(0,Math.min(rowIndex+navigator[0],this.rows));columnIndex=Math.max(0,Math.min(columnIndex+navigator[1],this.matrix[rowIndex].length-1));if(tmp+navigator[1]>this.matrix[rowIndex].length-1&&validator(rowIndex,columnIndex,action)){return[rowIndex,tmp];}var first=this.first(this.matrix[rowIndex],columnIndex,navigator,true,action);columnIndex=first===null?tmp:first;var val=getValue(rowIndex+'.'+columnIndex,this.matrix);return this.inValid(val)||!validator(rowIndex,columnIndex,action)?this.get(rowIndex,tmp,navigator,action,validator):[rowIndex,columnIndex];}},{key:'first',value:function first(vector,index,navigator,moveTo,action){if((index<0||index===vector.length)&&this.inValid(vector[index])&&action!=='upArrow'&&action!=='downArrow'||!vector.some(function(v){return v===1;})){return null;}return!this.inValid(vector[index])?index:this.first(vector,['upArrow','downArrow','shiftUp','shiftDown'].indexOf(action)!==-1?moveTo?0:++index:index+navigator[1],navigator,false,action);}},{key:'select',value:function select(rowIndex,columnIndex){rowIndex=Math.max(0,Math.min(rowIndex,this.rows));columnIndex=Math.max(0,Math.min(columnIndex,this.matrix[rowIndex].length-1));this.current=[rowIndex,columnIndex];}},{key:'generate',value:function generate(rows,selector){var _this42=this;this.rows=rows.length-1;this.matrix=[];rows.forEach(function(row,rIndex){var cells=row.cells.filter(function(c){return c.isSpanned!==true;});_this42.columns=Math.max(cells.length-1,_this42.columns|0);cells.forEach(function(cell,cIndex){_this42.set(rIndex,cIndex,selector(row,cell));});});return this.matrix;}},{key:'inValid',value:function inValid(value){return value===0||value===undefined;}}]);return Matrix;}();ContentFocus=function(){function ContentFocus(parent){var _this43=this;_classCallCheck(this,ContentFocus);this.matrix=new Matrix();this.parent=parent;this.keyActions={'rightArrow':[0,1],'tab':[0,1],'leftArrow':[0,-1],'shiftTab':[0,-1],'upArrow':[-1,0],'downArrow':[1,0],'shiftUp':[-1,0],'shiftDown':[1,0],'shiftRight':[0,1],'shiftLeft':[0,-1],'enter':[1,0],'shiftEnter':[-1,0]};this.indexesByKey=function(action){var opt={'home':[_this43.matrix.current[0],-1,0,1],'end':[_this43.matrix.current[0],_this43.matrix.columns+1,0,-1],'ctrlHome':[0,-1,0,1],'ctrlEnd':[_this43.matrix.rows,_this43.matrix.columns+1,0,-1]};return opt[action]||null;};}_createClass(ContentFocus,[{key:'getTable',value:function getTable(){return this.parent.frozenColumns?this.parent.getContent().querySelector('.e-movablecontent .e-table'):this.parent.getContentTable();}},{key:'onKeyPress',value:function onKeyPress(e){var navigator=this.keyActions[e.action];var current=this.getCurrentFromAction(e.action,navigator,e.action in this.keyActions,e);if(!current){return;}if((['tab','shiftTab'].indexOf(e.action)>-1&&this.matrix.current||[]).toString()===current.toString()){if(current.toString()===[this.matrix.rows,this.matrix.columns].toString()||current.toString()===[0,0].toString()){return false;}}this.matrix.select(current[0],current[1]);}},{key:'getCurrentFromAction',value:function getCurrentFromAction(action){var navigator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[0,0];var isPresent=arguments[2];var e=arguments[3];if(!isPresent&&!this.indexesByKey(action)){return null;}if(!this.shouldFocusChange(e)){return this.matrix.current;}var _ref=this.indexesByKey(action)||[].concat(_toConsumableArray(this.matrix.current),_toConsumableArray(navigator)),_ref2=_slicedToArray(_ref,4),rowIndex=_ref2[0],cellIndex=_ref2[1],rN=_ref2[2],cN=_ref2[3];var current=this.matrix.get(rowIndex,cellIndex,[rN,cN],action,this.validator());return current;}},{key:'onClick',value:function onClick(e,force){var target=e.target;target=target.classList.contains('e-rowcell')?target:closest(target,'td');target=target?target:closest(e.target,'td.e-detailrowcollapse')||closest(e.target,'td.e-detailrowexpand');target=closest(e.target,'td.e-detailcell')?isNullOrUndefined(closest(closest(e.target,'.e-grid'),'td.e-detailcell'))?null:target:target;target=target&&closest(target,'table').classList.contains('e-table')?target:null;if(!target){return false;}var _ref3=[target.parentElement.rowIndex,target.cellIndex],rowIndex=_ref3[0],cellIndex=_ref3[1];var _matrix$current=_slicedToArray(this.matrix.current,2),oRowIndex=_matrix$current[0],oCellIndex=_matrix$current[1];var val=getValue(rowIndex+'.'+cellIndex,this.matrix.matrix);if(this.matrix.inValid(val)||!force&&oRowIndex===rowIndex&&oCellIndex===cellIndex){return false;}this.matrix.select(rowIndex,cellIndex);}},{key:'getFocusInfo',value:function getFocusInfo(){var info={};var _matrix$current2=_slicedToArray(this.matrix.current,2),_matrix$current2$=_matrix$current2[0],rowIndex=_matrix$current2$===undefined?0:_matrix$current2$,_matrix$current2$2=_matrix$current2[1],cellIndex=_matrix$current2$2===undefined?0:_matrix$current2$2;this.matrix.current=[rowIndex,cellIndex];info.element=this.getTable().rows[rowIndex].cells[cellIndex];if(!info.element){return info;}info.elementToFocus=!info.element.classList.contains('e-unboundcell')&&!info.element.classList.contains('e-detailcell')&&!info.element.classList.contains('e-templatecell')?this.getFocusable(info.element):info.element;info.outline=true;return info;}},{key:'getFocusable',value:function getFocusable(element){var query='button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])';if(this.parent.isEdit){query='input:not([type="hidden"]), select:not([aria-hidden="true"]), textarea';}var child=[].slice.call(element.querySelectorAll(query));/* Select the first focusable child element
         * if no child found then select the cell itself.
         * if Grid is in editable state, check for editable control inside child.
         */return child.length?child[0]:element;}},{key:'selector',value:function selector(row,cell){var types=[CellType.Expand,CellType.GroupCaption,CellType.CaptionSummary,CellType.GroupSummary];return(row.isDataRow&&cell.visible&&(cell.isDataCell||cell.isTemplate)||row.isDataRow&&cell.cellType===CellType.DetailExpand||!row.isDataRow&&types.indexOf(cell.cellType)>-1||cell.column&&cell.column.type==='checkbox'||cell.cellType===CellType.CommandColumn)&&!(row.edit==='delete'&&row.isDirty);}},{key:'jump',value:function jump(action,current){var frozenSwap=this.parent.frozenColumns>0&&(action==='leftArrow'||action==='shiftTab')&&current[1]===0;var enterFrozen=this.parent.frozenRows!==0&&action==='shiftEnter';var info={swap:(action==='upArrow'||enterFrozen)&&current[0]===0||frozenSwap,toHeader:(action==='upArrow'||enterFrozen)&&current[0]===0,toFrozen:frozenSwap};return info;}},{key:'getNextCurrent',value:function getNextCurrent(){var previous=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var swap=arguments[1];var active=arguments[2];var action=arguments[3];var current=[];if(action==='rightArrow'||action==='tab'){current[0]=previous[0];current[1]=-1;}else if(action==='downArrow'||action==='enter'){current[0]=-1;current[1]=previous[1];}return current;}},{key:'generateRows',value:function generateRows(rows,optionals){var _handlerInstance$matr;var matrix=optionals.matrix,handlerInstance=optionals.handlerInstance;var len=handlerInstance.matrix.matrix.length;var defaultLen=this.parent.allowFiltering&&this.parent.filterSettings.type==='FilterBar'?len+1:len;handlerInstance.matrix.matrix=handlerInstance.matrix.matrix.slice(0,defaultLen);//Header matrix update.
handlerInstance.matrix.rows=defaultLen;(_handlerInstance$matr=handlerInstance.matrix.matrix).push.apply(_handlerInstance$matr,_toConsumableArray(matrix));handlerInstance.matrix.rows+=matrix.length;}},{key:'getInfo',value:function getInfo(e){var info=this.getFocusInfo();var _matrix$current3=_slicedToArray(this.matrix.current,2),rIndex=_matrix$current3[0],cIndex=_matrix$current3[1];var isData=info.element.classList.contains('e-rowcell');var isSelectable=isData||e&&e.action!=='enter'&&(info.element.classList.contains('e-detailrowcollapse')||info.element.classList.contains('e-detailrowexpand'));var _ref4=[Math.min(parseInt(info.element.parentElement.getAttribute('aria-rowindex'),10),rIndex),Math.min(parseInt(info.element.getAttribute('aria-colindex'),10),cIndex)],rowIndex=_ref4[0],cellIndex=_ref4[1];return{isContent:true,isDataCell:isData,indexes:[rowIndex,cellIndex],isSelectable:isSelectable};}},{key:'validator',value:function validator(){var table=this.getTable();return function(rowIndex,cellIndex,action){var cell=table.rows[rowIndex].cells[cellIndex];if(action==='enter'||action==='shiftEnter'){return cell.classList.contains('e-rowcell');}if((action==='shiftUp'||action==='shiftDown')&&cell.classList.contains('e-rowcell')){return true;}else if(action!=='shiftUp'&&action!=='shiftDown'){return cell.getBoundingClientRect().width!==0;}return false;};}},{key:'shouldFocusChange',value:function shouldFocusChange(e){var _matrix$current4=_slicedToArray(this.matrix.current,2),_matrix$current4$=_matrix$current4[0],rIndex=_matrix$current4$===undefined?-1:_matrix$current4$,_matrix$current4$2=_matrix$current4[1],cIndex=_matrix$current4$2===undefined?-1:_matrix$current4$2;if(rIndex<0||cIndex<0){return true;}var cell=getValue(rIndex+'.cells.'+cIndex,this.getTable().rows);if(!cell){return true;}return e.action==='enter'||e.action==='shiftEnter'?cell.classList.contains('e-rowcell')&&!cell.classList.contains('e-unboundcell')&&!cell.classList.contains('e-templatecell')&&!cell.classList.contains('e-detailcell'):true;}}]);return ContentFocus;}();HeaderFocus=function(_ContentFocus){_inherits(HeaderFocus,_ContentFocus);function HeaderFocus(parent){_classCallCheck(this,HeaderFocus);return _possibleConstructorReturn(this,(HeaderFocus.__proto__||Object.getPrototypeOf(HeaderFocus)).call(this,parent));}_createClass(HeaderFocus,[{key:'getTable',value:function getTable(){return this.parent.frozenColumns?this.parent.getHeaderContent().querySelector('.e-movableheader .e-table'):this.parent.getHeaderTable();}},{key:'onClick',value:function onClick(e){var target=e.target;target=target.classList.contains('e-headercell')?target:closest(target,'th');if(!target&&this.parent.frozenRows!==0){target=e.target.classList.contains('e-rowcell')?e.target:closest(e.target,'td');}if(!target){return;}var _ref5=[target.parentElement.rowIndex,target.cellIndex],rowIndex=_ref5[0],cellIndex=_ref5[1];var val=getValue(rowIndex+'.'+cellIndex,this.matrix.matrix);if(this.matrix.inValid(val)){return false;}this.matrix.select(target.parentElement.rowIndex,target.cellIndex);}},{key:'getFocusInfo',value:function getFocusInfo(){var info={};var _matrix$current5=_slicedToArray(this.matrix.current,2),_matrix$current5$=_matrix$current5[0],rowIndex=_matrix$current5$===undefined?0:_matrix$current5$,_matrix$current5$2=_matrix$current5[1],cellIndex=_matrix$current5$2===undefined?0:_matrix$current5$2;info.element=this.getTable().rows[rowIndex].cells[cellIndex];info.elementToFocus=this.getFocusable(info.element);info.outline=!info.element.classList.contains('e-filterbarcell');return info;}},{key:'selector',value:function selector(row,cell){return cell.visible&&(cell.column.field!==undefined||cell.isTemplate)||cell.column.type==='checkbox'||cell.cellType===CellType.StackedHeader;}},{key:'jump',value:function jump(action,current){var frozenSwap=this.parent.frozenColumns>0&&(action==='leftArrow'||action==='shiftTab')&&current[1]===0;var enterFrozen=this.parent.frozenRows!==0&&action==='enter';return{swap:(action==='downArrow'||enterFrozen)&&current[0]===this.matrix.matrix.length-1||frozenSwap,toHeader:frozenSwap,toFrozen:frozenSwap};}},{key:'getNextCurrent',value:function getNextCurrent(){var previous=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var swap=arguments[1];var active=arguments[2];var action=arguments[3];var current=[];if(action==='upArrow'||action==='shiftEnter'){current[0]=this.matrix.matrix.length;current[1]=previous[1];}else if(action==='rightArrow'||action==='tab'){current[0]=previous[0];current[1]=-1;}return current;}},{key:'generateRows',value:function generateRows(rows){var _this45=this;var length=this.matrix.matrix.length;if(this.parent.allowFiltering&&this.parent.filterSettings.type==='FilterBar'){this.matrix.rows=++this.matrix.rows;rows[0].cells.forEach(function(cell,cIndex){return _this45.matrix.set(length,cIndex,cell.visible&&cell.column.allowFiltering!==false);});}}},{key:'getInfo',value:function getInfo(e){return extend(_get(HeaderFocus.prototype.__proto__||Object.getPrototypeOf(HeaderFocus.prototype),'getInfo',this).call(this,e),{isContent:false,isHeader:true});}},{key:'validator',value:function validator(){return function(){return true;};}},{key:'shouldFocusChange',value:function shouldFocusChange(e){var _matrix$current6=_slicedToArray(this.matrix.current,2),rIndex=_matrix$current6[0],cIndex=_matrix$current6[1];if(rIndex<0||cIndex<0){return true;}var cell=getValue(rIndex+'.cells.'+cIndex,this.getTable().rows);if(!cell){return true;}return e.action==='enter'||e.action==='altDownArrow'?!cell.classList.contains('e-headercell'):true;}}]);return HeaderFocus;}(ContentFocus);FixedContentFocus=function(_ContentFocus2){_inherits(FixedContentFocus,_ContentFocus2);function FixedContentFocus(){_classCallCheck(this,FixedContentFocus);return _possibleConstructorReturn(this,(FixedContentFocus.__proto__||Object.getPrototypeOf(FixedContentFocus)).apply(this,arguments));}_createClass(FixedContentFocus,[{key:'getTable',value:function getTable(){return this.parent.getContent().querySelector('.e-frozencontent .e-table');}},{key:'jump',value:function jump(action,current){var enterFrozen=this.parent.frozenRows!==0&&action==='shiftEnter';return{swap:(action==='upArrow'||enterFrozen)&&current[0]===0||(action==='tab'||action==='rightArrow')&&current[1]===this.matrix.columns,toHeader:(action==='upArrow'||enterFrozen)&&current[0]===0,toFrozen:(action==='upArrow'||enterFrozen)&&current[0]===0};}},{key:'getNextCurrent',value:function getNextCurrent(){var previous=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var swap=arguments[1];var active=arguments[2];var action=arguments[3];var current=[];if(action==='leftArrow'||action==='shiftTab'){current[0]=previous[0];current[1]=active.matrix.columns+1;}else if(action==='downArrow'||action==='enter'){current[0]=-1;current[1]=previous[1];}return current;}}]);return FixedContentFocus;}(ContentFocus);FixedHeaderFocus=function(_HeaderFocus){_inherits(FixedHeaderFocus,_HeaderFocus);function FixedHeaderFocus(){_classCallCheck(this,FixedHeaderFocus);return _possibleConstructorReturn(this,(FixedHeaderFocus.__proto__||Object.getPrototypeOf(FixedHeaderFocus)).apply(this,arguments));}_createClass(FixedHeaderFocus,[{key:'jump',value:function jump(action,current){var enterFrozen=this.parent.frozenRows!==0&&action==='enter';return{swap:(action==='downArrow'||enterFrozen)&&current[0]===this.matrix.matrix.length-1||(action==='rightArrow'||action==='tab')&&current[1]===this.matrix.columns,toHeader:(action==='rightArrow'||action==='tab')&&current[1]===this.matrix.columns,toFrozen:(action==='downArrow'||enterFrozen)&&current[0]===this.matrix.matrix.length-1};}},{key:'getTable',value:function getTable(){return this.parent.getHeaderContent().querySelector('.e-frozenheader .e-table');}},{key:'getNextCurrent',value:function getNextCurrent(){var previous=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var swap=arguments[1];var active=arguments[2];var action=arguments[3];var current=[];if(action==='leftArrow'||action==='shiftTab'){current[0]=previous[0];current[1]=active.matrix.columns+1;}else if(action==='upArrow'||action==='shiftEnter'){current[0]=this.matrix.matrix.length;current[1]=previous[1];}return current;}}]);return FixedHeaderFocus;}(HeaderFocus);SearchBox=function(){function SearchBox(searchBox){_classCallCheck(this,SearchBox);this.searchBox=searchBox;}_createClass(SearchBox,[{key:'searchFocus',value:function searchFocus(args){args.target.parentElement.classList.add('e-input-focus');}},{key:'searchBlur',value:function searchBlur(args){args.target.parentElement.classList.remove('e-input-focus');}},{key:'wireEvent',value:function wireEvent(){if(this.searchBox){EventHandler.add(this.searchBox,'focus',this.searchFocus,this);EventHandler.add(this.searchBox,'blur',this.searchBlur,this);}}},{key:'unWireEvent',value:function unWireEvent(){if(this.searchBox){EventHandler.remove(this.searchBox,'focus',this.searchFocus);EventHandler.remove(this.searchBox,'blur',this.searchBlur);}}}]);return SearchBox;}();__decorate$1=undefined&&undefined.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if((typeof Reflect==='undefined'?'undefined':_typeof(Reflect))==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--){if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;}return c>3&&r&&Object.defineProperty(target,key,r),r;};PageSettings=function(_ChildProperty){_inherits(PageSettings,_ChildProperty);function PageSettings(){_classCallCheck(this,PageSettings);return _possibleConstructorReturn(this,(PageSettings.__proto__||Object.getPrototypeOf(PageSettings)).apply(this,arguments));}return PageSettings;}(ChildProperty);__decorate$1([Property(12)],PageSettings.prototype,"pageSize",void 0);__decorate$1([Property(8)],PageSettings.prototype,"pageCount",void 0);__decorate$1([Property(1)],PageSettings.prototype,"currentPage",void 0);__decorate$1([Property()],PageSettings.prototype,"totalRecordsCount",void 0);__decorate$1([Property(false)],PageSettings.prototype,"enableQueryString",void 0);__decorate$1([Property(false)],PageSettings.prototype,"pageSizes",void 0);__decorate$1([Property(null)],PageSettings.prototype,"template",void 0);/**
 * The `Selection` module is used to handle cell and row selection.
 */_export('Selection',Selection=function(){/**
     * Constructor for the Grid selection module
     * @hidden
     */function Selection(parent,selectionSettings,locator){_classCallCheck(this,Selection);//Internal variables       
/**
         * @hidden
         */this.selectedRowIndexes=[];/**
         * @hidden
         */this.selectedRowCellIndexes=[];/**
         * @hidden
         */this.selectedRecords=[];this.preventFocus=false;this.isMultiShiftRequest=false;this.isMultiCtrlRequest=false;this.enableSelectMultiTouch=false;this.selectedRowState={};this.totalRecordsCount=0;this.chkAllCollec=[];this.isCheckedOnAdd=false;this.persistSelectedData=[];this.isCancelDeSelect=false;this.isPreventCellSelect=false;this.parent=parent;this.selectionSettings=selectionSettings;this.factory=locator.getService('rendererFactory');this.focus=locator.getService('focus');this.addEventListener();}_createClass(Selection,[{key:'initializeSelection',value:function initializeSelection(){EventHandler.add(this.parent.getContent(),'mousedown',this.mouseDownHandler,this);}},{key:'onActionBegin',value:function onActionBegin(args,type){this.parent.trigger(type,this.fDataUpdate(args));}},{key:'fDataUpdate',value:function fDataUpdate(args){if(args.cellIndex||args.rowIndex){var rowObj=this.getRowObj(isNullOrUndefined(args.rowIndex)?isNullOrUndefined(args.cellIndex)?this.currentIndex:args.cellIndex.rowIndex:args.rowIndex);args.foreignKeyData=rowObj.foreignKeyData;}return args;}},{key:'onActionComplete',value:function onActionComplete(args,type){this.parent.trigger(type,this.fDataUpdate(args));}},{key:'getModuleName',value:function getModuleName(){return'selection';}},{key:'destroy',value:function destroy(){this.hidePopUp();this.clearSelection();this.removeEventListener();EventHandler.remove(this.parent.getContent(),'mousedown',this.mouseDownHandler);}},{key:'isEditing',value:function isEditing(){return(this.parent.editSettings.mode==='Normal'||this.parent.editSettings.mode==='Batch'&&this.parent.editModule.formObj&&!this.parent.editModule.formObj.validate())&&this.parent.isEdit&&!this.parent.isPersistSelection;}},{key:'getSelectedMovableRow',value:function getSelectedMovableRow(index){var gObj=this.parent;if(gObj.getFrozenColumns()){return gObj.getMovableRowByIndex(index);}return null;}},{key:'selectRow',value:function selectRow(index,isToggle){var gObj=this.parent;var selectedRow=gObj.getRowByIndex(index);var selectedMovableRow=this.getSelectedMovableRow(index);var selectData=gObj.getCurrentViewRecords()[index];if(!this.isRowType()||!selectedRow||this.isEditing()){// if (this.isEditing()) {
//     gObj.selectedRowIndex = index;
// }
return;}var isRowSelected=selectedRow.hasAttribute('aria-selected');isToggle=!isToggle?isToggle:index===this.prevRowIndex&&isRowSelected;var args=void 0;var can='cancel';if(!isToggle){args={data:selectData,rowIndex:index,isCtrlPressed:this.isMultiCtrlRequest,isShiftPressed:this.isMultiShiftRequest,row:selectedRow,previousRow:gObj.getRows()[this.prevRowIndex],previousRowIndex:this.prevRowIndex,target:this.target};args=this.addMovableArgs(args,selectedMovableRow);this.onActionBegin(args,rowSelecting);}if(!isNullOrUndefined(args)&&args[can]===true){return;}this.clearRow();if(!isToggle){this.updateRowSelection(selectedRow,index);if(gObj.getFrozenColumns()){this.updateRowSelection(selectedMovableRow,index);}gObj.selectedRowIndex=index;}this.updateRowProps(index);if(!isToggle){args={data:selectData,rowIndex:index,row:selectedRow,previousRow:gObj.getRows()[this.prevRowIndex],previousRowIndex:this.prevRowIndex,target:this.target};args=this.addMovableArgs(args,selectedMovableRow);this.onActionComplete(args,rowSelected);}}},{key:'addMovableArgs',value:function addMovableArgs(targetObj,mRow){if(this.parent.getFrozenColumns()){var mObj={mRow:mRow,previousMovRow:this.parent.getMovableRows()[this.prevRowIndex]};targetObj=Object.assign({},targetObj,mObj);}return targetObj;}},{key:'selectRowsByRange',value:function selectRowsByRange(startIndex,endIndex){this.selectRows(this.getCollectionFromIndexes(startIndex,endIndex));this.parent.selectedRowIndex=endIndex;}},{key:'selectRows',value:function selectRows(rowIndexes){var gObj=this.parent;var rowIndex=!this.isSingleSel()?rowIndexes[0]:rowIndexes[rowIndexes.length-1];var selectedRow=gObj.getRowByIndex(rowIndex);var selectedMovableRow=this.getSelectedMovableRow(rowIndex);var frzCols=gObj.getFrozenColumns();var selectedData=gObj.getCurrentViewRecords()[rowIndexes[0]];if(!this.isRowType()||this.isEditing()){return;}var args={rowIndexes:rowIndexes,row:selectedRow,rowIndex:rowIndex,target:this.target,prevRow:gObj.getRows()[this.prevRowIndex],previousRowIndex:this.prevRowIndex,isCtrlPressed:this.isMultiCtrlRequest,isShiftPressed:this.isMultiShiftRequest,data:selectedData};args=this.addMovableArgs(args,selectedMovableRow);this.onActionBegin(args,rowSelecting);this.clearRow();if(!this.isSingleSel()){var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=rowIndexes[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=true){var rowIdx=_step16.value;this.updateRowSelection(gObj.getRowByIndex(rowIdx),rowIdx);if(frzCols){this.updateRowSelection(gObj.getMovableRowByIndex(rowIdx),rowIdx);}this.updateRowProps(rowIndex);}}catch(err){_didIteratorError16=true;_iteratorError16=err;}finally{try{if(!_iteratorNormalCompletion16&&_iterator16.return){_iterator16.return();}}finally{if(_didIteratorError16){throw _iteratorError16;}}}}else{this.updateRowSelection(gObj.getRowByIndex(rowIndex),rowIndex);if(frzCols){this.updateRowSelection(gObj.getMovableRowByIndex(rowIndex),rowIndex);}this.updateRowProps(rowIndex);}args={rowIndexes:rowIndexes,row:selectedRow,rowIndex:rowIndex,target:this.target,prevRow:gObj.getRows()[this.prevRowIndex],previousRowIndex:this.prevRowIndex,data:selectedData};args=this.addMovableArgs(args,selectedMovableRow);this.onActionComplete(args,rowSelected);}},{key:'addRowsToSelection',value:function addRowsToSelection(rowIndexes){var gObj=this.parent;var selectedRow=!this.isSingleSel()?gObj.getRowByIndex(rowIndexes[0]):gObj.getRowByIndex(rowIndexes[rowIndexes.length-1]);var selectedMovableRow=!this.isSingleSel()?this.getSelectedMovableRow(rowIndexes[0]):this.getSelectedMovableRow(rowIndexes[rowIndexes.length-1]);var frzCols=gObj.getFrozenColumns();if(!this.isRowType()||this.isEditing()){return;}var args=void 0;var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=rowIndexes[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=true){var rowIndex=_step17.value;var rowObj=this.getRowObj(rowIndex);var isUnSelected=this.selectedRowIndexes.indexOf(rowIndex)>-1;gObj.selectedRowIndex=rowIndex;if(isUnSelected){this.rowDeselect(rowDeselecting,[rowIndex],[rowObj.data],[selectedRow],[rowObj.foreignKeyData]);this.selectedRowIndexes.splice(this.selectedRowIndexes.indexOf(rowIndex),1);this.selectedRecords.splice(this.selectedRecords.indexOf(selectedRow),1);selectedRow.removeAttribute('aria-selected');this.addRemoveClassesForRow(selectedRow,false,null,'e-selectionbackground','e-active');if(selectedMovableRow){this.selectedRecords.splice(this.selectedRecords.indexOf(selectedMovableRow),1);selectedMovableRow.removeAttribute('aria-selected');this.addRemoveClassesForRow(selectedMovableRow,false,null,'e-selectionbackground','e-active');}this.rowDeselect(rowDeselected,[rowIndex],[rowObj.data],[selectedRow],[rowObj.foreignKeyData],[selectedMovableRow]);}else{args={data:rowObj.data,rowIndex:rowIndex,row:selectedRow,target:this.target,prevRow:gObj.getRows()[this.prevRowIndex],previousRowIndex:this.prevRowIndex,isCtrlPressed:this.isMultiCtrlRequest,isShiftPressed:this.isMultiShiftRequest,foreignKeyData:rowObj.foreignKeyData};args=this.addMovableArgs(args,selectedMovableRow);this.onActionBegin(args,rowSelecting);if(this.isSingleSel()){this.clearRow();}this.updateRowSelection(selectedRow,rowIndex);if(frzCols){this.updateRowSelection(selectedMovableRow,rowIndex);}}this.updateRowProps(rowIndex);if(!isUnSelected){args={data:rowObj.data,rowIndex:rowIndex,row:selectedRow,target:this.target,prevRow:gObj.getRows()[this.prevRowIndex],previousRowIndex:this.prevRowIndex,foreignKeyData:rowObj.foreignKeyData};args=this.addMovableArgs(args,selectedMovableRow);this.onActionComplete(args,rowSelected);}if(this.isSingleSel()){break;}}}catch(err){_didIteratorError17=true;_iteratorError17=err;}finally{try{if(!_iteratorNormalCompletion17&&_iterator17.return){_iterator17.return();}}finally{if(_didIteratorError17){throw _iteratorError17;}}}}},{key:'getCollectionFromIndexes',value:function getCollectionFromIndexes(startIndex,endIndex){var indexes=[];var _ref6=startIndex<endIndex?{i:startIndex,max:endIndex}:{i:endIndex,max:startIndex},i=_ref6.i,max=_ref6.max;for(;i<=max;i++){indexes.push(i);}if(startIndex>endIndex){indexes.reverse();}return indexes;}},{key:'clearRow',value:function clearRow(){this.clearRowSelection();this.selectedRowIndexes=[];this.selectedRecords=[];this.parent.selectedRowIndex=-1;if(this.isSingleSel()&&this.parent.isPersistSelection){this.selectedRowState={};}}},{key:'updateRowProps',value:function updateRowProps(startIndex){this.prevRowIndex=startIndex;this.isRowSelected=this.selectedRowIndexes.length&&true;}},{key:'updatePersistCollection',value:function updatePersistCollection(selectedRow,chkState){if(this.parent.isPersistSelection&&!isNullOrUndefined(selectedRow)){var rowObj=this.getRowObj(selectedRow);var pKey=rowObj.data?rowObj.data[this.primaryKey]:null;if(pKey===null){return;}rowObj.isSelected=chkState;if(chkState){this.selectedRowState[pKey]=chkState;if(this.persistSelectedData.indexOf(rowObj.data)<0){this.persistSelectedData.push(rowObj.data);}}else{delete this.selectedRowState[pKey];if(this.persistSelectedData.indexOf(rowObj.data)>=0){this.persistSelectedData.splice(this.persistSelectedData.indexOf(rowObj.data),1);}}}}},{key:'updateCheckBoxes',value:function updateCheckBoxes(row,chkState){if(!isNullOrUndefined(row)){var chkBox=row.querySelector('.e-checkselect');if(!isNullOrUndefined(chkBox)){removeAddCboxClasses(chkBox.nextElementSibling,chkState);if(isNullOrUndefined(this.checkedTarget)||!isNullOrUndefined(this.checkedTarget)&&!this.checkedTarget.classList.contains('e-checkselectall')){this.setCheckAllState();}}}}},{key:'updateRowSelection',value:function updateRowSelection(selectedRow,startIndex){if(!selectedRow){return;}this.selectedRowIndexes.push(startIndex);var len=this.selectedRowIndexes.length;if(this.parent.getFrozenColumns()&&len>1){if(this.selectedRowIndexes[len-2]===this.selectedRowIndexes[len-1]){this.selectedRowIndexes.pop();}}this.selectedRecords.push(selectedRow);selectedRow.setAttribute('aria-selected','true');this.updatePersistCollection(selectedRow,true);this.updateCheckBoxes(selectedRow,true);this.addRemoveClassesForRow(selectedRow,true,null,'e-selectionbackground','e-active');if(!this.preventFocus){var target=this.focus.getPrevIndexes().cellIndex?selectedRow.cells[this.focus.getPrevIndexes().cellIndex]:selectedRow.querySelector('.e-selectionbackground:not(.e-hide)');if(!target){return;}this.focus.onClick({target:target},true);}}},{key:'clearSelection',value:function clearSelection(){if(!this.parent.isPersistSelection||this.parent.isPersistSelection&&!this.parent.isEdit||!isNullOrUndefined(this.checkedTarget)&&this.checkedTarget.classList.contains('e-checkselectall')){var span=this.parent.element.querySelector('.e-gridpopup').querySelector('span');if(span.classList.contains('e-rowselect')){span.classList.remove('e-spanclicked');}this.clearRowSelection();this.clearCellSelection();this.enableSelectMultiTouch=false;}}},{key:'clearRowSelection',value:function clearRowSelection(){var _this49=this;if(this.isRowSelected){var gObj=this.parent;var rows=this.parent.getDataRows();var data=[];var row=[];var mRow=[];var rowIndex=[];var frzCols=gObj.getFrozenColumns();var foreignKeyData$$1=[];var currentViewData=this.parent.getCurrentViewRecords();for(var i=0,len=this.selectedRowIndexes.length;i<len;i++){var currentRow=this.parent.getDataRows()[this.selectedRowIndexes[i]];var rowObj=this.getRowObj(currentRow);if(rowObj){data.push(rowObj.data);row.push(currentRow);rowIndex.push(this.selectedRowIndexes[i]);foreignKeyData$$1.push(rowObj.foreignKeyData);}if(frzCols){mRow.push(gObj.getMovableRows()[this.selectedRowIndexes[i]]);}}this.rowDeselect(rowDeselecting,rowIndex,data,row,foreignKeyData$$1,mRow);if(this.isCancelDeSelect===true){return;}rows.filter(function(record){return record.hasAttribute('aria-selected');}).forEach(function(ele){ele.removeAttribute('aria-selected');_this49.addRemoveClassesForRow(ele,false,true,'e-selectionbackground','e-active');_this49.updatePersistCollection(ele,false);_this49.updateCheckBoxes(ele);});for(var _i5=0,_len6=this.selectedRowIndexes.length;_i5<_len6;_i5++){var movableRow=this.getSelectedMovableRow(this.selectedRowIndexes[_i5]);if(movableRow){movableRow.removeAttribute('aria-selected');this.addRemoveClassesForRow(movableRow,false,true,'e-selectionbackground','e-active');this.updatePersistCollection(movableRow,false);}}this.selectedRowIndexes=[];this.selectedRecords=[];this.isRowSelected=false;this.parent.selectedRowIndex=-1;this.rowDeselect(rowDeselected,rowIndex,data,row,foreignKeyData$$1,mRow);}}},{key:'rowDeselect',value:function rowDeselect(type,rowIndex,data,row,foreignKeyData$$1,mRow){var cancl='cancel';this.updatePersistCollection(row[0],false);var rowDeselectObj={rowIndex:rowIndex,data:data,row:row,foreignKeyData:foreignKeyData$$1};this.parent.trigger(type,this.parent.getFrozenColumns()?Object.assign({},rowDeselectObj,{mRow:mRow}):rowDeselectObj);this.isCancelDeSelect=rowDeselectObj[cancl];this.updateCheckBoxes(row[0]);}},{key:'getRowObj',value:function getRowObj(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.currentIndex;if(isNullOrUndefined(row)){return{};}if(typeof row==='number'){row=this.parent.getRowByIndex(row);}if(row){return this.parent.getRowObjectFromUID(row.getAttribute('data-uid'))||{};}return{};}},{key:'getSelectedMovableCell',value:function getSelectedMovableCell(cellIndex){var gObj=this.parent;var frzCols=gObj.getFrozenColumns();if(frzCols){if(cellIndex.cellIndex>=frzCols){return gObj.getMovableCellFromIndex(cellIndex.rowIndex,this.getColIndex(cellIndex.rowIndex,cellIndex.cellIndex));}return null;}return null;}},{key:'selectCell',value:function selectCell(cellIndex,isToggle){if(!this.isCellType()){return;}var gObj=this.parent;var selectedCell=this.getSelectedMovableCell(cellIndex);if(!selectedCell){selectedCell=gObj.getCellFromIndex(cellIndex.rowIndex,this.getColIndex(cellIndex.rowIndex,cellIndex.cellIndex));}this.currentIndex=cellIndex.rowIndex;var args=void 0;var cncl='cancel';var selectedData=gObj.getCurrentViewRecords()[this.currentIndex];if(!this.isCellType()||!selectedCell||this.isEditing()){return;}var isCellSelected=selectedCell.classList.contains('e-cellselectionbackground');isToggle=!isToggle?isToggle:!isUndefined(this.prevCIdxs)&&cellIndex.rowIndex===this.prevCIdxs.rowIndex&&cellIndex.cellIndex===this.prevCIdxs.cellIndex&&isCellSelected;if(!isToggle){args={data:selectedData,cellIndex:cellIndex,currentCell:selectedCell,isCtrlPressed:this.isMultiCtrlRequest,isShiftPressed:this.isMultiShiftRequest,previousRowCellIndex:this.prevECIdxs,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined,cancel:false};this.onActionBegin(args,cellSelecting);}if(!isNullOrUndefined(args)&&args[cncl]===true){return;}this.clearCell();if(!isToggle){this.updateCellSelection(selectedCell,cellIndex.rowIndex,cellIndex.cellIndex);}this.updateCellProps(cellIndex,cellIndex);if(!isToggle){this.onActionComplete({data:selectedData,cellIndex:cellIndex,currentCell:selectedCell,previousRowCellIndex:this.prevECIdxs,selectedRowCellIndex:this.selectedRowCellIndexes,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined},cellSelected);}}},{key:'getCellIndex',value:function getCellIndex(rIdx,cIdx){return this.parent.getFrozenColumns()?cIdx>=this.parent.getFrozenColumns()?this.parent.getMovableCellFromIndex(rIdx,cIdx):this.parent.getCellFromIndex(rIdx,cIdx):this.parent.getCellFromIndex(rIdx,cIdx);}},{key:'selectCellsByRange',value:function selectCellsByRange(startIndex,endIndex){if(!this.isCellType()){return;}var gObj=this.parent;var selectedCell=this.getSelectedMovableCell(startIndex);var frzCols=gObj.getFrozenColumns();if(!selectedCell){selectedCell=gObj.getCellFromIndex(startIndex.rowIndex,startIndex.cellIndex);}var min=void 0;var max=void 0;var stIndex=startIndex;var edIndex=endIndex=endIndex?endIndex:startIndex;var cellIndexes=void 0;var cancl='cancel';this.currentIndex=startIndex.rowIndex;var selectedData=gObj.getCurrentViewRecords()[this.currentIndex];if(this.isSingleSel()||!this.isCellType()||this.isEditing()){return;}var args={data:selectedData,cellIndex:startIndex,currentCell:selectedCell,isCtrlPressed:this.isMultiCtrlRequest,isShiftPressed:this.isMultiShiftRequest,previousRowCellIndex:this.prevECIdxs,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined};this.onActionBegin(args,cellSelecting);if(!isNullOrUndefined(args)&&args[cancl]===true){return;}this.clearCell();if(startIndex.rowIndex>endIndex.rowIndex){var temp=startIndex;startIndex=endIndex;endIndex=temp;}for(var i=startIndex.rowIndex;i<=endIndex.rowIndex;i++){if(this.selectionSettings.cellSelectionMode!=='Box'){min=i===startIndex.rowIndex?startIndex.cellIndex:0;max=i===endIndex.rowIndex?endIndex.cellIndex:this.getLastColIndex(i);}else{min=startIndex.cellIndex;max=endIndex.cellIndex;}cellIndexes=[];for(var j=min<max?min:max,len=min>max?min:max;j<=len;j++){if(frzCols){if(j<frzCols){selectedCell=gObj.getCellFromIndex(i,j);}else{selectedCell=gObj.getMovableCellFromIndex(i,j);}}else{selectedCell=gObj.getCellFromIndex(i,j);}if(!selectedCell){continue;}cellIndexes.push(j);this.updateCellSelection(selectedCell);this.addAttribute(selectedCell);}this.selectedRowCellIndexes.push({rowIndex:i,cellIndexes:cellIndexes});}this.updateCellProps(stIndex,edIndex);this.onActionComplete({data:selectedData,cellIndex:startIndex,currentCell:selectedCell,previousRowCellIndex:this.prevECIdxs,selectedRowCellIndex:this.selectedRowCellIndexes,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined},cellSelected);}},{key:'selectCells',value:function selectCells(rowCellIndexes){if(!this.isCellType()){return;}var gObj=this.parent;var selectedCell=this.getSelectedMovableCell(rowCellIndexes[0]);var frzCols=gObj.getFrozenColumns();if(!selectedCell){selectedCell=gObj.getCellFromIndex(rowCellIndexes[0].rowIndex,rowCellIndexes[0].cellIndexes[0]);}this.currentIndex=rowCellIndexes[0].rowIndex;var selectedData=gObj.getCurrentViewRecords()[this.currentIndex];if(this.isSingleSel()||!this.isCellType()||this.isEditing()){return;}this.onActionBegin({data:selectedData,cellIndex:rowCellIndexes[0].cellIndexes[0],currentCell:selectedCell,isCtrlPressed:this.isMultiCtrlRequest,isShiftPressed:this.isMultiShiftRequest,previousRowCellIndex:this.prevECIdxs,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined},cellSelecting);for(var i=0,len=rowCellIndexes.length;i<len;i++){for(var j=0,cellLen=rowCellIndexes[i].cellIndexes.length;j<cellLen;j++){if(frzCols){if(rowCellIndexes[i].cellIndexes[j]<frzCols){selectedCell=gObj.getCellFromIndex(rowCellIndexes[i].rowIndex,rowCellIndexes[i].cellIndexes[j]);}else{selectedCell=gObj.getMovableCellFromIndex(rowCellIndexes[i].rowIndex,rowCellIndexes[i].cellIndexes[j]);}}else{selectedCell=gObj.getCellFromIndex(rowCellIndexes[i].rowIndex,rowCellIndexes[i].cellIndexes[j]);}if(!selectedCell){continue;}this.updateCellSelection(selectedCell);this.addAttribute(selectedCell);this.addRowCellIndex({rowIndex:rowCellIndexes[i].rowIndex,cellIndex:rowCellIndexes[i].cellIndexes[j]});}}this.updateCellProps({rowIndex:rowCellIndexes[0].rowIndex,cellIndex:rowCellIndexes[0].cellIndexes[0]},{rowIndex:rowCellIndexes[0].rowIndex,cellIndex:rowCellIndexes[0].cellIndexes[0]});this.onActionComplete({data:selectedData,cellIndex:rowCellIndexes[0].cellIndexes[0],currentCell:selectedCell,previousRowCellIndex:this.prevECIdxs,selectedRowCellIndex:this.selectedRowCellIndexes,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined},cellSelected);}},{key:'addCellsToSelection',value:function addCellsToSelection(cellIndexes){if(!this.isCellType()){return;}var gObj=this.parent;var selectedCell=void 0;var frzCols=gObj.getFrozenColumns();var index=void 0;this.currentIndex=cellIndexes[0].rowIndex;var selectedData=gObj.getCurrentViewRecords()[this.currentIndex];if(this.isSingleSel()||!this.isCellType()||this.isEditing()){return;}var rowObj=void 0;if(frzCols&&cellIndexes[0].cellIndex>=frzCols){rowObj=gObj.getMovableRowsObject()[cellIndexes[0].rowIndex];}else{rowObj=this.getRowObj(cellIndexes[0].rowIndex);}var foreignKeyData$$1=[];var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=cellIndexes[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=true){var cellIndex=_step18.value;for(var i=0,len=this.selectedRowCellIndexes.length;i<len;i++){if(this.selectedRowCellIndexes[i].rowIndex===cellIndex.rowIndex){index=i;break;}}selectedCell=this.getSelectedMovableCell(cellIndex);if(!selectedCell){selectedCell=gObj.getCellFromIndex(cellIndex.rowIndex,this.getColIndex(cellIndex.rowIndex,cellIndex.cellIndex));}foreignKeyData$$1.push(rowObj.cells[frzCols&&cellIndexes[0].cellIndex>=frzCols?cellIndex.cellIndex-frzCols:cellIndex.cellIndex].foreignKeyData);var args={data:selectedData,cellIndex:cellIndexes[0],isShiftPressed:this.isMultiShiftRequest,previousRowCellIndex:this.prevECIdxs,currentCell:selectedCell,isCtrlPressed:this.isMultiCtrlRequest,previousRowCell:this.prevECIdxs?gObj.getCellFromIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined};var isUnSelected=index>-1;if(isUnSelected){var selectedCellIdx=this.selectedRowCellIndexes[index].cellIndexes;if(selectedCellIdx.indexOf(cellIndex.cellIndex)>-1){this.cellDeselect(cellDeselecting,[{rowIndex:cellIndex.rowIndex,cellIndexes:[cellIndex.cellIndex]}],selectedData,[selectedCell],foreignKeyData$$1);selectedCellIdx.splice(selectedCellIdx.indexOf(cellIndex.cellIndex),1);selectedCell.classList.remove('e-cellselectionbackground');selectedCell.removeAttribute('aria-selected');this.cellDeselect(cellDeselected,[{rowIndex:cellIndex.rowIndex,cellIndexes:[cellIndex.cellIndex]}],selectedData,[selectedCell],foreignKeyData$$1);}else{isUnSelected=false;this.onActionBegin(args,cellSelecting);this.addRowCellIndex({rowIndex:cellIndex.rowIndex,cellIndex:cellIndex.cellIndex});this.updateCellSelection(selectedCell);this.addAttribute(selectedCell);}}else{this.onActionBegin(args,cellSelecting);this.updateCellSelection(selectedCell,cellIndex.rowIndex,cellIndex.cellIndex);}this.updateCellProps(cellIndex,cellIndex);if(!isUnSelected){this.onActionComplete({data:selectedData,cellIndex:cellIndexes[0],currentCell:selectedCell,previousRowCell:this.prevECIdxs?this.getCellIndex(this.prevECIdxs.rowIndex,this.prevECIdxs.cellIndex):undefined,previousRowCellIndex:this.prevECIdxs,selectedRowCellIndex:this.selectedRowCellIndexes},cellSelected);}}}catch(err){_didIteratorError18=true;_iteratorError18=err;}finally{try{if(!_iteratorNormalCompletion18&&_iterator18.return){_iterator18.return();}}finally{if(_didIteratorError18){throw _iteratorError18;}}}}},{key:'getColIndex',value:function getColIndex(rowIndex,index){var cells=void 0;var frzCols=this.parent.getFrozenColumns();if(frzCols){if(index>=frzCols){cells=this.parent.getMovableDataRows()[rowIndex].querySelectorAll('td.e-rowcell');}}if(!cells){cells=this.parent.getDataRows()[rowIndex].querySelectorAll('td.e-rowcell');}for(var m=0;m<cells.length;m++){var colIndex=parseInt(cells[m].getAttribute('aria-colindex'),10);if(colIndex===index){if(frzCols){if(index>=frzCols){m+=frzCols;}}return m;}}return-1;}},{key:'getLastColIndex',value:function getLastColIndex(rowIndex){var cells=this.parent.getFrozenColumns()?this.parent.getMovableDataRows()[rowIndex].querySelectorAll('td.e-rowcell'):this.parent.getDataRows()[rowIndex].querySelectorAll('td.e-rowcell');return parseInt(cells[cells.length-1].getAttribute('aria-colindex'),10);}},{key:'clearCell',value:function clearCell(){this.clearCellSelection();}},{key:'cellDeselect',value:function cellDeselect(type,cellIndexes,data,cells,foreignKeyData$$1){var cancl='cancel';if(cells[0]&&cells[0].classList.contains('e-gridchkbox')){this.updateCheckBoxes(closest(cells[0],'tr'));}var args={cells:cells,data:data,cellIndexes:cellIndexes,foreignKeyData:foreignKeyData$$1,cancel:false};this.parent.trigger(type,args);this.isPreventCellSelect=args[cancl];}},{key:'updateCellSelection',value:function updateCellSelection(selectedCell,rowIndex,cellIndex){if(!isNullOrUndefined(rowIndex)){this.addRowCellIndex({rowIndex:rowIndex,cellIndex:cellIndex});}selectedCell.classList.add('e-cellselectionbackground');if(selectedCell.classList.contains('e-gridchkbox')){this.updateCheckBoxes(closest(selectedCell,'tr'),true);}this.addAttribute(selectedCell);}},{key:'addAttribute',value:function addAttribute(cell){this.target=cell;if(!isNullOrUndefined(cell)){cell.setAttribute('aria-selected','true');if(!this.preventFocus){this.focus.onClick({target:cell},true);}}}},{key:'updateCellProps',value:function updateCellProps(startIndex,endIndex){this.prevCIdxs=startIndex;this.prevECIdxs=endIndex;this.isCellSelected=this.selectedRowCellIndexes.length&&true;}},{key:'addRowCellIndex',value:function addRowCellIndex(rowCellIndex){var isRowAvail=void 0;var index=void 0;for(var i=0,len=this.selectedRowCellIndexes.length;i<len;i++){if(this.selectedRowCellIndexes[i].rowIndex===rowCellIndex.rowIndex){isRowAvail=true;index=i;break;}}if(isRowAvail){if(this.selectedRowCellIndexes[index].cellIndexes.indexOf(rowCellIndex.cellIndex)<0){this.selectedRowCellIndexes[index].cellIndexes.push(rowCellIndex.cellIndex);}}else{this.selectedRowCellIndexes.push({rowIndex:rowCellIndex.rowIndex,cellIndexes:[rowCellIndex.cellIndex]});}}},{key:'clearCellSelection',value:function clearCellSelection(){if(this.isCellSelected){var gObj=this.parent;var selectedCells=this.getSelectedCellsElement();var rowCell=this.selectedRowCellIndexes;var data=[];var cells=[];var foreignKeyData$$1=[];var currentViewData=gObj.getCurrentViewRecords();var frzCols=gObj.getFrozenColumns();for(var i=0,len=rowCell.length;i<len;i++){data.push(currentViewData[rowCell[i].rowIndex]);var rowObj=this.getRowObj(rowCell[i].rowIndex);for(var j=0,cLen=rowCell[i].cellIndexes.length;j<cLen;j++){if(frzCols){if(rowCell[i].cellIndexes[j]<frzCols){cells.push(gObj.getCellFromIndex(rowCell[i].rowIndex,rowCell[i].cellIndexes[j]));}else{cells.push(gObj.getMovableCellFromIndex(rowCell[i].rowIndex,rowCell[i].cellIndexes[j]));}}else{foreignKeyData$$1.push(rowObj.cells[rowCell[i].cellIndexes[j]].foreignKeyData);cells.push(gObj.getCellFromIndex(rowCell[i].rowIndex,rowCell[i].cellIndexes[j]));}}}this.cellDeselect(cellDeselecting,rowCell,data,cells,foreignKeyData$$1);if(this.isPreventCellSelect===true){return;}for(var _i6=0,_len7=selectedCells.length;_i6<_len7;_i6++){selectedCells[_i6].classList.remove('e-cellselectionbackground');selectedCells[_i6].removeAttribute('aria-selected');}this.selectedRowCellIndexes=[];this.isCellSelected=false;this.cellDeselect(cellDeselected,rowCell,data,cells,foreignKeyData$$1);}}},{key:'getSelectedCellsElement',value:function getSelectedCellsElement(){var gObj=this.parent;var rows=gObj.getDataRows();var mRows=void 0;if(gObj.getFrozenColumns()){mRows=gObj.getMovableDataRows();rows=gObj.addMovableRows(rows,mRows);}var cells=[];for(var i=0,len=rows.length;i<len;i++){cells=cells.concat([].slice.call(rows[i].querySelectorAll('.e-cellselectionbackground')));}return cells;}},{key:'mouseMoveHandler',value:function mouseMoveHandler(e){e.preventDefault();var gBRect=this.parent.element.getBoundingClientRect();var x1=this.x;var y1=this.y;var position=getPosition(e);var x2=position.x-gBRect.left;var y2=position.y-gBRect.top;var tmp=void 0;var target=closest(e.target,'tr');this.isDragged=true;if(!this.isCellDrag){if(!target){target=closest(document.elementFromPoint(this.parent.element.offsetLeft+2,e.clientY),'tr');}if(x1>x2){tmp=x2;x2=x1;x1=tmp;}if(y1>y2){tmp=y2;y2=y1;y1=tmp;}this.element.style.left=x1+'px';this.element.style.top=y1+'px';this.element.style.width=x2-x1+'px';this.element.style.height=y2-y1+'px';}if(target&&!e.ctrlKey&&!e.shiftKey){var rowIndex=parseInt(target.getAttribute('aria-rowindex'),10);if(!this.isCellDrag){this.selectRowsByRange(this.startIndex,rowIndex);}else{var td=parentsUntil(e.target,'e-rowcell');if(td){this.selectLikeExcel(rowIndex,parseInt(td.getAttribute('aria-colindex'),10));}}}}},{key:'selectLikeExcel',value:function selectLikeExcel(rowIndex,cellIndex){this.clearCellSelection();this.selectCellsByRange({rowIndex:this.startIndex,cellIndex:this.startCellIndex},{rowIndex:rowIndex,cellIndex:cellIndex});}},{key:'mouseUpHandler',value:function mouseUpHandler(e){document.body.classList.remove('e-disableuserselect');if(this.element){remove(this.element);}EventHandler.remove(this.parent.getContent(),'mousemove',this.mouseMoveHandler);EventHandler.remove(document.body,'mouseup',this.mouseUpHandler);this.isDragged=false;}},{key:'mouseDownHandler',value:function mouseDownHandler(e){var target=e.target;var gObj=this.parent;var isDrag=void 0;var gridElement=parentsUntil(target,'e-grid');if(gridElement&&gridElement.id!==gObj.element.id){return;}if(e.shiftKey||e.ctrlKey){e.preventDefault();}if(target.classList.contains('e-rowcell')&&!e.shiftKey&&!e.ctrlKey){if(gObj.selectionSettings.cellSelectionMode==='Box'&&!this.isRowType()&&!this.isSingleSel()){this.isCellDrag=true;isDrag=true;}else if(gObj.allowRowDragAndDrop){if(!this.isRowType()||this.isSingleSel()||closest(target,'td').classList.contains('e-selectionbackground')){this.isDragged=false;return;}isDrag=true;this.element=createElement('div',{className:'e-griddragarea'});gObj.getContent().appendChild(this.element);}if(isDrag){var tr=closest(e.target,'tr');this.startIndex=parseInt(tr.getAttribute('aria-rowindex'),10);this.startCellIndex=parseInt(parentsUntil(target,'e-rowcell').getAttribute('aria-colindex'),10);document.body.classList.add('e-disableuserselect');var gBRect=gObj.element.getBoundingClientRect();var postion=getPosition(e);this.x=postion.x-gBRect.left;this.y=postion.y-gBRect.top;EventHandler.add(gObj.getContent(),'mousemove',this.mouseMoveHandler,this);EventHandler.add(document.body,'mouseup',this.mouseUpHandler,this);}}}},{key:'clearSelAfterRefresh',value:function clearSelAfterRefresh(e){if(e.requestType!=='virtualscroll'&&!this.parent.isPersistSelection){this.clearSelection();}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(initialEnd,this.initializeSelection,this);this.parent.on(rowSelectionComplete,this.onActionComplete,this);this.parent.on(cellSelectionComplete,this.onActionComplete,this);this.parent.on(inBoundModelChanged,this.onPropertyChanged,this);this.parent.on(cellFocused,this.onCellFocused,this);this.parent.on(dataReady,this.clearSelAfterRefresh,this);this.parent.on(columnPositionChanged,this.columnPositionChanged,this);this.parent.on(contentReady,this.initialEnd,this);this.actionBeginFunction=this.actionBegin.bind(this);this.actionCompleteFunction=this.actionComplete.bind(this);this.parent.addEventListener(actionBegin,this.actionBeginFunction);this.parent.addEventListener(actionComplete,this.actionCompleteFunction);this.parent.on(rowsRemoved,this.rowsRemoved,this);this.parent.on(headerRefreshed,this.refreshHeader,this);this.addEventListener_checkbox();}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialEnd,this.initializeSelection);this.parent.off(rowSelectionComplete,this.onActionComplete);this.parent.off(cellSelectionComplete,this.onActionComplete);this.parent.off(inBoundModelChanged,this.onPropertyChanged);this.parent.off(cellFocused,this.onCellFocused);this.parent.off(dataReady,this.clearSelAfterRefresh);this.parent.off(columnPositionChanged,this.columnPositionChanged);this.parent.removeEventListener(actionBegin,this.actionBeginFunction);this.parent.removeEventListener(actionComplete,this.actionCompleteFunction);this.parent.off(rowsRemoved,this.rowsRemoved);this.parent.off(headerRefreshed,this.refreshHeader);this.removeEventListener_checkbox();}},{key:'columnPositionChanged',value:function columnPositionChanged(){if(!this.parent.isPersistSelection){this.clearSelection();}}},{key:'refreshHeader',value:function refreshHeader(){this.setCheckAllState();}},{key:'rowsRemoved',value:function rowsRemoved(e){for(var i=0;i<e.records.length;i++){delete this.selectedRowState[e.records[i][this.primaryKey]];--this.totalRecordsCount;}this.setCheckAllState();}},{key:'dataReady',value:function dataReady(e){if(e.requestType!=='virtualscroll'&&!this.parent.isPersistSelection){this.clearSelection();}}},{key:'getCheckAllBox',value:function getCheckAllBox(){return this.parent.getHeaderContent().querySelector('.e-checkselectall');}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}var gObj=this.parent;if(!isNullOrUndefined(e.properties.type)&&this.selectionSettings.type==='Single'){if(this.selectedRowCellIndexes.length>1){this.clearCellSelection();}if(this.selectedRowIndexes.length>1){this.clearRowSelection();}this.enableSelectMultiTouch=false;this.hidePopUp();}if(!isNullOrUndefined(e.properties.mode)||!isNullOrUndefined(e.properties.cellSelectionMode)){this.clearSelection();}this.checkBoxSelectionChanged();this.initPerisistSelection();}},{key:'hidePopUp',value:function hidePopUp(){if(this.parent.element.querySelector('.e-gridpopup').querySelectorAll('.e-rowselect').length){this.parent.element.querySelector('.e-gridpopup').style.display='none';}}},{key:'initialEnd',value:function initialEnd(){this.parent.off(contentReady,this.initialEnd);this.selectRow(this.parent.selectedRowIndex);}},{key:'checkBoxSelectionChanged',value:function checkBoxSelectionChanged(){this.parent.off(contentReady,this.checkBoxSelectionChanged);var gobj=this.parent;var checkboxColumn=gobj.getColumns().filter(function(col){return col.type==='checkbox';});if(checkboxColumn.length>0){gobj.isCheckBoxSelection=true;this.chkField=checkboxColumn[0].field;this.totalRecordsCount=this.parent.pageSettings.totalRecordsCount;if(isNullOrUndefined(this.totalRecordsCount)){this.totalRecordsCount=this.parent.getCurrentViewRecords().length;}if(this.isSingleSel()){gobj.selectionSettings.type='Multiple';gobj.dataBind();}else{this.initPerisistSelection();}}if(!gobj.isCheckBoxSelection){this.chkField=null;this.initPerisistSelection();}}},{key:'initPerisistSelection',value:function initPerisistSelection(){var gobj=this.parent;if(this.parent.selectionSettings.persistSelection&&this.parent.getPrimaryKeyFieldNames().length>0){gobj.isPersistSelection=true;this.ensureCheckboxFieldSelection();}else if(this.parent.getPrimaryKeyFieldNames().length>0){gobj.isPersistSelection=false;this.ensureCheckboxFieldSelection();}else{gobj.isPersistSelection=false;this.selectedRowState={};}}},{key:'ensureCheckboxFieldSelection',value:function ensureCheckboxFieldSelection(){var gobj=this.parent;this.primaryKey=this.parent.getPrimaryKeyFieldNames()[0];if(!gobj.enableVirtualization&&this.chkField&&(gobj.isPersistSelection&&Object.keys(this.selectedRowState).length===0||!gobj.isPersistSelection)){var data=this.parent.getDataModule();var query=new Query().where(this.chkField,'equal',true);var dataManager=data.getData({},query);var proxy=this;this.parent.showSpinner();dataManager.then(function(e){proxy.dataSuccess(e.result);proxy.refreshPersistSelection();proxy.parent.hideSpinner();});}}},{key:'dataSuccess',value:function dataSuccess(res){for(var i=0;i<res.length;i++){if(isNullOrUndefined(this.selectedRowState[res[i][this.primaryKey]])&&res[i][this.chkField]){this.selectedRowState[res[i][this.primaryKey]]=res[i][this.chkField];}}this.persistSelectedData=res;}},{key:'setRowSelection',value:function setRowSelection(state){if(!this.parent.getDataModule().isRemote()){if(state){var _iteratorNormalCompletion19=true;var _didIteratorError19=false;var _iteratorError19=undefined;try{for(var _iterator19=this.getData()[Symbol.iterator](),_step19;!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=true){var data=_step19.value;this.selectedRowState[data[this.primaryKey]]=true;}}catch(err){_didIteratorError19=true;_iteratorError19=err;}finally{try{if(!_iteratorNormalCompletion19&&_iterator19.return){_iterator19.return();}}finally{if(_didIteratorError19){throw _iteratorError19;}}}}else{this.selectedRowState={};}// (this.getData()).forEach(function (data) {
//     this.selectedRowState[data[this.primaryKey]] = true;
// })
}}},{key:'getData',value:function getData(){return this.parent.getDataModule().dataManager.dataSource.json;}},{key:'refreshPersistSelection',value:function refreshPersistSelection(){var rows=this.parent.getRows();if(rows.length>0&&(this.parent.isPersistSelection||this.chkField)){var indexes=[];for(var j=0;j<rows.length;j++){var rowObj=this.getRowObj(rows[j]);var pKey=rowObj?rowObj.data[this.primaryKey]:null;if(pKey===null){return;}var checkState=void 0;var chkBox=rows[j].querySelector('.e-checkselect');if(this.selectedRowState[pKey]||this.parent.checkAllRows==='Check'&&this.chkAllCollec.indexOf(pKey)<0||this.parent.checkAllRows==='Uncheck'&&this.chkAllCollec.indexOf(pKey)>0||this.parent.checkAllRows==='Intermediate'&&!isNullOrUndefined(this.chkField)&&rowObj.data[this.chkField]){indexes.push(parseInt(rows[j].getAttribute('aria-rowindex'),10));checkState=true;}else{checkState=false;if(this.checkedTarget!==chkBox&&this.parent.isCheckBoxSelection){removeAddCboxClasses(chkBox.nextElementSibling,checkState);}}this.updatePersistCollection(rows[j],checkState);}this.isSingleSel()&&indexes.length>0?this.selectRow(indexes[0],true):this.selectRows(indexes);}if(this.parent.isCheckBoxSelection&&this.parent.getCurrentViewRecords().length>0){this.setCheckAllState();}}},{key:'actionBegin',value:function actionBegin(e){if(e.requestType==='save'&&this.parent.isPersistSelection){var editChkBox=this.parent.element.querySelector('.e-edit-checkselect');if(!isNullOrUndefined(editChkBox)){var row=closest(editChkBox,'.e-editedrow');if(row){if(this.parent.editSettings.mode==='Dialog'){row=this.parent.element.querySelector('.e-dlgeditrow');}var rowObj=this.getRowObj(row);if(!rowObj){return;}this.selectedRowState[rowObj.data[this.primaryKey]]=rowObj.isSelected=editChkBox.checked;}else{this.isCheckedOnAdd=editChkBox.checked;}}}}},{key:'actionComplete',value:function actionComplete(e){if(e.requestType==='save'&&this.parent.isPersistSelection){if(e.action==='add'&&this.isCheckedOnAdd){var rowObj=this.parent.getRowObjectFromUID(this.parent.getRows()[e.selectedRow].getAttribute('data-uid'));this.selectedRowState[rowObj.data[this.primaryKey]]=rowObj.isSelected=this.isCheckedOnAdd;}this.refreshPersistSelection();}}},{key:'onDataBound',value:function onDataBound(){if(!this.parent.enableVirtualization&&this.parent.isPersistSelection){this.refreshPersistSelection();}}},{key:'checkSelectAllAction',value:function checkSelectAllAction(checkState){var cRenderer=this.getRenderer();var editForm=this.parent.element.querySelector('.e-gridform');this.checkedTarget=this.getCheckAllBox();if(checkState&&this.parent.getCurrentViewRecords().length){this.selectRowsByRange(cRenderer.getVirtualRowIndex(0),cRenderer.getVirtualRowIndex(this.parent.getCurrentViewRecords().length));this.parent.checkAllRows='Check';}else{this.clearSelection();this.parent.checkAllRows='Uncheck';}this.chkAllCollec=[];if(this.parent.isPersistSelection){var rows=this.parent.getRows();for(var i=0;i<rows.length;i++){this.updatePersistCollection(rows[i],checkState);}if(this.parent.checkAllRows==='Uncheck'){this.setRowSelection(false);this.persistSelectedData=[];}else if(this.parent.checkAllRows==='Check'){this.setRowSelection(true);this.persistSelectedData=this.getData().slice();}}if(!isNullOrUndefined(editForm)){var editChkBox=editForm.querySelector('.e-edit-checkselect');removeAddCboxClasses(editChkBox.nextElementSibling,checkState);}}},{key:'checkSelectAll',value:function checkSelectAll(checkBox){var state=this.getCheckAllStatus(checkBox)==='Check';this.checkSelectAllAction(!state);this.target=null;if(this.parent.getCurrentViewRecords().length>0){this.setCheckAllState();}this.triggerChkChangeEvent(checkBox,!state);}},{key:'getCheckAllStatus',value:function getCheckAllStatus(ele){var classes=ele?ele.nextElementSibling.classList:this.getCheckAllBox().nextElementSibling.classList;var status=void 0;if(classes.contains('e-check')){status='Check';}else if(classes.contains('e-uncheck')){status='Uncheck';}else if(classes.contains('e-stop')){status='Intermediate';}else{status='None';}return status;}},{key:'checkSelect',value:function checkSelect(checkBox){var target=closest(this.checkedTarget,'.e-rowcell');this.isMultiCtrlRequest=true;var rIndex=parseInt(target.parentElement.getAttribute('aria-rowindex'),10);if(this.parent.isPersistSelection&&this.parent.element.querySelectorAll('.e-addedrow').length>0){++rIndex;}this.rowCellSelectionHandler(rIndex,parseInt(target.getAttribute('aria-colindex'),10));this.moveIntoUncheckCollection(closest(target,'.e-row'));this.setCheckAllState();this.isMultiCtrlRequest=false;this.triggerChkChangeEvent(checkBox,checkBox.nextElementSibling.classList.contains('e-check'));}},{key:'moveIntoUncheckCollection',value:function moveIntoUncheckCollection(row){if(this.parent.checkAllRows==='Check'||this.parent.checkAllRows==='Uncheck'){var rowObj=this.getRowObj(row);var pKey=rowObj&&rowObj.data?rowObj.data[this.primaryKey]:null;if(!pKey){return;}if(this.chkAllCollec.indexOf(pKey)<0){this.chkAllCollec.push(pKey);}else{this.chkAllCollec.splice(this.chkAllCollec.indexOf(pKey),1);}}}},{key:'triggerChkChangeEvent',value:function triggerChkChangeEvent(checkBox,checkState){this.parent.trigger(checkBoxChange,{checked:checkState,selectedRowIndexes:this.parent.getSelectedRowIndexes(),target:checkBox});if(!this.parent.isEdit){this.checkedTarget=null;}}},{key:'setCheckAllState',value:function setCheckAllState(isInteraction){if(this.parent.isCheckBoxSelection){var checkedLen=Object.keys(this.selectedRowState).length;if(!this.parent.isPersistSelection){checkedLen=this.selectedRecords.length;this.totalRecordsCount=this.parent.getCurrentViewRecords().length;}if(this.getCheckAllBox()){var spanEle=this.getCheckAllBox().nextElementSibling;removeClass([spanEle],['e-check','e-stop','e-uncheck']);if(checkedLen===this.totalRecordsCount){addClass([spanEle],['e-check']);if(isInteraction){this.getRenderer().setSelection(null,true,true);}this.parent.checkAllRows='Check';}else if(checkedLen===0||this.parent.getCurrentViewRecords().length===0){addClass([spanEle],['e-uncheck']);if(isInteraction){this.getRenderer().setSelection(null,false,true);}this.parent.checkAllRows='Uncheck';}else{addClass([spanEle],['e-stop']);this.parent.checkAllRows='Intermediate';}}}}},{key:'clickHandler',value:function clickHandler(e){var target=e.target;this.isMultiCtrlRequest=e.ctrlKey||this.enableSelectMultiTouch;this.isMultiShiftRequest=e.shiftKey;this.popUpClickHandler(e);var chkSelect=false;this.preventFocus=true;var checkBox=void 0;var checkWrap=parentsUntil(target,'e-checkbox-wrapper');if(checkWrap&&checkWrap.querySelectorAll('.e-checkselect,.e-checkselectall').length>0){checkBox=checkWrap.querySelector('input[type="checkbox"]');chkSelect=true;}target=parentsUntil(target,'e-rowcell');if(target&&target.parentElement.classList.contains('e-row')&&!this.parent.selectionSettings.checkboxOnly||chkSelect){if(this.parent.isCheckBoxSelection){this.isMultiCtrlRequest=true;}this.target=target;if(!isNullOrUndefined(checkBox)){this.checkedTarget=checkBox;if(checkBox.classList.contains('e-checkselectall')){this.checkSelectAll(checkBox);}else{this.checkSelect(checkBox);this.target=closest(target,'.e-rowcell');}}else{var rIndex=parseInt(target.parentElement.getAttribute('aria-rowindex'),10);if(this.parent.isPersistSelection&&this.parent.element.querySelectorAll('.e-addedrow').length>0){++rIndex;}this.rowCellSelectionHandler(rIndex,parseInt(target.getAttribute('aria-colindex'),10));if(this.parent.isCheckBoxSelection){this.moveIntoUncheckCollection(closest(target,'.e-row'));this.setCheckAllState();}}if(!this.parent.isCheckBoxSelection&&Browser.isDevice&&!this.isSingleSel()){this.showPopup(e);}}this.isMultiCtrlRequest=false;this.isMultiShiftRequest=false;this.preventFocus=false;}},{key:'popUpClickHandler',value:function popUpClickHandler(e){var target=e.target;if(closest(target,'.e-headercell')||e.target.classList.contains('e-rowcell')||closest(target,'.e-gridpopup')){if(target.classList.contains('e-rowselect')){if(!target.classList.contains('e-spanclicked')){target.classList.add('e-spanclicked');this.enableSelectMultiTouch=true;}else{target.classList.remove('e-spanclicked');this.enableSelectMultiTouch=false;this.parent.element.querySelector('.e-gridpopup').style.display='none';}}}else{this.parent.element.querySelector('.e-gridpopup').style.display='none';}}},{key:'showPopup',value:function showPopup(e){setCssInGridPopUp(this.parent.element.querySelector('.e-gridpopup'),e,'e-rowselect e-icons e-icon-rowselect'+(!this.isSingleSel()&&(this.selectedRecords.length>(this.parent.getFrozenColumns()?2:1)||this.selectedRowCellIndexes.length>1)?' e-spanclicked':''));}},{key:'rowCellSelectionHandler',value:function rowCellSelectionHandler(rowIndex,cellIndex){if(!this.isMultiCtrlRequest&&!this.isMultiShiftRequest||this.isSingleSel()){if(!this.isDragged){this.selectRow(rowIndex,true);}this.selectCell({rowIndex:rowIndex,cellIndex:cellIndex},true);}else if(this.isMultiShiftRequest){this.selectRowsByRange(isUndefined(this.prevRowIndex)?rowIndex:this.prevRowIndex,rowIndex);this.selectCellsByRange(isUndefined(this.prevCIdxs)?{rowIndex:rowIndex,cellIndex:cellIndex}:this.prevCIdxs,{rowIndex:rowIndex,cellIndex:cellIndex});}else{this.addRowsToSelection([rowIndex]);this.addCellsToSelection([{rowIndex:rowIndex,cellIndex:cellIndex}]);}this.isDragged=false;}},{key:'onCellFocused',value:function onCellFocused(e){if(this.parent.frozenRows&&e.container.isHeader&&e.byKey){if(e.keyArgs.action==='upArrow'){if(this.parent.allowFiltering){e.isJump=e.element.tagName==='INPUT'?true:false;}else{e.isJump=e.element.tagName==='TH'?true:false;}}else{if(e.keyArgs.action==='downArrow'){var rIdx=Number(e.element.parentElement.getAttribute('aria-rowindex'));e.isJump=rIdx===0?true:false;}else{if(e.keyArgs.action==='ctrlHome'){e.isJump=true;}}}}var clear=this.parent.getFrozenColumns()?(e.container.isHeader&&e.element.tagName!=='TD'&&e.isJump||(e.container.isContent||e.element.tagName==='TD')&&!(e.container.isSelectable||e.element.tagName==='TD'))&&!(e.byKey&&e.keyArgs.action==='space'):(e.container.isHeader&&e.isJump||e.container.isContent&&!e.container.isSelectable)&&!(e.byKey&&e.keyArgs.action==='space');var headerAction=e.container.isHeader&&e.element.tagName!=='TD'&&!closest(e.element,'.e-rowcell')&&!(e.byKey&&e.keyArgs.action==='space');if(!e.byKey||clear){if(clear){this.clearSelection();}return;}var _ref7=e.container.isContent?e.container.indexes:e.indexes,_ref8=_slicedToArray(_ref7,2),rowIndex=_ref8[0],cellIndex=_ref8[1];var prev=this.focus.getPrevIndexes();if(this.parent.frozenRows){if(e.container.isHeader&&(e.element.tagName==='TD'||closest(e.element,'.e-rowcell'))){var thLen=this.parent.getHeaderTable().querySelector('thead').childElementCount;rowIndex-=thLen;prev.rowIndex=prev.rowIndex?prev.rowIndex-thLen:null;}else{rowIndex+=this.parent.frozenRows;prev.rowIndex=prev.rowIndex===0||!isNullOrUndefined(prev.rowIndex)?prev.rowIndex+this.parent.frozenRows:null;}if(this.parent.getFrozenColumns()){var cIdx=Number(e.element.getAttribute('aria-colindex'));prev.cellIndex=prev.cellIndex?prev.cellIndex===cellIndex?cIdx:cIdx-1:null;cellIndex=cIdx;}}if(headerAction||['ctrlPlusA','escape'].indexOf(e.keyArgs.action)===-1&&e.keyArgs.action!=='space'&&rowIndex===prev.rowIndex&&cellIndex===prev.cellIndex){return;}this.preventFocus=true;switch(e.keyArgs.action){case'downArrow':case'upArrow':case'enter':case'shiftEnter':this.applyDownUpKey(rowIndex,cellIndex);break;case'rightArrow':case'leftArrow':this.applyRightLeftKey(rowIndex,cellIndex);break;case'shiftDown':case'shiftUp':this.shiftDownKey(rowIndex,cellIndex);break;case'shiftLeft':case'shiftRight':this.applyShiftLeftRightKey(rowIndex,cellIndex);break;case'home':case'end':cellIndex=e.keyArgs.action==='end'?this.getLastColIndex(rowIndex):0;this.applyHomeEndKey(rowIndex,cellIndex);break;case'ctrlHome':case'ctrlEnd':this.applyCtrlHomeEndKey(rowIndex,cellIndex);break;case'escape':this.clearSelection();break;case'ctrlPlusA':this.ctrlPlusA();break;case'space':this.applySpaceSelection(e.element);break;}this.preventFocus=false;}},{key:'ctrlPlusA',value:function ctrlPlusA(){if(this.isRowType()&&!this.isSingleSel()){this.selectRowsByRange(0,this.parent.getRows().length-1);}if(this.isCellType()&&!this.isSingleSel()){this.selectCellsByRange({rowIndex:0,cellIndex:0},{rowIndex:this.parent.getRows().length-1,cellIndex:this.parent.getColumns().length-1});}}},{key:'applySpaceSelection',value:function applySpaceSelection(target){if(target.classList.contains('e-checkselectall')){this.checkedTarget=target;this.checkSelectAll(this.checkedTarget);}else{if(target.classList.contains('e-checkselect')){this.checkedTarget=target;this.checkSelect(this.checkedTarget);}}}},{key:'applyDownUpKey',value:function applyDownUpKey(rowIndex,cellIndex){var gObj=this.parent;if(this.parent.isCheckBoxSelection&&this.parent.checkAllRows==='Check'){this.checkSelectAllAction(false);this.checkedTarget=null;}if(this.isRowType()){if(this.parent.frozenRows){this.selectRow(rowIndex,true);this.applyUpDown(gObj.selectedRowIndex);}else{this.selectRow(rowIndex,true);this.applyUpDown(gObj.selectedRowIndex);}}if(this.isCellType()){this.selectCell({rowIndex:rowIndex,cellIndex:cellIndex},true);}}},{key:'applyUpDown',value:function applyUpDown(rowIndex){if(rowIndex<0){return;}if(!this.target){this.target=this.parent.getRows()[0].children[this.parent.groupSettings.columns.length||0];}var cIndex=parseInt(this.target.getAttribute('aria-colindex'),10);var frzCols=this.parent.getFrozenColumns();if(frzCols){if(cIndex>=frzCols){this.target=this.contentRenderer.getMovableRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex-frzCols];}else{this.target=this.contentRenderer.getRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex];}}else{this.target=this.contentRenderer.getRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex];}this.addAttribute(this.target);}},{key:'applyRightLeftKey',value:function applyRightLeftKey(rowIndex,cellIndex){var gObj=this.parent;if(this.isCellType()){this.selectCell({rowIndex:rowIndex,cellIndex:cellIndex},true);this.addAttribute(this.target);}}},{key:'applyHomeEndKey',value:function applyHomeEndKey(rowIndex,cellIndex){if(this.isCellType()){this.selectCell({rowIndex:rowIndex,cellIndex:cellIndex},true);}else{this.addAttribute(this.parent.getCellFromIndex(rowIndex,cellIndex));}}},{key:'shiftDownKey',value:function shiftDownKey(rowIndex,cellIndex){var gObj=this.parent;this.isMultiShiftRequest=true;if(this.isRowType()&&!this.isSingleSel()){if(!isUndefined(this.prevRowIndex)){this.selectRowsByRange(this.prevRowIndex,rowIndex);this.applyUpDown(rowIndex);}else{this.selectRow(0,true);}}if(this.isCellType()&&!this.isSingleSel()){this.selectCellsByRange(this.prevCIdxs||{rowIndex:0,cellIndex:0},{rowIndex:rowIndex,cellIndex:cellIndex});}this.isMultiShiftRequest=false;}},{key:'applyShiftLeftRightKey',value:function applyShiftLeftRightKey(rowIndex,cellIndex){var gObj=this.parent;this.isMultiShiftRequest=true;this.selectCellsByRange(this.prevCIdxs,{rowIndex:rowIndex,cellIndex:cellIndex});this.isMultiShiftRequest=false;}},{key:'applyCtrlHomeEndKey',value:function applyCtrlHomeEndKey(rowIndex,cellIndex){if(this.isRowType()){this.selectRow(rowIndex,true);this.addAttribute(this.parent.getCellFromIndex(rowIndex,cellIndex));}if(this.isCellType()){this.selectCell({rowIndex:rowIndex,cellIndex:cellIndex},true);}}},{key:'addRemoveClassesForRow',value:function addRemoveClassesForRow(row,isAdd,clearAll){if(row){var cells=[].slice.call(row.querySelectorAll('.e-rowcell'));var cell=row.querySelector('.e-detailrowcollapse')||row.querySelector('.e-detailrowexpand');if(cell){cells.push(cell);}for(var _len8=arguments.length,args=Array(_len8>3?_len8-3:0),_key2=3;_key2<_len8;_key2++){args[_key2-3]=arguments[_key2];}addRemoveActiveClasses.apply(undefined,[cells,isAdd].concat(args));}this.getRenderer().setSelection(row?row.getAttribute('data-uid'):null,isAdd,clearAll);}},{key:'isRowType',value:function isRowType(){return this.selectionSettings.mode==='Row'||this.selectionSettings.mode==='Both';}},{key:'isCellType',value:function isCellType(){return this.selectionSettings.mode==='Cell'||this.selectionSettings.mode==='Both';}},{key:'isSingleSel',value:function isSingleSel(){return this.selectionSettings.type==='Single';}},{key:'getRenderer',value:function getRenderer(){if(isNullOrUndefined(this.contentRenderer)){this.contentRenderer=this.factory.getRenderer(RenderType.Content);}return this.contentRenderer;}},{key:'getSelectedRecords',value:function getSelectedRecords(){var selectedData=[];if(!this.selectionSettings.persistSelection){selectedData=this.parent.getRowsObject().filter(function(row){return row.isSelected;}).map(function(m){return m.data;});}else{selectedData=this.persistSelectedData;}return selectedData;}},{key:'addEventListener_checkbox',value:function addEventListener_checkbox(){this.parent.on(dataReady,this.dataReady,this);this.onDataBoundFunction=this.onDataBound.bind(this);this.parent.addEventListener(dataBound,this.onDataBoundFunction);this.parent.on(contentReady,this.checkBoxSelectionChanged,this);this.actionCompleteFunc=this.actionCompleteHandler.bind(this);this.parent.addEventListener(actionComplete,this.actionCompleteFunc);this.parent.on(click,this.clickHandler,this);}},{key:'removeEventListener_checkbox',value:function removeEventListener_checkbox(){this.parent.off(dataReady,this.dataReady);this.parent.removeEventListener(dataBound,this.onDataBoundFunction);this.parent.removeEventListener(actionComplete,this.actionCompleteFunc);this.parent.off(click,this.clickHandler);}},{key:'actionCompleteHandler',value:function actionCompleteHandler(e){if(e.requestType==='save'&&this.parent.isPersistSelection){this.refreshPersistSelection();}}}]);return Selection;}());_export('Search',Search=function(){/**
     * Constructor for Grid search module.
     * @hidden
     */function Search(parent){_classCallCheck(this,Search);this.parent=parent;this.addEventListener();}/**
     * Searches Grid records by given key.
     *
     * > You can customize the default search action by using [`searchSettings`](./api-grid.html#searchsettings-searchsettingsmodel).
     * @param  {string} searchString - Defines the key.
     * @return {void}
     */_createClass(Search,[{key:'search',value:function search(searchString){var gObj=this.parent;searchString=isNullOrUndefined(searchString)?'':searchString;if(_isActionPrevent(gObj)){gObj.notify(preventBatch,{instance:this,handler:this.search,arg1:searchString});return;}if(searchString!==gObj.searchSettings.key){gObj.searchSettings.key=searchString.toString();gObj.dataBind();}else if(this.refreshSearch){gObj.refresh();}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(inBoundModelChanged,this.onPropertyChanged,this);this.parent.on(searchComplete,this.onSearchComplete,this);this.parent.on(_destroy,this.destroy,this);this.actionCompleteFunc=this.onActionComplete.bind(this);this.parent.addEventListener(actionComplete,this.actionCompleteFunc);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(inBoundModelChanged,this.onPropertyChanged);this.parent.off(searchComplete,this.onSearchComplete);this.parent.off(_destroy,this.destroy);this.parent.removeEventListener(actionComplete,this.actionCompleteFunc);}},{key:'destroy',value:function destroy(){this.removeEventListener();}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}if(!isNullOrUndefined(e.properties.key)){this.parent.notify(modelChanged,{requestType:'searching',type:actionBegin,searchString:this.parent.searchSettings.key});}else{this.parent.notify(modelChanged,{requestType:'searching',type:actionBegin});}}},{key:'onSearchComplete',value:function onSearchComplete(e){this.parent.trigger(actionComplete,extend(e,{searchString:this.parent.searchSettings.key,requestType:'searching',type:actionComplete}));}},{key:'onActionComplete',value:function onActionComplete(e){this.refreshSearch=e.requestType!=='searching';}},{key:'getModuleName',value:function getModuleName(){return'search';}}]);return Search;}());ShowHide=function(){/**
     * Constructor for the show hide module.
     * @hidden
     */function ShowHide(parent){_classCallCheck(this,ShowHide);this.parent=parent;}/**
     * Shows a column by column name.
     * @param  {string|string[]} columnName - Defines a single or collection of column names to show.
     * @param  {string} showBy - Defines the column key either as field name or header text.
     * @return {void}
     */_createClass(ShowHide,[{key:'show',value:function show(columnName,showBy){var keys=this.getToggleFields(columnName);var columns=this.getColumns(keys,showBy);this.parent.notify(tooltipDestroy,{module:'edit'});columns.forEach(function(value){value.visible=true;});this.setVisible(columns);}},{key:'hide',value:function hide(columnName,hideBy){var keys=this.getToggleFields(columnName);var columns=this.getColumns(keys,hideBy);this.parent.notify(tooltipDestroy,{module:'edit'});columns.forEach(function(value){value.visible=false;});this.setVisible(columns);}},{key:'getToggleFields',value:function getToggleFields(key){var finalized=[];if(typeof key==='string'){finalized=[key];}else{finalized=key;}return finalized;}},{key:'getColumns',value:function getColumns(keys,getKeyBy){var _this50=this;var columns=iterateArrayOrObject(keys,function(key,index){return iterateArrayOrObject(_this50.parent.getColumns(),function(item,index){if(item[getKeyBy]===key){return item;}return undefined;})[0];});return columns;}},{key:'setVisible',value:function setVisible(columns){if(_isActionPrevent(this.parent)){this.parent.notify(preventBatch,{instance:this,handler:this.setVisible,arg1:columns});return;}columns=isNullOrUndefined(columns)?this.parent.getColumns():columns;if(this.parent.allowSelection&&this.parent.getSelectedRecords().length){this.parent.clearSelection();}this.parent.notify(columnVisibilityChanged,columns);}}]);return ShowHide;}();_export('Scroll',Scroll=function(){/**
     * Constructor for the Grid scrolling.
     * @hidden
     */function Scroll(parent){_classCallCheck(this,Scroll);this.lastScrollTop=0;//To maintain scroll state on grid actions.
this.previousValues={top:0,left:0};this.oneTimeReady=true;this.parent=parent;this.widthService=new ColumnWidthService(parent);this.addEventListener();}/**
     * For internal use only - Get the module name.
     * @private
     */_createClass(Scroll,[{key:'getModuleName',value:function getModuleName(){return'scroll';}},{key:'setWidth',value:function setWidth(){this.parent.element.style.width=formatUnit(this.parent.width);if(this.parent.toolbarModule&&this.parent.toolbarModule.toolbar&&this.parent.toolbarModule.toolbar.element){this.parent.toolbarModule.toolbar.refreshOverflow();}}},{key:'setHeight',value:function setHeight(){var mHdrHeight=0;var content=this.parent.getContent().firstChild;if(this.parent.frozenRows&&this.parent.height!=='auto'){mHdrHeight=this.parent.getHeaderContent().querySelector('tbody').offsetHeight;content.style.height=formatUnit(this.parent.height-mHdrHeight);}else{content.style.height=formatUnit(this.parent.height);}this.ensureOverflow(content);}},{key:'setPadding',value:function setPadding(){var content=this.parent.getHeaderContent();var scrollWidth=Scroll.getScrollBarWidth()-this.getThreshold();var cssProps=this.getCssProperties();content.firstChild.style[cssProps.border]=scrollWidth>0?'1px':'0px';content.style[cssProps.padding]=scrollWidth>0?scrollWidth+'px':'0px';}},{key:'removePadding',value:function removePadding(rtl){var cssProps=this.getCssProperties(rtl);this.parent.getHeaderContent().firstChild.style[cssProps.border]='';this.parent.getHeaderContent().firstChild.parentElement.style[cssProps.padding]='';}},{key:'refresh',value:function refresh(){if(this.parent.height!=='100%'){return;}var content=this.parent.getContent();this.parent.element.style.height='100%';var height=this.widthService.getSiblingsHeight(content);content.style.height='calc(100% - '+height+'px)';//Set the height to the '.e-gridcontent';
}},{key:'getThreshold',value:function getThreshold(){/* Some browsers places the scroller outside the content,
         * hence the padding should be adjusted.*/var appName=Browser.info.name;if(appName==='mozilla'){return 0.5;}return 1;}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(onEmpty,this.wireEvents,this);this.parent.on(contentReady,this.wireEvents,this);this.parent.on(uiUpdate,this.onPropertyChanged,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(onEmpty,this.wireEvents);this.parent.off(contentReady,this.wireEvents);this.parent.off(uiUpdate,this.onPropertyChanged);}},{key:'onContentScroll',value:function onContentScroll(scrollTarget){var _this51=this;var element=scrollTarget;var isHeader=element.classList.contains('e-headercontent');return function(e){if(_this51.content.querySelector('tbody')===null){return;}var target=e.target;var left=target.scrollLeft;var sLimit=target.scrollWidth;var isFooter=target.classList.contains('e-summarycontent');if(_this51.previousValues.left===left){_this51.previousValues.top=!isHeader?_this51.previousValues.top:target.scrollTop;return;}element.scrollLeft=left;if(isFooter){_this51.header.scrollLeft=left;}_this51.previousValues.left=left;_this51.parent.notify(scroll,{left:left});};}},{key:'onFreezeContentScroll',value:function onFreezeContentScroll(scrollTarget){var _this52=this;var element=scrollTarget;return function(e){if(_this52.content.querySelector('tbody')===null){return;}var target=e.target;var top=target.scrollTop;if(_this52.previousValues.top===top){return;}element.scrollTop=top;_this52.previousValues.top=top;if(_this52.parent.isDestroyed){return;}};}},{key:'onWheelScroll',value:function onWheelScroll(scrollTarget){var _this53=this;var element=scrollTarget;return function(e){if(_this53.content.querySelector('tbody')===null){return;}var top=element.scrollTop+e.deltaMode===1?e.deltaY*30:e.deltaY;if(_this53.previousValues.top===top){return;}e.preventDefault();_this53.parent.getContent().querySelector('.e-frozencontent').scrollTop=top;element.scrollTop=top;_this53.previousValues.top=top;};}},{key:'onTouchScroll',value:function onTouchScroll(scrollTarget){var _this54=this;var element=scrollTarget;return function(e){if(e.pointerType==='mouse'){return;}var cont=void 0;var mHdr=void 0;var pageXY=_this54.getPointXY(e);var top=element.scrollTop+(_this54.pageXY.y-pageXY.y);var left=element.scrollLeft+(_this54.pageXY.x-pageXY.x);if(_this54.parent.getHeaderContent().contains(e.target)){mHdr=_this54.parent.getFrozenColumns()?_this54.parent.getHeaderContent().querySelector('.e-movableheader'):_this54.parent.getHeaderContent().firstChild;if(_this54.previousValues.left===left||left<0||mHdr.scrollWidth-mHdr.clientWidth<left){return;}e.preventDefault();mHdr.scrollLeft=left;element.scrollLeft=left;_this54.pageXY.x=pageXY.x;_this54.previousValues.left=left;}else{cont=_this54.parent.getContent().querySelector('.e-frozencontent');if(_this54.previousValues.top===top||top<0||cont.scrollHeight-cont.clientHeight<top){return;}e.preventDefault();cont.scrollTop=top;element.scrollTop=top;_this54.pageXY.y=pageXY.y;_this54.previousValues.top=top;}};}},{key:'setPageXY',value:function setPageXY(){var _this55=this;return function(e){if(e.pointerType==='mouse'){return;}_this55.pageXY=_this55.getPointXY(e);};}},{key:'getPointXY',value:function getPointXY(e){var pageXY={x:0,y:0};if(e.touches&&e.touches.length){pageXY.x=e.touches[0].pageX;pageXY.y=e.touches[0].pageY;}else{pageXY.x=e.pageX;pageXY.y=e.pageY;}return pageXY;}},{key:'wireEvents',value:function wireEvents(){if(this.oneTimeReady){var frzCols=this.parent.getFrozenColumns();this.content=this.parent.getContent().firstChild;this.header=this.parent.getHeaderContent().firstChild;var mCont=this.content.querySelector('.e-movablecontent');var fCont=this.content.querySelector('.e-frozencontent');var mHdr=this.header.querySelector('.e-movableheader');if(this.parent.frozenRows){EventHandler.add(frzCols?mHdr:this.header,'touchstart pointerdown',this.setPageXY(),this);EventHandler.add(frzCols?mHdr:this.header,'touchmove pointermove',this.onTouchScroll(frzCols?mCont:this.content),this);}if(frzCols){EventHandler.add(mCont,'scroll',this.onContentScroll(mHdr),this);EventHandler.add(mCont,'scroll',this.onFreezeContentScroll(fCont),this);EventHandler.add(fCont,'scroll',this.onFreezeContentScroll(mCont),this);EventHandler.add(mHdr,'scroll',this.onContentScroll(mCont),this);EventHandler.add(fCont,'wheel',this.onWheelScroll(mCont),this);EventHandler.add(fCont,'touchstart pointerdown',this.setPageXY(),this);EventHandler.add(fCont,'touchmove pointermove',this.onTouchScroll(mCont),this);}else{EventHandler.add(this.content,'scroll',this.onContentScroll(this.header),this);EventHandler.add(this.header,'scroll',this.onContentScroll(this.content),this);}if(this.parent.aggregates.length){EventHandler.add(this.parent.getFooterContent().firstChild,'scroll',this.onContentScroll(this.content),this);}this.refresh();this.oneTimeReady=false;}var table=this.parent.getContentTable();if(table.scrollHeight<this.parent.getContent().clientHeight){addClass(table.querySelectorAll('tr:last-child td'),'e-lastrowcell');if(this.parent.getFrozenColumns()){addClass(this.parent.getContent().querySelector('.e-movablecontent').querySelectorAll('tr:last-child td'),'e-lastrowcell');}}if(!this.parent.enableVirtualization){this.content.scrollLeft=this.header.scrollLeft;this.content.scrollTop=this.previousValues.top;}if(!this.parent.enableColumnVirtualization){this.content.scrollLeft=this.header.scrollLeft;}}},{key:'getCssProperties',value:function getCssProperties(rtl){var css={};var enableRtl=isNullOrUndefined(rtl)?this.parent.enableRtl:rtl;css.border=enableRtl?'borderLeftWidth':'borderRightWidth';css.padding=enableRtl?'paddingLeft':'paddingRight';return css;}},{key:'ensureOverflow',value:function ensureOverflow(content){if(this.parent.getFrozenColumns()){content.querySelector('.e-movablecontent').style.overflowY=this.parent.height==='auto'?'auto':'scroll';}else{content.style.overflowY=this.parent.height==='auto'?'auto':'scroll';}}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}this.setPadding();this.oneTimeReady=true;if(this.parent.height==='auto'){this.removePadding();}this.wireEvents();this.setHeight();this.setWidth();}},{key:'destroy',value:function destroy(){this.removeEventListener();//Remove padding
this.removePadding();removeClass([this.parent.getHeaderContent().firstChild],'e-headercontent');removeClass([this.parent.getContent().firstChild],'e-content');//Remove height
this.parent.getContent().firstChild.style.height='';//Remove width
this.parent.element.style.width='';//Remove Dom event
EventHandler.remove(this.parent.getContent().firstChild,'scroll',this.onContentScroll);}}],[{key:'getScrollBarWidth',value:function getScrollBarWidth(){return _getScrollBarWidth();}}]);return Scroll;}());_export('Print',Print=function(){/**
     * Constructor for the Grid print module
     * @hidden
     */function Print(parent,scrollModule){_classCallCheck(this,Print);this.isAsyncPrint=false;this.printing='isPrinting';this.parent=parent;if(this.parent.isDestroyed){return;}this.parent.on(contentReady,this.contentReady.bind(this));this.parent.addEventListener(actionBegin,this.actionBegin.bind(this));this.parent.on(onEmpty,this.onEmpty.bind(this));this.scrollModule=scrollModule;}/**
     * By default, prints all the Grid pages and hides the pager.
     * > You can customize print options using the
     * [`printMode`](./api-grid.html#printmode-string).
     * @return {void}
     */_createClass(Print,[{key:'print',value:function print(){this.renderPrintGrid();this.printWind=window.open('','print','height='+window.outerHeight+',width='+window.outerWidth+',tabbar=no');this.printWind.moveTo(0,0);this.printWind.resizeTo(screen.availWidth,screen.availHeight);}},{key:'onEmpty',value:function onEmpty(){if(this.isPrintGrid()){this.contentReady();}}},{key:'actionBegin',value:function actionBegin(){if(this.isPrintGrid()){this.isAsyncPrint=true;}}},{key:'renderPrintGrid',value:function renderPrintGrid(){var gObj=this.parent;var printGridModel={};var element=createElement('div',{id:this.parent.element.id+'_print',className:gObj.element.className+' e-print-grid'});document.body.appendChild(element);var _iteratorNormalCompletion20=true;var _didIteratorError20=false;var _iteratorError20=undefined;try{for(var _iterator20=Print.printGridProp[Symbol.iterator](),_step20;!(_iteratorNormalCompletion20=(_step20=_iterator20.next()).done);_iteratorNormalCompletion20=true){var key=_step20.value;if(key==='columns'){printGridModel[key]=getActualPropFromColl(gObj[key]);}else if(key==='allowPaging'){printGridModel[key]=this.parent.printMode==='CurrentPage';}else{printGridModel[key]=getActualProperties(gObj[key]);}}}catch(err){_didIteratorError20=true;_iteratorError20=err;}finally{try{if(!_iteratorNormalCompletion20&&_iterator20.return){_iterator20.return();}}finally{if(_didIteratorError20){throw _iteratorError20;}}}var printGrid=new Grid(printGridModel);printGrid.appendTo(element);printGrid[this.printing]=true;}},{key:'contentReady',value:function contentReady(){if(this.isPrintGrid()){var gObj=this.parent;if(this.isAsyncPrint){this.printGrid();return;}var args={requestType:'print',element:gObj.element,selectedRows:gObj.getContentTable().querySelectorAll('tr[aria-selected="true"]'),cancel:false};if(!this.isAsyncPrint){gObj.trigger(beforePrint,args);}if(args.cancel){detach(gObj.element);return;}else if(!this.isAsyncPrint){this.printGrid();}}}},{key:'printGrid',value:function printGrid(){var gObj=this.parent;// Pager eleement process based on primt mode
if(gObj.allowPaging&&gObj.printMode==='CurrentPage'){gObj.element.querySelector('.e-gridpager').style.display='none';}// Height adjustment on print grid
if(gObj.height!=='auto'){var cssProps=this.scrollModule.getCssProperties();var contentDiv=gObj.element.querySelector('.e-content');var headerDiv=gObj.element.querySelector('.e-gridheader');contentDiv.style.height='auto';contentDiv.style.overflowY='auto';headerDiv.style[cssProps.padding]='';headerDiv.firstElementChild.style[cssProps.border]='';}// Grid alignment adjustment on grouping
if(gObj.allowGrouping){if(!gObj.groupSettings.columns.length){gObj.element.querySelector('.e-groupdroparea').style.display='none';}else{this.removeColGroup(gObj.groupSettings.columns.length,gObj.element);removeElement(gObj.element,'.e-grouptopleftcell');removeElement(gObj.element,'.e-recordpluscollapse');removeElement(gObj.element,'.e-indentcell');removeElement(gObj.element,'.e-recordplusexpand');}}// hide horizontal scroll
gObj.element.querySelector('.e-content').style.overflowX='hidden';//hide filter bar in print grid
if(gObj.allowFiltering&&gObj.filterSettings.type==='FilterBar'){gObj.element.querySelector('.e-filterbar').style.display='none';}// Hide the waiting popup
var waitingPop=gObj.element.querySelectorAll('.e-spin-show');if(waitingPop.length>0){waitingPop[0].classList.add('e-spin-hide');waitingPop[0].classList.remove('e-spin-show');}if(gObj[this.printing]){detach(gObj.element);}gObj.element.classList.remove('e-print-grid');this.printWind=print(gObj.element,this.printWind);gObj[this.printing]=false;var args={element:gObj.element};gObj.trigger(printComplete,args);}},{key:'removeColGroup',value:function removeColGroup(depth,element){var groupCaption=element.querySelectorAll('.e-groupcaption');var colSpan=groupCaption[depth-1].getAttribute('colspan');for(var i=0;i<groupCaption.length;i++){groupCaption[i].setAttribute('colspan',colSpan);}var colGroups=element.querySelectorAll('colgroup');for(var _i7=0;_i7<colGroups.length;_i7++){for(var j=0;j<depth;j++){colGroups[_i7].childNodes[j].style.display='none';}}}},{key:'isPrintGrid',value:function isPrintGrid(){return this.parent.element.id.indexOf('_print')>0&&this.parent[this.printing];}},{key:'destroy',value:function destroy(){if(this.parent.isDestroyed){return;}this.parent.off(contentReady,this.contentReady.bind(this));this.parent.removeEventListener(actionBegin,this.actionBegin.bind(this));this.parent.off(onEmpty,this.onEmpty.bind(this));}},{key:'getModuleName',value:function getModuleName(){return'print';}}]);return Print;}());Print.printGridProp=['aggregates','allowGrouping','allowFiltering','allowMultiSorting','allowReordering','allowSorting','allowTextWrap','childGrid','columns','currentViewData','dataSource','detailTemplate','enableAltRow','enableColumnVirtualization','filterSettings','gridLines','groupSettings','height','locale','pageSettings','printMode','query','queryString','rowHeight','rowTemplate','sortSettings','textWrapSettings','allowPaging',beforePrint,printComplete];__decorate$2=undefined&&undefined.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if((typeof Reflect==='undefined'?'undefined':_typeof(Reflect))==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--){if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;}return c>3&&r&&Object.defineProperty(target,key,r),r;};AggregateColumn=function(_ChildProperty2){_inherits(AggregateColumn,_ChildProperty2);function AggregateColumn(){_classCallCheck(this,AggregateColumn);var _this56=_possibleConstructorReturn(this,(AggregateColumn.__proto__||Object.getPrototypeOf(AggregateColumn)).apply(this,arguments));_this56.templateFn={};return _this56;}/**
     * @hidden
     */_createClass(AggregateColumn,[{key:'setFormatter',value:function setFormatter(){var valueFormatter=new ValueFormatter();if(this.format&&(this.format.skeleton||this.format.format)){this.formatFn=valueFormatter.getFormatFunction(this.format);}}},{key:'getFormatter',value:function getFormatter(){return this.formatFn;}},{key:'setTemplate',value:function setTemplate(){var helper=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.footerTemplate!==undefined){this.templateFn[getEnumValue(CellType,CellType.Summary)]={fn:_compile(this.footerTemplate,helper),property:'footerTemplate'};}if(this.groupFooterTemplate!==undefined){this.templateFn[getEnumValue(CellType,CellType.GroupSummary)]={fn:_compile(this.groupFooterTemplate,helper),property:'groupFooterTemplate'};}if(this.groupCaptionTemplate!==undefined){this.templateFn[getEnumValue(CellType,CellType.CaptionSummary)]={fn:_compile(this.groupCaptionTemplate,helper),property:'groupCaptionTemplate'};}}},{key:'getTemplate',value:function getTemplate(type){return this.templateFn[getEnumValue(CellType,type)];}},{key:'setPropertiesSilent',value:function setPropertiesSilent(prop){this.setProperties(prop,true);}}]);return AggregateColumn;}(ChildProperty);__decorate$2([Property()],AggregateColumn.prototype,"type",void 0);__decorate$2([Property()],AggregateColumn.prototype,"field",void 0);__decorate$2([Property()],AggregateColumn.prototype,"columnName",void 0);__decorate$2([Property()],AggregateColumn.prototype,"format",void 0);__decorate$2([Property()],AggregateColumn.prototype,"footerTemplate",void 0);__decorate$2([Property()],AggregateColumn.prototype,"groupFooterTemplate",void 0);__decorate$2([Property()],AggregateColumn.prototype,"groupCaptionTemplate",void 0);__decorate$2([Property()],AggregateColumn.prototype,"customAggregate",void 0);/**
 * Configures the aggregate rows.
 */AggregateRow=function(_ChildProperty3){_inherits(AggregateRow,_ChildProperty3);function AggregateRow(){_classCallCheck(this,AggregateRow);return _possibleConstructorReturn(this,(AggregateRow.__proto__||Object.getPrototypeOf(AggregateRow)).apply(this,arguments));}return AggregateRow;}(ChildProperty);__decorate$2([Collection([],AggregateColumn)],AggregateRow.prototype,"columns",void 0);/**
 * The `Clipboard` module is used to handle clipboard copy action.
 */_export('Clipboard',Clipboard=function(){/**
     * Constructor for the Grid clipboard module
     * @hidden
     */function Clipboard(parent){_classCallCheck(this,Clipboard);this.copyContent='';this.isSelect=false;this.parent=parent;this.addEventListener();}/**
     * @hidden
     */_createClass(Clipboard,[{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(contentReady,this.initialEnd,this);this.parent.on(keyPressed,this.keyDownHandler,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(keyPressed,this.keyDownHandler);}},{key:'initialEnd',value:function initialEnd(){this.parent.off(contentReady,this.initialEnd);this.clipBoardTextArea=createElement('textarea',{className:'e-clipboard',styles:'opacity: 0',attrs:{readonly:'true',tabindex:'-1','aria-label':'clipboard'}});this.parent.element.appendChild(this.clipBoardTextArea);}},{key:'keyDownHandler',value:function keyDownHandler(e){if(e.action==='ctrlPlusC'){this.copy();}else if(e.action==='ctrlShiftPlusH'){this.copy(true);}}},{key:'setCopyData',value:function setCopyData(withHeader){if(window.getSelection().toString()===''){var isFrozen=this.parent.getFrozenColumns();this.clipBoardTextArea.value=this.copyContent='';var mRows=void 0;var rows=this.parent.getRows();if(isFrozen){mRows=this.parent.getMovableDataRows();}if(this.parent.selectionSettings.mode!=='Cell'){var selectedIndexes=this.parent.getSelectedRowIndexes().sort(function(a,b){return a-b;});if(withHeader){var headerTextArray=[];for(var i=0;i<this.parent.getVisibleColumns().length;i++){headerTextArray[i]=this.parent.getVisibleColumns()[i].headerText;}this.getCopyData(headerTextArray,false,'\t',withHeader);this.copyContent+='\n';}for(var _i8=0;_i8<selectedIndexes.length;_i8++){if(_i8>0){this.copyContent+='\n';}var cells=[].slice.call(rows[selectedIndexes[_i8]].querySelectorAll('.e-rowcell'));if(isFrozen){cells.push.apply(cells,_toConsumableArray([].slice.call(mRows[selectedIndexes[_i8]].querySelectorAll('.e-rowcell'))));}this.getCopyData(cells,false,'\t',withHeader);}}else{var obj=this.checkBoxSelection();if(obj.status){if(withHeader){var headers=[];for(var _i9=0;_i9<obj.colIndexes.length;_i9++){headers.push(this.parent.getColumnHeaderByIndex(obj.colIndexes[_i9]));}this.getCopyData(headers,false,'\t',withHeader);this.copyContent+='\n';}for(var _i10=0;_i10<obj.rowIndexes.length;_i10++){if(_i10>0){this.copyContent+='\n';}var _cells=[].slice.call(rows[obj.rowIndexes[_i10]].querySelectorAll('.e-cellselectionbackground'));if(isFrozen){_cells.push.apply(_cells,_toConsumableArray([].slice.call(mRows[obj.rowIndexes[_i10]].querySelectorAll('.e-cellselectionbackground'))));}this.getCopyData(_cells,false,'\t',withHeader);}}else{this.getCopyData([].slice.call(this.parent.element.querySelectorAll('.e-cellselectionbackground')),true,'\n',withHeader);}}var args={data:this.copyContent,cancel:false};this.parent.trigger(beforeCopy,args);if(args.cancel){return;}this.clipBoardTextArea.value=this.copyContent=args.data;if(!Browser.userAgent.match(/ipad|ipod|iphone/i)){this.clipBoardTextArea.select();}else{this.clipBoardTextArea.setSelectionRange(0,this.clipBoardTextArea.value.length);}this.isSelect=true;}}},{key:'getCopyData',value:function getCopyData(cells,isCell,splitKey,withHeader){var isElement=typeof cells[0]!=='string';for(var j=0;j<cells.length;j++){if(withHeader&&isCell){this.copyContent+=this.parent.getColumns()[parseInt(cells[j].getAttribute('aria-colindex'),10)].headerText+'\n';}if(isElement){if(!cells[j].classList.contains('e-hide')){this.copyContent+=cells[j].textContent;}}else{this.copyContent+=cells[j];}if(j<cells.length-1){this.copyContent+=splitKey;}}}},{key:'copy',value:function copy(withHeader){if(document.queryCommandSupported('copy')){this.setCopyData(withHeader);document.execCommand('copy');this.clipBoardTextArea.blur();}if(this.isSelect){window.getSelection().removeAllRanges();this.isSelect=false;}}},{key:'getModuleName',value:function getModuleName(){return'clipboard';}},{key:'destroy',value:function destroy(){this.removeEventListener();remove(this.clipBoardTextArea);}},{key:'checkBoxSelection',value:function checkBoxSelection(){var gridObj=this.parent;var obj={status:false};if(gridObj.selectionSettings.mode==='Cell'){var rowCellIndxes=gridObj.getSelectedRowCellIndexes();var str=void 0;var rowIndexes=[];var i=void 0;for(i=0;i<rowCellIndxes.length;i++){if(rowCellIndxes[i].cellIndexes.length){rowIndexes.push(rowCellIndxes[i].rowIndex);}if(rowCellIndxes[i].cellIndexes.length){if(!str){str=JSON.stringify(rowCellIndxes[i].cellIndexes.sort());}if(str!==JSON.stringify(rowCellIndxes[i].cellIndexes.sort())){break;}}}rowIndexes.sort();if(i===rowCellIndxes.length&&rowIndexes[rowIndexes.length-1]-rowIndexes[0]===rowIndexes.length-1){obj={status:true,rowIndexes:rowIndexes,colIndexes:rowCellIndxes[0].cellIndexes};}}return obj;}}]);return Clipboard;}());__decorate=undefined&&undefined.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if((typeof Reflect==='undefined'?'undefined':_typeof(Reflect))==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--){if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;}return c>3&&r&&Object.defineProperty(target,key,r),r;};_export('SortDescriptor',SortDescriptor=function(_ChildProperty4){_inherits(SortDescriptor,_ChildProperty4);function SortDescriptor(){_classCallCheck(this,SortDescriptor);return _possibleConstructorReturn(this,(SortDescriptor.__proto__||Object.getPrototypeOf(SortDescriptor)).apply(this,arguments));}return SortDescriptor;}(ChildProperty));__decorate([Property()],SortDescriptor.prototype,"field",void 0);__decorate([Property()],SortDescriptor.prototype,"direction",void 0);/**
 * Configures the sorting behavior of Grid.
 */_export('SortSettings',SortSettings=function(_ChildProperty5){_inherits(SortSettings,_ChildProperty5);function SortSettings(){_classCallCheck(this,SortSettings);return _possibleConstructorReturn(this,(SortSettings.__proto__||Object.getPrototypeOf(SortSettings)).apply(this,arguments));}return SortSettings;}(ChildProperty));__decorate([Collection([],SortDescriptor)],SortSettings.prototype,"columns",void 0);__decorate([Property(true)],SortSettings.prototype,"allowUnsort",void 0);/**
 * Represents the predicate for the filter column.
 */_export('Predicate',Predicate$1=function(_ChildProperty6){_inherits(Predicate$1,_ChildProperty6);function Predicate$1(){_classCallCheck(this,Predicate$1);return _possibleConstructorReturn(this,(Predicate$1.__proto__||Object.getPrototypeOf(Predicate$1)).apply(this,arguments));}return Predicate$1;}(ChildProperty));__decorate([Property()],Predicate$1.prototype,"field",void 0);__decorate([Property()],Predicate$1.prototype,"operator",void 0);__decorate([Property()],Predicate$1.prototype,"value",void 0);__decorate([Property()],Predicate$1.prototype,"matchCase",void 0);__decorate([Property()],Predicate$1.prototype,"ignoreAccent",void 0);__decorate([Property()],Predicate$1.prototype,"predicate",void 0);__decorate([Property({})],Predicate$1.prototype,"actualFilterValue",void 0);__decorate([Property({})],Predicate$1.prototype,"actualOperator",void 0);__decorate([Property()],Predicate$1.prototype,"type",void 0);__decorate([Property()],Predicate$1.prototype,"ejpredicate",void 0);/**
 * Configures the filtering behavior of the Grid.
 */_export('FilterSettings',FilterSettings=function(_ChildProperty7){_inherits(FilterSettings,_ChildProperty7);function FilterSettings(){_classCallCheck(this,FilterSettings);return _possibleConstructorReturn(this,(FilterSettings.__proto__||Object.getPrototypeOf(FilterSettings)).apply(this,arguments));}return FilterSettings;}(ChildProperty));__decorate([Collection([],Predicate$1)],FilterSettings.prototype,"columns",void 0);__decorate([Property('FilterBar')],FilterSettings.prototype,"type",void 0);__decorate([Property()],FilterSettings.prototype,"mode",void 0);__decorate([Property(true)],FilterSettings.prototype,"showFilterBarStatus",void 0);__decorate([Property(1500)],FilterSettings.prototype,"immediateModeDelay",void 0);__decorate([Property()],FilterSettings.prototype,"operators",void 0);__decorate([Property(false)],FilterSettings.prototype,"ignoreAccent",void 0);/**
 * Configures the selection behavior of the Grid.
 */_export('SelectionSettings',SelectionSettings=function(_ChildProperty8){_inherits(SelectionSettings,_ChildProperty8);function SelectionSettings(){_classCallCheck(this,SelectionSettings);return _possibleConstructorReturn(this,(SelectionSettings.__proto__||Object.getPrototypeOf(SelectionSettings)).apply(this,arguments));}return SelectionSettings;}(ChildProperty));__decorate([Property('Row')],SelectionSettings.prototype,"mode",void 0);__decorate([Property('Flow')],SelectionSettings.prototype,"cellSelectionMode",void 0);__decorate([Property('Single')],SelectionSettings.prototype,"type",void 0);__decorate([Property(false)],SelectionSettings.prototype,"checkboxOnly",void 0);__decorate([Property(false)],SelectionSettings.prototype,"persistSelection",void 0);/**
 * Configures the search behavior of the Grid.
 */_export('SearchSettings',SearchSettings=function(_ChildProperty9){_inherits(SearchSettings,_ChildProperty9);function SearchSettings(){_classCallCheck(this,SearchSettings);return _possibleConstructorReturn(this,(SearchSettings.__proto__||Object.getPrototypeOf(SearchSettings)).apply(this,arguments));}return SearchSettings;}(ChildProperty));__decorate([Property([])],SearchSettings.prototype,"fields",void 0);__decorate([Property('')],SearchSettings.prototype,"key",void 0);__decorate([Property('contains')],SearchSettings.prototype,"operator",void 0);__decorate([Property(true)],SearchSettings.prototype,"ignoreCase",void 0);/**
 * Configures the row drop settings of the Grid.
 */_export('RowDropSettings',RowDropSettings=function(_ChildProperty10){_inherits(RowDropSettings,_ChildProperty10);function RowDropSettings(){_classCallCheck(this,RowDropSettings);return _possibleConstructorReturn(this,(RowDropSettings.__proto__||Object.getPrototypeOf(RowDropSettings)).apply(this,arguments));}return RowDropSettings;}(ChildProperty));__decorate([Property()],RowDropSettings.prototype,"targetID",void 0);/**
 * Configures the text wrap settings of the Grid.
 */_export('TextWrapSettings',TextWrapSettings=function(_ChildProperty11){_inherits(TextWrapSettings,_ChildProperty11);function TextWrapSettings(){_classCallCheck(this,TextWrapSettings);return _possibleConstructorReturn(this,(TextWrapSettings.__proto__||Object.getPrototypeOf(TextWrapSettings)).apply(this,arguments));}return TextWrapSettings;}(ChildProperty));__decorate([Property('Both')],TextWrapSettings.prototype,"wrapMode",void 0);/**
 * Configures the group behavior of the Grid.
 */_export('GroupSettings',GroupSettings=function(_ChildProperty12){_inherits(GroupSettings,_ChildProperty12);function GroupSettings(){_classCallCheck(this,GroupSettings);return _possibleConstructorReturn(this,(GroupSettings.__proto__||Object.getPrototypeOf(GroupSettings)).apply(this,arguments));}return GroupSettings;}(ChildProperty));__decorate([Property(true)],GroupSettings.prototype,"showDropArea",void 0);__decorate([Property(false)],GroupSettings.prototype,"showToggleButton",void 0);__decorate([Property(false)],GroupSettings.prototype,"showGroupedColumn",void 0);__decorate([Property(true)],GroupSettings.prototype,"showUngroupButton",void 0);__decorate([Property(false)],GroupSettings.prototype,"disablePageWiseAggregates",void 0);__decorate([Property([])],GroupSettings.prototype,"columns",void 0);__decorate([Property()],GroupSettings.prototype,"captionTemplate",void 0);/**
 * Configures the edit behavior of the Grid.
 */_export('EditSettings',EditSettings=function(_ChildProperty13){_inherits(EditSettings,_ChildProperty13);function EditSettings(){_classCallCheck(this,EditSettings);return _possibleConstructorReturn(this,(EditSettings.__proto__||Object.getPrototypeOf(EditSettings)).apply(this,arguments));}return EditSettings;}(ChildProperty));__decorate([Property(false)],EditSettings.prototype,"allowAdding",void 0);__decorate([Property(false)],EditSettings.prototype,"allowEditing",void 0);__decorate([Property(false)],EditSettings.prototype,"allowDeleting",void 0);__decorate([Property('Normal')],EditSettings.prototype,"mode",void 0);__decorate([Property(true)],EditSettings.prototype,"allowEditOnDblClick",void 0);__decorate([Property(true)],EditSettings.prototype,"showConfirmDialog",void 0);__decorate([Property(false)],EditSettings.prototype,"showDeleteConfirmDialog",void 0);/**
 * Represents the Grid component.
 * ```html
 * <div id="grid"></div>
 * <script>
 *  var gridObj = new Grid({ allowPaging: true });
 *  gridObj.appendTo("#grid");
 * </script>
 * ```
 */_export('Grid',Grid=function(_Component){_inherits(Grid,_Component);/**
     * Constructor for creating the component
     * @hidden
     */function Grid(options,element){_classCallCheck(this,Grid);var _this68=_possibleConstructorReturn(this,(Grid.__proto__||Object.getPrototypeOf(Grid)).call(this,options,element));_this68.freezeRefresh=Component.prototype.refresh;_this68.needsID=true;setValue('mergePersistData',_this68.mergePersistGridData,_this68);return _this68;}/**
     * Get the properties to be maintained in the persisted state.
     * @return {string}
     * @hidden
     */_createClass(Grid,[{key:'getPersistData',value:function getPersistData(){var _this69=this;var keyEntity=['pageSettings','sortSettings','filterSettings','groupSettings','columns','searchSettings','selectedRowIndex'];var ignoreOnPersist={pageSettings:['template','pageSizes','enableQueryString','totalRecordsCount','pageCount'],filterSettings:['type','mode','showFilterBarStatus','immediateModeDelay','ignoreAccent'],groupSettings:['showDropArea','showToggleButton','showGroupedColumn','showUngroupButton','disablePageWiseAggregates','hideCaptionCount'],searchSettings:['fields','operator','ignoreCase'],sortSettings:[],columns:[],selectedRowIndex:[]};var ignoreOnColumn=['filter','edit','filterBarTemplate','headerTemplate','template','commandTemplate','commands','format','dataSource'];keyEntity.forEach(function(value){var currentObject=_this69[value];var _iteratorNormalCompletion21=true;var _didIteratorError21=false;var _iteratorError21=undefined;try{for(var _iterator21=ignoreOnPersist[value][Symbol.iterator](),_step21;!(_iteratorNormalCompletion21=(_step21=_iterator21.next()).done);_iteratorNormalCompletion21=true){var val=_step21.value;delete currentObject[val];}}catch(err){_didIteratorError21=true;_iteratorError21=err;}finally{try{if(!_iteratorNormalCompletion21&&_iterator21.return){_iterator21.return();}}finally{if(_didIteratorError21){throw _iteratorError21;}}}});this.ignoreInArrays(ignoreOnColumn,this.columns);return this.addOnPersist(keyEntity);}},{key:'ignoreInArrays',value:function ignoreInArrays(ignoreOnColumn,columns){var _this70=this;columns.forEach(function(column){if(column.columns){_this70.ignoreInColumn(ignoreOnColumn,column);_this70.ignoreInArrays(ignoreOnColumn,column.columns);}else{_this70.ignoreInColumn(ignoreOnColumn,column);}});}},{key:'ignoreInColumn',value:function ignoreInColumn(ignoreOnColumn,column){ignoreOnColumn.forEach(function(val){delete column[val];});}},{key:'requiredModules',value:function requiredModules(){var modules=[];if(this.allowFiltering){modules.push({member:'filter',args:[this,this.filterSettings,this.serviceLocator]});}if(this.allowExcelExport){modules.push({member:'ExcelExport',args:[this]});}if(this.allowPdfExport){modules.push({member:'PdfExport',args:[this]});}if(this.allowSorting){modules.push({member:'sort',args:[this,this.sortSettings,this.sortedColumns,this.serviceLocator]});}if(this.allowPaging){modules.push({member:'pager',args:[this,this.pageSettings]});}if(this.allowSelection){modules.push({member:'selection',args:[this,this.selectionSettings,this.serviceLocator]});}modules.push({member:'resize',args:[this]});if(this.allowReordering){modules.push({member:'reorder',args:[this]});}if(this.allowRowDragAndDrop){modules.push({member:'rowDragAndDrop',args:[this]});}if(this.allowGrouping){modules.push({member:'group',args:[this,this.groupSettings,this.sortedColumns,this.serviceLocator]});}if(this.aggregates.length){modules.push({member:'aggregate',args:[this,this.serviceLocator]});}if(this.isDetail()){modules.push({member:'detailRow',args:[this,this.serviceLocator]});}if(this.toolbar||this.toolbarTemplate){modules.push({member:'toolbar',args:[this,this.serviceLocator]});}if(this.enableVirtualization||this.enableColumnVirtualization){modules.push({member:'virtualscroll',args:[this,this.serviceLocator]});}if(this.getFrozenColumns()||this.frozenRows){modules.push({member:'freeze',args:[this,this.serviceLocator]});}if(this.isCommandColumn(this.columns)){modules.push({member:'commandColumn',args:[this,this.serviceLocator]});}if(this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing){modules.push({member:'edit',args:[this,this.serviceLocator]});}this.extendRequiredModules(modules);return modules;}},{key:'extendRequiredModules',value:function extendRequiredModules(modules){if(this.contextMenuItems){modules.push({member:'contextMenu',args:[this,this.serviceLocator]});}if(this.showColumnMenu){modules.push({member:'columnMenu',args:[this,this.serviceLocator]});}if(this.showColumnChooser){modules.push({member:'columnChooser',args:[this,this.serviceLocator]});}if(this.isForeignKeyEnabled(this.columns)){modules.push({member:'foreignKey',args:[this,this.serviceLocator]});}}},{key:'preRender',value:function preRender(){this.serviceLocator=new ServiceLocator();this.initProperties();this.initializeServices();}},{key:'initProperties',value:function initProperties(){/* tslint:disable */this.isInitial=true;this.sortedColumns=[];this.inViewIndexes=[];this.mediaCol=[];this.isMediaQuery=false;this.isInitialLoad=false;this.mergeCells={};this.isEdit=false;this.checkAllRows='None';this.isCheckBoxSelection=false;this.isPersistSelection=false;this.freezeRefresh=Component.prototype.refresh;this.filterOperators={contains:'contains',endsWith:'endswith',equal:'equal',greaterThan:'greaterthan',greaterThanOrEqual:'greaterthanorequal',lessThan:'lessthan',lessThanOrEqual:'lessthanorequal',notEqual:'notequal',startsWith:'startswith'};this.defaultLocale={EmptyRecord:'No records to display',True:'true',False:'false',InvalidFilterMessage:'Invalid Filter Data',GroupDropArea:'Drag a column header here to group its column',UnGroup:'Click here to ungroup',GroupDisable:'Grouping is disabled for this column',FilterbarTitle:'\'s filter bar cell',EmptyDataSourceError:'DataSource must not be empty at initial load since columns are generated from dataSource in AutoGenerate Column Grid',// Toolbar Items
Add:'Add',Edit:'Edit',Cancel:'Cancel',Update:'Update',Delete:'Delete',Print:'Print',Pdfexport:'PDF Export',Excelexport:'Excel Export',Wordexport:'Word Export',Csvexport:'CSV Export',Search:'Search',Columnchooser:'Columns',Save:'Save',Item:'item',Items:'items',EditOperationAlert:'No records selected for edit operation',DeleteOperationAlert:'No records selected for delete operation',SaveButton:'Save',OKButton:'OK',CancelButton:'Cancel',EditFormTitle:'Details of ',AddFormTitle:'Add New Record',BatchSaveConfirm:'Are you sure you want to save changes?',BatchSaveLostChanges:'Unsaved changes will be lost. Are you sure you want to continue?',ConfirmDelete:'Are you sure you want to Delete Record?',CancelEdit:'Are you sure you want to Cancel the changes?',ChooseColumns:'Choose Column',SearchColumns:'search columns',Matchs:'No Matches Found',FilterButton:'Filter',ClearButton:'Clear',StartsWith:'Starts With',EndsWith:'Ends With',Contains:'Contains',Equal:'Equal',NotEqual:'Not Equal',LessThan:'Less Than',LessThanOrEqual:'Less Than Or Equal',GreaterThan:'Greater Than',GreaterThanOrEqual:'Greater Than Or Equal',ChooseDate:'Choose a Date',EnterValue:'Enter the value',Copy:'Copy',Group:'Group by this column',Ungroup:'Ungroup by this column',autoFitAll:'Auto Fit all columns',autoFit:'Auto Fit this column',Export:'Export',FirstPage:'First Page',LastPage:'Last Page',PreviousPage:'Previous Page',NextPage:'Next Page',SortAscending:'Sort Ascending',SortDescending:'Sort Descending',EditRecord:'Edit Record',DeleteRecord:'Delete Record',FilterMenu:'Filter'};this.keyConfigs={downArrow:'downarrow',upArrow:'uparrow',rightArrow:'rightarrow',leftArrow:'leftarrow',shiftDown:'shift+downarrow',shiftUp:'shift+uparrow',shiftRight:'shift+rightarrow',shiftLeft:'shift+leftarrow',home:'home',end:'end',escape:'escape',ctrlHome:'ctrl+home',ctrlEnd:'ctrl+end',pageUp:'pageup',pageDown:'pagedown',ctrlAltPageUp:'ctrl+alt+pageup',ctrlAltPageDown:'ctrl+alt+pagedown',altPageUp:'alt+pageup',altPageDown:'alt+pagedown',altDownArrow:'alt+downarrow',altUpArrow:'alt+uparrow',ctrlDownArrow:'ctrl+downarrow',ctrlUpArrow:'ctrl+uparrow',ctrlPlusA:'ctrl+A',ctrlPlusP:'ctrl+P',insert:'insert',delete:'delete',f2:'f2',enter:'enter',ctrlEnter:'ctrl+enter',shiftEnter:'shift+enter',tab:'tab',shiftTab:'shift+tab',space:'space',ctrlPlusC:'ctrl+C',ctrlShiftPlusH:'ctrl+shift+H'};/* tslint:enable */}},{key:'render',value:function render(){this.ariaService.setOptions(this.element,{role:'grid'});createSpinner({target:this.element});this.renderModule=new Render(this,this.serviceLocator);this.getMediaColumns();this.searchModule=new Search(this);this.scrollModule=new Scroll(this);this.notify(initialLoad,{});this.trigger(load);prepareColumns(this.columns,this.enableColumnVirtualization);this.getColumns();this.processModel();this.gridRender();this.wireEvents();this.addListener();this.updateDefaultCursor();this.updateStackedFilter();this.showSpinner();this.notify(initialEnd,{});}},{key:'showSpinner',value:function showSpinner(){_showSpinner(this.element);}},{key:'hideSpinner',value:function hideSpinner(){_hideSpinner(this.element);}},{key:'updateStackedFilter',value:function updateStackedFilter(){if(this.allowFiltering&&this.filterSettings.type==='FilterBar'&&this.getHeaderContent().querySelectorAll('.e-stackedheadercell').length){this.getHeaderContent().classList.add('e-stackedfilter');}else{this.getHeaderContent().classList.remove('e-stackedfilter');}}},{key:'getMediaColumns',value:function getMediaColumns(){if(!this.enableColumnVirtualization){var gcol=this.getColumns();this.getShowHideService=this.serviceLocator.getService('showHideService');if(!isNullOrUndefined(gcol)){for(var index=0;index<gcol.length;index++){if(!isNullOrUndefined(gcol[index].hideAtMedia)){this.mediaCol.push(gcol[index]);var media=window.matchMedia(gcol[index].hideAtMedia);this.mediaQueryUpdate(index,media);media.addListener(this.mediaQueryUpdate.bind(this,index));}}}}}},{key:'mediaQueryUpdate',value:function mediaQueryUpdate(columnIndex,e){this.isMediaQuery=true;var col=this.getColumns()[columnIndex];col.visible=e.matches;if(this.isInitialLoad){if(col.visible){this.showHider.show(col.headerText,'headerText');}else{this.showHider.hide(col.headerText,'headerText');}}}},{key:'refreshMediaCol',value:function refreshMediaCol(){if(this.isMediaQuery){this.refresh();this.isMediaQuery=false;}this.isInitialLoad=true;}},{key:'eventInitializer',value:function eventInitializer(){}//eventInitializer
/**
     * Destroys the component (detaches/removes all event handlers, attributes, classes, and empties the component element).
     * @method destroy
     * @return {void}
     */},{key:'destroy',value:function destroy(){this.unwireEvents();this.removeListener();this.notify(_destroy,{});this.destroyDependentModules();_get(Grid.prototype.__proto__||Object.getPrototypeOf(Grid.prototype),'destroy',this).call(this);this.element.innerHTML='';classList(this.element,[],['e-rtl','e-gridhover','e-responsive','e-default','e-device','e-grid-min-height']);}},{key:'destroyDependentModules',value:function destroyDependentModules(){this.scrollModule.destroy();this.keyboardModule.destroy();this.focusModule.destroy();}},{key:'getModuleName',value:function getModuleName(){return'grid';}},{key:'onPropertyChanged',value:function onPropertyChanged(newProp,oldProp){var requireRefresh=false;var requireGridRefresh=false;var checkCursor=void 0;var args={requestType:'refresh'};if(this.isDestroyed){return;}var _iteratorNormalCompletion22=true;var _didIteratorError22=false;var _iteratorError22=undefined;try{for(var _iterator22=Object.keys(newProp)[Symbol.iterator](),_step22;!(_iteratorNormalCompletion22=(_step22=_iterator22.next()).done);_iteratorNormalCompletion22=true){var prop=_step22.value;switch(prop){case'allowPaging':this.notify(uiUpdate,{module:'pager',enable:this.allowPaging});requireRefresh=true;break;case'pageSettings':this.notify(inBoundModelChanged,{module:'pager',properties:newProp.pageSettings});if(isNullOrUndefined(newProp.pageSettings.currentPage)&&isNullOrUndefined(newProp.pageSettings.totalRecordsCount)){requireRefresh=true;}break;case'currencyCode':case'locale':_get(Grid.prototype.__proto__||Object.getPrototypeOf(Grid.prototype),'refresh',this).call(this);break;case'allowSorting':this.notify(uiUpdate,{module:'sort',enable:this.allowSorting});requireRefresh=true;checkCursor=true;break;case'allowFiltering':this.updateStackedFilter();this.notify(uiUpdate,{module:'filter',enable:this.allowFiltering});requireRefresh=true;if(this.filterSettings.type!=='FilterBar'){this.refreshHeader();}break;case'height':case'width':this.notify(uiUpdate,{module:'scroll',properties:{width:newProp.width,height:newProp.height}});break;case'allowReordering':this.headerModule.refreshUI();checkCursor=true;break;case'allowRowDragAndDrop':this.notify(uiUpdate,{module:'rowDragAndDrop',enable:this.allowRowDragAndDrop});break;case'rowTemplate':this.rowTemplateFn=templateCompiler(this.rowTemplate);requireRefresh=true;break;case'detailTemplate':this.detailTemplateFn=templateCompiler(this.detailTemplate);requireRefresh=true;break;case'allowGrouping':this.notify(uiUpdate,{module:'group',enable:this.allowGrouping});this.headerModule.refreshUI();requireRefresh=true;checkCursor=true;break;case'childGrid':requireRefresh=true;break;case'toolbar':this.notify(uiUpdate,{module:'toolbar'});break;case'groupSettings':if(!isNullOrUndefined(newProp.groupSettings.showDropArea)){this.headerModule.refreshUI();requireRefresh=true;checkCursor=true;}this.notify(inBoundModelChanged,{module:'group',properties:newProp.groupSettings,oldProperties:oldProp.groupSettings});break;case'aggregates':this.notify(uiUpdate,{module:'aggregate',properties:newProp});break;case'columns':this.updateColumnObject();requireGridRefresh=true;break;case'frozenColumns':case'frozenRows':this.freezeRefresh();break;default:this.extendedPropertyChange(prop,newProp);}}}catch(err){_didIteratorError22=true;_iteratorError22=err;}finally{try{if(!_iteratorNormalCompletion22&&_iterator22.return){_iterator22.return();}}finally{if(_didIteratorError22){throw _iteratorError22;}}}if(checkCursor){this.updateDefaultCursor();}if(requireGridRefresh){this.refresh();}else if(requireRefresh){this.notify(modelChanged,args);requireRefresh=false;}}},{key:'extendedPropertyChange',value:function extendedPropertyChange(prop,newProp){switch(prop){case'enableRtl':this.updateRTL();if(this.allowPaging){this.element.querySelector('.e-gridpager').ej2_instances[0].enableRtl=newProp.enableRtl;this.element.querySelector('.e-gridpager').ej2_instances[0].dataBind();}if(this.height!=='auto'){this.scrollModule.removePadding(!newProp.enableRtl);this.scrollModule.setPadding();}if(this.toolbar){this.toolbarModule.getToolbar().ej2_instances[0].enableRtl=newProp.enableRtl;this.toolbarModule.getToolbar().ej2_instances[0].dataBind();}if(this.contextMenuItems){this.contextMenuModule.getContextMenu().ej2_instances[0].enableRtl=newProp.enableRtl;this.contextMenuModule.getContextMenu().ej2_instances[0].dataBind();}if(this.showColumnMenu){this.columnMenuModule.getColumnMenu().ej2_instances[0].enableRtl=newProp.enableRtl;this.columnMenuModule.getColumnMenu().ej2_instances[0].dataBind();}this.notify(rtlUpdated,{});break;case'enableAltRow':this.renderModule.refresh();break;case'allowResizing':this.headerModule.refreshUI();this.updateResizeLines();break;case'rowHeight':if(this.rowHeight){addClass([this.element],'e-grid-min-height');}else{removeClass([this.element],'e-grid-min-height');}this.renderModule.refresh();this.headerModule.refreshUI();break;case'gridLines':this.updateGridLines();break;case'showColumnMenu':this.headerModule.refreshUI();this.notify(uiUpdate,{module:'columnMenu',enable:true});break;case'columnMenuItems':this.notify(uiUpdate,{module:'columnMenu',enable:this.columnMenuItems});break;case'contextMenuItems':this.notify(uiUpdate,{module:'contextMenu',enable:this.contextMenuItems});break;case'showColumnChooser':this.notify(uiUpdate,{module:'columnChooser',enable:this.showColumnChooser});break;case'filterSettings':this.updateStackedFilter();this.notify(inBoundModelChanged,{module:'filter',properties:newProp.filterSettings});break;case'searchSettings':this.notify(inBoundModelChanged,{module:'search',properties:newProp.searchSettings});break;case'sortSettings':this.notify(inBoundModelChanged,{module:'sort'});break;case'selectionSettings':this.notify(inBoundModelChanged,{module:'selection',properties:newProp.selectionSettings});break;case'editSettings':this.notify(inBoundModelChanged,{module:'edit',properties:newProp.editSettings});break;case'allowTextWrap':case'textWrapSettings':if(this.allowTextWrap){this.applyTextWrap();}else{this.removeTextWrap();}this.notify(freezeRender,{case:'textwrap',isModeChg:prop==='textWrapSettings'});break;case'dataSource':var pending=this.getDataModule().getState();if(pending.isPending){var gResult=!isNullOrUndefined(this.dataSource)?this.dataSource.result:[];(pending.group||[]).forEach(function(name){gResult=DataUtil.group(gResult,name);});this.dataSource={result:gResult,count:this.dataSource.count};pending.resolver(this.dataSource);}else{this.notify(dataSourceModified,{});this.renderModule.refresh();}break;case'enableHover':var action=newProp.enableHover?addClass:removeClass;action([this.element],'e-gridhover');break;}}},{key:'updateDefaultCursor',value:function updateDefaultCursor(){var headerRows=[].slice.call(this.element.querySelectorAll('.e-columnheader'));var _iteratorNormalCompletion23=true;var _didIteratorError23=false;var _iteratorError23=undefined;try{for(var _iterator23=headerRows[Symbol.iterator](),_step23;!(_iteratorNormalCompletion23=(_step23=_iterator23.next()).done);_iteratorNormalCompletion23=true){var row=_step23.value;if(this.allowSorting||this.allowGrouping||this.allowReordering){row.classList.remove('e-defaultcursor');}else{row.classList.add('e-defaultcursor');}}}catch(err){_didIteratorError23=true;_iteratorError23=err;}finally{try{if(!_iteratorNormalCompletion23&&_iterator23.return){_iterator23.return();}}finally{if(_didIteratorError23){throw _iteratorError23;}}}}},{key:'updateColumnModel',value:function updateColumnModel(columns){for(var i=0,len=columns.length;i<len;i++){if(columns[i].columns){this.updateColumnModel(columns[i].columns);}else{this.columnModel.push(columns[i]);}}this.updateFrozenColumns();}},{key:'updateFrozenColumns',value:function updateFrozenColumns(){var cols=this.columnModel;var count=0;for(var i=0,len=cols.length;i<len;i++){if(cols[i].isFrozen){cols.splice(this.frozenColumns+count,0,cols.splice(i,1)[0]);count++;}}}},{key:'getColumns',value:function getColumns(isRefresh){var _this71=this;var inview=this.inViewIndexes.map(function(v){return v-_this71.groupSettings.columns.length;}).filter(function(v){return v>-1;});var vLen=inview.length;if(!this.enableColumnVirtualization||isNullOrUndefined(this.columnModel)||this.columnModel.length===0||isRefresh){this.columnModel=[];this.updateColumnModel(this.columns);}var columns=vLen===0?this.columnModel:this.columnModel.slice(inview[0],inview[vLen-1]+1);return columns;}},{key:'getColumnIndexesInView',value:function getColumnIndexesInView(){return this.inViewIndexes;}},{key:'getLocaleConstants',value:function getLocaleConstants(){return this.defaultLocale;}},{key:'setColumnIndexesInView',value:function setColumnIndexesInView(indexes){this.inViewIndexes=indexes;}},{key:'getVisibleColumns',value:function getVisibleColumns(){var cols=[];var _iteratorNormalCompletion24=true;var _didIteratorError24=false;var _iteratorError24=undefined;try{for(var _iterator24=this.columnModel[Symbol.iterator](),_step24;!(_iteratorNormalCompletion24=(_step24=_iterator24.next()).done);_iteratorNormalCompletion24=true){var col=_step24.value;if(col.visible){cols.push(col);}}}catch(err){_didIteratorError24=true;_iteratorError24=err;}finally{try{if(!_iteratorNormalCompletion24&&_iterator24.return){_iterator24.return();}}finally{if(_didIteratorError24){throw _iteratorError24;}}}return cols;}},{key:'getHeaderContent',value:function getHeaderContent(){return this.headerModule.getPanel();}},{key:'setGridHeaderContent',value:function setGridHeaderContent(element){this.headerModule.setPanel(element);}},{key:'getContentTable',value:function getContentTable(){return this.contentModule.getTable();}},{key:'setGridContentTable',value:function setGridContentTable(element){this.contentModule.setTable(element);}},{key:'getContent',value:function getContent(){return this.contentModule.getPanel();}},{key:'setGridContent',value:function setGridContent(element){this.contentModule.setPanel(element);}},{key:'getHeaderTable',value:function getHeaderTable(){return this.headerModule.getTable();}},{key:'setGridHeaderTable',value:function setGridHeaderTable(element){this.headerModule.setTable(element);}},{key:'getFooterContent',value:function getFooterContent(){if(isNullOrUndefined(this.footerElement)){this.footerElement=this.element.getElementsByClassName('e-gridfooter')[0];}return this.footerElement;}},{key:'getFooterContentTable',value:function getFooterContentTable(){if(isNullOrUndefined(this.footerElement)){this.footerElement=this.element.getElementsByClassName('e-gridfooter')[0];}return this.footerElement.firstChild.firstChild;}},{key:'getPager',value:function getPager(){return this.gridPager;//get element from pager
}},{key:'setGridPager',value:function setGridPager(element){this.gridPager=element;}},{key:'getRowByIndex',value:function getRowByIndex(index){return this.contentModule.getRowByIndex(index);}},{key:'getMovableRowByIndex',value:function getMovableRowByIndex(index){return this.contentModule.getMovableRowByIndex(index);}},{key:'getRows',value:function getRows(){return this.contentModule.getRowElements();}},{key:'getRowInfo',value:function getRowInfo(target){var ele=target;var args={target:target};if(!isNullOrUndefined(target)&&isNullOrUndefined(parentsUntil(ele,'e-detailrowcollapse')&&isNullOrUndefined(parentsUntil(ele,'e-recordplusexpand')))&&!this.isEdit){var cell=closest(ele,'.e-rowcell');if(!cell){return args;}var cellIndex=parseInt(cell.getAttribute('aria-colindex'),10);if(!isNullOrUndefined(cell)&&!isNaN(cellIndex)){var row=closest(cell,'.e-row');var rowIndex=parseInt(row.getAttribute('aria-rowindex'),10);var frzCols=this.getFrozenColumns();var isMovable=frzCols?cellIndex>=frzCols:false;var rows=isMovable?this.contentModule.getMovableRows():this.contentModule.getRows();var rowsObject=rows.filter(function(r){return r.uid===row.getAttribute('data-uid');});var rowData=rowsObject[0].data;var column=rowsObject[0].cells[isMovable?cellIndex-frzCols:cellIndex].column;args={cell:cell,cellIndex:cellIndex,row:row,rowIndex:rowIndex,rowData:rowData,column:column,target:target};}}return args;}},{key:'getMovableRows',value:function getMovableRows(){return this.contentModule.getMovableRowElements();}},{key:'getDataRows',value:function getDataRows(){var rows=[].slice.call(this.getContentTable().querySelector('tbody').children);if(this.frozenRows){var freezeRows=[].slice.call(this.getHeaderTable().querySelector('tbody').children);rows=this.addMovableRows(freezeRows,rows);}var dataRows=this.generateDataRows(rows);return dataRows;}},{key:'addMovableRows',value:function addMovableRows(fRows,mrows){for(var i=0,len=mrows.length;i<len;i++){fRows.push(mrows[i]);}return fRows;}},{key:'generateDataRows',value:function generateDataRows(rows){var dRows=[];for(var i=0,len=rows.length;i<len;i++){if(rows[i].classList.contains('e-row')&&!rows[i].classList.contains('e-hiddenrow')){dRows.push(rows[i]);}}return dRows;}},{key:'getMovableDataRows',value:function getMovableDataRows(){var rows=[].slice.call(this.getContent().querySelector('.e-movablecontent').querySelector('tbody').children);if(this.frozenRows){var freezeRows=[].slice.call(this.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);rows=this.addMovableRows(freezeRows,rows);}var dataRows=this.generateDataRows(rows);return dataRows;}},{key:'setCellValue',value:function setCellValue(key,field,value){var cells='cells';var rowData='data';var rowuID='uid';var fieldIdx=void 0;var col=void 0;var tr=void 0;var pkName=this.getPrimaryKeyFieldNames()[0];var cell=new CellRenderer(this,this.serviceLocator);var selectedRow={};var rowObjects=this.contentModule.getRows();fieldIdx=this.getColumnIndexByField(field);col=this.getColumnByField(field);selectedRow=rowObjects.filter(function(r){return getValue(pkName,r.data)===key;})[0];tr=!isNullOrUndefined(selectedRow)?this.element.querySelector('[data-uid='+selectedRow[rowuID]+']'):null;if(!isNullOrUndefined(tr)){setValue(field,value,selectedRow[rowData]);var td=tr.childNodes[fieldIdx];if(!isNullOrUndefined(td)){cell.refreshTD(td,selectedRow[cells][fieldIdx],selectedRow[rowData]);this.trigger(queryCellInfo,{cell:td,column:col,data:selectedRow[rowData]});}}else{return;}}},{key:'setRowData',value:function setRowData(key,rowData){var rowuID='uid';var rowObjects=this.contentModule.getRows();var selectedRow=void 0;var pkName=this.getPrimaryKeyFieldNames()[0];var rowRenderer=new RowRenderer(this.serviceLocator,null,this);selectedRow=rowObjects.filter(function(r){return getValue(pkName,r.data)===key;})[0];if(!isNullOrUndefined(selectedRow)&&this.element.querySelectorAll('[data-uid='+selectedRow[rowuID]+']').length){selectedRow.changes=rowData;refreshForeignData(selectedRow,this.getForeignKeyColumns(),selectedRow.changes);rowRenderer.refresh(selectedRow,this.getColumns(),true);}else{return;}}},{key:'getCellFromIndex',value:function getCellFromIndex(rowIndex,columnIndex){return this.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[columnIndex];}},{key:'getMovableCellFromIndex',value:function getMovableCellFromIndex(rowIndex,columnIndex){return this.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')[columnIndex-this.getFrozenColumns()];}},{key:'getColumnHeaderByIndex',value:function getColumnHeaderByIndex(index){return this.getHeaderTable().querySelectorAll('.e-headercell')[index];}},{key:'getRowObjectFromUID',value:function getRowObjectFromUID(uid){var rows=this.contentModule.getRows();var row=this.rowObject(rows,uid);if(this.getFrozenColumns()){if(!row){row=this.rowObject(this.contentModule.getMovableRows(),uid);return row;}}return row;}},{key:'rowObject',value:function rowObject(rows,uid){var _iteratorNormalCompletion25=true;var _didIteratorError25=false;var _iteratorError25=undefined;try{for(var _iterator25=rows[Symbol.iterator](),_step25;!(_iteratorNormalCompletion25=(_step25=_iterator25.next()).done);_iteratorNormalCompletion25=true){var row=_step25.value;if(row.uid===uid){return row;}}}catch(err){_didIteratorError25=true;_iteratorError25=err;}finally{try{if(!_iteratorNormalCompletion25&&_iterator25.return){_iterator25.return();}}finally{if(_didIteratorError25){throw _iteratorError25;}}}return null;}},{key:'getRowsObject',value:function getRowsObject(){return this.contentModule.getRows();}},{key:'getMovableRowsObject',value:function getMovableRowsObject(){return this.contentModule.getMovableRows();}},{key:'getColumnHeaderByField',value:function getColumnHeaderByField(field){return this.getColumnHeaderByUid(this.getColumnByField(field).uid);}},{key:'getColumnHeaderByUid',value:function getColumnHeaderByUid(uid){return this.getHeaderContent().querySelector('[e-mappinguid='+uid+']').parentElement;}},{key:'getColumnByField',value:function getColumnByField(field){return iterateArrayOrObject(this.getColumns(),function(item,index){if(item.field===field){return item;}return undefined;})[0];}},{key:'getColumnIndexByField',value:function getColumnIndexByField(field){var index=iterateArrayOrObject(this.getColumns(),function(item,index){if(item.field===field){return index;}return undefined;})[0];return!isNullOrUndefined(index)?index:-1;}},{key:'getColumnByUid',value:function getColumnByUid(uid){return iterateArrayOrObject(this.getColumns(),function(item,index){if(item.uid===uid){return item;}return undefined;})[0];}},{key:'getColumnIndexByUid',value:function getColumnIndexByUid(uid){var index=iterateArrayOrObject(this.getColumns(),function(item,index){if(item.uid===uid){return index;}return undefined;})[0];return!isNullOrUndefined(index)?index:-1;}},{key:'getUidByColumnField',value:function getUidByColumnField(field){return iterateArrayOrObject(this.getColumns(),function(item,index){if(item.field===field){return item.uid;}return undefined;})[0];}},{key:'getNormalizedColumnIndex',value:function getNormalizedColumnIndex(uid){var index=this.getColumnIndexByUid(uid);if(this.allowGrouping){index+=this.groupSettings.columns.length;}if(this.isDetail()){index++;}/**
         * TODO: index normalization based on the stacked header, grouping and detailTemplate
         * and frozen should be handled here
         */return index;}},{key:'getColumnFieldNames',value:function getColumnFieldNames(){var columnNames=[];var column=void 0;for(var i=0,len=this.getColumns().length;i<len;i++){column=this.getColumns()[i];if(column.visible){columnNames.push(column.field);}}return columnNames;}},{key:'getRowTemplate',value:function getRowTemplate(){return this.rowTemplateFn;}},{key:'getDetailTemplate',value:function getDetailTemplate(){return this.detailTemplateFn;}},{key:'getPrimaryKeyFieldNames',value:function getPrimaryKeyFieldNames(){var keys=[];for(var key=0,col=this.columns,cLen=col.length;key<cLen;key++){if(col[key].isPrimaryKey){keys.push(col[key].field);}}return keys;}},{key:'refresh',value:function refresh(){this.headerModule.refreshUI();this.updateStackedFilter();this.updateDefaultCursor();this.renderModule.refresh();}},{key:'refreshHeader',value:function refreshHeader(){this.headerModule.refreshUI();}},{key:'getSelectedRows',value:function getSelectedRows(){return this.selectionModule?this.selectionModule.selectedRecords:[];}},{key:'getSelectedRowIndexes',value:function getSelectedRowIndexes(){return this.selectionModule?this.selectionModule.selectedRowIndexes:[];}},{key:'getSelectedRowCellIndexes',value:function getSelectedRowCellIndexes(){return this.selectionModule.selectedRowCellIndexes;}},{key:'getSelectedRecords',value:function getSelectedRecords(){return this.selectionModule.getSelectedRecords();}},{key:'getDataModule',value:function getDataModule(){return this.renderModule.data;}},{key:'showColumns',value:function showColumns(keys,showBy){showBy=showBy?showBy:'headerText';this.showHider.show(keys,showBy);}},{key:'hideColumns',value:function hideColumns(keys,hideBy){hideBy=hideBy?hideBy:'headerText';this.showHider.hide(keys,hideBy);}},{key:'getFrozenColumns',value:function getFrozenColumns(){return this.frozenColumns+this.getFrozenCount(this.columns,0);}},{key:'getFrozenCount',value:function getFrozenCount(cols,cnt){for(var i=0,len=cols.length;i<len;i++){if(cols[i].columns){cnt=this.getFrozenCount(cols[i].columns,cnt);}else{if(cols[i].isFrozen){cnt++;}}}return cnt;}},{key:'goToPage',value:function goToPage(pageNo){this.pagerModule.goToPage(pageNo);}},{key:'updateExternalMessage',value:function updateExternalMessage(message){this.pagerModule.updateExternalMessage(message);}},{key:'sortColumn',value:function sortColumn(columnName,direction,isMultiSort){this.sortModule.sortColumn(columnName,direction,isMultiSort);}},{key:'clearSorting',value:function clearSorting(){this.sortModule.clearSorting();}},{key:'removeSortColumn',value:function removeSortColumn(field){this.sortModule.removeSortColumn(field);}},{key:'filterByColumn',value:function filterByColumn(fieldName,filterOperator,filterValue,predicate,matchCase,ignoreAccent,actualFilterValue,actualOperator){this.filterModule.filterByColumn(fieldName,filterOperator,filterValue,predicate,matchCase,ignoreAccent,actualFilterValue,actualOperator);}},{key:'clearFiltering',value:function clearFiltering(){this.filterModule.clearFiltering();}},{key:'removeFilteredColsByField',value:function removeFilteredColsByField(field,isClearFilterBar){this.filterModule.removeFilteredColsByField(field,isClearFilterBar);}},{key:'selectRow',value:function selectRow(index,isToggle){this.selectionModule.selectRow(index,isToggle);}},{key:'selectRows',value:function selectRows(rowIndexes){this.selectionModule.selectRows(rowIndexes);}},{key:'clearSelection',value:function clearSelection(){this.selectionModule.clearSelection();}},{key:'selectCell',value:function selectCell(cellIndex,isToggle){this.selectionModule.selectCell(cellIndex,isToggle);}},{key:'search',value:function search(searchString){this.searchModule.search(searchString);}},{key:'print',value:function print(){this.printModule.print();}},{key:'deleteRecord',value:function deleteRecord(fieldname,data){this.editModule.deleteRecord(fieldname,data);}},{key:'startEdit',value:function startEdit(){this.editModule.startEdit();}},{key:'endEdit',value:function endEdit(){this.editModule.endEdit();}},{key:'closeEdit',value:function closeEdit(){this.editModule.closeEdit();}},{key:'addRecord',value:function addRecord(data,index){this.editModule.addRecord(data,index);}},{key:'deleteRow',value:function deleteRow(tr){this.editModule.deleteRow(tr);}},{key:'copy',value:function copy(withHeader){this.clipboardModule.copy(withHeader);}},{key:'recalcIndentWidth',value:function recalcIndentWidth(){if(!this.getHeaderTable().querySelector('.e-emptycell')){return;}if(!this.groupSettings.columns.length&&!this.isDetail()||this.getHeaderTable().querySelector('.e-emptycell').getAttribute('indentRefreshed')||!this.getContentTable()){return;}var indentWidth=this.getHeaderTable().querySelector('.e-emptycell').parentElement.offsetWidth;var headerCol=[].slice.call(this.getHeaderTable().querySelector('colgroup').childNodes);var contentCol=[].slice.call(this.getContentTable().querySelector('colgroup').childNodes);var perPixel=indentWidth/30;var i=0;if(perPixel>=1){indentWidth=30/perPixel;}if(this.enableColumnVirtualization){indentWidth=30;}while(i<this.groupSettings.columns.length){headerCol[i].style.width=indentWidth+'px';contentCol[i].style.width=indentWidth+'px';this.notify(columnWidthChanged,{index:i,width:indentWidth});i++;}if(this.isDetail()){headerCol[i].style.width=indentWidth+'px';contentCol[i].style.width=indentWidth+'px';this.notify(columnWidthChanged,{index:i,width:indentWidth});}this.getHeaderTable().querySelector('.e-emptycell').setAttribute('indentRefreshed','true');}},{key:'reorderColumns',value:function reorderColumns(fromFName,toFName){this.reorderModule.reorderColumns(fromFName,toFName);}},{key:'autoFitColumns',value:function autoFitColumns(fieldNames){this.resizeModule.autoFitColumns(fieldNames);}},{key:'createColumnchooser',value:function createColumnchooser(x,y,target){this.columnChooserModule.renderColumnChooser(x,y,target);}},{key:'initializeServices',value:function initializeServices(){this.serviceLocator.register('widthService',this.widthService=new ColumnWidthService(this));this.serviceLocator.register('cellRendererFactory',new CellRendererFactory());this.serviceLocator.register('rendererFactory',new RendererFactory());this.serviceLocator.register('localization',this.localeObj=new L10n(this.getModuleName(),this.defaultLocale,this.locale));this.serviceLocator.register('valueFormatter',this.valueFormatterService=new ValueFormatter(this.locale));this.serviceLocator.register('showHideService',this.showHider=new ShowHide(this));this.serviceLocator.register('ariaService',this.ariaService=new AriaService());this.serviceLocator.register('focus',this.focusModule=new FocusStrategy(this));}},{key:'processModel',value:function processModel(){var _this72=this;var gCols=this.groupSettings.columns;var sCols=this.sortSettings.columns;var flag=void 0;var j=void 0;if(this.allowGrouping){var _loop=function _loop(i,len){j=0;for(var sLen=sCols.length;j<sLen;j++){if(sCols[j].field===gCols[i]){flag=true;break;}}if(!flag){sCols.push({field:gCols[i],direction:'Ascending'});}else{if(_this72.allowSorting){_this72.sortedColumns.push(sCols[j].field);}else{sCols[j].direction='Ascending';}}if(!_this72.groupSettings.showGroupedColumn){var column=_this72.enableColumnVirtualization?_this72.columns.filter(function(c){return c.field===gCols[i];})[0]:_this72.getColumnByField(gCols[i]);column.visible=false;}};for(var i=0,len=gCols.length;i<len;i++){_loop(i,len);}}if(!gCols.length){sCols.forEach(function(col){_this72.sortedColumns.push(col.field);});}this.rowTemplateFn=templateCompiler(this.rowTemplate);this.detailTemplateFn=templateCompiler(this.detailTemplate);if(!isNullOrUndefined(this.parentDetails)){var value=isNullOrUndefined(this.parentDetails.parentKeyFieldValue)?'undefined':this.parentDetails.parentKeyFieldValue;this.query.where(this.queryString,'equal',value,true);}this.initForeignColumn();}},{key:'initForeignColumn',value:function initForeignColumn(){if(this.isForeignKeyEnabled(this.getColumns())){this.notify(initForeignKeyColumn,this.getForeignKeyColumns());}}},{key:'gridRender',value:function gridRender(){this.updateRTL();if(this.enableHover){this.element.classList.add('e-gridhover');}if(Browser.isDevice){this.element.classList.add('e-device');}if(this.rowHeight){this.element.classList.add('e-grid-min-height');}classList(this.element,['e-responsive','e-default'],[]);var rendererFactory=this.serviceLocator.getService('rendererFactory');this.headerModule=rendererFactory.getRenderer(RenderType.Header);this.contentModule=rendererFactory.getRenderer(RenderType.Content);this.printModule=new Print(this,this.scrollModule);this.clipboardModule=new Clipboard(this);this.renderModule.render();this.eventInitializer();this.createGridPopUpElement();this.widthService.setWidthToColumns();this.updateGridLines();this.applyTextWrap();}},{key:'dataReady',value:function dataReady(){this.scrollModule.setWidth();this.scrollModule.setHeight();if(this.height!=='auto'){this.scrollModule.setPadding();}}},{key:'updateRTL',value:function updateRTL(){if(this.enableRtl){this.element.classList.add('e-rtl');}else{this.element.classList.remove('e-rtl');}}},{key:'createGridPopUpElement',value:function createGridPopUpElement(){var popup=createElement('div',{className:'e-gridpopup',styles:'display:none;'});var content=createElement('div',{className:'e-content',attrs:{tabIndex:'-1'}});append([content,createElement('div',{className:'e-uptail e-tail'})],popup);content.appendChild(createElement('span'));append([content,createElement('div',{className:'e-downtail e-tail'})],popup);this.element.appendChild(popup);}},{key:'updateGridLines',value:function updateGridLines(){classList(this.element,[],['e-verticallines','e-horizontallines','e-hidelines','e-bothlines']);switch(this.gridLines){case'Horizontal':this.element.classList.add('e-horizontallines');break;case'Vertical':this.element.classList.add('e-verticallines');break;case'None':this.element.classList.add('e-hidelines');break;case'Both':this.element.classList.add('e-bothlines');break;}this.updateResizeLines();}},{key:'updateResizeLines',value:function updateResizeLines(){if(this.allowResizing&&!(this.gridLines==='Vertical'||this.gridLines==='Both')){this.element.classList.add('e-resize-lines');}else{this.element.classList.remove('e-resize-lines');}}},{key:'applyTextWrap',value:function applyTextWrap(){if(this.allowTextWrap){var headerRows=[].slice.call(this.element.querySelectorAll('.e-columnheader'));switch(this.textWrapSettings.wrapMode){case'Header':wrap(this.element,false);wrap(this.getContent(),false);wrap(headerRows,true);break;case'Content':wrap(this.getContent(),true);wrap(this.element,false);wrap(headerRows,false);break;default:wrap(this.element,true);wrap(this.getContent(),false);wrap(headerRows,false);}}}},{key:'removeTextWrap',value:function removeTextWrap(){wrap(this.element,false);var headerRows=[].slice.call(this.element.querySelectorAll('.e-columnheader'));wrap(headerRows,false);wrap(this.getContent(),false);}},{key:'refreshTooltip',value:function refreshTooltip(){var width=void 0;var headerTable=this.getHeaderTable();var contentTable=this.getContentTable();var headerDivTag='e-gridheader';var htable=this.createTable(headerTable,headerDivTag,'header');var ctable=this.createTable(headerTable,headerDivTag,'content');var all=this.element.querySelectorAll('.e-ellipsistooltip');var allele=[];for(var i=0;i<all.length;i++){allele[i]=all[i];}allele.forEach(function(element){var table=headerTable.contains(element)?htable:ctable;var ele=headerTable.contains(element)?'th':'tr';table.querySelector(ele).className=element.className;table.querySelector(ele).innerHTML=element.innerHTML;width=table.querySelector(ele).getBoundingClientRect().width;if(width>element.getBoundingClientRect().width&&!element.classList.contains('e-tooltip')){var tooltip=new Tooltip({content:element.innerHTML},element);}else if(width<element.getBoundingClientRect().width&&element.classList.contains('e-tooltip')){element.ej2_instances[0].destroy();}});document.body.removeChild(htable);document.body.removeChild(ctable);}},{key:'createTable',value:function createTable(table,tag,type){var myTableDiv=createElement('div');myTableDiv.className=this.element.className;myTableDiv.style.cssText='display: inline-block;visibility:hidden;position:absolute';var mySubDiv=createElement('div');mySubDiv.className=tag;var myTable=createElement('table');myTable.className=table.className;myTable.style.cssText='table-layout: auto;width: auto';var ele=type==='header'?'th':'td';var myTr=createElement('tr');var mytd=createElement(ele);myTr.appendChild(mytd);myTable.appendChild(myTr);mySubDiv.appendChild(myTable);myTableDiv.appendChild(mySubDiv);document.body.appendChild(myTableDiv);return myTableDiv;}},{key:'wireEvents',value:function wireEvents(){EventHandler.add(this.element,'click',this.mouseClickHandler,this);EventHandler.add(this.element,'touchend',this.mouseClickHandler,this);EventHandler.add(this.element,'focusout',this.focusOutHandler,this);EventHandler.add(this.getContent(),'dblclick',this.dblClickHandler,this);if(this.allowKeyboard){this.element.tabIndex=this.element.tabIndex===-1?0:this.element.tabIndex;}this.keyboardModule=new KeyboardEvents(this.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:'keydown'});}},{key:'unwireEvents',value:function unwireEvents(){EventHandler.remove(this.element,'click',this.mouseClickHandler);EventHandler.remove(this.element,'touchend',this.mouseClickHandler);EventHandler.remove(this.element,'focusout',this.focusOutHandler);}},{key:'addListener',value:function addListener(){var _this73=this;if(this.isDestroyed){return;}this.on(dataReady,this.dataReady,this);this.on(contentReady,this.recalcIndentWidth,this);[updateData,modelChanged,contentReady,columnWidthChanged].forEach(function(event){return _this73.on(event,_this73.refreshTooltip,_this73);});this.on(headerRefreshed,this.recalcIndentWidth,this);this.dataBoundFunction=this.refreshMediaCol.bind(this);this.addEventListener(dataBound,this.dataBoundFunction);}},{key:'removeListener',value:function removeListener(){var _this74=this;if(this.isDestroyed){return;}this.off(dataReady,this.dataReady);this.off(contentReady,this.recalcIndentWidth);[updateData,modelChanged,contentReady,columnWidthChanged].forEach(function(event){return _this74.off(event,_this74.refreshTooltip);});this.off(headerRefreshed,this.recalcIndentWidth);this.removeEventListener(dataBound,this.dataBoundFunction);}},{key:'getCurrentViewRecords',value:function getCurrentViewRecords(){return this.allowGrouping&&this.groupSettings.columns.length?this.currentViewData.records:this.currentViewData;}},{key:'mouseClickHandler',value:function mouseClickHandler(e){if(this.isChildGrid(e)||parentsUntil(e.target,'e-gridpopup')&&e.touches||this.element.querySelectorAll('.e-cloneproperties').length||this.checkEdit(e)){return;}if((!this.allowRowDragAndDrop&&(parentsUntil(e.target,'e-gridcontent')||e.target.tagName==='TD')||!(this.allowGrouping||this.allowReordering)&&parentsUntil(e.target,'e-gridheader'))&&e.touches){return;}if(parentsUntil(e.target,'e-gridheader')&&this.allowRowDragAndDrop){e.preventDefault();}this.notify(click,e);}},{key:'checkEdit',value:function checkEdit(e){var tr=parentsUntil(e.target,'e-row');var isEdit=this.editSettings.mode!=='Batch'&&this.isEdit&&tr&&(tr.classList.contains('e-editedrow')||tr.classList.contains('e-addedrow'));return!parentsUntil(e.target,'e-unboundcelldiv')&&(isEdit||parentsUntil(e.target,'e-rowcell')&&parentsUntil(e.target,'e-rowcell').classList.contains('e-editedbatchcell'));}},{key:'dblClickHandler',value:function dblClickHandler(e){var grid=parentsUntil(e.target,'e-grid');if(isNullOrUndefined(grid)||grid.id!==this.element.id||closest(e.target,'.e-unboundcelldiv')){return;}var args=this.getRowInfo(e.target);args.target=e.target;this.trigger(recordDoubleClick,args);this.notify(dblclick,e);}},{key:'focusOutHandler',value:function focusOutHandler(e){if(this.isChildGrid(e)){return;}if(!parentsUntil(e.target,'e-grid')){this.element.querySelector('.e-gridpopup').style.display='None';}var filterClear=this.element.querySelector('.e-cancel:not(.e-hide)');if(filterClear){filterClear.classList.add('e-hide');}if(!e.relatedTarget&&!this.keyPress&&this.editSettings.mode==='Batch'&&this.isEdit){this.editModule.saveCell();}this.keyPress=false;}},{key:'isChildGrid',value:function isChildGrid(e){var gridElement=parentsUntil(e.target,'e-grid');if(gridElement&&gridElement.id!==this.element.id){return true;}return false;}},{key:'mergePersistGridData',value:function mergePersistGridData(){var _this75=this;var data=window.localStorage.getItem(this.getModuleName()+this.element.id);if(!(isNullOrUndefined(data)||data==='')){(function(){var dataObj=JSON.parse(data);var keys=Object.keys(dataObj);_this75.isProtectedOnChange=true;var _loop2=function _loop2(key){if(_typeof(_this75[key])==='object'&&!isNullOrUndefined(_this75[key])){if(Array.isArray(_this75[key])){_this75[key].forEach(function(element,index,arr){arr[index]=extend({},element,dataObj[key][index],true);});}else{extend(_this75[key],dataObj[key]);}}else{_this75[key]=dataObj[key];}};var _iteratorNormalCompletion26=true;var _didIteratorError26=false;var _iteratorError26=undefined;try{for(var _iterator26=keys[Symbol.iterator](),_step26;!(_iteratorNormalCompletion26=(_step26=_iterator26.next()).done);_iteratorNormalCompletion26=true){var key=_step26.value;_loop2(key);}}catch(err){_didIteratorError26=true;_iteratorError26=err;}finally{try{if(!_iteratorNormalCompletion26&&_iterator26.return){_iterator26.return();}}finally{if(_didIteratorError26){throw _iteratorError26;}}}_this75.isProtectedOnChange=false;})();}}},{key:'isDetail',value:function isDetail(){return!isNullOrUndefined(this.detailTemplate)||!isNullOrUndefined(this.childGrid);}},{key:'isCommandColumn',value:function isCommandColumn(columns){var _this76=this;return columns.some(function(col){if(col.columns){return _this76.isCommandColumn(col.columns);}return!!(col.commands||col.commandsTemplate);});}},{key:'isForeignKeyEnabled',value:function isForeignKeyEnabled(columns){var _this77=this;return columns.some(function(col){if(col.columns){return _this77.isForeignKeyEnabled(col.columns);}return!!(col.dataSource&&col.foreignKeyValue);});}},{key:'keyActionHandler',value:function keyActionHandler(e){this.keyPress=true;if(this.isChildGrid(e)||this.isEdit&&e.action!=='escape'&&e.action!=='enter'&&e.action!=='shiftEnter'&&e.action!=='tab'&&e.action!=='shiftTab'){return;}if(this.allowKeyboard){if(e.action==='ctrlPlusP'){e.preventDefault();this.print();}this.notify(keyPressed,e);}}},{key:'setInjectedModules',value:function setInjectedModules(modules){this.injectedModules=modules;}},{key:'updateColumnObject',value:function updateColumnObject(){prepareColumns(this.columns,this.enableColumnVirtualization);this.initForeignColumn();this.notify(autoCol,{});}},{key:'getForeignKeyColumns',value:function getForeignKeyColumns(){return this.getColumns().filter(function(col){return col.isForeignColumn();});}},{key:'refreshColumns',value:function refreshColumns(){this.updateColumnObject();this.refresh();}},{key:'excelExport',value:function excelExport(excelExportProperties,isMultipleExport,/* tslint:disable-next-line:no-any */workbook,isBlob){return this.excelExportModule.Map(this,excelExportProperties,isMultipleExport,workbook,false,isBlob);}},{key:'csvExport',value:function csvExport(excelExportProperties,/* tslint:disable-next-line:no-any */isMultipleExport,workbook,isBlob){return this.excelExportModule.Map(this,excelExportProperties,isMultipleExport,workbook,true,isBlob);}},{key:'pdfExport',value:function pdfExport(pdfExportProperties,/* tslint:disable-next-line:no-any */isMultipleExport,pdfDoc,isBlob){return this.pdfExportModule.Map(this,pdfExportProperties,isMultipleExport,pdfDoc,isBlob);}},{key:'groupColumn',value:function groupColumn(columnName){this.groupModule.groupColumn(columnName);}},{key:'ungroupColumn',value:function ungroupColumn(columnName){this.groupModule.ungroupColumn(columnName);}},{key:'isContextMenuOpen',value:function isContextMenuOpen(){return this.contextMenuModule&&this.contextMenuModule.isOpen;}},{key:'ensureModuleInjected',value:function ensureModuleInjected(module){return this.getInjectedModules().indexOf(module)>=0;}},{key:'destroyTemplate',value:function destroyTemplate(propertyNames){this.clearTemplate(propertyNames);}}]);return Grid;}(Component));__decorate([Property([])],Grid.prototype,"columns",void 0);__decorate([Property(true)],Grid.prototype,"enableAltRow",void 0);__decorate([Property(true)],Grid.prototype,"enableHover",void 0);__decorate([Property(true)],Grid.prototype,"allowKeyboard",void 0);__decorate([Property(false)],Grid.prototype,"allowTextWrap",void 0);__decorate([Complex({},TextWrapSettings)],Grid.prototype,"textWrapSettings",void 0);__decorate([Property(false)],Grid.prototype,"allowPaging",void 0);__decorate([Complex({},PageSettings)],Grid.prototype,"pageSettings",void 0);__decorate([Property(false)],Grid.prototype,"enableVirtualization",void 0);__decorate([Property(false)],Grid.prototype,"enableColumnVirtualization",void 0);__decorate([Complex({},SearchSettings)],Grid.prototype,"searchSettings",void 0);__decorate([Property(false)],Grid.prototype,"allowSorting",void 0);__decorate([Property(true)],Grid.prototype,"allowMultiSorting",void 0);__decorate([Property(false)],Grid.prototype,"allowExcelExport",void 0);__decorate([Property(false)],Grid.prototype,"allowPdfExport",void 0);__decorate([Complex({},SortSettings)],Grid.prototype,"sortSettings",void 0);__decorate([Property(true)],Grid.prototype,"allowSelection",void 0);__decorate([Property(-1)],Grid.prototype,"selectedRowIndex",void 0);__decorate([Complex({},SelectionSettings)],Grid.prototype,"selectionSettings",void 0);__decorate([Property(false)],Grid.prototype,"allowFiltering",void 0);__decorate([Property(false)],Grid.prototype,"allowReordering",void 0);__decorate([Property(false)],Grid.prototype,"allowResizing",void 0);__decorate([Property(false)],Grid.prototype,"allowRowDragAndDrop",void 0);__decorate([Complex({},RowDropSettings)],Grid.prototype,"rowDropSettings",void 0);__decorate([Complex({},FilterSettings)],Grid.prototype,"filterSettings",void 0);__decorate([Property(false)],Grid.prototype,"allowGrouping",void 0);__decorate([Property(false)],Grid.prototype,"showColumnMenu",void 0);__decorate([Complex({},GroupSettings)],Grid.prototype,"groupSettings",void 0);__decorate([Complex({},EditSettings)],Grid.prototype,"editSettings",void 0);__decorate([Collection([],AggregateRow)],Grid.prototype,"aggregates",void 0);__decorate([Property(false)],Grid.prototype,"showColumnChooser",void 0);__decorate([Property('auto')],Grid.prototype,"height",void 0);__decorate([Property('auto')],Grid.prototype,"width",void 0);__decorate([Property('Default')],Grid.prototype,"gridLines",void 0);__decorate([Property()],Grid.prototype,"rowTemplate",void 0);__decorate([Property()],Grid.prototype,"detailTemplate",void 0);__decorate([Property()],Grid.prototype,"childGrid",void 0);__decorate([Property()],Grid.prototype,"queryString",void 0);__decorate([Property('AllPages')],Grid.prototype,"printMode",void 0);__decorate([Property([])],Grid.prototype,"dataSource",void 0);__decorate([Property(null)],Grid.prototype,"rowHeight",void 0);__decorate([Property()],Grid.prototype,"query",void 0);__decorate([Property('USD')],Grid.prototype,"currencyCode",void 0);__decorate([Property()],Grid.prototype,"toolbar",void 0);__decorate([Property()],Grid.prototype,"contextMenuItems",void 0);__decorate([Property()],Grid.prototype,"columnMenuItems",void 0);__decorate([Property()],Grid.prototype,"toolbarTemplate",void 0);__decorate([Property()],Grid.prototype,"pagerTemplate",void 0);__decorate([Property(0)],Grid.prototype,"frozenRows",void 0);__decorate([Property(0)],Grid.prototype,"frozenColumns",void 0);__decorate([Event()],Grid.prototype,"created",void 0);__decorate([Event()],Grid.prototype,"destroyed",void 0);__decorate([Event()],Grid.prototype,"load",void 0);__decorate([Event()],Grid.prototype,"rowDataBound",void 0);__decorate([Event()],Grid.prototype,"queryCellInfo",void 0);__decorate([Event()],Grid.prototype,"actionBegin",void 0);__decorate([Event()],Grid.prototype,"actionComplete",void 0);__decorate([Event()],Grid.prototype,"actionFailure",void 0);__decorate([Event()],Grid.prototype,"dataBound",void 0);__decorate([Event()],Grid.prototype,"recordDoubleClick",void 0);__decorate([Event()],Grid.prototype,"rowSelecting",void 0);__decorate([Event()],Grid.prototype,"rowSelected",void 0);__decorate([Event()],Grid.prototype,"rowDeselecting",void 0);__decorate([Event()],Grid.prototype,"rowDeselected",void 0);__decorate([Event()],Grid.prototype,"cellSelecting",void 0);__decorate([Event()],Grid.prototype,"cellSelected",void 0);__decorate([Event()],Grid.prototype,"cellDeselecting",void 0);__decorate([Event()],Grid.prototype,"cellDeselected",void 0);__decorate([Event()],Grid.prototype,"columnDragStart",void 0);__decorate([Event()],Grid.prototype,"columnDrag",void 0);__decorate([Event()],Grid.prototype,"columnDrop",void 0);__decorate([Event()],Grid.prototype,"printComplete",void 0);__decorate([Event()],Grid.prototype,"beforePrint",void 0);__decorate([Event()],Grid.prototype,"pdfQueryCellInfo",void 0);__decorate([Event()],Grid.prototype,"excelQueryCellInfo",void 0);__decorate([Event()],Grid.prototype,"beforeExcelExport",void 0);__decorate([Event()],Grid.prototype,"excelExportComplete",void 0);__decorate([Event()],Grid.prototype,"beforePdfExport",void 0);__decorate([Event()],Grid.prototype,"pdfExportComplete",void 0);__decorate([Event()],Grid.prototype,"detailDataBound",void 0);__decorate([Event()],Grid.prototype,"rowDragStart",void 0);__decorate([Event()],Grid.prototype,"rowDrag",void 0);__decorate([Event()],Grid.prototype,"rowDrop",void 0);__decorate([Event()],Grid.prototype,"toolbarClick",void 0);__decorate([Event()],Grid.prototype,"beforeOpenColumnChooser",void 0);__decorate([Event()],Grid.prototype,"batchAdd",void 0);__decorate([Event()],Grid.prototype,"batchDelete",void 0);__decorate([Event()],Grid.prototype,"beforeBatchAdd",void 0);__decorate([Event()],Grid.prototype,"beforeBatchDelete",void 0);__decorate([Event()],Grid.prototype,"beforeBatchSave",void 0);__decorate([Event()],Grid.prototype,"beginEdit",void 0);__decorate([Event()],Grid.prototype,"cellEdit",void 0);__decorate([Event()],Grid.prototype,"cellSave",void 0);__decorate([Event()],Grid.prototype,"resizeStart",void 0);__decorate([Event()],Grid.prototype,"resizing",void 0);__decorate([Event()],Grid.prototype,"resizeStop",void 0);__decorate([Event()],Grid.prototype,"beforeDataBound",void 0);__decorate([Event()],Grid.prototype,"contextMenuOpen",void 0);__decorate([Event()],Grid.prototype,"contextMenuClick",void 0);__decorate([Event()],Grid.prototype,"columnMenuOpen",void 0);__decorate([Event()],Grid.prototype,"columnMenuClick",void 0);__decorate([Event()],Grid.prototype,"checkBoxChange",void 0);__decorate([Event()],Grid.prototype,"beforeCopy",void 0);__decorate([Event()],Grid.prototype,"dataStateChange",void 0);__decorate([Event()],Grid.prototype,"dataSourceChanged",void 0);_export('Grid',Grid=__decorate([NotifyPropertyChanges],Grid));Grid.Inject(Selection);/**
 * Base export
 *//**
 *
 * The `Sort` module is used to handle sorting action.
 */_export('Sort',Sort=function(){/**
     * Constructor for Grid sorting module
     * @hidden
     */function Sort(parent,sortSettings,sortedColumns,locator){_classCallCheck(this,Sort);this.contentRefresh=true;this.isModelChanged=true;this.aria=new AriaService();this.parent=parent;this.sortSettings=sortSettings;this.sortedColumns=sortedColumns;this.focus=locator.getService('focus');this.addEventListener();}/**
     * The function used to update sortSettings
     * @return {void}
     * @hidden
     */_createClass(Sort,[{key:'updateModel',value:function updateModel(){var sortedColumn={field:this.columnName,direction:this.direction};var index=void 0;var gCols=this.parent.groupSettings.columns;var flag=false;if(!this.isMultiSort){if(!gCols.length){this.sortSettings.columns=[sortedColumn];}else{var sortedCols=[];for(var i=0,len=gCols.length;i<len;i++){index=this.getSortedColsIndexByField(gCols[i],sortedCols);if(this.columnName===gCols[i]){flag=true;sortedCols.push(sortedColumn);}else{var sCol=this.getSortColumnFromField(gCols[i]);sortedCols.push({field:sCol.field,direction:sCol.direction});}}if(!flag){sortedCols.push(sortedColumn);}this.sortSettings.columns=sortedCols;}}else{index=this.getSortedColsIndexByField(this.columnName);if(index>-1){this.sortSettings.columns.splice(index,1);}this.sortSettings.columns.push(sortedColumn);this.sortSettings.columns=this.sortSettings.columns;}this.parent.dataBind();this.lastSortedCol=this.columnName;}},{key:'onActionComplete',value:function onActionComplete(e){var args=!this.isRemove?{columnName:this.columnName,direction:this.direction,requestType:'sorting',type:actionComplete}:{requestType:'sorting',type:actionComplete};this.isRemove=false;this.parent.trigger(actionComplete,extend(e,args));}},{key:'sortColumn',value:function sortColumn(columnName,direction,isMultiSort){var gObj=this.parent;if(this.parent.getColumnByField(columnName).allowSorting===false||this.parent.isContextMenuOpen()){return;}if(!gObj.allowMultiSorting){isMultiSort=gObj.allowMultiSorting;}if(this.isActionPrevent()){gObj.notify(preventBatch,{instance:this,handler:this.sortColumn,arg1:columnName,arg2:direction,arg3:isMultiSort});return;}this.columnName=columnName;this.direction=direction;this.isMultiSort=isMultiSort;this.removeSortIcons();var column=gObj.getColumnHeaderByField(columnName);this.updateSortedCols(columnName,isMultiSort);this.updateModel();}},{key:'updateSortedCols',value:function updateSortedCols(columnName,isMultiSort){if(!isMultiSort){if(this.parent.allowGrouping){for(var i=0,len=this.sortedColumns.length;i<len;i++){if(this.parent.groupSettings.columns.indexOf(this.sortedColumns[i])<0){this.sortedColumns.splice(i,1);len--;i--;}}}else{this.sortedColumns.splice(0,this.sortedColumns.length);}}if(this.sortedColumns.indexOf(columnName)<0){this.sortedColumns.push(columnName);}}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}if(this.contentRefresh){var args=this.sortSettings.columns.length?{columnName:this.columnName,direction:this.direction,requestType:'sorting',type:actionBegin}:{requestType:'sorting',type:actionBegin};this.parent.notify(modelChanged,args);}this.removeSortIcons();this.addSortIcons();}},{key:'clearSorting',value:function clearSorting(){var cols=getActualPropFromColl(this.sortSettings.columns);if(this.isActionPrevent()){this.parent.notify(preventBatch,{instance:this,handler:this.clearSorting});return;}for(var i=0,len=cols.length;i<len;i++){this.removeSortColumn(cols[i].field);}}},{key:'isActionPrevent',value:function isActionPrevent(){return _isActionPrevent(this.parent);}},{key:'removeSortColumn',value:function removeSortColumn(field){var gObj=this.parent;var cols=this.sortSettings.columns;if(this.sortedColumns.indexOf(field)<0){return;}if(this.isActionPrevent()){this.parent.notify(preventBatch,{instance:this,handler:this.removeSortColumn,arg1:field});return;}this.removeSortIcons();for(var i=0,len=cols.length;i<len;i++){if(cols[i].field===field){if(gObj.allowGrouping&&gObj.groupSettings.columns.indexOf(cols[i].field)>-1){continue;}this.sortedColumns.splice(this.sortedColumns.indexOf(cols[i].field),1);cols.splice(i,1);this.isRemove=true;if(this.isModelChanged){this.parent.notify(modelChanged,{requestType:'sorting',type:actionBegin});}break;}}this.addSortIcons();}},{key:'getSortedColsIndexByField',value:function getSortedColsIndexByField(field,sortedColumns){var cols=sortedColumns?sortedColumns:this.sortSettings.columns;for(var i=0,len=cols.length;i<len;i++){if(cols[i].field===field){return i;}}return-1;}},{key:'getModuleName',value:function getModuleName(){return'sort';}},{key:'initialEnd',value:function initialEnd(){this.parent.off(contentReady,this.initialEnd);if(this.parent.getColumns().length&&this.sortSettings.columns.length){var gObj=this.parent;this.contentRefresh=false;this.isMultiSort=this.sortSettings.columns.length>1;var _iteratorNormalCompletion27=true;var _didIteratorError27=false;var _iteratorError27=undefined;try{for(var _iterator27=gObj.sortSettings.columns[Symbol.iterator](),_step27;!(_iteratorNormalCompletion27=(_step27=_iterator27.next()).done);_iteratorNormalCompletion27=true){var col=_step27.value;if(this.sortedColumns.indexOf(col.field)>-1){this.sortColumn(col.field,col.direction,true);}}}catch(err){_didIteratorError27=true;_iteratorError27=err;}finally{try{if(!_iteratorNormalCompletion27&&_iterator27.return){_iterator27.return();}}finally{if(_didIteratorError27){throw _iteratorError27;}}}this.isMultiSort=false;this.contentRefresh=true;}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(contentReady,this.initialEnd,this);this.parent.on(sortComplete,this.onActionComplete,this);this.parent.on(inBoundModelChanged,this.onPropertyChanged,this);this.parent.on(click,this.clickHandler,this);this.parent.on(headerRefreshed,this.refreshSortIcons,this);this.parent.on(keyPressed,this.keyPressed,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(sortComplete,this.onActionComplete);this.parent.off(inBoundModelChanged,this.onPropertyChanged);this.parent.off(click,this.clickHandler);this.parent.off(headerRefreshed,this.refreshSortIcons);this.parent.off(keyPressed,this.keyPressed);}},{key:'destroy',value:function destroy(){this.isModelChanged=false;if(this.parent.element.querySelector('.e-gridpopup').querySelectorAll('.e-sortdirect').length){this.parent.element.querySelector('.e-gridpopup').style.display='none';}this.clearSorting();this.isModelChanged=true;this.removeEventListener();}},{key:'clickHandler',value:function clickHandler(e){this.popUpClickHandler(e);var target=closest(e.target,'.e-headercell');if(target&&!e.target.classList.contains('e-grptogglebtn')&&!e.target.classList.contains('e-stackedheadercell')&&!e.target.classList.contains('e-stackedheadercelldiv')&&!target.classList.contains('e-resized')&&!e.target.classList.contains('e-rhandler')&&!e.target.classList.contains('e-columnmenu')&&!e.target.classList.contains('e-filtermenudiv')){var gObj=this.parent;var colObj=gObj.getColumnByUid(target.querySelector('.e-headercelldiv').getAttribute('e-mappinguid'));var direction=!target.querySelectorAll('.e-ascending').length?'Ascending':'Descending';if(colObj.type!=='checkbox'){this.initiateSort(target,e,colObj);if(Browser.isDevice){this.showPopUp(e);}}}if(target){target.classList.remove('e-resized');}}},{key:'keyPressed',value:function keyPressed(e){var ele=e.target;if(!this.parent.isEdit&&(e.action==='enter'||e.action==='ctrlEnter'||e.action==='shiftEnter')&&closest(ele,'.e-headercell')){var target=this.focus.getFocusedElement();if(isNullOrUndefined(target)||!target.classList.contains('e-headercell')||!target.querySelector('.e-headercelldiv')){return;}var col=this.parent.getColumnByUid(target.querySelector('.e-headercelldiv').getAttribute('e-mappinguid'));this.initiateSort(target,e,col);}}},{key:'initiateSort',value:function initiateSort(target,e,column){var gObj=this.parent;var field=column.field;var direction=!target.querySelectorAll('.e-ascending').length?'Ascending':'Descending';if(e.shiftKey||this.sortSettings.allowUnsort&&target.querySelectorAll('.e-descending').length&&!(gObj.groupSettings.columns.indexOf(field)>-1)){this.removeSortColumn(field);}else{this.sortColumn(field,direction,e.ctrlKey||this.enableSortMultiTouch);}}},{key:'showPopUp',value:function showPopUp(e){var target=closest(e.target,'.e-headercell');if(!isNullOrUndefined(target)||this.parent.isContextMenuOpen()){setCssInGridPopUp(this.parent.element.querySelector('.e-gridpopup'),e,'e-sortdirect e-icons e-icon-sortdirect'+(this.sortedColumns.length>1?' e-spanclicked':''));}}},{key:'popUpClickHandler',value:function popUpClickHandler(e){var target=e.target;if(closest(target,'.e-headercell')||e.target.classList.contains('e-rowcell')||closest(target,'.e-gridpopup')){if(target.classList.contains('e-sortdirect')){if(!target.classList.contains('e-spanclicked')){target.classList.add('e-spanclicked');this.enableSortMultiTouch=true;}else{target.classList.remove('e-spanclicked');this.enableSortMultiTouch=false;this.parent.element.querySelector('.e-gridpopup').style.display='none';}}}else{this.parent.element.querySelector('.e-gridpopup').style.display='none';}}},{key:'addSortIcons',value:function addSortIcons(){var gObj=this.parent;var header=void 0;var filterElement=void 0;var cols=this.sortSettings.columns;var fieldNames=this.parent.getColumns().map(function(c){return c.field;});for(var i=0,len=cols.length;i<len;i++){if(fieldNames.indexOf(cols[i].field)===-1){continue;}header=gObj.getColumnHeaderByField(cols[i].field);this.aria.setSort(header,cols[i].direction);if(this.isMultiSort&&cols.length>1){header.querySelector('.e-headercelldiv').insertBefore(createElement('span',{className:'e-sortnumber',innerHTML:(i+1).toString()}),header.querySelector('.e-headertext'));}filterElement=header.querySelector('.e-sortfilterdiv');if(cols[i].direction==='Ascending'){classList(filterElement,['e-ascending','e-icon-ascending'],[]);}else{classList(filterElement,['e-descending','e-icon-descending'],[]);}}}},{key:'removeSortIcons',value:function removeSortIcons(position){var gObj=this.parent;var header=void 0;var cols=this.sortSettings.columns;var fieldNames=this.parent.getColumns().map(function(c){return c.field;});for(var i=position?position:0,len=!isNullOrUndefined(position)?position+1:cols.length;i<len;i++){if(gObj.allowGrouping&&gObj.groupSettings.columns.indexOf(cols[i].field)>-1){continue;}if(fieldNames.indexOf(cols[i].field)===-1){continue;}header=gObj.getColumnHeaderByField(cols[i].field);this.aria.setSort(header,'none');classList(header.querySelector('.e-sortfilterdiv'),[],['e-descending','e-icon-descending','e-ascending','e-icon-ascending']);if(header.querySelector('.e-sortnumber')){header.querySelector('.e-headercelldiv').removeChild(header.querySelector('.e-sortnumber'));}}}},{key:'getSortColumnFromField',value:function getSortColumnFromField(field){for(var i=0,len=this.sortSettings.columns.length;i<len;i++){if(this.sortSettings.columns[i].field===field){return this.sortSettings.columns[i];}}return false;}},{key:'updateAriaAttr',value:function updateAriaAttr(){var fieldNames=this.parent.getColumns().map(function(c){return c.field;});var _iteratorNormalCompletion28=true;var _didIteratorError28=false;var _iteratorError28=undefined;try{for(var _iterator28=this.sortedColumns[Symbol.iterator](),_step28;!(_iteratorNormalCompletion28=(_step28=_iterator28.next()).done);_iteratorNormalCompletion28=true){var col=_step28.value;if(fieldNames.indexOf(col)===-1){continue;}var header=this.parent.getColumnHeaderByField(col);this.aria.setSort(header,this.getSortColumnFromField(col).direction);}}catch(err){_didIteratorError28=true;_iteratorError28=err;}finally{try{if(!_iteratorNormalCompletion28&&_iterator28.return){_iterator28.return();}}finally{if(_didIteratorError28){throw _iteratorError28;}}}}},{key:'refreshSortIcons',value:function refreshSortIcons(){this.removeSortIcons();this.isMultiSort=true;this.removeSortIcons();this.addSortIcons();this.isMultiSort=false;this.updateAriaAttr();}}]);return Sort;}());_export('NumericContainer',NumericContainer=function(){/**
     * Constructor for numericContainer module
     * @hidden
     */function NumericContainer(pagerModule){_classCallCheck(this,NumericContainer);this.pagerModule=pagerModule;}/**
     * The function is used to render numericContainer
     * @hidden
     */_createClass(NumericContainer,[{key:'render',value:function render(){this.pagerElement=this.pagerModule.element;this.renderNumericContainer();this.refreshNumericLinks();this.wireEvents();}},{key:'refresh',value:function refresh(){this.pagerModule.updateTotalPages();if(this.links.length){this.updateLinksHtml();}this.updateStyles();}},{key:'refreshNumericLinks',value:function refreshNumericLinks(){var link=void 0;var pagerObj=this.pagerModule;var div=pagerObj.element.querySelector('.e-numericcontainer');var frag=document.createDocumentFragment();div.innerHTML='';for(var i=1;i<=pagerObj.pageCount;i++){link=createElement('a',{className:'e-link e-numericitem e-spacing e-pager-default',attrs:{role:'link',tabindex:'-1','aria-label':'Goto Page '+i,href:'javascript:void(0);',name:'Goto page'+i}});if(pagerObj.currentPage===i){classList(link,['e-currentitem','e-active'],['e-pager-default']);}frag.appendChild(link);}div.appendChild(frag);this.links=[].slice.call(div.childNodes);}},{key:'wireEvents',value:function wireEvents(){EventHandler.add(this.pagerElement,'click',this.clickHandler,this);}},{key:'unwireEvents',value:function unwireEvents(){EventHandler.remove(this.pagerElement,'click',this.clickHandler);}},{key:'destroy',value:function destroy(){this.unwireEvents();}},{key:'renderNumericContainer',value:function renderNumericContainer(){this.element=createElement('div',{className:'e-pagercontainer',attrs:{'role':'navigation'}});this.renderFirstNPrev(this.element);this.renderPrevPagerSet(this.element);this.element.appendChild(createElement('div',{className:'e-numericcontainer'}));this.renderNextPagerSet(this.element);this.renderNextNLast(this.element);this.pagerModule.element.appendChild(this.element);}},{key:'renderFirstNPrev',value:function renderFirstNPrev(pagerContainer){this.first=createElement('div',{className:'e-first e-icons e-icon-first',attrs:{title:this.pagerModule.getLocalizedLabel('firstPageTooltip'),'aria-label':this.pagerModule.getLocalizedLabel('firstPageTooltip'),tabindex:'-1'}});this.prev=createElement('div',{className:'e-prev e-icons e-icon-prev',attrs:{title:this.pagerModule.getLocalizedLabel('previousPageTooltip'),'aria-label':this.pagerModule.getLocalizedLabel('previousPageTooltip'),tabindex:'-1'}});append([this.first,this.prev],pagerContainer);}},{key:'renderPrevPagerSet',value:function renderPrevPagerSet(pagerContainer){var prevPager=createElement('div');this.PP=createElement('a',{className:'e-link e-pp e-spacing',innerHTML:'...',attrs:{title:this.pagerModule.getLocalizedLabel('previousPagerTooltip'),role:'link','aria-label':this.pagerModule.getLocalizedLabel('previousPagerTooltip'),tabindex:'-1',name:this.pagerModule.getLocalizedLabel('previousPagerTooltip'),href:'javascript:void(0);'}});prevPager.appendChild(this.PP);pagerContainer.appendChild(prevPager);}},{key:'renderNextPagerSet',value:function renderNextPagerSet(pagerContainer){var nextPager=createElement('div');this.NP=createElement('a',{className:'e-link e-np e-spacing',innerHTML:'...',attrs:{title:this.pagerModule.getLocalizedLabel('nextPagerTooltip'),role:'link','aria-label':this.pagerModule.getLocalizedLabel('nextPagerTooltip'),tabindex:'-1',name:this.pagerModule.getLocalizedLabel('nextPagerTooltip'),href:'javascript:void(0);'}});nextPager.appendChild(this.NP);pagerContainer.appendChild(nextPager);}},{key:'renderNextNLast',value:function renderNextNLast(pagerContainer){this.next=createElement('div',{className:'e-next e-icons e-icon-next',attrs:{title:this.pagerModule.getLocalizedLabel('nextPageTooltip'),'aria-label':this.pagerModule.getLocalizedLabel('nextPageTooltip'),tabindex:'-1'}});this.last=createElement('div',{className:'e-last e-icons e-icon-last',attrs:{title:this.pagerModule.getLocalizedLabel('lastPageTooltip'),'aria-label':this.pagerModule.getLocalizedLabel('lastPageTooltip'),tabindex:'-1'}});append([this.next,this.last],pagerContainer);}},{key:'clickHandler',value:function clickHandler(e){var pagerObj=this.pagerModule;var target=e.target;pagerObj.previousPageNo=pagerObj.currentPage;if(!target.classList.contains('e-disable')&&!isNullOrUndefined(target.getAttribute('index'))){pagerObj.currentPage=parseInt(target.getAttribute('index'),10);pagerObj.dataBind();}return false;}},{key:'updateLinksHtml',value:function updateLinksHtml(){var pagerObj=this.pagerModule;var currentPageSet=void 0;var pageNo=void 0;pagerObj.currentPage=pagerObj.totalPages===1?1:pagerObj.currentPage;if(pagerObj.currentPage>pagerObj.totalPages&&pagerObj.totalPages){pagerObj.currentPage=pagerObj.totalPages;}currentPageSet=parseInt((pagerObj.currentPage/pagerObj.pageCount).toString(),10);if(pagerObj.currentPage%pagerObj.pageCount===0&&currentPageSet>0){currentPageSet=currentPageSet-1;}for(var i=0;i<pagerObj.pageCount;i++){pageNo=currentPageSet*pagerObj.pageCount+1+i;if(pageNo<=pagerObj.totalPages){this.links[i].style.display='';this.links[i].setAttribute('index',pageNo.toString());this.links[i].innerHTML=!pagerObj.customText?pageNo.toString():pagerObj.customText+pageNo;if(pagerObj.currentPage!==pageNo){this.links[i].classList.add('e-pager-default');}else{this.links[i].classList.remove('e-pager-default');}}else{this.links[i].innerHTML=!pagerObj.customText?pageNo.toString():pagerObj.customText+pageNo;this.links[i].style.display='none';}classList(this.links[i],[],['e-currentitem','e-active']);}this.first.setAttribute('index','1');this.last.setAttribute('index',pagerObj.totalPages.toString());this.prev.setAttribute('index',(pagerObj.currentPage-1).toString());this.next.setAttribute('index',(pagerObj.currentPage+1).toString());this.pagerElement.querySelector('.e-mfirst').setAttribute('index','1');this.pagerElement.querySelector('.e-mlast').setAttribute('index',pagerObj.totalPages.toString());this.pagerElement.querySelector('.e-mprev').setAttribute('index',(pagerObj.currentPage-1).toString());this.pagerElement.querySelector('.e-mnext').setAttribute('index',(pagerObj.currentPage+1).toString());this.PP.setAttribute('index',(parseInt(this.links[0].getAttribute('index'),10)-pagerObj.pageCount).toString());this.NP.setAttribute('index',(parseInt(this.links[this.links.length-1].getAttribute('index'),10)+1).toString());}},{key:'updateStyles',value:function updateStyles(){this.updateFirstNPrevStyles();this.updatePrevPagerSetStyles();this.updateNextPagerSetStyles();this.updateNextNLastStyles();if(this.links.length){classList(this.links[(this.pagerModule.currentPage-1)%this.pagerModule.pageCount],['e-currentitem','e-active'],[]);}}},{key:'updateFirstNPrevStyles',value:function updateFirstNPrevStyles(){var firstPage=['e-firstpage','e-pager-default'];var firstPageDisabled=['e-firstpagedisabled','e-disable'];var prevPage=['e-prevpage','e-pager-default'];var prevPageDisabled=['e-prevpagedisabled','e-disable'];if(this.pagerModule.totalPages>0&&this.pagerModule.currentPage>1){classList(this.prev,prevPage,prevPageDisabled);classList(this.first,firstPage,firstPageDisabled);classList(this.pagerElement.querySelector('.e-mfirst'),firstPage,firstPageDisabled);classList(this.pagerElement.querySelector('.e-mprev'),prevPage,prevPageDisabled);}else{classList(this.prev,prevPageDisabled,prevPage);classList(this.first,firstPageDisabled,firstPage);classList(this.pagerElement.querySelector('.e-mprev'),prevPageDisabled,prevPage);classList(this.pagerElement.querySelector('.e-mfirst'),firstPageDisabled,firstPage);}}},{key:'updatePrevPagerSetStyles',value:function updatePrevPagerSetStyles(){if(this.pagerModule.currentPage>this.pagerModule.pageCount){classList(this.PP,['e-numericitem','e-pager-default'],['e-nextprevitemdisabled','e-disable']);}else{classList(this.PP,['e-nextprevitemdisabled','e-disable'],['e-numericitem','e-pager-default']);}}},{key:'updateNextPagerSetStyles',value:function updateNextPagerSetStyles(){var pagerObj=this.pagerModule;var firstPage=this.links[0].innerHTML.replace(pagerObj.customText,'');if(!firstPage.length||!this.links.length||parseInt(firstPage,10)+pagerObj.pageCount>pagerObj.totalPages){classList(this.NP,['e-nextprevitemdisabled','e-disable'],['e-numericitem','e-pager-default']);}else{classList(this.NP,['e-numericitem','e-pager-default'],['e-nextprevitemdisabled','e-disable']);}}},{key:'updateNextNLastStyles',value:function updateNextNLastStyles(){var lastPage=['e-lastpage','e-pager-default'];var lastPageDisabled=['e-lastpagedisabled','e-disable'];var nextPage=['e-nextpage','e-pager-default'];var nextPageDisabled=['e-nextpagedisabled','e-disable'];var pagerObj=this.pagerModule;if(pagerObj.currentPage===pagerObj.totalPages||pagerObj.totalRecordsCount===0){classList(this.last,lastPageDisabled,lastPage);classList(this.next,nextPageDisabled,nextPage);classList(this.pagerElement.querySelector('.e-mlast'),lastPageDisabled,lastPage);classList(this.pagerElement.querySelector('.e-mnext'),nextPageDisabled,nextPage);}else{classList(this.last,lastPage,lastPageDisabled);classList(this.next,nextPage,nextPageDisabled);classList(this.pagerElement.querySelector('.e-mlast'),lastPage,lastPageDisabled);classList(this.pagerElement.querySelector('.e-mnext'),nextPage,nextPageDisabled);}}}]);return NumericContainer;}());_export('PagerMessage',PagerMessage=function(){/**
     * Constructor for externalMessage module
     * @hidden
     */function PagerMessage(pagerModule){_classCallCheck(this,PagerMessage);this.pagerModule=pagerModule;}/**
     * The function is used to render pager message
     * @hidden
     */_createClass(PagerMessage,[{key:'render',value:function render(){var div=createElement('div',{className:'e-parentmsgbar',attrs:{'aria-label':'Pager Information'}});this.pageNoMsgElem=createElement('span',{className:'e-pagenomsg',styles:'textalign:right'});this.pageCountMsgElem=createElement('span',{className:'e-pagecountmsg',styles:'textalign:right'});append([this.pageNoMsgElem,this.pageCountMsgElem],div);this.pagerModule.element.appendChild(div);this.refresh();}},{key:'refresh',value:function refresh(){var pagerObj=this.pagerModule;this.pageNoMsgElem.textContent=this.format(pagerObj.getLocalizedLabel('currentPageInfo'),[pagerObj.totalRecordsCount===0?0:pagerObj.currentPage,pagerObj.totalPages||0])+' ';this.pageCountMsgElem.textContent=this.format(pagerObj.getLocalizedLabel('totalItemsInfo'),[pagerObj.totalRecordsCount||0]);this.pageNoMsgElem.parentElement.setAttribute('aria-label',this.pageNoMsgElem.textContent+this.pageCountMsgElem.textContent);}},{key:'hideMessage',value:function hideMessage(){if(this.pageNoMsgElem){this.pageNoMsgElem.style.display='none';}if(this.pageCountMsgElem){this.pageCountMsgElem.style.display='none';}}},{key:'showMessage',value:function showMessage(){if(!this.pageNoMsgElem){this.render();}this.pageNoMsgElem.style.display='';this.pageCountMsgElem.style.display='';}},{key:'destroy',value:function destroy(){//destroy
}},{key:'format',value:function format(str,args){var regx=void 0;for(var i=0;i<args.length;i++){regx=new RegExp('\\{'+i+'\\}','gm');str=str.replace(regx,args[i].toString());}return str;}}]);return PagerMessage;}());__decorate$3=undefined&&undefined.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if((typeof Reflect==='undefined'?'undefined':_typeof(Reflect))==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--){if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;}return c>3&&r&&Object.defineProperty(target,key,r),r;};_export('Pager',Pager=function(_Component2){_inherits(Pager,_Component2);/**
     * Constructor for creating the component.
     * @hidden
     */function Pager(options,element){_classCallCheck(this,Pager);var _this78=_possibleConstructorReturn(this,(Pager.__proto__||Object.getPrototypeOf(Pager)).call(this,options,element));_this78.defaultConstants={currentPageInfo:'{0} of {1} pages',totalItemsInfo:'({0} items)',firstPageTooltip:'Go to first page',lastPageTooltip:'Go to last page',nextPageTooltip:'Go to next page',previousPageTooltip:'Go to previous page',nextPagerTooltip:'Go to next pager',previousPagerTooltip:'Go to previous pager',pagerDropDown:'Items per page'};/**
         * `containerModule` is used to manipulate numeric container behavior of Pager.
         */_this78.containerModule=new NumericContainer(_this78);/**
         * `pagerMessageModule` is used to manipulate pager message of Pager.
         */_this78.pagerMessageModule=new PagerMessage(_this78);return _this78;}/**
     * To provide the array of modules needed for component rendering
     * @hidden
     */_createClass(Pager,[{key:'requiredModules',value:function requiredModules(){var modules=[];if(this.enableExternalMessage){modules.push({member:'externalMessage',args:[this]});}if(this.checkpagesizes()){modules.push({member:'pagerdropdown',args:[this]});}return modules;}},{key:'preRender',value:function preRender(){}//preRender
/**
     * To Initialize the component rendering
     */},{key:'render',value:function render(){if(this.template){this.pagerTemplate();}else{this.initLocalization();this.updateRTL();this.totalRecordsCount=this.totalRecordsCount||0;this.renderFirstPrevDivForDevice();this.containerModule.render();if(this.enablePagerMessage){this.pagerMessageModule.render();}this.renderNextLastDivForDevice();if(this.checkpagesizes()){this.pagerdropdownModule.render();}this.addAriaLabel();if(this.enableExternalMessage&&this.externalMessageModule){this.externalMessageModule.render();}this.refresh();this.trigger('created',{'currentPage':this.currentPage,'totalRecordsCount':this.totalRecordsCount});}}},{key:'getPersistData',value:function getPersistData(){var keyEntity=['currentPage','pageSize'];return this.addOnPersist(keyEntity);}},{key:'destroy',value:function destroy(){_get(Pager.prototype.__proto__||Object.getPrototypeOf(Pager.prototype),'destroy',this).call(this);this.containerModule.destroy();this.pagerMessageModule.destroy();this.element.innerHTML='';}},{key:'getModuleName',value:function getModuleName(){return'pager';}},{key:'onPropertyChanged',value:function onPropertyChanged(newProp,oldProp){if(this.isDestroyed){return;}if(newProp.pageCount!==oldProp.pageCount){this.containerModule.refreshNumericLinks();this.containerModule.refresh();}var _iteratorNormalCompletion29=true;var _didIteratorError29=false;var _iteratorError29=undefined;try{for(var _iterator29=Object.keys(newProp)[Symbol.iterator](),_step29;!(_iteratorNormalCompletion29=(_step29=_iterator29.next()).done);_iteratorNormalCompletion29=true){var prop=_step29.value;switch(prop){case'currentPage':if(this.checkGoToPage(newProp.currentPage,oldProp.currentPage)){this.currentPageChanged();}break;case'pageSize':case'totalRecordsCount':case'customText':this.refresh();break;case'pageSizes':if(this.checkpagesizes()){this.pagerdropdownModule.destroy();this.pagerdropdownModule.render();}this.refresh();break;case'template':this.templateFn=this.compile(this.template);this.refresh();break;case'locale':this.initLocalization();this.refresh();break;case'enableExternalMessage':if(this.enableExternalMessage){this.externalMessageModule.render();}break;case'externalMessage':if(this.externalMessageModule){this.externalMessageModule.refresh();}break;case'enableRtl':this.updateRTL();break;case'enablePagerMessage':if(this.enablePagerMessage){this.pagerMessageModule.showMessage();}else{this.pagerMessageModule.hideMessage();}break;}}}catch(err){_didIteratorError29=true;_iteratorError29=err;}finally{try{if(!_iteratorNormalCompletion29&&_iterator29.return){_iterator29.return();}}finally{if(_didIteratorError29){throw _iteratorError29;}}}}},{key:'getLocalizedLabel',value:function getLocalizedLabel(key){return this.localeObj.getConstant(key);}},{key:'goToPage',value:function goToPage(pageNo){if(this.checkGoToPage(pageNo)){this.currentPage=pageNo;this.dataBind();}}},{key:'checkpagesizes',value:function checkpagesizes(){if(this.pageSizes===true||this.pageSizes.length){return true;}return false;}},{key:'checkGoToPage',value:function checkGoToPage(newPageNo,oldPageNo){if(newPageNo!==this.currentPage){this.previousPageNo=this.currentPage;}if(!isNullOrUndefined(oldPageNo)){this.previousPageNo=oldPageNo;}if(this.previousPageNo!==newPageNo&&newPageNo>=1&&newPageNo<=this.totalPages){return true;}return false;}},{key:'currentPageChanged',value:function currentPageChanged(){if(this.enableQueryString){this.updateQueryString(this.currentPage);}var args={currentPage:this.currentPage,cancel:false};this.trigger('click',args);if(!args.cancel){this.refresh();}}},{key:'pagerTemplate',value:function pagerTemplate(){var result=void 0;this.element.classList.add('e-pagertemplate');this.compile(this.template);var data={currentPage:this.currentPage,pageSize:this.pageSize,pageCount:this.pageCount,totalRecordsCount:this.totalRecordsCount,totalPages:this.totalPages};result=this.getPagerTemplate()(data);appendChildren(this.element,result);}},{key:'updateTotalPages',value:function updateTotalPages(){this.totalPages=this.totalRecordsCount%this.pageSize===0?this.totalRecordsCount/this.pageSize:parseInt((this.totalRecordsCount/this.pageSize).toString(),10)+1;}},{key:'getPagerTemplate',value:function getPagerTemplate(){return this.templateFn;}},{key:'compile',value:function compile(template){if(template){try{if(document.querySelectorAll(template).length){this.templateFn=_compile(document.querySelector(template).innerHTML.trim());}}catch(e){this.templateFn=_compile(template);}}return undefined;}},{key:'refresh',value:function refresh(){if(this.template){this.element.innerHTML='';this.updateTotalPages();this.pagerTemplate();}else{this.updateRTL();this.containerModule.refresh();if(this.enablePagerMessage){this.pagerMessageModule.refresh();}if(this.enableExternalMessage&&this.externalMessageModule){this.externalMessageModule.refresh();}}}},{key:'updateRTL',value:function updateRTL(){if(this.enableRtl){this.element.classList.add('e-rtl');}else{this.element.classList.remove('e-rtl');}}},{key:'initLocalization',value:function initLocalization(){this.localeObj=new L10n(this.getModuleName(),this.defaultConstants,this.locale);}},{key:'updateQueryString',value:function updateQueryString(value){var updatedUrl=this.getUpdatedURL(window.location.href,'page',value.toString());window.history.pushState({path:updatedUrl},'',updatedUrl);}},{key:'getUpdatedURL',value:function getUpdatedURL(uri,key,value){var regx=new RegExp('([?|&])'+key+'=.*?(&|#|$)','i');if(uri.match(regx)){return uri.replace(regx,'$1'+key+'='+value+'$2');}else{var hash='';if(uri.indexOf('#')!==-1){hash=uri.replace(/.*#/,'#');uri=uri.replace(/#.*/,'');}return uri+(uri.indexOf('?')!==-1?'&':'?')+key+'='+value+hash;}}},{key:'renderFirstPrevDivForDevice',value:function renderFirstPrevDivForDevice(){this.element.appendChild(createElement('div',{className:'e-mfirst e-icons e-icon-first',attrs:{title:this.getLocalizedLabel('firstPageTooltip'),tabindex:'-1'}}));this.element.appendChild(createElement('div',{className:'e-mprev e-icons e-icon-prev',attrs:{title:this.getLocalizedLabel('previousPageTooltip'),tabindex:'-1'}}));}},{key:'renderNextLastDivForDevice',value:function renderNextLastDivForDevice(){this.element.appendChild(createElement('div',{className:'e-mnext e-icons e-icon-next',attrs:{title:this.getLocalizedLabel('nextPageTooltip'),tabindex:'-1'}}));this.element.appendChild(createElement('div',{className:'e-mlast e-icons e-icon-last',attrs:{title:this.getLocalizedLabel('lastPageTooltip'),tabindex:'-1'}}));}},{key:'addAriaLabel',value:function addAriaLabel(){var _this79=this;var classList$$1=['.e-mfirst','.e-mprev','.e-mnext','.e-mlast'];if(!Browser.isDevice){classList$$1.forEach(function(value){var element=_this79.element.querySelector(value);element.setAttribute('aria-label',element.getAttribute('title'));});}}}]);return Pager;}(Component));__decorate$3([Property(false)],Pager.prototype,"enableQueryString",void 0);__decorate$3([Property(false)],Pager.prototype,"enableExternalMessage",void 0);__decorate$3([Property(true)],Pager.prototype,"enablePagerMessage",void 0);__decorate$3([Property(12)],Pager.prototype,"pageSize",void 0);__decorate$3([Property(10)],Pager.prototype,"pageCount",void 0);__decorate$3([Property(1)],Pager.prototype,"currentPage",void 0);__decorate$3([Property()],Pager.prototype,"totalRecordsCount",void 0);__decorate$3([Property()],Pager.prototype,"externalMessage",void 0);__decorate$3([Property(false)],Pager.prototype,"pageSizes",void 0);__decorate$3([Property()],Pager.prototype,"template",void 0);__decorate$3([Property('')],Pager.prototype,"customText",void 0);__decorate$3([Event()],Pager.prototype,"click",void 0);__decorate$3([Event()],Pager.prototype,"dropDownChanged",void 0);__decorate$3([Event()],Pager.prototype,"created",void 0);_export('Pager',Pager=__decorate$3([NotifyPropertyChanges],Pager));/**
 * `PagerDropDown` module handles selected pageSize from DropDownList.
 */PagerDropDown=function(){/**
     * Constructor for pager module
     * @hidden
     */function PagerDropDown(pagerModule){_classCallCheck(this,PagerDropDown);this.pagerModule=pagerModule;}/**
     * For internal use only - Get the module name.
     * @private
     * @hidden
     */_createClass(PagerDropDown,[{key:'getModuleName',value:function getModuleName(){return'pagerdropdown';}},{key:'render',value:function render(){var pagerObj=this.pagerModule;this.pagerDropDownDiv=createElement('div',{className:'e-pagesizes'});var dropDownDiv=createElement('div',{className:'e-pagerdropdown'});var defaultTextDiv=createElement('div',{className:'e-pagerconstant'});var input=createElement('input',{attrs:{type:'text',tabindex:'1'}});this.pagerCons=createElement('span',{className:'e-constant',innerHTML:this.pagerModule.getLocalizedLabel('pagerDropDown')});dropDownDiv.appendChild(input);defaultTextDiv.appendChild(this.pagerCons);this.pagerDropDownDiv.appendChild(dropDownDiv);this.pagerDropDownDiv.appendChild(defaultTextDiv);this.pagerModule.element.appendChild(this.pagerDropDownDiv);var pageSizesModule=this.pagerModule.pageSizes;var pageSizesArray=pageSizesModule.length?pageSizesModule:[5,10,12,20];var defaultValue=pageSizesArray.indexOf(this.pagerModule.pageSize)>-1?this.pagerModule.pageSize:pageSizesArray[0];this.dropDownListObject=new DropDownList({dataSource:pageSizesArray,value:defaultValue,change:this.onChange.bind(this)});this.dropDownListObject.appendTo(input);pagerObj.pageSize=defaultValue;pagerObj.dataBind();pagerObj.trigger('dropDownChanged',{pageSize:defaultValue});}},{key:'onChange',value:function onChange(e){this.pagerModule.pageSize=this.dropDownListObject.value;this.pagerModule.dataBind();this.pagerModule.trigger('dropDownChanged',{pageSize:this.dropDownListObject.value});}},{key:'destroy',value:function destroy(args){if(this.dropDownListObject&&!this.dropDownListObject.isDestroyed){this.dropDownListObject.destroy();remove(this.pagerDropDownDiv);}}}]);return PagerDropDown;}();_export('ExternalMessage',ExternalMessage=function(){/**
     * Constructor for externalMessage module
     * @param  {Pager} pagerModule?
     * @returns defaultType
     * @hidden
     */function ExternalMessage(pagerModule){_classCallCheck(this,ExternalMessage);this.pagerModule=pagerModule;}/**
     * For internal use only - Get the module name.
     * @private
     */_createClass(ExternalMessage,[{key:'getModuleName',value:function getModuleName(){return'externalMessage';}},{key:'render',value:function render(){this.element=createElement('div',{className:'e-pagerexternalmsg',attrs:{'aria-label':'Pager external message'}});this.pagerModule.element.appendChild(this.element);this.refresh();}},{key:'refresh',value:function refresh(){if(this.pagerModule.externalMessage&&this.pagerModule.externalMessage.toString().length){this.showMessage();this.element.innerHTML=this.pagerModule.externalMessage;}else{this.hideMessage();}}},{key:'hideMessage',value:function hideMessage(){this.element.style.display='none';}},{key:'showMessage',value:function showMessage(){this.element.style.display='';}},{key:'destroy',value:function destroy(){remove(this.element);}}]);return ExternalMessage;}());Pager.Inject(ExternalMessage,PagerDropDown);/**
 * The `Page` module is used to render pager and handle paging action.
 */_export('Page',Page=function(){/**
     * Constructor for the Grid paging module
     * @hidden
     */function Page(parent,pageSettings){_classCallCheck(this,Page);this.parent=parent;this.pageSettings=pageSettings;this.addEventListener();}/**
     * For internal use only - Get the module name.
     * @private
     */_createClass(Page,[{key:'getModuleName',value:function getModuleName(){return'pager';}},{key:'render',value:function render(){var gObj=this.parent;var pagerObj=void 0;this.pagerDestroy();if(!isNullOrUndefined(this.parent.pagerTemplate)){this.pageSettings.template=this.parent.pagerTemplate;}this.element=createElement('div',{className:'e-gridpager'});pagerObj=extend$1({},extend({},getActualProperties(this.pageSettings)),{click:this.clickHandler.bind(this),dropDownChanged:this.onSelect.bind(this),enableRtl:gObj.enableRtl,locale:gObj.locale,created:this.addAriaAttr.bind(this)},['parentObj','propName']);this.pagerObj=new Pager(pagerObj);}},{key:'onSelect',value:function onSelect(e){this.pageSettings.pageSize=e.pageSize;this.pageSettings.currentPage=1;}},{key:'addAriaAttr',value:function addAriaAttr(){var _this80=this;if(!this.pageSettings.template){var numericContainerNew=createElement('div',{className:'e-numericcontainer'});var pagerContainer=this.element.querySelector('.e-pagercontainer');var frag=document.createDocumentFragment();var numericContainer=this.element.querySelector('.e-numericcontainer');var links=numericContainer.querySelectorAll('a');for(var i=0;i<links.length;i++){if(this.parent.getContentTable()){links[i].setAttribute('aria-owns',this.parent.getContentTable().id);var numericContainerDiv=createElement('div');numericContainerDiv.appendChild(links[i]);frag.appendChild(numericContainerDiv);}}numericContainerNew.appendChild(frag);pagerContainer.replaceChild(numericContainerNew,numericContainer);var classList$$1=['.e-mfirst','.e-mprev','.e-first','.e-prev','.e-next','.e-last','.e-mnext','.e-mlast'];classList$$1.forEach(function(value){var element=_this80.element.querySelector(value);if(_this80.parent.getContentTable()){element.setAttribute('aria-owns',_this80.parent.getContentTable().id);}});}}},{key:'dataReady',value:function dataReady(e){this.updateModel(e);}},{key:'refresh',value:function refresh(){this.pagerObj.refresh();}},{key:'goToPage',value:function goToPage(pageNo){this.pagerObj.goToPage(pageNo);}},{key:'updateModel',value:function updateModel(e){this.parent.pageSettings.totalRecordsCount=e.count;this.parent.dataBind();}},{key:'onActionComplete',value:function onActionComplete(e){this.parent.trigger(actionComplete,extend(e,{currentPage:this.parent.pageSettings.currentPage,requestType:'paging',type:actionComplete}));}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}var newProp=e.properties;var _iteratorNormalCompletion30=true;var _didIteratorError30=false;var _iteratorError30=undefined;try{for(var _iterator30=Object.keys(newProp)[Symbol.iterator](),_step30;!(_iteratorNormalCompletion30=(_step30=_iterator30.next()).done);_iteratorNormalCompletion30=true){var prop=_step30.value;this.pagerObj[prop]=newProp[prop];}}catch(err){_didIteratorError30=true;_iteratorError30=err;}finally{try{if(!_iteratorNormalCompletion30&&_iterator30.return){_iterator30.return();}}finally{if(_didIteratorError30){throw _iteratorError30;}}}this.pagerObj.dataBind();}},{key:'clickHandler',value:function clickHandler(e){var gObj=this.parent;if(this.isForceCancel||_isActionPrevent(gObj)){if(!this.isForceCancel){gObj.notify(preventBatch,{instance:this,handler:this.goToPage,arg1:e.currentPage});this.isForceCancel=true;this.pagerObj.currentPage=gObj.pageSettings.currentPage;this.pagerObj.dataBind();}else{this.isForceCancel=false;}e.cancel=true;return;}var prevPage=this.pageSettings.currentPage;this.pageSettings.currentPage=e.currentPage;this.parent.notify(modelChanged,{requestType:'paging',previousPage:prevPage,currentPage:e.currentPage,type:actionBegin});}},{key:'keyPressHandler',value:function keyPressHandler(e){if(e.action in keyActions){e.preventDefault();this.element.querySelector(keyActions[e.action]).click();}}},{key:'updateExternalMessage',value:function updateExternalMessage(message){if(!this.pagerObj.enableExternalMessage){this.pagerObj.enableExternalMessage=true;this.pagerObj.dataBind();}this.pagerObj.externalMessage=message;this.pagerObj.dataBind();}},{key:'appendToElement',value:function appendToElement(e){this.parent.element.appendChild(this.element);this.parent.setGridPager(this.element);this.pagerObj.appendTo(this.element);}},{key:'enableAfterRender',value:function enableAfterRender(e){if(e.module===this.getModuleName()&&e.enable){this.render();this.appendToElement();}}},{key:'addEventListener',value:function addEventListener(){this.handlers={load:this.render,end:this.appendToElement,ready:this.dataReady,complete:this.onActionComplete,updateLayout:this.enableAfterRender,inboundChange:this.onPropertyChanged,keyPress:this.keyPressHandler};if(this.parent.isDestroyed){return;}this.parent.on(initialLoad,this.handlers.load,this);this.parent.on(initialEnd,this.handlers.end,this);//For initial rendering
this.parent.on(dataReady,this.handlers.ready,this);this.parent.on(pageComplete,this.handlers.complete,this);this.parent.on(uiUpdate,this.handlers.updateLayout,this);this.parent.on(inBoundModelChanged,this.handlers.inboundChange,this);this.parent.on(keyPressed,this.handlers.keyPress,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialLoad,this.handlers.load);this.parent.off(initialEnd,this.handlers.end);//For initial rendering
this.parent.off(dataReady,this.handlers.ready);this.parent.off(pageComplete,this.handlers.complete);this.parent.off(uiUpdate,this.handlers.updateLayout);this.parent.off(inBoundModelChanged,this.handlers.inboundChange);this.parent.off(keyPressed,this.handlers.keyPress);}},{key:'destroy',value:function destroy(){this.removeEventListener();this.pagerDestroy();}},{key:'pagerDestroy',value:function pagerDestroy(){if(this.pagerObj&&!this.pagerObj.isDestroyed){this.pagerObj.destroy();remove(this.element);}}}]);return Page;}());keyActions={pageUp:'.e-prev',pageDown:'.e-next',ctrlAltPageDown:'.e-last',ctrlAltPageUp:'.e-first',altPageUp:'.e-pp',altPageDown:'.e-np'};_export('FilterCellRenderer',FilterCellRenderer=function(_CellRenderer9){_inherits(FilterCellRenderer,_CellRenderer9);function FilterCellRenderer(){_classCallCheck(this,FilterCellRenderer);var _this81=_possibleConstructorReturn(this,(FilterCellRenderer.__proto__||Object.getPrototypeOf(FilterCellRenderer)).apply(this,arguments));_this81.element=createElement('TH',{className:'e-filterbarcell'});return _this81;}/**
     * Function to return the wrapper for the TH content.
     * @returns string
     */_createClass(FilterCellRenderer,[{key:'getGui',value:function getGui(){return createElement('div');}},{key:'render',value:function render(cell,data){var tr=this.parent.element.querySelector('.e-filterbar');var node=this.element.cloneNode();var innerDIV=this.getGui();var input=void 0;var column=cell.column;tr.appendChild(node);if(column.type!=='checkbox'){if((isNullOrUndefined(column.allowFiltering)||column.allowFiltering)&&!isNullOrUndefined(column.filterBarTemplate)){node.classList.add('e-fltrtemp');attributes(innerDIV,{'class':'e-fltrtempdiv'});if(isNullOrUndefined(column.filterBarTemplate.create)){input=createElement('input',{id:column.field+'_filterBarcell',className:'e-filterUi_input e-filtertext e-fltrTemp',attrs:{type:'search',title:column.headerText}});innerDIV.appendChild(input);}else{var args={column:column,node:Element};var temp=column.filterBarTemplate.create;if(typeof temp==='string'){temp=getValue(temp,window);}input=temp(args);if(typeof input==='string'){var div=createElement('div');div.innerHTML=input;input=div.firstChild;}attributes(innerDIV,{class:'e-filterUi_input e-filtertext e-fltrTemp',title:column.headerText,id:column.field+'_filterBarcell'});innerDIV.appendChild(input);}}else{attributes(innerDIV,{'class':'e-filterdiv e-fltrinputdiv'});input=createElement('input',{id:column.field+'_filterBarcell',className:'e-filtertext',attrs:{type:'search',title:column.headerText+cell.attributes.title,value:data[cell.column.field]?data[cell.column.field]:'',role:'search'}});innerDIV.appendChild(input);Input.createInput({element:input,floatLabelType:'Never',properties:{enableRtl:this.parent.enableRtl,showClearButton:true}});}//TODO: apply intial filtering
if(column.allowFiltering===false||column.field===''||isNullOrUndefined(column.field)){input.setAttribute('disabled','true');input.classList.add('e-disable');}if(!column.visible){node.classList.add('e-hide');}this.appendHtml(node,innerDIV);if((isNullOrUndefined(column.allowFiltering)||column.allowFiltering)&&!isNullOrUndefined(column.filterBarTemplate)){var templateWrite=column.filterBarTemplate.write;var _args={element:input,column:column};if(typeof templateWrite==='string'){templateWrite=getValue(templateWrite,window);}templateWrite.call(this,_args);}}return node;}},{key:'appendHtml',value:function appendHtml(node,innerHtml){node.appendChild(innerHtml);return node;}}]);return FilterCellRenderer;}(CellRenderer));_export('FlMenuOptrUI',FlMenuOptrUI=function(){function FlMenuOptrUI(parent,customFltrOperators,serviceLocator,filterSettings){_classCallCheck(this,FlMenuOptrUI);this.parent=parent;this.serviceLocator=serviceLocator;this.filterSettings=filterSettings;this.customFilterOperators=customFltrOperators;}/**
     * @hidden
     */_createClass(FlMenuOptrUI,[{key:'renderOperatorUI',value:function renderOperatorUI(dlgConetntEle,target,column,dlgObj){this.dialogObj=dlgObj;var optr=column.type+'Operator';this.optrData=this.customOptr=!isNullOrUndefined(this.parent.filterSettings.operators)&&!isNullOrUndefined(this.parent.filterSettings.operators[optr])?this.parent.filterSettings.operators[optr]:this.customFilterOperators[optr];var dropDatasource=this.customOptr;var selectedValue=this.dropSelectedVal(column,optr);var optrDiv=createElement('div',{className:'e-flm_optrdiv'});dlgConetntEle.appendChild(optrDiv);var optrInput=createElement('input',{id:column.uid+'-floptr'});optrDiv.appendChild(optrInput);this.dropOptr=new DropDownList({dataSource:dropDatasource,fields:{text:'text',value:'value'},open:this.dropDownOpen.bind(this),text:selectedValue});this.dropOptr.appendTo('#'+column.uid+'-floptr');}},{key:'dropDownOpen',value:function dropDownOpen(args){args.popup.element.style.zIndex=(this.dialogObj.zIndex+1).toString();}},{key:'dropSelectedVal',value:function dropSelectedVal(col,optr){var selValue='';var columns=this.parent.filterSettings.columns;var _iteratorNormalCompletion31=true;var _didIteratorError31=false;var _iteratorError31=undefined;try{for(var _iterator31=columns[Symbol.iterator](),_step31;!(_iteratorNormalCompletion31=(_step31=_iterator31.next()).done);_iteratorNormalCompletion31=true){var column=_step31.value;if(col.field===column.field){var selectedField=new DataManager(this.optrData).executeLocal(new Query().where('value','equal',column.operator));selValue=!isNullOrUndefined(selectedField[0])?selectedField[0].text:'';}}}catch(err){_didIteratorError31=true;_iteratorError31=err;}finally{try{if(!_iteratorNormalCompletion31&&_iterator31.return){_iterator31.return();}}finally{if(_didIteratorError31){throw _iteratorError31;}}}if(selValue===''){selValue=this.optrData[0].text;}return selValue;}},{key:'getFlOperator',value:function getFlOperator(){return this.dropOptr.value;}}]);return FlMenuOptrUI;}());_export('StringFilterUI',StringFilterUI=function(){function StringFilterUI(parent,serviceLocator,filterSettings){_classCallCheck(this,StringFilterUI);this.parent=parent;this.serLocator=serviceLocator;this.filterSettings=filterSettings;}_createClass(StringFilterUI,[{key:'create',value:function create(args){this.instance=createElement('input',{className:'e-flmenu-input',id:'strui-'+args.column.uid});args.target.appendChild(this.instance);this.dialogObj=args.dialogObj;this.actObj=new AutoComplete(this.getAutoCompleteOptions(args));this.actObj.appendTo(this.instance);}},{key:'getAutoCompleteOptions',value:function getAutoCompleteOptions(args){var _this82=this;var isForeignColumn=args.column.isForeignColumn();var dataSource=isForeignColumn?args.column.dataSource:this.parent.dataSource;var fields={value:isForeignColumn?args.column.foreignKeyValue:args.column.field};return{dataSource:dataSource instanceof DataManager?dataSource:new DataManager(dataSource),fields:fields,locale:this.parent.locale,enableRtl:this.parent.enableRtl,sortOrder:'Ascending',open:this.openPopup.bind(this),cssClass:'e-popup-flmenu',focus:function focus(){_this82.actObj.filterType=args.getOptrInstance.getFlOperator();},autofill:true,placeholder:args.localizeText.getConstant('EnterValue'),actionComplete:function actionComplete(e){e.result=e.result.filter(function(obj,index,arr){return arr.map(function(mapObj){return mapObj[_this82.actObj.fields.value];}).indexOf(obj[_this82.actObj.fields.value])===index;});}};}},{key:'write',value:function write(args){var columns=this.filterSettings.columns;if(args.filteredValue!==''){var struiObj=document.querySelector('#strui-'+args.column.uid).ej2_instances[0];struiObj.value=args.filteredValue;}}},{key:'read',value:function read(element,column,filterOptr,filterObj){var actuiObj=document.querySelector('#strui-'+column.uid).ej2_instances[0];if(Browser.isDevice){actuiObj.hidePopup();actuiObj.focusOut();}var filterValue=actuiObj.value;if(isNullOrUndefined(filterValue)||filterValue===''){filterValue=null;}filterObj.filterByColumn(column.field,filterOptr,filterValue,'and',false);}},{key:'openPopup',value:function openPopup(args){getZIndexCalcualtion(args,this.dialogObj);}}]);return StringFilterUI;}());_export('NumberFilterUI',NumberFilterUI=function(){function NumberFilterUI(parent,serviceLocator,filterSettings){_classCallCheck(this,NumberFilterUI);this.filterSettings=filterSettings;this.parent=parent;this.serviceLocator=serviceLocator;}_createClass(NumberFilterUI,[{key:'create',value:function create(args){this.instance=createElement('input',{className:'e-flmenu-input',id:'numberui-'+args.column.uid});args.target.appendChild(this.instance);this.numericTxtObj=new NumericTextBox({format:args.column.format,locale:this.parent.locale,cssClass:'e-popup-flmenu',placeholder:args.localizeText.getConstant('EnterValue'),enableRtl:this.parent.enableRtl});this.numericTxtObj.appendTo(this.instance);}},{key:'write',value:function write(args){var numberuiObj=document.querySelector('#numberui-'+args.column.uid).ej2_instances[0];numberuiObj.value=args.filteredValue;}},{key:'read',value:function read(element,column,filterOptr,filterObj){var numberuiObj=document.querySelector('#numberui-'+column.uid).ej2_instances[0];var filterValue=numberuiObj.value;filterObj.filterByColumn(column.field,filterOptr,filterValue,'and',true);}}]);return NumberFilterUI;}());_export('BooleanFilterUI',BooleanFilterUI=function(){function BooleanFilterUI(parent,serviceLocator,filterSettings){_classCallCheck(this,BooleanFilterUI);this.parent=parent;this.serviceLocator=serviceLocator;this.filterSettings=filterSettings;}_createClass(BooleanFilterUI,[{key:'create',value:function create(args){var fields=args.column.field;this.elem=createElement('input',{className:'e-flmenu-input',id:'bool-ui-'+args.column.uid});args.target.appendChild(this.elem);this.dialogObj=args.dialogObj;this.dropInstance=new DropDownList({dataSource:this.parent.dataSource instanceof DataManager?this.parent.dataSource:new DataManager(this.parent.dataSource),query:new Query().select(args.column.field),fields:{text:args.column.field,value:args.column.field},placeholder:args.localizeText.getConstant('SelectValue'),cssClass:'e-popup-flmenu',locale:this.parent.locale,enableRtl:this.parent.enableRtl,open:this.openPopup.bind(this),actionComplete:function actionComplete(e){e.result=DataUtil.distinct(e.result,fields,true);}});this.dropInstance.appendTo(this.elem);}},{key:'write',value:function write(args){var drpuiObj=document.querySelector('#bool-ui-'+args.column.uid).ej2_instances[0];drpuiObj.text=!isNullOrUndefined(args.filteredValue)?args.filteredValue:'';}},{key:'read',value:function read(element,column,filterOptr,filterObj){var drpuiObj=document.querySelector('#bool-ui-'+column.uid).ej2_instances[0];var filterValue=drpuiObj.value;filterObj.filterByColumn(column.field,filterOptr,filterValue,'and',false);}},{key:'openPopup',value:function openPopup(args){getZIndexCalcualtion(args,this.dialogObj);}}]);return BooleanFilterUI;}());_export('DateFilterUI',DateFilterUI=function(){function DateFilterUI(parent,serviceLocator,filterSettings){_classCallCheck(this,DateFilterUI);this.parent=parent;this.locator=serviceLocator;this.fltrSettings=filterSettings;}_createClass(DateFilterUI,[{key:'create',value:function create(args){var intl=new Internationalization();var colFormat=args.column.format;var format=intl.getDatePattern({type:'date',skeleton:colFormat},false);this.dialogObj=args.dialogObj;this.inputElem=createElement('input',{className:'e-flmenu-input',id:'dateui-'+args.column.uid});args.target.appendChild(this.inputElem);this.datePickerObj=new DatePicker({format:format,cssClass:'e-popup-flmenu',placeholder:args.localizeText.getConstant('ChooseDate'),width:'100%',locale:this.parent.locale,enableRtl:this.parent.enableRtl,open:this.openPopup.bind(this)});this.datePickerObj.appendTo(this.inputElem);}},{key:'write',value:function write(args){var columns=this.fltrSettings.columns;var dateuiObj=document.querySelector('#dateui-'+args.column.uid).ej2_instances[0];dateuiObj.value=!isNullOrUndefined(args.filteredValue)?new Date(args.filteredValue):null;}},{key:'read',value:function read(element,column,filterOptr,filterObj){var dateuiObj=document.querySelector('#dateui-'+column.uid).ej2_instances[0];var filterValue=dateuiObj.value;filterValue=isNullOrUndefined(filterValue)?null:filterValue;filterObj.filterByColumn(column.field,filterOptr,filterValue,'and',true);}},{key:'openPopup',value:function openPopup(args){args.popup.element.style.zIndex=(this.dialogObj.zIndex+1).toString();}}]);return DateFilterUI;}());FilterMenuRenderer=function(){function FilterMenuRenderer(parent,filterSettings,serviceLocator,customFltrOperators,fltrObj){_classCallCheck(this,FilterMenuRenderer);this.isDialogOpen=false;this.colTypes={'string':StringFilterUI,'number':NumberFilterUI,'date':DateFilterUI,'boolean':BooleanFilterUI,'datetime':DateFilterUI};this.parent=parent;this.filterSettings=filterSettings;this.serviceLocator=serviceLocator;this.customFilterOperators=customFltrOperators;this.filterObj=fltrObj;this.flMuiObj=new FlMenuOptrUI(this.parent,this.customFilterOperators,this.serviceLocator);this.l10n=this.serviceLocator.getService('localization');}_createClass(FilterMenuRenderer,[{key:'openDialog',value:function openDialog(args){this.col=this.parent.getColumnByField(args.field);if(isNullOrUndefined(this.col.filter)||isNullOrUndefined(this.col.filter.type)||this.col.filter.type==='Menu'){this.renderDlgContent(args.target,this.col);}}},{key:'closeDialog',value:function closeDialog(){var elem=document.getElementById(this.dlgObj.element.id);if(this.dlgObj&&!this.dlgObj.isDestroyed&&elem){this.parent.notify(filterMenuClose,{field:this.col.field});this.isDialogOpen=false;this.dlgObj.destroy();remove(elem);}}},{key:'renderDlgContent',value:function renderDlgContent(target,column){var args={requestType:filterBeforeOpen,filterModel:this,columnName:column.field,columnType:column.type};this.parent.trigger(actionBegin,args);var mainDiv=createElement('div',{className:'e-flmenu-maindiv',id:column.uid+'-flmenu'});this.dlgDiv=createElement('div',{className:'e-flmenu',id:column.uid+'-flmdlg'});this.parent.element.appendChild(this.dlgDiv);this.dlgObj=new Dialog({showCloseIcon:false,closeOnEscape:false,locale:this.parent.locale,visible:false,enableRtl:this.parent.enableRtl,created:this.dialogCreated.bind(this,target,column),position:this.parent.element.classList.contains('e-device')?{X:'center',Y:'center'}:{X:'',Y:''},target:this.parent.element.classList.contains('e-device')?document.body:this.parent.element,buttons:[{click:this.filterBtnClick.bind(this,column),buttonModel:{content:this.l10n.getConstant('FilterButton'),isPrimary:true,cssClass:'e-flmenu-okbtn'}},{click:this.clearBtnClick.bind(this,column),buttonModel:{content:this.l10n.getConstant('ClearButton'),cssClass:'e-flmenu-cancelbtn'}}],content:mainDiv,width:!isNullOrUndefined(parentsUntil(target,'e-bigger'))||this.parent.element.classList.contains('e-device')?260:250,animationSettings:{effect:'None'},cssClass:'e-filter-popup'});this.dlgObj.appendTo(this.dlgDiv);}},{key:'dialogCreated',value:function dialogCreated(target,column){if(!Browser.isDevice){getFilterMenuPostion(target,this.dlgObj,this.parent);}this.renderFilterUI(target,column);this.parent.notify(filterDialogCreated,{});this.dlgObj.element.style.maxHeight='350px';this.dlgObj.show();this.writeMethod(column,this.dlgObj.element.querySelector('#'+column.uid+'-flmenu'));var args={requestType:filterAfterOpen,filterModel:this,columnName:column.field,columnType:column.type};this.isDialogOpen=true;this.parent.trigger(actionComplete,args);}},{key:'renderFilterUI',value:function renderFilterUI(target,col){var dlgConetntEle=this.dlgObj.element.querySelector('.e-flmenu-maindiv');this.renderOperatorUI(dlgConetntEle,target,col);this.renderFlValueUI(dlgConetntEle,target,col);}},{key:'renderOperatorUI',value:function renderOperatorUI(dlgConetntEle,target,column){this.flMuiObj.renderOperatorUI(dlgConetntEle,target,column,this.dlgObj);}},{key:'renderFlValueUI',value:function renderFlValueUI(dlgConetntEle,target,column){var valueDiv=createElement('div',{className:'e-flmenu-valuediv'});dlgConetntEle.appendChild(valueDiv);var args={target:valueDiv,column:column,getOptrInstance:this.flMuiObj,dialogObj:this.dlgObj};var instanceofFilterUI=new this.colTypes[column.type](this.parent,this.serviceLocator,this.parent.filterSettings);if(!isNullOrUndefined(column.filter)&&!isNullOrUndefined(column.filter.ui)&&!isNullOrUndefined(column.filter.ui.create)){var temp=column.filter.ui.create;if(typeof temp==='string'){temp=getValue(temp,window);}column.filter.ui.create({column:column,target:valueDiv,getOptrInstance:this.flMuiObj,dialogObj:this.dlgObj});}else{instanceofFilterUI.create({column:column,target:valueDiv,getOptrInstance:this.flMuiObj,localizeText:this.l10n,dialogObj:this.dlgObj});}}},{key:'writeMethod',value:function writeMethod(col,dlgContentEle){var flValue=void 0;var target=dlgContentEle.querySelector('.e-flmenu-valinput');var instanceofFilterUI=new this.colTypes[col.type](this.parent,this.serviceLocator,this.parent.filterSettings);var columns=this.filterSettings.columns;var _iteratorNormalCompletion32=true;var _didIteratorError32=false;var _iteratorError32=undefined;try{for(var _iterator32=columns[Symbol.iterator](),_step32;!(_iteratorNormalCompletion32=(_step32=_iterator32.next()).done);_iteratorNormalCompletion32=true){var column=_step32.value;if(col.field===column.field||col.foreignKeyValue===column.field){flValue=column.value;}}}catch(err){_didIteratorError32=true;_iteratorError32=err;}finally{try{if(!_iteratorNormalCompletion32&&_iterator32.return){_iterator32.return();}}finally{if(_didIteratorError32){throw _iteratorError32;}}}if(!isNullOrUndefined(col.filter)&&!isNullOrUndefined(col.filter.ui)&&!isNullOrUndefined(col.filter.ui.write)){var temp=col.filter.ui.write;if(typeof temp==='string'){temp=getValue(temp,window);}col.filter.ui.write({column:col,target:target,parent:this.parent,filteredValue:flValue});}else{instanceofFilterUI.write({column:col,target:target,parent:this.parent,filteredValue:flValue});}}},{key:'filterBtnClick',value:function filterBtnClick(col){var flValue=void 0;var flOptrValue=void 0;var targ=this.dlgObj.element.querySelector('.e-flmenu-valuediv input');flOptrValue=this.flMuiObj.getFlOperator();var instanceofFilterUI=new this.colTypes[col.type](this.parent,this.serviceLocator,this.parent.filterSettings);if(!isNullOrUndefined(col.filter)&&!isNullOrUndefined(col.filter.ui)&&!isNullOrUndefined(col.filter.ui.read)){var temp=col.filter.ui.read;if(typeof temp==='string'){temp=getValue(temp,window);}flValue=col.filter.ui.read({element:targ,column:col,operator:flOptrValue,fltrObj:this.filterObj});}else{instanceofFilterUI.read(targ,col,flOptrValue,this.filterObj);}var iconClass=this.parent.showColumnMenu?'.e-columnmenu':'.e-icon-filter';var column=this.parent.element.querySelector('[e-mappinguid="'+col.uid+'"]').parentElement;var flIcon=column.querySelector(iconClass);if(flIcon){flIcon.classList.add('e-filtered');}this.closeDialog();}},{key:'clearBtnClick',value:function clearBtnClick(column){this.filterObj.removeFilteredColsByField(column.field);this.closeDialog();var iconClass=this.parent.showColumnMenu?'.e-columnmenu':'.e-icon-filter';var col=this.parent.element.querySelector('[e-mappinguid="'+column.uid+'"]').parentElement;var flIcon=col.querySelector(iconClass);if(flIcon){flIcon.classList.remove('e-filtered');}}},{key:'destroy',value:function destroy(){this.closeDialog();}}]);return FilterMenuRenderer;}();_export('ExcelFilter',ExcelFilter=function(_CheckBoxFilter){_inherits(ExcelFilter,_CheckBoxFilter);/**
     * Constructor for excel filtering module
     * @hidden
     */function ExcelFilter(parent,filterSettings,serviceLocator,customFltrOperators){_classCallCheck(this,ExcelFilter);var _this83=_possibleConstructorReturn(this,(ExcelFilter.__proto__||Object.getPrototypeOf(ExcelFilter)).call(this,parent,filterSettings,serviceLocator));_this83.localeConstants={ClearFilter:'Clear Filter',NumberFilter:'Number Filters',TextFilter:'Text Filters',DateFilter:'Date Filters',MatchCase:'Match Case',Equal:'Equal',NotEqual:'Not Equal',LessThan:'Less Than',LessThanOrEqual:'Less Than Or Equal',GreaterThan:'Greater Than',GreaterThanOrEqual:'Greater Than Or Equal',Between:'Between',CustomFilter:'Custom Filter',StartsWith:'Starts With',EndsWith:'Ends With',Contains:'Contains',OK:'OK',Cancel:'Cancel',CustomFilterPlaceHolder:'Enter the value',CustomFilterDatePlaceHolder:'Choose a date',AND:'AND',OR:'OR',ShowRowsWhere:'Show rows where:'};_this83.customFilterOperators=customFltrOperators;extend(_this83.defaultConstants,_this83.localeConstants);_this83.isExcel=true;_this83.initLocale(_this83.defaultConstants);return _this83;}_createClass(ExcelFilter,[{key:'getCMenuDS',value:function getCMenuDS(type,operator){var options={number:['Equal','NotEqual','','LessThan','LessThanOrEqual','GreaterThan','GreaterThanOrEqual','Between','','CustomFilter'],string:['Equal','NotEqual','','StartsWith','EndsWith','','Contains','','CustomFilter']};options.date=options.number;options.datetime=options.number;var model=[];for(var i=0;i<options[type].length;i++){if(options[type][i].length){if(operator){model.push({text:this.getLocalizedLabel(options[type][i])+'...',iconCss:'e-icons e-icon-check '+(operator===options[type][i]?'':'e-emptyicon')});}else{model.push({text:this.getLocalizedLabel(options[type][i])+'...'});}}else{model.push({separator:true});}}return model;}},{key:'destroy',value:function destroy(){if(this.dlg){this.unwireExEvents();_get(ExcelFilter.prototype.__proto__||Object.getPrototypeOf(ExcelFilter.prototype),'destroy',this).call(this);}if(this.cmenu.parentElement){remove(this.cmenu);}}},{key:'createMenu',value:function createMenu(type,isFiltered,isCheckIcon){var options={string:'TextFilter',date:'DateFilter',datetime:'DateFilter',number:'NumberFilter'};this.menu=createElement('div',{className:'e-contextmenu-wrapper'});if(this.parent.enableRtl){this.menu.classList.add('e-rtl');}else{this.menu.classList.remove('e-rtl');}var ul=createElement('ul');var icon=isFiltered?'e-excl-filter-icon e-filtered':'e-excl-filter-icon';ul.appendChild(this.createMenuElem(this.getLocalizedLabel('ClearFilter'),isFiltered?'':'e-disabled',icon));if(type!=='boolean'){ul.appendChild(this.createMenuElem(this.getLocalizedLabel(options[type]),'e-submenu',isCheckIcon&&this.ensureTextFilter()?'e-icon-check':icon+' e-emptyicon',true));}this.menu.appendChild(ul);}},{key:'createMenuElem',value:function createMenuElem(val,className,iconName,isSubMenu){var li=createElement('li',{className:className+' e-menu-item'});li.innerHTML=val;li.insertBefore(createElement('span',{className:'e-menu-icon e-icons '+iconName}),li.firstChild);if(isSubMenu){li.appendChild(createElement('span',{className:'e-icons e-caret'}));}return li;}},{key:'wireExEvents',value:function wireExEvents(){EventHandler.add(this.dlg,'mouseover',this.hoverHandler,this);EventHandler.add(this.dlg,'click',this.clickExHandler,this);}},{key:'unwireExEvents',value:function unwireExEvents(){EventHandler.remove(this.dlg,'mouseover',this.hoverHandler);EventHandler.remove(this.dlg,'click',this.clickExHandler);}},{key:'clickExHandler',value:function clickExHandler(e){var menuItem=parentsUntil(e.target,'e-menu-item');if(menuItem&&this.getLocalizedLabel('ClearFilter')===menuItem.innerText.trim()){this.clearFilter();this.closeDialog();}}},{key:'destroyCMenu',value:function destroyCMenu(){if(this.menuObj&&!this.menuObj.isDestroyed){this.menuObj.destroy();remove(this.cmenu);}}},{key:'hoverHandler',value:function hoverHandler(e){var target=e.target.querySelector('.e-contextmenu');var li=parentsUntil(e.target,'e-menu-item');var focused=this.menu.querySelector('.e-focused');var isSubMenu=void 0;if(focused){focused.classList.remove('e-focused');}if(li){li.classList.add('e-focused');isSubMenu=li.classList.contains('e-submenu');}if(target){return;}if(!isSubMenu){var submenu=this.menu.querySelector('.e-submenu');if(!isNullOrUndefined(submenu)){submenu.classList.remove('e-selected');}this.isCMenuOpen=false;this.destroyCMenu();}var selectedMenu=this.ensureTextFilter();if(!this.isCMenuOpen&&isSubMenu){li.classList.add('e-selected');this.isCMenuOpen=true;var menuOptions={items:this.getCMenuDS(this.options.type,selectedMenu?selectedMenu.replace(/\s/g,''):undefined),select:this.selectHandler.bind(this),onClose:this.destroyCMenu.bind(this),enableRtl:this.parent.enableRtl,beforeClose:this.preventClose};this.parent.element.appendChild(this.cmenu);this.menuObj=new ContextMenu(menuOptions,this.cmenu);var client=this.menu.querySelector('.e-submenu').getBoundingClientRect();var pos={top:0,left:0};if(Browser.isDevice){var contextRect=this.getContextBounds(this.menuObj);pos.top=(window.innerHeight-contextRect.height)/2;pos.left=(window.innerWidth-contextRect.width)/2;this.closeDialog();}else{pos.top=client.top;pos.left=this.getCMenuYPosition(this.dlg,this.menuObj);}this.menuObj.open(pos.top,pos.left);}}},{key:'ensureTextFilter',value:function ensureTextFilter(){var selectedMenu=void 0;var predicates=this.existingPredicate[this.options.field];if(predicates&&predicates.length===2){if(predicates[0].operator==='greaterThanOrEqual'&&predicates[1].operator==='lessThanOrEqual'){selectedMenu='Between';}else{selectedMenu='CustomFilter';}}else{if(predicates&&predicates.length===1){this.optrData=this.customFilterOperators[this.options.type+'Operator'];selectedMenu=this.getSelectedText(predicates[0].operator);}}return selectedMenu;}},{key:'preventClose',value:function preventClose(args){if(args.event instanceof MouseEvent&&args.event.target.classList.contains('e-submenu')){args.cancel=true;}}},{key:'getContextBounds',value:function getContextBounds(context){var elementVisible=this.menuObj.element.style.display;this.menuObj.element.style.display='block';return this.menuObj.element.getBoundingClientRect();}},{key:'getCMenuYPosition',value:function getCMenuYPosition(target,context){var contextWidth=this.getContextBounds(context).width;var targetPosition=target.getBoundingClientRect();var leftPos=targetPosition.right+contextWidth-this.parent.element.clientWidth;return leftPos<1?targetPosition.right+1:targetPosition.left-contextWidth-1;}},{key:'openDialog',value:function openDialog(options){var _this84=this;this.updateModel(options);this.getAndSetChkElem(options);this.showDialog(options);this.dialogObj.dataBind();var filterLength=this.existingPredicate[options.field]&&this.existingPredicate[options.field].length||this.options.filteredColumns.filter(function(col){return _this84.options.field===col.field;}).length;this.createMenu(options.type,filterLength>0,filterLength===1||filterLength===2);this.dlg.insertBefore(this.menu,this.dlg.firstChild);this.dlg.classList.add('e-excelfilter');this.dlg.classList.remove('e-checkboxfilter');this.cmenu=createElement('ul',{className:'e-excel-menu'});this.wireExEvents();}},{key:'closeDialog',value:function closeDialog(){_get(ExcelFilter.prototype.__proto__||Object.getPrototypeOf(ExcelFilter.prototype),'closeDialog',this).call(this);}},{key:'selectHandler',value:function selectHandler(e){if(e.item){this.menuItem=e.item;this.renderDialogue(e);}}},{key:'renderDialogue',value:function renderDialogue(e){var _this85=this;var target=e.element;var column=this.options.field;var mainDiv=createElement('div',{className:'e-xlfl-maindiv',id:column+'-xlflmenu'});this.dlgDiv=createElement('div',{className:'e-xlflmenu',id:column+'-xlfldlg'});this.parent.element.appendChild(this.dlgDiv);this.dlgObj=new Dialog({header:'Custom Filter',isModal:true,overlayClick:this.removeDialog.bind(this),showCloseIcon:true,closeOnEscape:false,target:document.body,// target: this.parent.element,
visible:false,enableRtl:this.parent.enableRtl,open:function open(){var row=_this85.dlgObj.element.querySelector('table.e-xlfl-table>tr');row.cells[1].querySelector('input:not([type=hidden])').focus();},close:this.removeDialog.bind(this),created:this.createdDialog.bind(this,target,column),buttons:[{click:this.filterBtnClick.bind(this,column),buttonModel:{content:this.getLocalizedLabel('OK'),isPrimary:true,cssClass:'e-xlfl-okbtn'}},{click:this.removeDialog.bind(this),buttonModel:{content:this.getLocalizedLabel('Cancel'),cssClass:'e-xlfl-cancelbtn'}}],content:mainDiv,width:430,animationSettings:{effect:'None'}});this.dlgObj.appendTo(this.dlgDiv);}},{key:'removeDialog',value:function removeDialog(){this.removeObjects([this.dropOptr,this.datePicker,this.actObj,this.numericTxtObj,this.dlgObj]);remove(this.dlgDiv);}},{key:'clearBtnClick',value:function clearBtnClick(field){this.clearFilter();this.removeDialog();}},{key:'createdDialog',value:function createdDialog(target,column){this.renderCustomFilter(target,column);this.dlgObj.element.style.left='0px';this.dlgObj.element.style.top='0px';if(Browser.isDevice&&window.innerWidth<440){this.dlgObj.element.style.width='90%';}this.dlgObj.show();}},{key:'renderCustomFilter',value:function renderCustomFilter(target,column){var dlgConetntEle=this.dlgObj.element.querySelector('.e-xlfl-maindiv');/* tslint:disable-next-line:max-line-length */var dlgFields=createElement('div',{innerHTML:this.getLocalizedLabel('ShowRowsWhere'),className:'e-xlfl-dlgfields'});dlgConetntEle.appendChild(dlgFields);//column name
var fieldSet=createElement('div',{innerHTML:this.options.displayName,className:'e-xlfl-fieldset'});dlgConetntEle.appendChild(fieldSet);this.renderFilterUI(column,dlgConetntEle);}},{key:'filterBtnClick',value:function filterBtnClick(col){var fValue=this.dlgDiv.querySelector('#'+col+'-xlfl-frstvalue').ej2_instances[0];var fOperator=this.dlgDiv.querySelector('#'+col+'-xlfl-frstoptr').ej2_instances[0];var sValue=this.dlgDiv.querySelector('#'+col+'-xlfl-secndvalue').ej2_instances[0];var sOperator=this.dlgDiv.querySelector('#'+col+'-xlfl-secndoptr').ej2_instances[0];var checkBoxValue=void 0;if(this.options.type==='string'){var checkBox=this.dlgDiv.querySelector('#'+col+'-xlflmtcase').ej2_instances[0];checkBoxValue=checkBox.checked;}var andRadio=this.dlgDiv.querySelector('#'+col+'e-xlfl-frstpredicate').ej2_instances[0];var orRadio=this.dlgDiv.querySelector('#'+col+'e-xlfl-secndpredicate').ej2_instances[0];var predicate=andRadio.checked?'and':'or';if(sValue.value===null){predicate='or';}this.filterByColumn(this.options.field,fOperator.value,fValue.value,predicate,checkBoxValue,this.parent.filterSettings.ignoreAccent,sOperator.value,sValue.value);this.removeDialog();}},{key:'filterByColumn',value:function filterByColumn(fieldName,firstOperator,firstValue,predicate,matchCase,ignoreAccent,secondOperator,secondValue){var _this86=this;var col=this.parent.getColumnByField(fieldName);var field=col.isForeignColumn()?col.foreignKeyValue:fieldName;var fColl=[];var mPredicate=void 0;fColl.push({field:field,predicate:predicate,matchCase:matchCase,ignoreAccent:ignoreAccent,operator:firstOperator,value:firstValue,type:this.options.type});mPredicate=new Predicate(field,firstOperator.toLowerCase(),firstValue,!matchCase,ignoreAccent);if(secondValue){secondOperator=!isNullOrUndefined(secondOperator)?secondOperator:'equal';fColl.push({field:field,predicate:predicate,matchCase:matchCase,ignoreAccent:ignoreAccent,operator:secondOperator,value:secondValue,type:this.options.type});/* tslint:disable-next-line:max-line-length */mPredicate=mPredicate[predicate](field,secondOperator.toLowerCase(),secondValue,!matchCase,ignoreAccent);}var args={action:'filtering',filterCollection:fColl,field:this.options.field,ejpredicate:mPredicate,actualPredicate:fColl};var fPredicate={};var filterCollection=[];if(col.isForeignColumn()){this.options.column.dataSource.executeQuery(new Query().where(mPredicate)).then(function(e){_this86.options.column.columnData=e.result;_this86.parent.notify(generateQuery,{predicate:fPredicate,column:col});args.ejpredicate=fPredicate.predicate.predicates;fPredicate.predicate.predicates.forEach(function(fpred){filterCollection.push({field:fpred.field,predicate:'or',matchCase:fpred.ignoreCase,ignoreAccent:fpred.ignoreAccent,operator:fpred.operator,value:fpred.value,type:_this86.options.type});});args.filterCollection=filterCollection.length?filterCollection:fColl.filter(function(col){return col.field=_this86.options.field;});_this86.options.handler(args);});}else{this.options.handler(args);}}},{key:'renderOperatorUI',value:function renderOperatorUI(column,table,elementID,predicates,isFirst){var fieldElement=createElement('tr',{className:'e-xlfl-fields'});table.appendChild(fieldElement);var xlfloptr=createElement('td',{className:'e-xlfl-optr'});fieldElement.appendChild(xlfloptr);var optrDiv=createElement('div',{className:'e-xlfl-optrdiv'});var optrInput=createElement('input',{id:column+elementID});optrDiv.appendChild(optrInput);xlfloptr.appendChild(optrDiv);var optr=this.options.type+'Operator';var dropDatasource=this.customFilterOperators[optr];this.optrData=dropDatasource;var selectedValue=this.dropSelectedVal(column,predicates,isFirst);//Trailing three dots are sliced.
var menuText='';if(this.menuItem){menuText=this.menuItem.text.slice(0,-3);if(menuText!==this.getLocalizedLabel('CustomFilter')){selectedValue=isFirst?menuText:undefined;}if(menuText===this.getLocalizedLabel('Between')){selectedValue=this.getLocalizedLabel(isFirst?'GreaterThanOrEqual':'LessThanOrEqual');}}this.dropOptr=new DropDownList({dataSource:dropDatasource,fields:{text:'text',value:'value'},text:selectedValue,open:this.dropDownOpen.bind(this),enableRtl:this.parent.enableRtl});this.dropOptr.appendTo(optrInput);var operator=this.getSelectedValue(selectedValue);return{fieldElement:fieldElement,operator:operator};}},{key:'dropDownOpen',value:function dropDownOpen(args){args.popup.element.style.zIndex=(this.dialogObj.zIndex+1).toString();}},{key:'getSelectedValue',value:function getSelectedValue(text){var selectedField=new DataManager(this.optrData).executeLocal(new Query().where('text','equal',text));return!isNullOrUndefined(selectedField[0])?selectedField[0].value:'';}},{key:'dropSelectedVal',value:function dropSelectedVal(col,predicates,isFirst){var operator=void 0;if(predicates&&predicates.length>0){operator=predicates.length===2?isFirst?predicates[0].operator:predicates[1].operator:isFirst?predicates[0].operator:undefined;}else{operator=isFirst?'equal':undefined;}return this.getSelectedText(operator);}},{key:'getSelectedText',value:function getSelectedText(operator){var selectedField=new DataManager(this.optrData).executeLocal(new Query().where('value','equal',operator));return!isNullOrUndefined(selectedField[0])?selectedField[0].text:'';}},{key:'renderFilterUI',value:function renderFilterUI(column,dlgConetntEle){var predicates=this.existingPredicate[column];var table=createElement('table',{className:'e-xlfl-table'});dlgConetntEle.appendChild(table);var colGroup=createElement('colGroup');colGroup.innerHTML='<col style="width: 50%"></col><col style="width: 50%"></col>';table.appendChild(colGroup);//Renders first dropdown
/* tslint:disable-next-line:max-line-length */var optr=this.renderOperatorUI(column,table,'-xlfl-frstoptr',predicates,true);//Renders first value
this.renderFlValueUI(column,optr,'-xlfl-frstvalue',predicates,true);var predicate=createElement('tr',{className:'e-xlfl-predicate'});table.appendChild(predicate);//Renders first radion button
this.renderRadioButton(column,predicate,predicates);//Renders second dropdown
optr=this.renderOperatorUI(column,table,'-xlfl-secndoptr',predicates,false);//Renders second text box
this.renderFlValueUI(column,optr,'-xlfl-secndvalue',predicates,false);}},{key:'renderRadioButton',value:function renderRadioButton(column,tr,predicates){var td=createElement('td',{className:'e-xlfl-radio',attrs:{'colSpan':'2'}});tr.appendChild(td);var radioDiv=createElement('div',{className:'e-xlfl-radiodiv',attrs:{'style':'display: inline-block'}});/* tslint:disable-next-line:max-line-length */var frstpredicate=createElement('input',{id:column+'e-xlfl-frstpredicate',attrs:{'type':'radio'}});/* tslint:disable-next-line:max-line-length */var secndpredicate=createElement('input',{id:column+'e-xlfl-secndpredicate',attrs:{'type':'radio'}});//appends into div
radioDiv.appendChild(frstpredicate);radioDiv.appendChild(secndpredicate);td.appendChild(radioDiv);if(this.options.type==='string'){this.renderMatchCase(column,tr,td,'-xlflmtcase',predicates);}// Initialize AND RadioButton component.
/* tslint:disable-next-line:max-line-length */var andRadio=new RadioButton({label:this.getLocalizedLabel('AND'),name:'default',cssClass:'e-xlfl-radio-and',checked:true,enableRtl:this.parent.enableRtl});// Initialize OR RadioButton component.
/* tslint:disable-next-line:max-line-length */var orRadio=new RadioButton({label:this.getLocalizedLabel('OR'),name:'default',cssClass:'e-xlfl-radio-or',enableRtl:this.parent.enableRtl});var flValue=predicates&&predicates.length===2?predicates[1].predicate:'and';if(flValue==='and'){andRadio.checked=true;orRadio.checked=false;}else{orRadio.checked=true;andRadio.checked=false;}// Render initialized RadioButton.
andRadio.appendTo(frstpredicate);orRadio.appendTo(secndpredicate);}},{key:'removeObjects',value:function removeObjects(elements){var _iteratorNormalCompletion33=true;var _didIteratorError33=false;var _iteratorError33=undefined;try{for(var _iterator33=elements[Symbol.iterator](),_step33;!(_iteratorNormalCompletion33=(_step33=_iterator33.next()).done);_iteratorNormalCompletion33=true){var obj=_step33.value;if(obj&&!obj.isDestroyed){obj.destroy();}}}catch(err){_didIteratorError33=true;_iteratorError33=err;}finally{try{if(!_iteratorNormalCompletion33&&_iterator33.return){_iterator33.return();}}finally{if(_didIteratorError33){throw _iteratorError33;}}}}},{key:'renderFlValueUI',value:function renderFlValueUI(column,optr,elementId,predicates,isFirst){var value=createElement('td',{className:'e-xlfl-value'});optr.fieldElement.appendChild(value);var valueDiv=createElement('div',{className:'e-xlfl-valuediv'});var valueInput=createElement('input',{id:column+elementId});valueDiv.appendChild(valueInput);value.appendChild(valueDiv);var flValue=void 0;var predicate=void 0;if(predicates&&predicates.length>0){predicate=predicates.length===2?isFirst?predicates[0]:predicates[1]:isFirst?predicates[0]:undefined;flValue=predicate&&predicate.operator===optr.operator?predicate.value:undefined;}var types={'string':this.renderAutoComplete.bind(this),'number':this.renderNumericTextBox.bind(this),'date':this.renderDate.bind(this),'datetime':this.renderDate.bind(this)};types[this.options.type](this.options,column,valueInput,flValue,this.parent.enableRtl);}},{key:'renderMatchCase',value:function renderMatchCase(column,tr,matchCase,elementId,predicates){/* tslint:disable-next-line:max-line-length */var matchCaseDiv=createElement('div',{className:'e-xlfl-matchcasediv',attrs:{'style':'display: inline-block'}});var matchCaseInput=createElement('input',{id:column+elementId,attrs:{'type':'checkbox'}});matchCaseDiv.appendChild(matchCaseInput);matchCase.appendChild(matchCaseDiv);var flValue=predicates&&predicates.length>0?predicates&&predicates.length===2?predicates[1].matchCase:predicates[0].matchCase:false;// Initialize Match Case check box.
var checkbox=new CheckBox({label:'Match Case',enableRtl:this.parent.enableRtl,checked:flValue});// Render initialized CheckBox.
checkbox.appendTo(matchCaseInput);}},{key:'renderDate',value:function renderDate(options,column,inputValue,fValue,isRtl){var intl=new Internationalization();var format=intl.getDatePattern({type:'date',skeleton:options.format},false);this.datePicker=new DatePicker({format:format,cssClass:'e-popup-flmenu',placeholder:this.getLocalizedLabel('CustomFilterDatePlaceHolder'),width:'100%',enableRtl:isRtl,value:new Date(fValue)});this.datePicker.appendTo(inputValue);}},{key:'completeAction',value:function completeAction(e){e.result=distinctStringValues(e.result);}},{key:'renderNumericTextBox',value:function renderNumericTextBox(options,column,inputValue,fValue,isRtl){this.numericTxtObj=new NumericTextBox({format:options.format,placeholder:this.getLocalizedLabel('CustomFilterPlaceHolder'),enableRtl:isRtl,value:fValue});this.numericTxtObj.appendTo(inputValue);}},{key:'renderAutoComplete',value:function renderAutoComplete(options,column,inputValue,fValue,isRtl){var _this87=this;var colObj=this.parent.getColumnByField(column);var isForeignColumn=colObj.isForeignColumn();var dataSource=isForeignColumn?colObj.dataSource:options.dataSource;var fields={value:isForeignColumn?colObj.foreignKeyValue:column};var actObj=new AutoComplete({dataSource:dataSource instanceof DataManager?dataSource:new DataManager(dataSource),fields:fields,sortOrder:'Ascending',locale:this.parent.locale,autofill:true,focus:function focus(){actObj.filterType=_this87.dlgDiv.querySelector('#'+column+(inputValue.id===column+'-xlfl-frstvalue'?'-xlfl-frstoptr':'-xlfl-secndoptr')).ej2_instances[0].value;actObj.ignoreCase=options.type==='string'?!_this87.dlgDiv.querySelector('#'+column+'-xlflmtcase').ej2_instances[0].checked:true;actObj.filterType=!isNullOrUndefined(actObj.filterType)?actObj.filterType:'equal';},placeholder:this.getLocalizedLabel('CustomFilterPlaceHolder'),enableRtl:isRtl,actionComplete:function actionComplete(e){e.result=e.result.filter(function(obj,index,arr){return arr.map(function(mapObject){return mapObject[actObj.fields.value];}).indexOf(obj[_this87.actObj.fields.value])===index;});},value:fValue});actObj.appendTo(inputValue);this.actObj=actObj;}},{key:'getModuleName',value:function getModuleName(){return'excelFilter';}}]);return ExcelFilter;}(CheckBoxFilter));_export('Filter',Filter=function(){/**
     * Constructor for Grid filtering module
     * @hidden
     */function Filter(parent,filterSettings,serviceLocator){_classCallCheck(this,Filter);this.predicate='and';this.contentRefresh=true;this.values={};this.nextFlMenuOpen='';this.type={'Menu':FilterMenuRenderer,'CheckBox':CheckBoxFilter,'Excel':ExcelFilter};this.filterOperators={contains:'contains',endsWith:'endswith',equal:'equal',greaterThan:'greaterthan',greaterThanOrEqual:'greaterthanorequal',lessThan:'lessthan',lessThanOrEqual:'lessthanorequal',notEqual:'notequal',startsWith:'startswith'};this.fltrDlgDetails={field:'',isOpen:false};this.actualPredicate={};this.parent=parent;this.filterSettings=filterSettings;this.serviceLocator=serviceLocator;this.addEventListener();}/**
     * To render filter bar when filtering enabled.
     * @return {void}
     * @hidden
     */_createClass(Filter,[{key:'render',value:function render(e){if(DataUtil.getObject('args.isFrozen',e)){return;}var gObj=this.parent;this.l10n=this.serviceLocator.getService('localization');this.getLocalizedCustomOperators();if(this.parent.filterSettings.type==='FilterBar'){if(gObj.columns.length){var fltrElem=this.parent.element.querySelector('.e-filterbar');if(fltrElem){remove(fltrElem);}var rowRenderer=new RowRenderer(this.serviceLocator,CellType.Filter,gObj);var row=void 0;var cellrender=this.serviceLocator.getService('cellRendererFactory');cellrender.addCellRenderer(CellType.Filter,new FilterCellRenderer(this.parent,this.serviceLocator));this.valueFormatter=this.serviceLocator.getService('valueFormatter');rowRenderer.element=createElement('tr',{className:'e-filterbar'});row=this.generateRow();row.data=this.values;this.parent.getHeaderContent().querySelector('thead').appendChild(rowRenderer.element);this.element=rowRenderer.render(row,gObj.getColumns(),null,null,rowRenderer.element);var detail=this.element.querySelector('.e-detailheadercell');if(detail){detail.className='e-filterbarcell e-mastercell';}var gCells=[].slice.call(this.element.querySelectorAll('.e-grouptopleftcell'));if(gCells.length){gCells[gCells.length-1].classList.add('e-lastgrouptopleftcell');}this.wireEvents();this.parent.notify(freezeRender,{case:'filter'});}}}},{key:'destroy',value:function destroy(){if(this.filterModule){this.filterModule.destroy();}this.filterSettings.columns=[];this.updateFilterMsg();this.removeEventListener();this.unWireEvents();if(this.element){remove(this.element);if(this.parent.getFrozenColumns()){remove(this.parent.getHeaderContent().querySelector('.e-filterbar'));}}}},{key:'generateRow',value:function generateRow(index){var options={};var row=new Row(options);row.cells=this.generateCells();return row;}},{key:'generateCells',value:function generateCells(){//TODO: generate dummy column for group, detail, stacked row here for filtering;
var cells=[];if(this.parent.allowGrouping){for(var c=0,len=this.parent.groupSettings.columns.length;c<len;c++){cells.push(this.generateCell({},CellType.HeaderIndent));}}if(this.parent.detailTemplate||this.parent.childGrid){cells.push(this.generateCell({},CellType.DetailHeader));}var _iteratorNormalCompletion34=true;var _didIteratorError34=false;var _iteratorError34=undefined;try{for(var _iterator34=this.parent.getColumns()[Symbol.iterator](),_step34;!(_iteratorNormalCompletion34=(_step34=_iterator34.next()).done);_iteratorNormalCompletion34=true){var dummy=_step34.value;cells.push(this.generateCell(dummy));}}catch(err){_didIteratorError34=true;_iteratorError34=err;}finally{try{if(!_iteratorNormalCompletion34&&_iterator34.return){_iterator34.return();}}finally{if(_didIteratorError34){throw _iteratorError34;}}}return cells;}},{key:'generateCell',value:function generateCell(column,cellType){var opt={'visible':column.visible,'isDataCell':false,'rowId':'','column':column,'cellType':cellType?cellType:CellType.Filter,'attributes':{title:this.l10n.getConstant('FilterbarTitle')}};return new Cell(opt);}},{key:'updateModel',value:function updateModel(){var col=this.parent.getColumnByField(this.fieldName);var field=col.isForeignColumn()?col.foreignKeyValue:this.fieldName;this.currentFilterObject={field:field,operator:this.operator,value:this.value,predicate:this.predicate,matchCase:this.matchCase,ignoreAccent:this.ignoreAccent,actualFilterValue:{},actualOperator:{}};var index=this.getFilteredColsIndexByField(col);if(index>-1){this.filterSettings.columns[index]=this.currentFilterObject;}else{this.filterSettings.columns.push(this.currentFilterObject);}this.filterSettings.columns=this.filterSettings.columns;this.parent.dataBind();}},{key:'getFilteredColsIndexByField',value:function getFilteredColsIndexByField(col){var cols=this.filterSettings.columns;for(var i=0,len=cols.length;i<len;i++){if(cols[i].field===col.field||col.isForeignColumn()&&cols[i].field===col.foreignKeyValue){return i;}}return-1;}},{key:'onActionComplete',value:function onActionComplete(e){var args=!this.isRemove?{currentFilterObject:this.currentFilterObject,currentFilteringColumn:this.column.field,columns:this.filterSettings.columns,requestType:'filtering',type:actionComplete}:{requestType:'filtering',type:actionComplete};this.parent.trigger(actionComplete,extend(e,args));this.isRemove=false;}},{key:'wireEvents',value:function wireEvents(){EventHandler.add(this.parent.getHeaderContent(),'keyup',this.keyUpHandler,this);}},{key:'unWireEvents',value:function unWireEvents(){EventHandler.remove(this.parent.getHeaderContent(),'keyup',this.keyUpHandler);}},{key:'enableAfterRender',value:function enableAfterRender(e){if(e.module===this.getModuleName()&&e.enable){this.render();}}},{key:'initialEnd',value:function initialEnd(){this.parent.off(contentReady,this.initialEnd);if(this.parent.getColumns().length&&this.filterSettings.columns.length){var gObj=this.parent;this.contentRefresh=false;var _iteratorNormalCompletion35=true;var _didIteratorError35=false;var _iteratorError35=undefined;try{for(var _iterator35=gObj.filterSettings.columns[Symbol.iterator](),_step35;!(_iteratorNormalCompletion35=(_step35=_iterator35.next()).done);_iteratorNormalCompletion35=true){var col=_step35.value;this.filterByColumn(col.field,col.operator,col.value,col.predicate,col.matchCase,col.ignoreAccent,col.actualFilterValue,col.actualOperator);}}catch(err){_didIteratorError35=true;_iteratorError35=err;}finally{try{if(!_iteratorNormalCompletion35&&_iterator35.return){_iterator35.return();}}finally{if(_didIteratorError35){throw _iteratorError35;}}}this.updateFilterMsg();this.contentRefresh=true;}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(uiUpdate,this.enableAfterRender,this);this.parent.on(filterComplete,this.onActionComplete,this);this.parent.on(inBoundModelChanged,this.onPropertyChanged,this);this.parent.on(keyPressed,this.keyUpHandler,this);this.parent.on(columnPositionChanged,this.columnPositionChanged,this);this.parent.on(headerRefreshed,this.render,this);this.parent.on(contentReady,this.initialEnd,this);this.parent.on(filterMenuClose,this.filterMenuClose,this);EventHandler.add(document,'click',this.clickHandler,this);this.parent.on(filterOpen,this.columnMenuFilter,this);this.parent.on(click,this.filterIconClickHandler,this);}},{key:'removeEventListener',value:function removeEventListener(){EventHandler.remove(document,'click',this.clickHandler);if(this.parent.isDestroyed){return;}this.parent.off(uiUpdate,this.enableAfterRender);this.parent.off(filterComplete,this.onActionComplete);this.parent.off(inBoundModelChanged,this.onPropertyChanged);this.parent.off(keyPressed,this.keyUpHandler);this.parent.off(columnPositionChanged,this.columnPositionChanged);this.parent.off(headerRefreshed,this.render);this.parent.off(filterOpen,this.columnMenuFilter);this.parent.off(filterMenuClose,this.filterMenuClose);this.parent.off(click,this.filterIconClickHandler);}},{key:'filterMenuClose',value:function filterMenuClose(args){this.fltrDlgDetails.isOpen=false;}},{key:'filterByColumn',value:function filterByColumn(fieldName,filterOperator,filterValue,predicate,matchCase,ignoreAccent,actualFilterValue,actualOperator){var gObj=this.parent;var filterCell=void 0;this.column=gObj.getColumnByField(fieldName);if(this.filterSettings.type==='FilterBar'){filterCell=gObj.getHeaderContent().querySelector('[id=\''+this.column.field+'_filterBarcell\']');}if(!isNullOrUndefined(this.column.allowFiltering)&&!this.column.allowFiltering){return;}if(_isActionPrevent(gObj)){gObj.notify(preventBatch,{instance:this,handler:this.filterByColumn,arg1:fieldName,arg2:filterOperator,arg3:filterValue,arg4:predicate,arg5:matchCase,arg6:ignoreAccent,arg7:actualFilterValue,arg8:actualOperator});return;}this.value=filterValue;this.matchCase=matchCase||false;this.ignoreAccent=this.ignoreAccent=!isNullOrUndefined(ignoreAccent)?ignoreAccent:this.parent.filterSettings.ignoreAccent;this.fieldName=fieldName;this.predicate=predicate||'and';this.operator=filterOperator;filterValue=!isNullOrUndefined(filterValue)&&filterValue.toString();if(this.column.type==='number'||this.column.type==='date'){this.matchCase=true;}gObj.getColumnHeaderByField(fieldName).setAttribute('aria-filtered','true');if(filterValue.length<1||this.checkForSkipInput(this.column,filterValue)){this.filterStatusMsg=filterValue.length<1?'':this.l10n.getConstant('InvalidFilterMessage');this.updateFilterMsg();return;}if(this.filterSettings.type==='FilterBar'&&filterCell.value!==filterValue){filterCell.value=filterValue;}if(this.checkAlreadyColFiltered(this.column.field)){return;}if(!isNullOrUndefined(this.column.format)){this.applyColumnFormat(filterValue);}else{this.values[this.column.field]=filterValue;//this line should be above updateModel
}this.updateModel();}},{key:'applyColumnFormat',value:function applyColumnFormat(filterValue){var getFlvalue=this.column.type==='date'||this.column.type==='datetime'?new Date(filterValue):parseFloat(filterValue);this.values[this.column.field]=this.setFormatForFlColumn(getFlvalue,this.column);}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}var _iteratorNormalCompletion36=true;var _didIteratorError36=false;var _iteratorError36=undefined;try{for(var _iterator36=Object.keys(e.properties)[Symbol.iterator](),_step36;!(_iteratorNormalCompletion36=(_step36=_iterator36.next()).done);_iteratorNormalCompletion36=true){var prop=_step36.value;switch(prop){case'columns':if(this.contentRefresh){this.parent.notify(modelChanged,{currentFilterObject:this.currentFilterObject,currentFilteringColumn:this.column?this.column.field:undefined,columns:this.filterSettings.columns,requestType:'filtering',type:actionBegin});this.refreshFilterSettings();this.updateFilterMsg();}break;case'showFilterBarStatus':if(e.properties[prop]){this.updateFilterMsg();}else if(this.parent.allowPaging){this.parent.updateExternalMessage('');}break;case'type':this.parent.refreshHeader();break;}}}catch(err){_didIteratorError36=true;_iteratorError36=err;}finally{try{if(!_iteratorNormalCompletion36&&_iterator36.return){_iterator36.return();}}finally{if(_didIteratorError36){throw _iteratorError36;}}}}},{key:'refreshFilterSettings',value:function refreshFilterSettings(){if(this.filterSettings.type==='FilterBar'){for(var i=0;i<this.filterSettings.columns.length;i++){var filterValue=this.filterSettings.columns[i].value;filterValue=!isNullOrUndefined(filterValue)&&filterValue.toString();if(!isNullOrUndefined(this.column.format)){this.applyColumnFormat(filterValue);}else{var key=this.filterSettings.columns[i].field;this.values[key]=this.filterSettings.columns[i].value;}var selector='[id=\''+this.filterSettings.columns[i].field+'_filterBarcell\']';var filterElement=this.element.querySelector(selector);if(filterElement){filterElement.value=this.filterSettings.columns[i].value;}}}}},{key:'clearFiltering',value:function clearFiltering(){var cols=getActualPropFromColl(this.filterSettings.columns);if(_isActionPrevent(this.parent)){this.parent.notify(preventBatch,{instance:this,handler:this.clearFiltering});return;}for(var i=0,len=cols.length;i<len;i++){this.removeFilteredColsByField(cols[i].field,false);}if(this.parent.filterSettings.columns.length===0&&this.parent.element.querySelector('.e-filtered')){var fltrElement=[].slice.call(this.parent.element.querySelectorAll('.e-filtered'));for(var _i11=0,_len9=fltrElement.length;_i11<_len9;_i11++){fltrElement[0].removeAttribute('aria-filtered');fltrElement[0].classList.remove('e-filtered');}}this.isRemove=true;this.filterStatusMsg='';this.updateFilterMsg();}},{key:'checkAlreadyColFiltered',value:function checkAlreadyColFiltered(field){var columns=this.filterSettings.columns;var _iteratorNormalCompletion37=true;var _didIteratorError37=false;var _iteratorError37=undefined;try{for(var _iterator37=columns[Symbol.iterator](),_step37;!(_iteratorNormalCompletion37=(_step37=_iterator37.next()).done);_iteratorNormalCompletion37=true){var col=_step37.value;if(col.field===field&&col.value===this.value&&col.operator===this.operator&&col.predicate===this.predicate){return true;}}}catch(err){_didIteratorError37=true;_iteratorError37=err;}finally{try{if(!_iteratorNormalCompletion37&&_iterator37.return){_iterator37.return();}}finally{if(_didIteratorError37){throw _iteratorError37;}}}return false;}},{key:'columnMenuFilter',value:function columnMenuFilter(args){this.column=args.col;var ele=closest(args.target,'#'+args.id);if(args.isClose&&!ele){this.filterModule.closeDialog();}else if(ele){this.filterDialogOpen(this.column,args.target);}}},{key:'filterDialogOpen',value:function filterDialogOpen(col,target,left,top){var gObj=this.parent;if(this.filterModule){this.filterModule.closeDialog();}this.filterModule=new this.type[col.filter.type||this.parent.filterSettings.type](this.parent,gObj.filterSettings,this.serviceLocator,this.customOperators,this);var dataSource=col.filter.dataSource||gObj.getDataModule().dataManager;this.filterModule.openDialog({type:col.type,field:col.field,displayName:col.headerText,dataSource:dataSource,format:col.format,filteredColumns:gObj.filterSettings.columns,target:target,sortedColumns:gObj.sortSettings.columns,formatFn:col.getFormatter(),parserFn:col.getParser(),query:gObj.query,template:col.getFilterItemTemplate(),hideSearchbox:isNullOrUndefined(col.filter.hideSearchbox)?false:col.filter.hideSearchbox,handler:this.filterHandler.bind(this),localizedStrings:gObj.getLocaleConstants(),position:{X:left,Y:top},column:col,foreignKeyValue:col.foreignKeyValue,actualPredicate:this.actualPredicate});}},{key:'removeFilteredColsByField',value:function removeFilteredColsByField(field,isClearFilterBar){var fCell=void 0;var cols=this.filterSettings.columns;if(_isActionPrevent(this.parent)){var args={instance:this,handler:this.removeFilteredColsByField,arg1:field,arg2:isClearFilterBar};this.parent.notify(preventBatch,args);return;}for(var i=0,len=cols.length;i<len;i++){var column=this.parent.getColumnByField(field)||getColumnByForeignKeyValue(field,this.parent.getForeignKeyColumns());if(cols[i].field===field||cols[i].field===column.foreignKeyValue){if(this.filterSettings.type==='FilterBar'&&!isClearFilterBar){var selector='[id=\''+cols[i].field+'_filterBarcell\']';fCell=this.parent.getHeaderContent().querySelector(selector);delete this.values[field];}cols.splice(i,1);var fltrElement=this.parent.getColumnHeaderByField(column.field);fltrElement.removeAttribute('aria-filtered');if(this.filterSettings.type!=='FilterBar'){var iconClass=this.parent.showColumnMenu?'.e-columnmenu':'.e-icon-filter';fltrElement.querySelector(iconClass).classList.remove('e-filtered');}this.isRemove=true;this.parent.notify(modelChanged,{requestType:'filtering',type:actionBegin});break;}}this.updateFilterMsg();}},{key:'getModuleName',value:function getModuleName(){return'filter';}},{key:'keyUpHandler',value:function keyUpHandler(e){var gObj=this.parent;var target=e.target;if(target&&matches(target,'.e-filterbar input')){this.column=gObj.getColumnByField(target.id.split('_')[0]);if(!this.column){return;}if((this.filterSettings.mode==='Immediate'||e.keyCode===13)&&e.keyCode!==9){this.value=target.value.trim();this.processFilter(e);}}}},{key:'updateCrossIcon',value:function updateCrossIcon(element){if(element.value.length){element.nextElementSibling.classList.remove('e-hide');}}},{key:'updateFilterMsg',value:function updateFilterMsg(){if(this.filterSettings.type==='FilterBar'){var gObj=this.parent;var columns=this.filterSettings.columns;var formater=this.serviceLocator.getService('valueFormatter');var column=void 0;if(!this.filterSettings.showFilterBarStatus){return;}if(columns.length>0&&this.filterStatusMsg!==this.l10n.getConstant('InvalidFilterMessage')){this.filterStatusMsg='';for(var index=0;index<columns.length;index++){column=gObj.getColumnByField(columns[index].field)||getColumnByForeignKeyValue(columns[index].field,this.parent.getForeignKeyColumns());if(index){this.filterStatusMsg+=' && ';}if(!isNullOrUndefined(column.format)){var flValue=column.type==='date'||column.type==='datetime'?new Date(this.values[column.field]):this.values[column.field];var getFormatFlValue=this.setFormatForFlColumn(flValue,column);this.filterStatusMsg+=column.headerText+': '+getFormatFlValue;}else{this.filterStatusMsg+=column.headerText+': '+this.values[column.field];}}}if(gObj.allowPaging){gObj.updateExternalMessage(this.filterStatusMsg);}//TODO: virtual paging       
this.filterStatusMsg='';}}},{key:'setFormatForFlColumn',value:function setFormatForFlColumn(value,column){var formater=this.serviceLocator.getService('valueFormatter');return formater.toView(value,column.getFormatter()).toString();}},{key:'checkForSkipInput',value:function checkForSkipInput(column,value){var isSkip=void 0;var skipInput=void 0;if(column.type==='number'){skipInput=['=',' ','!'];if(DataUtil.operatorSymbols[value]||skipInput.indexOf(value)>-1){isSkip=true;}}else if(column.type==='string'){skipInput=['>','<','=','!'];var _iteratorNormalCompletion38=true;var _didIteratorError38=false;var _iteratorError38=undefined;try{for(var _iterator38=value[Symbol.iterator](),_step38;!(_iteratorNormalCompletion38=(_step38=_iterator38.next()).done);_iteratorNormalCompletion38=true){var val=_step38.value;if(skipInput.indexOf(val)>-1){isSkip=true;}}}catch(err){_didIteratorError38=true;_iteratorError38=err;}finally{try{if(!_iteratorNormalCompletion38&&_iterator38.return){_iterator38.return();}}finally{if(_didIteratorError38){throw _iteratorError38;}}}}return isSkip;}},{key:'processFilter',value:function processFilter(e){this.stopTimer();this.startTimer(e);}},{key:'startTimer',value:function startTimer(e){var _this88=this;this.timer=window.setInterval(function(){_this88.onTimerTick();},e.keyCode===13?0:this.filterSettings.immediateModeDelay);}},{key:'stopTimer',value:function stopTimer(){window.clearInterval(this.timer);}},{key:'onTimerTick',value:function onTimerTick(){var selector='[id=\''+this.column.field+'_filterBarcell\']';var filterElement=this.element.querySelector(selector);if(!filterElement&&this.parent.getFrozenColumns()){filterElement=this.parent.getHeaderContent().querySelector(selector);}var filterValue=JSON.parse(JSON.stringify(filterElement.value));this.stopTimer();if(!isNullOrUndefined(this.column.filterBarTemplate)){var templateRead=this.column.filterBarTemplate.read;if(typeof templateRead==='string'){templateRead=getValue(templateRead,window);}this.value=templateRead.call(this,filterElement);}if(this.value===''){this.removeFilteredColsByField(this.column.field);return;}this.validateFilterValue(this.value);this.filterByColumn(this.column.field,this.operator,this.value,this.predicate,this.matchCase,this.ignoreAccent);filterElement.value=filterValue;this.updateFilterMsg();}},{key:'validateFilterValue',value:function validateFilterValue(value){var gObj=this.parent;var skipInput=void 0;var index=void 0;this.matchCase=true;switch(this.column.type){case'number':this.operator=this.filterOperators.equal;skipInput=['>','<','=','!'];for(var i=0;i<value.length;i++){if(skipInput.indexOf(value[i])>-1){index=i;break;}}this.getOperator(value.substring(index));if(index!==0){this.value=value.substring(0,index);}if(this.value!==''&&value.length>=1){this.value=this.valueFormatter.fromView(this.value,this.column.getParser(),this.column.type);}if(isNaN(this.value)){this.filterStatusMsg=this.l10n.getConstant('InvalidFilterMessage');}break;case'date':case'datetime':this.operator=this.filterOperators.equal;this.getOperator(value);if(this.value!==''){this.value=this.valueFormatter.fromView(this.value,this.column.getParser(),this.column.type);if(isNullOrUndefined(this.value)){this.filterStatusMsg=this.l10n.getConstant('InvalidFilterMessage');}}break;case'string':this.matchCase=false;if(value.charAt(0)==='*'){this.value=this.value.slice(1);this.operator=this.filterOperators.startsWith;}else if(value.charAt(value.length-1)==='%'){this.value=this.value.slice(0,-1);this.operator=this.filterOperators.startsWith;}else if(value.charAt(0)==='%'){this.value=this.value.slice(1);this.operator=this.filterOperators.endsWith;}else{this.operator=this.filterOperators.startsWith;}break;case'boolean':if(value.toLowerCase()==='true'||value==='1'){this.value=true;}else if(value.toLowerCase()==='false'||value==='0'){this.value=false;}else if(value.length){this.filterStatusMsg=this.l10n.getConstant('InvalidFilterMessage');}this.operator=this.filterOperators.equal;break;default:this.operator=this.filterOperators.equal;}}},{key:'getOperator',value:function getOperator(value){var singleOp=value.charAt(0);var multipleOp=value.slice(0,2);var operators=extend({'=':this.filterOperators.equal,'!':this.filterOperators.notEqual},DataUtil.operatorSymbols);if(operators.hasOwnProperty(singleOp)||operators.hasOwnProperty(multipleOp)){this.operator=operators[singleOp];this.value=value.substring(1);if(!this.operator){this.operator=operators[multipleOp];this.value=value.substring(2);}}if(this.operator===this.filterOperators.lessThan||this.operator===this.filterOperators.greaterThan){if(this.value.charAt(0)==='='){this.operator=this.operator+'orequal';this.value=this.value.substring(1);}}}},{key:'columnPositionChanged',value:function columnPositionChanged(e){if(this.parent.filterSettings.type!=='FilterBar'){return;}}},{key:'getLocalizedCustomOperators',value:function getLocalizedCustomOperators(){var numOptr=[{value:'equal',text:this.l10n.getConstant('Equal')},{value:'greaterthan',text:this.l10n.getConstant('GreaterThan')},{value:'greaterthanorequal',text:this.l10n.getConstant('GreaterThanOrEqual')},{value:'lessthan',text:this.l10n.getConstant('LessThan')},{value:'lessthanorequal',text:this.l10n.getConstant('LessThanOrEqual')},{value:'notequal',text:this.l10n.getConstant('NotEqual')}];this.customOperators={stringOperator:[{value:'startswith',text:this.l10n.getConstant('StartsWith')},{value:'endswith',text:this.l10n.getConstant('EndsWith')},{value:'contains',text:this.l10n.getConstant('Contains')},{value:'equal',text:this.l10n.getConstant('Equal')},{value:'notequal',text:this.l10n.getConstant('NotEqual')}],numberOperator:numOptr,dateOperator:numOptr,datetimeOperator:numOptr,booleanOperator:[{value:'equal',text:this.l10n.getConstant('Equal')},{value:'notequal',text:this.l10n.getConstant('NotEqual')}]};}},{key:'filterIconClickHandler',value:function filterIconClickHandler(e){var target=e.target;if(target.classList.contains('e-filtermenudiv')&&(this.parent.filterSettings.type==='Menu'||this.parent.filterSettings.type==='CheckBox'||this.parent.filterSettings.type==='Excel')){var gObj=this.parent;var col=gObj.getColumnByUid(parentsUntil(target,'e-headercell').firstElementChild.getAttribute('e-mappinguid'));var gClient=gObj.element.getBoundingClientRect();var fClient=target.getBoundingClientRect();this.column=col;if(this.fltrDlgDetails.field===col.field&&this.fltrDlgDetails.isOpen){return;}if(this.filterModule){this.filterModule.closeDialog();}this.fltrDlgDetails={field:col.field,isOpen:true};this.filterDialogOpen(this.column,target,fClient.right-gClient.left,fClient.bottom-gClient.top);}}},{key:'clickHandler',value:function clickHandler(e){if(this.filterSettings.mode==='Immediate'||this.parent.filterSettings.type==='Menu'||this.parent.filterSettings.type==='CheckBox'||this.parent.filterSettings.type==='Excel'){var gObj=this.parent;var target=e.target;var datepickerEle=target.classList.contains('e-day');// due to datepicker popup cause
if(parentsUntil(target,'e-filter-popup')||target.classList.contains('e-filtermenudiv')){return;}else if(this.filterModule&&!parentsUntil(target,'e-popup-wrapper')&&!closest(target,'.e-filter-item.e-menu-item')&&!parentsUntil(target,'e-popup')&&!datepickerEle){this.filterModule.closeDialog(target);}if(this.filterSettings.mode==='Immediate'&&target.classList.contains('e-clear-icon')){var targetText=target.previousElementSibling;this.removeFilteredColsByField(targetText.id.slice(0,-14));//Length of _filterBarcell = 14
}}}},{key:'filterHandler',value:function filterHandler(args){var filterIconElement=void 0;this.actualPredicate[args.field]=args.actualPredicate;var dataManager=new DataManager(this.filterSettings.columns);var query=new Query().where('field',this.filterOperators.equal,args.field);var result=dataManager.executeLocal(query);for(var i=0;i<result.length;i++){var index=-1;for(var j=0;j<this.filterSettings.columns.length;j++){if(result[i].field===this.filterSettings.columns[j].field){index=j;break;}}if(index!==-1){this.filterSettings.columns.splice(index,1);}}var iconClass=this.parent.showColumnMenu?'.e-columnmenu':'.e-icon-filter';filterIconElement=this.parent.getColumnHeaderByField(args.field).querySelector(iconClass);if(args.action==='filtering'){this.filterSettings.columns=this.filterSettings.columns.concat(args.filterCollection);if(this.filterSettings.columns.length&&filterIconElement){filterIconElement.classList.add('e-filtered');}}else{if(filterIconElement){filterIconElement.classList.remove('e-filtered');}this.parent.refresh();//hot-fix onpropertychanged not working for object { array }           
}this.parent.dataBind();}}]);return Filter;}());_export('resizeClassList',resizeClassList={root:'e-rhandler',suppress:'e-rsuppress',icon:'e-ricon',helper:'e-rhelper',header:'th.e-headercell',cursor:'e-rcursor'});_export('Resize',Resize=function(){/**
     * Constructor for the Grid resize module
     * @hidden
     */function Resize(parent){_classCallCheck(this,Resize);this.tapped=false;this.isDblClk=true;this.parent=parent;if(this.parent.isDestroyed){return;}this.widthService=new ColumnWidthService(parent);this.addEventListener();}/**
     * Resize by field names.
     * @param  {string|string[]} fName - Defines the field name.
     * @return {void}
     */_createClass(Resize,[{key:'autoFitColumns',value:function autoFitColumns(fName){var columnName=fName===undefined||fName===null||fName.length<=0?this.parent.getColumns().map(function(x){return x.field;}):typeof fName==='string'?[fName]:fName;this.findColumn(columnName);}},{key:'resizeColumn',value:function resizeColumn(fName,index,id){var gObj=this.parent;var tWidth=0;var headerTable=void 0;var contentTable=void 0;var headerDivTag='e-gridheader';var contentDivTag='e-gridcontent';var indentWidth=0;var uid=id?id:this.parent.getUidByColumnField(fName);var columnIndex=this.parent.getNormalizedColumnIndex(uid);var headerTextClone=void 0;var contentTextClone=void 0;var frzCols=gObj.getFrozenColumns();if(frzCols){if(index<frzCols){headerTable=gObj.getHeaderTable();contentTable=gObj.getContentTable();headerTextClone=headerTable.querySelectorAll('th')[columnIndex].cloneNode(true);contentTextClone=contentTable.querySelectorAll('td:nth-child('+(columnIndex+1)+')');}else{headerTable=gObj.getHeaderContent().querySelector('.e-movableheader').children[0];contentTable=gObj.getContent().querySelector('.e-movablecontent').children[0];headerTextClone=headerTable.querySelectorAll('th')[columnIndex-frzCols].cloneNode(true);contentTextClone=contentTable.querySelectorAll('td:nth-child('+(columnIndex-frzCols+1)+')');}}else{headerTable=gObj.getHeaderTable();contentTable=gObj.getContentTable();headerTextClone=headerTable.querySelectorAll('th')[columnIndex].cloneNode(true);contentTextClone=contentTable.querySelectorAll('td:nth-child('+(columnIndex+1)+'):not(.e-groupcaption)');}var indentWidthClone=headerTable.querySelector('tr').querySelectorAll('.e-grouptopleftcell');if(indentWidthClone.length>0){for(var i=0;i<indentWidthClone.length;i++){indentWidth+=indentWidthClone[i].offsetWidth;}}var headerText=[headerTextClone];var contentText=[];for(var _i12=0;_i12<contentTextClone.length;_i12++){contentText[_i12]=contentTextClone[_i12].cloneNode(true);}var wHeader=this.createTable(headerTable,headerText,headerDivTag);var wContent=this.createTable(contentTable,contentText,contentDivTag);var columnbyindex=gObj.getColumns()[index];var result=void 0;var width=wHeader>wContent?columnbyindex.width=formatUnit(wHeader):columnbyindex.width=formatUnit(wContent);this.widthService.setColumnWidth(gObj.getColumns()[index]);result=gObj.getColumns().some(function(x){return x.width===null||x.width===undefined||x.width.length<=0;});if(result===false){gObj.getColumns().forEach(function(element){if(element.visible){tWidth=tWidth+parseInt(element.width,10);}});}var calcTableWidth=tWidth+indentWidth;if(tWidth>0&&!gObj.getFrozenColumns()){headerTable.style.width=formatUnit(calcTableWidth);contentTable.style.width=formatUnit(calcTableWidth);}var tableWidth=headerTable.offsetWidth;var contentwidth=gObj.getContent().scrollWidth;if(contentwidth>tableWidth){headerTable.classList.add('e-tableborder');contentTable.classList.add('e-tableborder');}else{headerTable.classList.remove('e-tableborder');contentTable.classList.remove('e-tableborder');}}},{key:'destroy',value:function destroy(){this.widthService=null;this.unwireEvents();this.removeEventListener();}},{key:'getModuleName',value:function getModuleName(){return'resize';}},{key:'findColumn',value:function findColumn(fName){var _this89=this;fName.forEach(function(element){var fieldName=element;var columnIndex=_this89.parent.getColumnIndexByField(fieldName);if(_this89.parent.getColumns()[columnIndex].visible===true){_this89.resizeColumn(fieldName,columnIndex);}});}},{key:'createTable',value:function createTable(table,text,tag){var myTableDiv=createElement('div');myTableDiv.className=this.parent.element.className;myTableDiv.style.cssText='display: inline-block;visibility:hidden;position:absolute';var mySubDiv=createElement('div');mySubDiv.className=tag;var myTable=createElement('table');myTable.className=table.className;myTable.style.cssText='table-layout: auto;width: auto';var myTr=createElement('tr');text.forEach(function(element){var tr=myTr.cloneNode();tr.className=table.querySelector('tr').className;tr.appendChild(element);myTable.appendChild(tr);});mySubDiv.appendChild(myTable);myTableDiv.appendChild(mySubDiv);document.body.appendChild(myTableDiv);var offsetWidthValue=myTable.getBoundingClientRect().width;document.body.removeChild(myTableDiv);return Math.ceil(offsetWidthValue);}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(headerRefreshed,this.render,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(headerRefreshed,this.render);}},{key:'render',value:function render(){this.unwireEvents();this.wireEvents();this.setHandlerHeight();}},{key:'wireEvents',value:function wireEvents(){var _this90=this;this.getResizeHandlers().forEach(function(ele){ele.style.height=ele.parentElement.offsetHeight+'px';EventHandler.add(ele,Browser.touchStartEvent,_this90.resizeStart,_this90);EventHandler.add(ele,dblclick,_this90.callAutoFit,_this90);});}},{key:'unwireEvents',value:function unwireEvents(){var _this91=this;this.getResizeHandlers().forEach(function(ele){EventHandler.remove(ele,Browser.touchStartEvent,_this91.resizeStart);EventHandler.remove(ele,dblclick,_this91.callAutoFit);});}},{key:'getResizeHandlers',value:function getResizeHandlers(){return this.parent.getFrozenColumns()?[].slice.call(this.parent.getHeaderContent().querySelectorAll('.'+resizeClassList.root)):[].slice.call(this.parent.getHeaderTable().querySelectorAll('.'+resizeClassList.root));}},{key:'setHandlerHeight',value:function setHandlerHeight(){[].slice.call(this.parent.getHeaderTable().querySelectorAll('.'+resizeClassList.suppress)).forEach(function(ele){ele.style.height=ele.parentElement.offsetHeight+'px';});}},{key:'callAutoFit',value:function callAutoFit(e){var col=this.getTargetColumn(e);this.resizeColumn(col.field,this.parent.getNormalizedColumnIndex(col.uid),col.uid);var header=closest(e.target,resizeClassList.header);header.classList.add('e-resized');}},{key:'resizeStart',value:function resizeStart(e){if(!this.helper){if(this.getScrollBarWidth()===0){var _iteratorNormalCompletion39=true;var _didIteratorError39=false;var _iteratorError39=undefined;try{for(var _iterator39=this.refreshColumnWidth()[Symbol.iterator](),_step39;!(_iteratorNormalCompletion39=(_step39=_iterator39.next()).done);_iteratorNormalCompletion39=true){var col=_step39.value;this.widthService.setColumnWidth(col);}}catch(err){_didIteratorError39=true;_iteratorError39=err;}finally{try{if(!_iteratorNormalCompletion39&&_iterator39.return){_iterator39.return();}}finally{if(_didIteratorError39){throw _iteratorError39;}}}this.widthService.setWidthToTable();}this.element=e.target;this.parentElementWidth=this.parent.element.getBoundingClientRect().width;this.appendHelper();this.column=this.getTargetColumn(e);this.pageX=this.getPointX(e);if(this.parent.enableRtl){this.minMove=parseInt(this.column.width.toString(),10)-(this.column.minWidth?parseInt(this.column.minWidth.toString(),10):0);}else{this.minMove=(this.column.minWidth?parseInt(this.column.minWidth.toString(),10):0)-parseInt(this.column.width.toString(),10);}this.minMove+=this.pageX;}if(Browser.isDevice&&!this.helper.classList.contains(resizeClassList.icon)){this.helper.classList.add(resizeClassList.icon);EventHandler.add(document,Browser.touchStartEvent,this.removeHelper,this);EventHandler.add(this.helper,Browser.touchStartEvent,this.resizeStart,this);}else{var args={e:e,column:this.column};this.parent.trigger(_resizeStart,args);if(args.cancel){this.cancelResizeAction();return;}EventHandler.add(document,Browser.touchEndEvent,this.resizeEnd,this);EventHandler.add(this.parent.element,Browser.touchMoveEvent,this.resizing,this);this.updateCursor('add');}}},{key:'cancelResizeAction',value:function cancelResizeAction(removeEvents){if(removeEvents){EventHandler.remove(this.parent.element,Browser.touchMoveEvent,this.resizing);EventHandler.remove(document,Browser.touchEndEvent,this.resizeEnd);this.updateCursor('remove');}if(Browser.isDevice){EventHandler.remove(document,Browser.touchStartEvent,this.removeHelper);EventHandler.remove(this.helper,Browser.touchStartEvent,this.resizeStart);}detach(this.helper);this.refresh();}},{key:'getWidth',value:function getWidth(width,minWidth,maxWidth){if(minWidth&&width<minWidth){return minWidth;}else if(maxWidth&&width>maxWidth){return maxWidth;}else{return width;}}},{key:'resizing',value:function resizing(e){if(this.parent.allowTextWrap){if(this.parent.getFrozenColumns()){this.parent.notify(freezeRender,{case:'textwrap'});}this.element.style.height=this.element.parentElement.offsetHeight+'px';this.setHelperHeight();}var pageX=this.getPointX(e);var mousemove=this.parent.enableRtl?-(pageX-this.pageX):pageX-this.pageX;var colData={width:parseInt(this.widthService.getWidth(this.column).toString(),10)+mousemove,minWidth:this.column.minWidth?parseInt(this.column.minWidth.toString(),10):null,maxWidth:this.column.maxWidth?parseInt(this.column.maxWidth.toString(),10):null};var width=this.getWidth(colData.width,colData.minWidth,colData.maxWidth);if(!this.parent.enableRtl&&this.minMove>=pageX||this.parent.enableRtl&&this.minMove<=pageX){width=this.column.minWidth?parseInt(this.column.minWidth.toString(),10):0;this.pageX=pageX=this.minMove;}if(width!==parseInt(this.column.width.toString(),10)){this.pageX=pageX;this.column.width=formatUnit(width);var args={e:e,column:this.column};this.parent.trigger(onResize,args);if(args.cancel){this.cancelResizeAction(true);return;}this.widthService.setColumnWidth(this.column,null,'resize');this.updateHelper();}this.isDblClk=false;}},{key:'resizeEnd',value:function resizeEnd(e){if(!this.helper||this.parent.isDestroyed){return;}EventHandler.remove(this.parent.element,Browser.touchMoveEvent,this.resizing);EventHandler.remove(document,Browser.touchEndEvent,this.resizeEnd);this.updateCursor('remove');detach(this.helper);var args={e:e,column:this.column};this.parent.trigger(resizeStop,args);closest(this.element,'.e-headercell').classList.add('e-resized');this.refresh();this.doubleTapEvent(e);this.isDblClk=true;}},{key:'getPointX',value:function getPointX(e){if(e.touches&&e.touches.length){return e.touches[0].pageX;}else{return e.pageX;}}},{key:'refreshColumnWidth',value:function refreshColumnWidth(){var columns=this.parent.getColumns();var _iteratorNormalCompletion40=true;var _didIteratorError40=false;var _iteratorError40=undefined;try{for(var _iterator40=[].slice.apply(this.parent.getHeaderTable().querySelectorAll('th.e-headercell'))[Symbol.iterator](),_step40;!(_iteratorNormalCompletion40=(_step40=_iterator40.next()).done);_iteratorNormalCompletion40=true){var ele=_step40.value;var _iteratorNormalCompletion41=true;var _didIteratorError41=false;var _iteratorError41=undefined;try{for(var _iterator41=columns[Symbol.iterator](),_step41;!(_iteratorNormalCompletion41=(_step41=_iterator41.next()).done);_iteratorNormalCompletion41=true){var column=_step41.value;if(ele.querySelector('[e-mappinguid]')&&ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid')===column.uid&&column.visible){column.width=ele.getBoundingClientRect().width;break;}}}catch(err){_didIteratorError41=true;_iteratorError41=err;}finally{try{if(!_iteratorNormalCompletion41&&_iterator41.return){_iterator41.return();}}finally{if(_didIteratorError41){throw _iteratorError41;}}}}}catch(err){_didIteratorError40=true;_iteratorError40=err;}finally{try{if(!_iteratorNormalCompletion40&&_iterator40.return){_iterator40.return();}}finally{if(_didIteratorError40){throw _iteratorError40;}}}return columns;}},{key:'getTargetColumn',value:function getTargetColumn(e){var cell=closest(e.target,resizeClassList.header);var uid=cell.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');return this.parent.getColumnByUid(uid);}},{key:'updateCursor',value:function updateCursor(action){var headerRows=[].slice.call(this.parent.getHeaderContent().querySelectorAll('th'));headerRows.push(this.parent.element);var _iteratorNormalCompletion42=true;var _didIteratorError42=false;var _iteratorError42=undefined;try{for(var _iterator42=headerRows[Symbol.iterator](),_step42;!(_iteratorNormalCompletion42=(_step42=_iterator42.next()).done);_iteratorNormalCompletion42=true){var row=_step42.value;row.classList[action](resizeClassList.cursor);}}catch(err){_didIteratorError42=true;_iteratorError42=err;}finally{try{if(!_iteratorNormalCompletion42&&_iterator42.return){_iterator42.return();}}finally{if(_didIteratorError42){throw _iteratorError42;}}}}},{key:'refresh',value:function refresh(){this.column=null;this.pageX=null;this.element=null;this.helper=null;}},{key:'appendHelper',value:function appendHelper(){this.helper=createElement('div',{className:resizeClassList.helper});this.parent.element.appendChild(this.helper);this.setHelperHeight();}},{key:'setHelperHeight',value:function setHelperHeight(){var height=this.parent.getContent().offsetHeight-this.getScrollBarWidth();var rect=closest(this.element,resizeClassList.header);var tr=[].slice.call(this.parent.getHeaderContent().querySelectorAll('tr'));var frzCols=this.parent.getFrozenColumns();if(frzCols){if(rect.parentElement.children.length!==frzCols){tr.splice(0,tr.length/2);}else{tr.splice(tr.length/2,tr.length/2);}}for(var i=tr.indexOf(rect.parentElement);i<tr.length;i++){height+=tr[i].offsetHeight;}var pos=this.calcPos(rect);pos.left+=this.parent.enableRtl?0-1:rect.offsetWidth-2;this.helper.style.cssText='height: '+height+'px; top: '+pos.top+'px; left:'+Math.floor(pos.left)+'px;';}},{key:'getScrollBarWidth',value:function getScrollBarWidth(height){var ele=this.parent.getFrozenColumns()?this.parent.getContent().querySelector('.e-movablecontent'):this.parent.getContent().firstChild;return ele.scrollHeight>ele.clientHeight&&height||ele.scrollWidth>ele.clientWidth?_getScrollBarWidth():0;}},{key:'removeHelper',value:function removeHelper(e){var cls=e.target.classList;if(!(cls.contains(resizeClassList.root)||cls.contains(resizeClassList.icon))&&this.helper){EventHandler.remove(document,Browser.touchStartEvent,this.removeHelper);EventHandler.remove(this.helper,Browser.touchStartEvent,this.resizeStart);detach(this.helper);this.refresh();}}},{key:'updateHelper',value:function updateHelper(){var rect=closest(this.element,resizeClassList.header);var left=Math.floor(this.calcPos(rect).left+(this.parent.enableRtl?0-1:rect.offsetWidth-2));var borderWidth=2;// to maintain the helper inside of grid element.
if(left>this.parentElementWidth){left=this.parentElementWidth-borderWidth;}if(this.parent.getFrozenColumns()){var table=closest(rect,'.e-table');var fLeft=table.offsetLeft;if(left<fLeft){left=fLeft;}}this.helper.style.left=left+'px';}},{key:'calcPos',value:function calcPos(elem){var parentOffset={top:0,left:0};var offset=elem.getBoundingClientRect();var doc=elem.ownerDocument;var offsetParent=elem.offsetParent||doc.documentElement;while(offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&offsetParent.style.position==='static'){offsetParent=offsetParent.parentNode;}if(offsetParent&&offsetParent!==elem&&offsetParent.nodeType===1){parentOffset=offsetParent.getBoundingClientRect();}return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};}},{key:'doubleTapEvent',value:function doubleTapEvent(e){if(this.getUserAgent()&&this.isDblClk){if(!this.tapped){this.tapped=setTimeout(this.timeoutHandler(),300);}else{clearTimeout(this.tapped);this.callAutoFit(e);this.tapped=null;}}}},{key:'getUserAgent',value:function getUserAgent(){var userAgent=Browser.userAgent.toLowerCase();return /iphone|ipod|ipad/.test(userAgent);}},{key:'timeoutHandler',value:function timeoutHandler(){this.tapped=null;}}]);return Resize;}());_export('Reorder',Reorder=function(){/**
     * Constructor for the Grid reorder module
     * @hidden
     */function Reorder(parent){_classCallCheck(this,Reorder);this.parent=parent;if(this.parent.isDestroyed){return;}this.parent.on(headerDrop,this.headerDrop,this);this.parent.on(uiUpdate,this.enableAfterRender,this);this.parent.on(reorderComplete,this.onActionComplete,this);this.parent.on(columnDrag,this.drag,this);this.parent.on(columnDragStart,this.dragStart,this);this.parent.on(columnDragStop,this.dragStop,this);this.parent.on(headerDrop,this.headerDrop,this);this.parent.on(headerRefreshed,this.createReorderElement,this);}_createClass(Reorder,[{key:'chkDropPosition',value:function chkDropPosition(srcElem,destElem){return(srcElem.parentElement.isEqualNode(destElem.parentElement)||this.parent.getFrozenColumns()&&Array.prototype.indexOf.call(closest(srcElem,'thead').children,srcElem.parentElement)===Array.prototype.indexOf.call(closest(destElem,'thead').children,destElem.parentElement))&&this.targetParentContainerIndex(srcElem,destElem)>-1;}},{key:'chkDropAllCols',value:function chkDropAllCols(srcElem,destElem){var isFound=void 0;var headers=this.getHeaderCells();var header=void 0;while(!isFound&&headers.length>0){header=headers.pop();isFound=srcElem!==header&&this.targetParentContainerIndex(srcElem,destElem)>-1;}return isFound;}},{key:'findColParent',value:function findColParent(col,cols,parent){parent=parent;for(var i=0,len=cols.length;i<len;i++){if(col===cols[i]){return true;}else if(cols[i].columns){var cnt=parent.length;parent.push(cols[i]);if(!this.findColParent(col,cols[i].columns,parent)){parent.splice(cnt,parent.length-cnt);}else{return true;}}}return false;}},{key:'getColumnsModel',value:function getColumnsModel(cols){var columnModel=[];var subCols=[];for(var i=0,len=cols.length;i<len;i++){columnModel.push(cols[i]);if(cols[i].columns){subCols=subCols.concat(cols[i].columns);}}if(subCols.length){columnModel=columnModel.concat(this.getColumnsModel(subCols));}return columnModel;}},{key:'headerDrop',value:function headerDrop(e){var gObj=this.parent;if(!closest(e.target,'th')){return;}var destElem=closest(e.target,'.e-headercell');if(destElem&&!(!this.chkDropPosition(this.element,destElem)||!this.chkDropAllCols(this.element,destElem))){if(this.parent.enableColumnVirtualization){var columns=this.parent.columns;var sourceUid=this.element.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');var col=this.parent.getColumns(true).filter(function(col){return col.uid===sourceUid;});var colMatchIndex=null;var column=col[0];var destUid=destElem.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');var bool=columns.some(function(col,index){if(col.uid===destUid){colMatchIndex=index;return col.uid===destUid;}return false;});if(!isNullOrUndefined(colMatchIndex)){this.moveColumns(colMatchIndex,column);}}else{var headers=this.getHeaderCells();var oldIdx=getElementIndex(this.element,headers);var _columns=this.getColumnsModel(this.parent.columns);var _column2=_columns[oldIdx];var newIndex=this.targetParentContainerIndex(this.element,destElem);this.moveColumns(newIndex,_column2);}}}},{key:'isActionPrevent',value:function isActionPrevent(gObj){return _isActionPrevent(gObj);}},{key:'moveColumns',value:function moveColumns(destIndex,column){var gObj=this.parent;if(this.isActionPrevent(gObj)){gObj.notify(preventBatch,{instance:this,handler:this.moveColumns,arg1:destIndex,arg2:column});return;}var parent=this.getColParent(column,this.parent.columns);var cols=parent?parent.columns:this.parent.columns;var srcIdx=inArray(column,cols);if(!gObj.allowReordering||srcIdx===destIndex||srcIdx===-1||destIndex===-1){return;}cols.splice(destIndex,0,cols.splice(srcIdx,1)[0]);gObj.getColumns(true);gObj.notify(columnPositionChanged,{fromIndex:destIndex,toIndex:srcIdx});gObj.notify(modelChanged,{type:actionBegin,requestType:'reorder'});}},{key:'targetParentContainerIndex',value:function targetParentContainerIndex(srcElem,destElem){var headers=this.getHeaderCells();var cols=this.parent.columns;var flatColumns=this.getColumnsModel(cols);var parent=this.getColParent(flatColumns[getElementIndex(srcElem,headers)],cols);cols=parent?parent.columns:cols;return inArray(flatColumns[getElementIndex(destElem,headers)],cols);}},{key:'getHeaderCells',value:function getHeaderCells(){if(this.parent.getFrozenColumns()){var fTh=void 0;var mTh=void 0;var fHeaders=[];var fRows=[].slice.call(this.parent.getHeaderTable().querySelectorAll('.e-columnheader'));var mRows=[].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelectorAll('.e-columnheader'));for(var i=0;i<fRows.length;i++){fTh=[].slice.call(fRows[i].getElementsByClassName('e-headercell'));mTh=[].slice.call(mRows[i].getElementsByClassName('e-headercell'));fHeaders=fHeaders.concat(fTh);for(var j=0;j<mTh.length;j++){if(!fTh.length||j!==0||fTh[fTh.length-1].innerText!==mTh[0].innerText){fHeaders.push(mTh[j]);}}}return fHeaders;}else{return[].slice.call(this.parent.element.getElementsByClassName('e-headercell'));}}},{key:'getColParent',value:function getColParent(column,columns){var parents$$1=[];this.findColParent(column,columns,parents$$1);return parents$$1[parents$$1.length-1];}},{key:'reorderColumns',value:function reorderColumns(fromFName,toFName){var column=this.parent.getColumnByField(toFName);var parent=this.getColParent(column,this.parent.columns);var columns=parent?parent.columns:this.parent.columns;var destIndex=inArray(column,columns);if(destIndex>-1){this.moveColumns(destIndex,this.parent.getColumnByField(fromFName));}}},{key:'enableAfterRender',value:function enableAfterRender(e){if(e.module===this.getModuleName()&&e.enable){this.createReorderElement();}}},{key:'createReorderElement',value:function createReorderElement(){var header=this.parent.element.querySelector('.e-headercontent');this.upArrow=header.appendChild(createElement('div',{className:'e-icons e-icon-reorderuparrow e-reorderuparrow',attrs:{style:'display:none'}}));this.downArrow=header.appendChild(createElement('div',{className:'e-icons e-icon-reorderdownarrow e-reorderdownarrow',attrs:{style:'display:none'}}));}},{key:'onActionComplete',value:function onActionComplete(e){this.parent.trigger(actionComplete,extend(e,{type:actionComplete}));}},{key:'destroy',value:function destroy(){if(this.parent.isDestroyed){return;}remove(this.upArrow);remove(this.downArrow);this.parent.off(headerDrop,this.headerDrop);this.parent.off(uiUpdate,this.enableAfterRender);this.parent.off(reorderComplete,this.onActionComplete);this.parent.off(columnDrag,this.drag);this.parent.off(columnDragStart,this.dragStart);this.parent.off(columnDragStop,this.dragStop);this.parent.off(headerRefreshed,this.createReorderElement);//call ejdrag and drop destroy
}},{key:'drag',value:function drag(e){var gObj=this.parent;var target=e.target;var closest$$1=closest(target,'.e-headercell:not(.e-stackedHeaderCell)');var cloneElement=gObj.element.querySelector('.e-cloneproperties');var isLeft=this.x>getPosition(e.event).x+gObj.getContent().firstElementChild.scrollLeft;removeClass(gObj.getHeaderTable().querySelectorAll('.e-reorderindicate'),['e-reorderindicate']);this.setDisplay('none');this.stopTimer();classList(cloneElement,['e-defaultcur'],['e-notallowedcur']);this.updateScrollPostion(e.event);if(closest$$1&&!closest$$1.isEqualNode(this.element)){target=closest$$1;//consider stacked, detail header cell 
if(!(!this.chkDropPosition(this.element,target)||!this.chkDropAllCols(this.element,target))){this.updateArrowPosition(target,isLeft);classList(target,['e-allowDrop','e-reorderindicate'],[]);}else if(!(gObj.allowGrouping&&parentsUntil(e.target,'e-groupdroparea'))){classList(cloneElement,['e-notallowedcur'],['e-defaultcur']);}}gObj.trigger(columnDrag,{target:target,draggableType:'headercell',column:e.column});}},{key:'updateScrollPostion',value:function updateScrollPostion(e){var _this92=this;var frzCols=this.parent.getFrozenColumns();var x=getPosition(e).x;var cliRect=this.parent.element.getBoundingClientRect();var cliRectBaseLeft=frzCols?this.parent.element.querySelector('.e-movableheader').getBoundingClientRect().left:cliRect.left;var cliRectBaseRight=cliRect.right;var scrollElem=frzCols?this.parent.getContent().querySelector('.e-movablecontent'):this.parent.getContent().firstElementChild;if(x>cliRectBaseLeft&&x<cliRectBaseLeft+35){this.timer=window.setInterval(function(){_this92.setScrollLeft(scrollElem,true);},50);}else if(x<cliRectBaseRight&&x>cliRectBaseRight-35){this.timer=window.setInterval(function(){_this92.setScrollLeft(scrollElem,false);},50);}}},{key:'setScrollLeft',value:function setScrollLeft(scrollElem,isLeft){var scrollLeft=scrollElem.scrollLeft;scrollElem.scrollLeft=scrollElem.scrollLeft+(isLeft?-5:5);if(scrollLeft!==scrollElem.scrollLeft){this.setDisplay('none');}}},{key:'stopTimer',value:function stopTimer(){window.clearInterval(this.timer);}},{key:'updateArrowPosition',value:function updateArrowPosition(target,isLeft){var cliRect=target.getBoundingClientRect();var cliRectBase=this.parent.element.getBoundingClientRect();if(isLeft&&cliRect.left<cliRectBase.left||!isLeft&&cliRect.right>cliRectBase.right){return;}this.upArrow.style.top=cliRect.top+cliRect.height-cliRectBase.top+'px';this.downArrow.style.top=cliRect.top-cliRectBase.top-4+'px';this.upArrow.style.left=this.downArrow.style.left=(isLeft?cliRect.left:cliRect.right)-cliRectBase.left-4+'px';this.setDisplay('');}},{key:'dragStart',value:function dragStart(e){var gObj=this.parent;var target=e.target;this.element=target.classList.contains('e-headercell')?target:parentsUntil(target,'e-headercell');this.x=getPosition(e.event).x+gObj.getContent().firstElementChild.scrollLeft;gObj.trigger(columnDragStart,{target:target,draggableType:'headercell',column:e.column});}},{key:'dragStop',value:function dragStop(e){var gObj=this.parent;this.setDisplay('none');this.stopTimer();if(!e.cancel){gObj.trigger(columnDrop,{target:e.target,draggableType:'headercell',column:e.column});}removeClass(gObj.getHeaderTable().querySelectorAll('.e-reorderindicate'),['e-reorderindicate']);}},{key:'setDisplay',value:function setDisplay(display){this.upArrow.style.display=display;this.downArrow.style.display=display;}},{key:'getModuleName',value:function getModuleName(){return'reorder';}}]);return Reorder;}());_export('RowDD',RowDD=function(){/**
     * Constructor for the Grid print module
     * @hidden
     */function RowDD(parent){var _this93=this;_classCallCheck(this,RowDD);//Internal variables    
this.selectedRows=[];this.helper=function(e){var gObj=_this93.parent;if(document.getElementsByClassName('e-griddragarea').length||!e.sender.target.classList.contains('e-selectionbackground')&&gObj.selectionSettings.type!=='Single'){return false;}var visualElement=createElement('div',{className:'e-cloneproperties e-draganddrop e-grid e-dragclone',styles:'height:"auto", z-index:2, width:'+gObj.element.offsetWidth});var table=createElement('table',{styles:'width:'+gObj.element.offsetWidth});var tbody=createElement('tbody');if(gObj.selectionSettings.mode==='Row'&&gObj.selectionSettings.type==='Single'){var index=parseInt(e.sender.target.parentElement.getAttribute('aria-rowindex'),10);gObj.selectRow(index);}var selectedRows=gObj.getSelectedRows();for(var i=0,len=selectedRows.length;i<len;i++){var selectedRow=selectedRows[i].cloneNode(true);removeElement(selectedRow,'.e-indentcell');removeElement(selectedRow,'.e-detailrowcollapse');removeElement(selectedRow,'.e-detailrowexpand');tbody.appendChild(selectedRow);}table.appendChild(tbody);visualElement.appendChild(table);gObj.element.appendChild(visualElement);return visualElement;};this.dragStart=function(e){var gObj=_this93.parent;if(document.getElementsByClassName('e-griddragarea').length){return;}gObj.trigger(rowDragStart,{rows:gObj.getSelectedRows(),target:e.target,draggableType:'rows',data:gObj.getSelectedRecords()});var dropElem=document.getElementById(gObj.rowDropSettings.targetID);if(gObj.rowDropSettings.targetID&&dropElem&&dropElem.ej2_instances){dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');}_this93.isDragStop=false;};this.drag=function(e){var gObj=_this93.parent;var cloneElement=_this93.parent.element.querySelector('.e-cloneproperties');var target=_this93.getElementFromPosition(cloneElement,e.event);classList(cloneElement,['e-defaultcur'],['e-notallowedcur']);gObj.trigger(rowDrag,{rows:gObj.getSelectedRows(),target:target,draggableType:'rows',data:gObj.getSelectedRecords()});gObj.element.classList.add('e-rowdrag');if(!parentsUntil(target,'e-gridcontent')||parentsUntil(cloneElement.parentElement,'e-grid').id===parentsUntil(target,'e-grid').id){classList(cloneElement,['e-notallowedcur'],['e-defaultcur']);}};this.dragStop=function(e){var gObj=_this93.parent;if(_this93.parent.isDestroyed){return;}var target=_this93.getElementFromPosition(e.helper,e.event);gObj.element.classList.remove('e-rowdrag');var dropElem=document.getElementById(gObj.rowDropSettings.targetID);if(gObj.rowDropSettings.targetID&&dropElem&&dropElem.ej2_instances){dropElem.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');}gObj.trigger(rowDrop,{target:target,draggableType:'rows',rows:gObj.getSelectedRows(),data:gObj.getSelectedRecords()});if(!parentsUntil(target,'e-gridcontent')){remove(e.helper);return;}};this.parent=parent;if(this.parent.isDestroyed){return;}this.parent.on(initialEnd,this.initializeDrag,this);this.parent.on(columnDrop,this.columnDrop,this);this.parent.on(rowDragAndDropComplete,this.onActionComplete,this);this.parent.on(uiUpdate,this.enableAfterRender,this);}_createClass(RowDD,[{key:'initializeDrag',value:function initializeDrag(){var gObj=this.parent;var drag=void 0;drag=new Draggable(gObj.getContent(),{dragTarget:'.e-rowcell',distance:5,helper:this.helper,dragStart:this.dragStart,drag:this.drag,dragStop:this.dragStop});}},{key:'getElementFromPosition',value:function getElementFromPosition(element,event){var target=void 0;var position=getPosition(event);element.style.display='none';target=document.elementFromPoint(position.x,position.y);element.style.display='';return target;}},{key:'onActionComplete',value:function onActionComplete(e){this.parent.trigger(actionComplete,extend(e,{type:actionComplete}));}},{key:'getTargetIdx',value:function getTargetIdx(targetRow){return targetRow?parseInt(targetRow.getAttribute('aria-rowindex'),10):0;}},{key:'columnDrop',value:function columnDrop(e){var gObj=this.parent;if(e.droppedElement.getAttribute('action')!=='grouping'){var targetRow=closest(e.target,'tr');var srcControl=void 0;var currentIndex=void 0;if(e.droppedElement.parentElement.id!==gObj.element.id){srcControl=e.droppedElement.parentElement.ej2_instances[0];}else{return;}if(srcControl.element.id!==gObj.element.id&&srcControl.rowDropSettings.targetID!==gObj.element.id){return;}var records=srcControl.getSelectedRecords();var targetIndex=currentIndex=this.getTargetIdx(targetRow);if(isNaN(targetIndex)){targetIndex=currentIndex=0;}if(gObj.allowPaging){targetIndex=targetIndex+gObj.pageSettings.currentPage*gObj.pageSettings.pageSize-gObj.pageSettings.pageSize;}//Todo: drag and drop mapper & BatchChanges                   
gObj.notify(rowsAdded,{toIndex:targetIndex,records:records});gObj.notify(modelChanged,{type:actionBegin,requestType:'rowdraganddrop'});var selectedRows=srcControl.getSelectedRowIndexes();var skip=srcControl.allowPaging?srcControl.pageSettings.currentPage*srcControl.pageSettings.pageSize-srcControl.pageSettings.pageSize:0;this.selectedRows=[];for(var i=0,len=records.length;i<len;i++){this.selectedRows.push(skip+selectedRows[i]);}srcControl.notify(rowsRemoved,{indexes:this.selectedRows,records:records});srcControl.notify(modelChanged,{type:actionBegin,requestType:'rowdraganddrop'});}}},{key:'enableAfterRender',value:function enableAfterRender(e){if(e.module===this.getModuleName()&&e.enable){this.initializeDrag();}}},{key:'destroy',value:function destroy(){if(this.parent.isDestroyed){return;}this.parent.off(initialEnd,this.initializeDrag);this.parent.off(columnDrop,this.columnDrop);this.parent.off(rowDragAndDropComplete,this.onActionComplete);this.parent.off(uiUpdate,this.enableAfterRender);//destory ejdrag and drop
}},{key:'getModuleName',value:function getModuleName(){return'rowDragAndDrop';}}]);return RowDD;}());_export('Group',Group=function(){/**
     * Constructor for Grid group module
     * @hidden
     */function Group(parent,groupSettings,sortedColumns,serviceLocator){var _this94=this;_classCallCheck(this,Group);this.isAppliedGroup=false;this.isAppliedUnGroup=false;this.visualElement=createElement('div',{className:'e-cloneproperties e-dragclone e-gdclone',styles:'line-height:23px',attrs:{action:'grouping'}});this.helper=function(e){var gObj=_this94.parent;var target=e.sender.target;var element=target.classList.contains('e-groupheadercell')?target:parentsUntil(target,'e-groupheadercell');if(!element){return false;}_this94.column=gObj.getColumnByField(element.firstElementChild.getAttribute('ej-mappingname'));_this94.visualElement.textContent=element.textContent;_this94.visualElement.style.width=element.offsetWidth+2+'px';_this94.visualElement.style.height=element.offsetHeight+2+'px';_this94.visualElement.setAttribute('e-mappinguid',_this94.column.uid);gObj.element.appendChild(_this94.visualElement);return _this94.visualElement;};this.dragStart=function(){_this94.parent.element.classList.add('e-ungroupdrag');};this.drag=function(e){var target=e.target;var cloneElement=_this94.parent.element.querySelector('.e-cloneproperties');_this94.parent.trigger(columnDrag,{target:target,draggableType:'headercell',column:_this94.column});classList(cloneElement,['e-defaultcur'],['e-notallowedcur']);if(!(parentsUntil(target,'e-gridcontent')||parentsUntil(target,'e-headercell'))){classList(cloneElement,['e-notallowedcur'],['e-defaultcur']);}};this.dragStop=function(e){_this94.parent.element.classList.remove('e-ungroupdrag');if(!(parentsUntil(e.target,'e-gridcontent')||parentsUntil(e.target,'e-gridheader'))){remove(e.helper);return;}};this.drop=function(e){var gObj=_this94.parent;var column=gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));_this94.element.classList.remove('e-hover');remove(e.droppedElement);_this94.aria.setDropTarget(_this94.parent.element.querySelector('.e-groupdroparea'),false);_this94.aria.setGrabbed(_this94.parent.getHeaderTable().querySelector('[aria-grabbed=true]'),false);if(isNullOrUndefined(column)||column.allowGrouping===false||parentsUntil(gObj.getColumnHeaderByUid(column.uid),'e-grid').getAttribute('id')!==gObj.element.getAttribute('id')){return;}_this94.groupColumn(column.field);};this.contentRefresh=true;this.aria=new AriaService();this.parent=parent;this.groupSettings=groupSettings;this.serviceLocator=serviceLocator;this.sortedColumns=sortedColumns;this.focus=serviceLocator.getService('focus');this.addEventListener();}_createClass(Group,[{key:'columnDrag',value:function columnDrag(e){var gObj=this.parent;var cloneElement=this.parent.element.querySelector('.e-cloneproperties');classList(cloneElement,['e-defaultcur'],['e-notallowedcur']);if(!parentsUntil(e.target,'e-groupdroparea')&&!(this.parent.allowReordering&&parentsUntil(e.target,'e-headercell'))){classList(cloneElement,['e-notallowedcur'],['e-defaultcur']);}e.target.classList.contains('e-groupdroparea')?this.element.classList.add('e-hover'):this.element.classList.remove('e-hover');}},{key:'columnDragStart',value:function columnDragStart(e){if(e.target.classList.contains('e-stackedheadercell')){return;}var gObj=this.parent;var dropArea=this.parent.element.querySelector('.e-groupdroparea');this.aria.setDropTarget(dropArea,e.column.allowGrouping);var element=e.target.classList.contains('e-headercell')?e.target:parentsUntil(e.target,'e-headercell');this.aria.setGrabbed(element,true,!e.column.allowGrouping);}},{key:'columnDrop',value:function columnDrop(e){var gObj=this.parent;if(e.droppedElement.getAttribute('action')==='grouping'){var column=gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));if(isNullOrUndefined(column)||column.allowGrouping===false||parentsUntil(gObj.getColumnHeaderByUid(column.uid),'e-grid').getAttribute('id')!==gObj.element.getAttribute('id')){return;}this.ungroupColumn(column.field);}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(uiUpdate,this.enableAfterRender,this);this.parent.on(groupComplete,this.onActionComplete,this);this.parent.on(ungroupComplete,this.onActionComplete,this);this.parent.on(inBoundModelChanged,this.onPropertyChanged,this);this.parent.on(click,this.clickHandler,this);this.parent.on(columnDrag,this.columnDrag,this);this.parent.on(columnDragStart,this.columnDragStart,this);this.parent.on(columnDrop,this.columnDrop,this);this.parent.on(headerRefreshed,this.refreshSortIcons,this);this.parent.on(sortComplete,this.refreshSortIcons,this);this.parent.on(keyPressed,this.keyPressHandler,this);this.parent.on(contentReady,this.initialEnd,this);this.parent.on(onEmpty,this.initialEnd,this);this.parent.on(initialEnd,this.render,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialEnd,this.render);this.parent.off(uiUpdate,this.enableAfterRender);this.parent.off(groupComplete,this.onActionComplete);this.parent.off(ungroupComplete,this.onActionComplete);this.parent.off(inBoundModelChanged,this.onPropertyChanged);this.parent.off(click,this.clickHandler);this.parent.off(columnDrag,this.columnDrag);this.parent.off(columnDragStart,this.columnDragStart);this.parent.off(columnDrop,this.columnDrop);this.parent.off(headerRefreshed,this.refreshSortIcons);this.parent.off(sortComplete,this.refreshSortIcons);this.parent.off(keyPressed,this.keyPressHandler);}},{key:'initialEnd',value:function initialEnd(){var gObj=this.parent;this.parent.off(contentReady,this.initialEnd);this.parent.off(onEmpty,this.initialEnd);if(this.parent.getColumns().length&&this.groupSettings.columns.length){this.contentRefresh=false;var _iteratorNormalCompletion43=true;var _didIteratorError43=false;var _iteratorError43=undefined;try{for(var _iterator43=gObj.groupSettings.columns[Symbol.iterator](),_step43;!(_iteratorNormalCompletion43=(_step43=_iterator43.next()).done);_iteratorNormalCompletion43=true){var col=_step43.value;this.groupColumn(col);}}catch(err){_didIteratorError43=true;_iteratorError43=err;}finally{try{if(!_iteratorNormalCompletion43&&_iterator43.return){_iterator43.return();}}finally{if(_didIteratorError43){throw _iteratorError43;}}}this.contentRefresh=true;}}},{key:'keyPressHandler',value:function keyPressHandler(e){var gObj=this.parent;if(!this.groupSettings.columns.length||['altDownArrow','altUpArrow','ctrlDownArrow','ctrlUpArrow','enter'].indexOf(e.action)===-1){return;}e.preventDefault();switch(e.action){case'altDownArrow':case'altUpArrow':var selected=gObj.allowSelection?gObj.getSelectedRowIndexes():[];if(selected.length){var rows=gObj.getContentTable().querySelector('tbody').children;var dataRow=gObj.getDataRows()[selected[selected.length-1]];var grpRow=void 0;for(var i=dataRow.rowIndex;i>=0;i--){if(!rows[i].classList.contains('e-row')&&!rows[i].classList.contains('e-detailrow')){grpRow=rows[i];break;}}this.expandCollapseRows(grpRow.querySelector(e.action==='altUpArrow'?'.e-recordplusexpand':'.e-recordpluscollapse'));}break;case'ctrlDownArrow':this.expandAll();break;case'ctrlUpArrow':this.collapseAll();break;case'enter':if(this.parent.isEdit||closest(e.target,'#'+this.parent.element.id+'_searchbar')!==null){return;}var element=this.focus.getFocusedElement();var row=element?element.parentElement.querySelector('[class^="e-record"]'):null;if(!row){break;}this.expandCollapseRows(row);break;}}},{key:'clickHandler',value:function clickHandler(e){this.expandCollapseRows(e.target);this.applySortFromTarget(e.target);this.unGroupFromTarget(e.target);this.toogleGroupFromHeader(e.target);}},{key:'unGroupFromTarget',value:function unGroupFromTarget(target){if(target.classList.contains('e-ungroupbutton')){this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));}}},{key:'toogleGroupFromHeader',value:function toogleGroupFromHeader(target){if(this.groupSettings.showToggleButton){if(target.classList.contains('e-grptogglebtn')){if(target.classList.contains('e-toggleungroup')){this.ungroupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);}else{this.groupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);}}else{if(target.classList.contains('e-toggleungroup')){this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));}}}}},{key:'applySortFromTarget',value:function applySortFromTarget(target){var gObj=this.parent;var gHeader=closest(target,'.e-groupheadercell');if(gObj.allowSorting&&gHeader&&!target.classList.contains('e-ungroupbutton')&&!target.classList.contains('e-toggleungroup')){var field=gHeader.firstElementChild.getAttribute('ej-mappingname');if(gObj.getColumnHeaderByField(field).querySelectorAll('.e-ascending').length){gObj.sortColumn(field,'Descending',true);}else{gObj.sortColumn(field,'Ascending',true);}}}},{key:'expandCollapseRows',value:function expandCollapseRows(target){var trgt=parentsUntil(target,'e-recordplusexpand')||parentsUntil(target,'e-recordpluscollapse');if(trgt){var cellIdx=trgt.cellIndex;var rowIdx=trgt.parentElement.rowIndex;var rowNodes=this.parent.getContentTable().querySelector('tbody').children;var rows=[].slice.call(rowNodes).slice(rowIdx+1,rowNodes.length);var isHide=void 0;var expandElem=void 0;var toExpand=[];var indent=trgt.parentElement.querySelectorAll('.e-indentcell').length;var expand=false;if(trgt.classList.contains('e-recordpluscollapse')){addClass([trgt],'e-recordplusexpand');removeClass([trgt],'e-recordpluscollapse');trgt.firstElementChild.className='e-icons e-gdiagonaldown e-icon-gdownarrow';expand=true;}else{isHide=true;removeClass([trgt],'e-recordplusexpand');addClass([trgt],'e-recordpluscollapse');trgt.firstElementChild.className='e-icons e-gnextforward e-icon-grightarrow';}this.aria.setExpand(trgt,expand);for(var i=0,len=rows.length;i<len;i++){if(rows[i].querySelectorAll('td')[cellIdx]&&rows[i].querySelectorAll('td')[cellIdx].classList.contains('e-indentcell')&&rows){if(isHide){rows[i].style.display='none';}else{if(rows[i].querySelectorAll('.e-indentcell').length===indent+1){rows[i].style.display='';expandElem=rows[i].querySelector('.e-recordplusexpand');if(expandElem){toExpand.push(expandElem);}if(rows[i].classList.contains('e-detailrow')){if(rows[i-1].querySelectorAll('.e-detailrowcollapse').length){rows[i].style.display='none';}}}}}else{break;}}for(var _i13=0,_len10=toExpand.length;_i13<_len10;_i13++){removeClass([toExpand[_i13]],'e-recordplusexpand');addClass([toExpand[_i13]],'e-recordpluscollapse');toExpand[_i13].firstElementChild.className='e-icons e-gnextforward e-icon-grightarrow';this.expandCollapseRows(toExpand[_i13]);}}}},{key:'expandCollapse',value:function expandCollapse(isExpand){var rowNodes=this.parent.getContentTable().querySelector('tbody').children;var row=void 0;for(var i=0,len=rowNodes.length;i<len;i++){if(rowNodes[i].querySelectorAll('.e-recordplusexpand, .e-recordpluscollapse').length){row=rowNodes[i].querySelector(isExpand?'.e-recordpluscollapse':'.e-recordplusexpand');if(row){row.className=isExpand?'e-recordplusexpand':'e-recordpluscollapse';row.firstElementChild.className=isExpand?'e-icons e-gdiagonaldown e-icon-gdownarrow':'e-icons e-gnextforward e-icon-grightarrow';}if(!(rowNodes[i].firstElementChild.classList.contains('e-recordplusexpand')||rowNodes[i].firstElementChild.classList.contains('e-recordpluscollapse'))){rowNodes[i].style.display=isExpand?'':'none';}}else{rowNodes[i].style.display=isExpand?'':'none';}}}},{key:'expandAll',value:function expandAll(){this.expandCollapse(true);}},{key:'collapseAll',value:function collapseAll(){this.expandCollapse(false);}},{key:'render',value:function render(){this.l10n=this.serviceLocator.getService('localization');this.renderGroupDropArea();this.initDragAndDrop();this.refreshToggleBtn();}},{key:'renderGroupDropArea',value:function renderGroupDropArea(){var groupElem=this.parent.element.querySelector('.e-groupdroparea');if(groupElem){remove(groupElem);}this.element=createElement('div',{className:'e-groupdroparea',attrs:{'tabindex':'-1'}});this.updateGroupDropArea();this.parent.element.insertBefore(this.element,this.parent.element.firstChild);if(!this.groupSettings.showDropArea){this.element.style.display='none';}}},{key:'updateGroupDropArea',value:function updateGroupDropArea(clear){if(this.groupSettings.showDropArea&&!this.groupSettings.columns.length){var dragLabel=this.l10n.getConstant('GroupDropArea');this.element.innerHTML=dragLabel;this.element.classList.remove('e-grouped');}else{if(this.element.innerHTML===this.l10n.getConstant('GroupDropArea')&&(this.groupSettings.columns.length===1||!this.isAppliedGroup&&!this.isAppliedUnGroup)||clear){this.element.innerHTML='';}this.element.classList.add('e-grouped');}}},{key:'initDragAndDrop',value:function initDragAndDrop(){this.initializeGHeaderDrop();this.initializeGHeaderDrag();}},{key:'initializeGHeaderDrag',value:function initializeGHeaderDrag(){var drag=new Draggable(this.element,{dragTarget:'.e-groupheadercell',distance:5,helper:this.helper,dragStart:this.dragStart,drag:this.drag,dragStop:this.dragStop});}},{key:'initializeGHeaderDrop',value:function initializeGHeaderDrop(){var gObj=this.parent;var drop=new Droppable(this.element,{accept:'.e-dragclone',drop:this.drop});}},{key:'groupColumn',value:function groupColumn(columnName){var gObj=this.parent;var column=gObj.getColumnByField(columnName);if(isNullOrUndefined(column)||column.allowGrouping===false||this.contentRefresh&&this.groupSettings.columns.indexOf(columnName)>-1){return;}if(_isActionPrevent(gObj)){gObj.notify(preventBatch,{instance:this,handler:this.groupColumn,arg1:columnName});return;}column.visible=gObj.groupSettings.showGroupedColumn;this.colName=columnName;this.isAppliedGroup=true;if(this.contentRefresh){this.updateModel();}else{this.addColToGroupDrop(columnName);}this.updateGroupDropArea();this.isAppliedGroup=false;}},{key:'ungroupColumn',value:function ungroupColumn(columnName){var gObj=this.parent;var column=this.parent.enableColumnVirtualization?this.parent.columns.filter(function(c){return c.field===columnName;})[0]:gObj.getColumnByField(columnName);if(isNullOrUndefined(column)||column.allowGrouping===false||this.groupSettings.columns.indexOf(columnName)<0){return;}if(_isActionPrevent(gObj)){gObj.notify(preventBatch,{instance:this,handler:this.ungroupColumn,arg1:columnName});return;}column.visible=true;this.colName=column.field;var columns=JSON.parse(JSON.stringify(this.groupSettings.columns));columns.splice(columns.indexOf(this.colName),1);if(this.sortedColumns.indexOf(columnName)<0){for(var i=0,len=gObj.sortSettings.columns.length;i<len;i++){if(columnName===gObj.sortSettings.columns[i].field){gObj.sortSettings.columns.splice(i,1);break;}}}this.groupSettings.columns=columns;if(gObj.allowGrouping){this.isAppliedUnGroup=true;this.parent.dataBind();}}},{key:'updateModel',value:function updateModel(){var gObj=this.parent;var columns=JSON.parse(JSON.stringify(this.groupSettings.columns));columns.push(this.colName);this.groupSettings.columns=columns;this.groupAddSortingQuery(this.colName);this.parent.dataBind();}},{key:'onActionComplete',value:function onActionComplete(e){var gObj=this.parent;if(e.requestType==='grouping'){this.addColToGroupDrop(this.colName);}else{this.removeColFromGroupDrop(this.colName);}var args=this.groupSettings.columns.indexOf(this.colName)>-1?{columnName:this.colName,requestType:'grouping',type:actionComplete}:{requestType:'ungrouping',type:actionComplete};this.parent.trigger(actionComplete,extend(e,args));this.colName=null;}},{key:'groupAddSortingQuery',value:function groupAddSortingQuery(colName){var i=0;while(i<this.parent.sortSettings.columns.length){if(this.parent.sortSettings.columns[i].field===colName){break;}i++;}if(this.parent.sortSettings.columns.length===i){this.parent.sortSettings.columns.push({field:colName,direction:'Ascending'});}else if(!this.parent.allowSorting){this.parent.sortSettings.columns[i].direction='Ascending';}}},{key:'addColToGroupDrop',value:function addColToGroupDrop(field){var gObj=this.parent;var direction='Ascending';var groupedColumn=createElement('div',{className:'e-grid-icon e-groupheadercell'});var childDiv=createElement('div',{attrs:{'ej-mappingname':field}});var column=this.parent.getColumnByField(field);if(isNullOrUndefined(column)){return;}//Todo headerTemplateID for grouped column, disableHtmlEncode                          
var headerCell=gObj.getColumnHeaderByUid(column.uid);if(!isNullOrUndefined(column.headerTemplate)){if(column.headerTemplate.indexOf('#')!==-1){childDiv.innerHTML=document.querySelector(column.headerTemplate).innerHTML.trim();}else{childDiv.innerHTML=column.headerTemplate;}childDiv.firstElementChild.classList.add('e-grouptext');}else{childDiv.appendChild(createElement('span',{className:'e-grouptext',innerHTML:column.headerText,attrs:{tabindex:'-1','aria-label':'sort the grouped column'}}));}if(this.groupSettings.showToggleButton){childDiv.appendChild(createElement('span',{className:'e-togglegroupbutton e-icons e-icon-ungroup e-toggleungroup',innerHTML:'&nbsp;',attrs:{tabindex:'-1','aria-label':'ungroup button'}}));}if(headerCell.querySelectorAll('.e-ascending,.e-descending').length){direction=headerCell.querySelector('.e-ascending')?'Ascending':'Descending';}childDiv.appendChild(createElement('span',{className:'e-groupsort e-icons '+('e-'+direction.toLowerCase()+' e-icon-'+direction.toLowerCase()),innerHTML:'&nbsp;',attrs:{tabindex:'-1','aria-label':'sort the grouped column'}}));childDiv.appendChild(createElement('span',{className:'e-ungroupbutton e-icons e-icon-hide',innerHTML:'&nbsp;',attrs:{title:this.l10n.getConstant('UnGroup'),tabindex:'-1','aria-label':'ungroup the grouped column'},styles:this.groupSettings.showUngroupButton?'':'display:none'}));groupedColumn.appendChild(childDiv);this.element.appendChild(groupedColumn);//Todo:  rtl 
}},{key:'refreshToggleBtn',value:function refreshToggleBtn(isRemove){if(this.groupSettings.showToggleButton){var headers=[].slice.call(this.parent.element.getElementsByClassName('e-headercelldiv'));for(var i=0,len=headers.length;i<len;i++){if(!(headers[i].classList.contains('e-emptycell')||headers[i].classList.contains('e-headerchkcelldiv'))){var column=this.parent.getColumnByUid(headers[i].getAttribute('e-mappinguid'));if(!this.parent.showColumnMenu||this.parent.showColumnMenu&&!column.showColumnMenu){if(headers[i].querySelectorAll('.e-grptogglebtn').length){remove(headers[i].querySelectorAll('.e-grptogglebtn')[0]);}if(!isRemove){headers[i].appendChild(createElement('span',{className:'e-grptogglebtn e-icons '+(this.groupSettings.columns.indexOf(column.field)>-1?'e-toggleungroup e-icon-ungroup':'e-togglegroup e-icon-group'),attrs:{tabindex:'-1','aria-label':'Group button'}}));}}}}}}},{key:'removeColFromGroupDrop',value:function removeColFromGroupDrop(field){if(!isNullOrUndefined(this.getGHeaderCell(field))){remove(this.getGHeaderCell(field));this.updateGroupDropArea();}this.isAppliedUnGroup=false;}},{key:'onPropertyChanged',value:function onPropertyChanged(e){var _this95=this;if(e.module!==this.getModuleName()){return;}var _loop3=function _loop3(prop){switch(prop){case'columns':var args=void 0;if(_this95.contentRefresh){if(!_this95.isAppliedUnGroup){if(!_this95.isAppliedGroup){_this95.updateGroupDropArea(true);for(var i=0;i<_this95.groupSettings.columns.length;i++){_this95.colName=_this95.groupSettings.columns[i];var col=_this95.parent.getColumnByField(_this95.colName);col.visible=_this95.parent.groupSettings.showGroupedColumn;_this95.groupAddSortingQuery(_this95.colName);if(i<_this95.groupSettings.columns.length-1){_this95.addColToGroupDrop(_this95.groupSettings.columns[i]);}}}args={columnName:_this95.colName,requestType:e.properties[prop].length?'grouping':'ungrouping',type:actionBegin};}else{args={requestType:'ungrouping',type:actionBegin};}if(!_this95.groupSettings.showGroupedColumn){e.oldProperties[prop].forEach(function(column){if(e.properties[prop].indexOf(column)===-1){_this95.parent.getColumnByField(column).visible=true;}});}_this95.parent.notify(modelChanged,args);}break;case'showDropArea':_this95.updateGroupDropArea();_this95.groupSettings.showDropArea?_this95.element.style.display='':_this95.element.style.display='none';break;case'showGroupedColumn':_this95.updateGroupedColumn(_this95.groupSettings.showGroupedColumn);_this95.parent.notify(modelChanged,{requestType:'refresh'});break;case'showUngroupButton':_this95.updateButtonVisibility(_this95.groupSettings.showUngroupButton,'e-ungroupbutton');break;case'showToggleButton':_this95.updateButtonVisibility(_this95.groupSettings.showToggleButton,'e-togglegroupbutton ');_this95.parent.refreshHeader();break;}};var _iteratorNormalCompletion44=true;var _didIteratorError44=false;var _iteratorError44=undefined;try{for(var _iterator44=Object.keys(e.properties)[Symbol.iterator](),_step44;!(_iteratorNormalCompletion44=(_step44=_iterator44.next()).done);_iteratorNormalCompletion44=true){var prop=_step44.value;_loop3(prop);}}catch(err){_didIteratorError44=true;_iteratorError44=err;}finally{try{if(!_iteratorNormalCompletion44&&_iterator44.return){_iterator44.return();}}finally{if(_didIteratorError44){throw _iteratorError44;}}}}},{key:'updateGroupedColumn',value:function updateGroupedColumn(isVisible){for(var i=0;i<this.groupSettings.columns.length;i++){this.parent.getColumnByField(this.groupSettings.columns[i]).visible=isVisible;}}},{key:'updateButtonVisibility',value:function updateButtonVisibility(isVisible,className){var gHeader=[].slice.call(this.element.querySelectorAll('.'+className));for(var i=0;i<gHeader.length;i++){gHeader[i].style.display=isVisible?'':'none';}}},{key:'enableAfterRender',value:function enableAfterRender(e){if(e.module===this.getModuleName()&&e.enable){this.render();}}},{key:'destroy',value:function destroy(){this.clearGrouping();this.removeEventListener();this.refreshToggleBtn(true);remove(this.element);//call ejdrag and drop destroy
}},{key:'clearGrouping',value:function clearGrouping(){var cols=JSON.parse(JSON.stringify(this.groupSettings.columns));this.contentRefresh=false;for(var i=0,len=cols.length;i<len;i++){this.ungroupColumn(cols[i]);}this.contentRefresh=true;}},{key:'getModuleName',value:function getModuleName(){return'group';}},{key:'refreshSortIcons',value:function refreshSortIcons(e){var gObj=this.parent;var header=void 0;var cols=gObj.sortSettings.columns;var gCols=gObj.groupSettings.columns;var fieldNames=this.parent.getColumns().map(function(c){return c.field;});this.refreshToggleBtn();for(var i=0,len=cols.length;i<len;i++){if(fieldNames.indexOf(cols[i].field)===-1){continue;}header=gObj.getColumnHeaderByField(cols[i].field);if(!gObj.allowSorting&&(this.sortedColumns.indexOf(cols[i].field)>-1||this.groupSettings.columns.indexOf(cols[i].field)>-1)){classList(header.querySelector('.e-sortfilterdiv'),['e-ascending','e-icon-ascending'],[]);if(cols.length>1){header.querySelector('.e-headercelldiv').appendChild(createElement('span',{className:'e-sortnumber',innerHTML:(i+1).toString()}));}}else if(this.getGHeaderCell(cols[i].field)&&this.getGHeaderCell(cols[i].field).querySelectorAll('.e-groupsort').length){if(cols[i].direction==='Ascending'){classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'),['e-ascending','e-icon-ascending'],['e-descending','e-icon-descending']);}else{classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'),['e-descending','e-icon-descending'],['e-ascending','e-icon-ascending']);}}}for(var _i14=0,_len11=gCols.length;_i14<_len11;_i14++){if(fieldNames.indexOf(gCols[_i14])===-1){continue;}gObj.getColumnHeaderByField(gCols[_i14]).setAttribute('aria-grouped','true');}}},{key:'getGHeaderCell',value:function getGHeaderCell(field){if(this.element&&this.element.querySelector('[ej-mappingname="'+field+'"]')){return this.element.querySelector('[ej-mappingname="'+field+'"]').parentElement;}return null;}}]);return Group;}());_export('DetailRow',DetailRow=function(){/**
     * Constructor for the Grid detail template module
     * @hidden
     */function DetailRow(parent,locator){_classCallCheck(this,DetailRow);//Internal variables
this.aria=new AriaService();this.parent=parent;if(this.parent.isDestroyed){return;}this.focus=locator.getService('focus');this.parent.on(click,this.clickHandler,this);this.parent.on(_destroy,this.destroy,this);this.parent.on(keyPressed,this.keyPressHandler,this);}_createClass(DetailRow,[{key:'clickHandler',value:function clickHandler(e){this.toogleExpandcollapse(closest(e.target,'td'));}},{key:'toogleExpandcollapse',value:function toogleExpandcollapse(target){var gObj=this.parent;var parent='parentDetails';if(target&&(target.classList.contains('e-detailrowcollapse')||target.classList.contains('e-detailrowexpand'))){var tr=target.parentElement;var _uid2=tr.getAttribute('data-uid');var nextRow=this.parent.getContentTable().querySelector('tbody').children[tr.rowIndex+1];if(target.classList.contains('e-detailrowcollapse')){var key='records';var currentViewData=gObj.allowGrouping&&gObj.groupSettings.columns.length?gObj.currentViewData[key]:gObj.currentViewData;var data=currentViewData[tr.getAttribute('aria-rowindex')];if(this.isDetailRow(nextRow)){nextRow.style.display='';}else if(gObj.getDetailTemplate()||gObj.childGrid){var detailRow=createElement('tr',{className:'e-detailrow'});var detailCell=createElement('td',{className:'e-detailcell'});detailCell.setAttribute('colspan',this.parent.getVisibleColumns().length.toString());var row=new Row({isDataRow:true,isExpand:true,cells:[new Cell({cellType:CellType.Indent}),new Cell({isDataCell:true,visible:true})]});for(var i=0,len=gObj.groupSettings.columns.length;i<len;i++){detailRow.appendChild(createElement('td',{className:'e-indentcell'}));row.cells.unshift(new Cell({cellType:CellType.Indent}));}detailRow.appendChild(createElement('td',{className:'e-detailindentcell'}));detailRow.appendChild(detailCell);tr.parentNode.insertBefore(detailRow,tr.nextSibling);if(gObj.detailTemplate){appendChildren(detailCell,gObj.getDetailTemplate()(data,gObj,'detailTemplate'));}else{gObj.childGrid[parent]={parentID:gObj.element.id,parentPrimaryKeys:gObj.getPrimaryKeyFieldNames(),parentKeyField:gObj.childGrid.queryString,parentKeyFieldValue:data[gObj.childGrid.queryString],parentRowData:data};var grid=new Grid(gObj.childGrid);var modules=grid.getInjectedModules();var injectedModues=gObj.getInjectedModules();if(!modules||modules.length!==injectedModues.length){grid.setInjectedModules(injectedModues);}var gridElem=createElement('div',{id:'child'+parents(tr,'e-grid').length+'_grid'+tr.rowIndex+getUid('')});detailCell.appendChild(gridElem);grid.appendTo(gridElem);}detailRow.appendChild(detailCell);tr.parentNode.insertBefore(detailRow,tr.nextSibling);var idx=void 0;this.parent.getRowsObject().some(function(r,rIndex){idx=rIndex;return r.uid===_uid2;});gObj.getRows().splice(tr.rowIndex+1,0,detailRow);this.parent.getRowsObject().splice(idx+1,0,row);gObj.trigger(detailDataBound,{detailElement:detailCell,data:data});gObj.notify(detailDataBound,{rows:this.parent.getRowsObject()});}classList(target,['e-detailrowexpand'],['e-detailrowcollapse']);classList(target.firstElementChild,['e-dtdiagonaldown','e-icon-gdownarrow'],['e-dtdiagonalright','e-icon-grightarrow']);this.parent.getRowsObject()[tr.rowIndex].isExpand=true;this.aria.setExpand(target,true);}else{if(this.isDetailRow(nextRow)){nextRow.style.display='none';}classList(target,['e-detailrowcollapse'],['e-detailrowexpand']);classList(target.firstElementChild,['e-dtdiagonalright','e-icon-grightarrow'],['e-dtdiagonaldown','e-icon-gdownarrow']);this.parent.getRowsObject()[tr.rowIndex].isExpand=false;this.aria.setExpand(target,false);}}}},{key:'isDetailRow',value:function isDetailRow(row){return row&&row.classList.contains('e-detailrow');}},{key:'destroy',value:function destroy(){if(this.parent.isDestroyed){return;}this.parent.off(click,this.clickHandler);this.parent.off(_destroy,this.destroy);this.parent.off(keyPressed,this.keyPressHandler);}},{key:'getTDfromIndex',value:function getTDfromIndex(index,className){var tr=this.parent.getDataRows()[index];if(tr&&tr.querySelector(className)){return tr.querySelector(className);}return null;}},{key:'expand',value:function expand(target){if(!isNaN(target)){target=this.getTDfromIndex(target,'.e-detailrowcollapse');}if(target&&target.classList.contains('e-detailrowcollapse')){this.toogleExpandcollapse(target);}}},{key:'collapse',value:function collapse(target){if(!isNaN(target)){target=this.getTDfromIndex(target,'.e-detailrowexpand');}if(target&&target.classList.contains('e-detailrowexpand')){this.toogleExpandcollapse(target);}}},{key:'expandAll',value:function expandAll(){this.expandCollapse(true);}},{key:'collapseAll',value:function collapseAll(){this.expandCollapse(false);}},{key:'expandCollapse',value:function expandCollapse(isExpand){var td=void 0;var rows=this.parent.getDataRows();for(var i=0,len=rows.length;i<len;i++){td=rows[i].querySelector('.e-detailrowcollapse, .e-detailrowexpand');isExpand?this.expand(td):this.collapse(td);}}},{key:'keyPressHandler',value:function keyPressHandler(e){var gObj=this.parent;switch(e.action){case'ctrlDownArrow':this.expandAll();break;case'ctrlUpArrow':this.collapseAll();break;case'altUpArrow':case'altDownArrow':var selected=gObj.allowSelection?gObj.getSelectedRowIndexes():[];if(selected.length){var dataRow=gObj.getDataRows()[selected[selected.length-1]];var td=dataRow.querySelector('.e-detailrowcollapse, .e-detailrowexpand');e.action==='altDownArrow'?this.expand(td):this.collapse(td);}break;case'enter':if(this.parent.isEdit){return;}var element=this.focus.getFocusedElement();if(!e.target.classList.contains('e-detailrowcollapse')&&!e.target.classList.contains('e-detailrowexpand')){break;}this.toogleExpandcollapse(element);break;}}},{key:'getModuleName',value:function getModuleName(){return'detailRow';}}]);return DetailRow;}());_export('Toolbar',Toolbar$1=function(){function Toolbar$1(parent,serviceLocator){_classCallCheck(this,Toolbar$1);this.predefinedItems={};this.items=['Add','Edit','Update','Delete','Cancel','Print','Search','ColumnChooser','PdfExport','ExcelExport','CsvExport','WordExport'];this.parent=parent;this.gridID=parent.element.id;this.serviceLocator=serviceLocator;this.addEventListener();}_createClass(Toolbar$1,[{key:'render',value:function render(){this.l10n=this.serviceLocator.getService('localization');var preItems=['Add','Edit','Update','Delete','Cancel','Print','PdfExport','ExcelExport','WordExport','CsvExport'];var _iteratorNormalCompletion45=true;var _didIteratorError45=false;var _iteratorError45=undefined;try{for(var _iterator45=preItems[Symbol.iterator](),_step45;!(_iteratorNormalCompletion45=(_step45=_iterator45.next()).done);_iteratorNormalCompletion45=true){var item=_step45.value;var itemStr=item.toLowerCase();var localeName=itemStr[0].toUpperCase()+itemStr.slice(1);this.predefinedItems[item]={id:this.gridID+'_'+itemStr,prefixIcon:'e-'+itemStr,text:this.l10n.getConstant(localeName),tooltipText:this.l10n.getConstant(localeName)};}}catch(err){_didIteratorError45=true;_iteratorError45=err;}finally{try{if(!_iteratorNormalCompletion45&&_iterator45.return){_iterator45.return();}}finally{if(_didIteratorError45){throw _iteratorError45;}}}this.predefinedItems.Search={id:this.gridID+'_search',template:'<div class="e-input-group e-search" role="search">\
            <input id="'+this.gridID+'_searchbar" class="e-input" name="input" type="search" \
            placeholder= \"'+this.l10n.getConstant('Search')+'\"/>\
            <span id="'+this.gridID+'_searchbutton" class="e-input-group-icon e-search-icon e-icons" \
            tabindex="-1" title="Search In" aria-label= "search"></span> \
            </div>',tooltipText:this.l10n.getConstant('Search'),align:'right',cssClass:'e-search-wrapper'};this.predefinedItems.ColumnChooser={id:this.gridID+'_'+'columnchooser',cssClass:'e-cc e-ccdiv e-cc-toolbar',suffixIcon:'e-'+'columnchooser-btn',text:'Columns',tooltipText:'columns',align:'right'};this.createToolbar();}},{key:'getToolbar',value:function getToolbar(){return this.toolbar.element;}},{key:'destroy',value:function destroy(){if(!this.toolbar.isDestroyed){if(!this.toolbar.element){this.parent.destroyTemplate(['toolbarTemplate']);}else{this.toolbar.destroy();}this.unWireEvent();this.removeEventListener();remove(this.element);}}},{key:'createToolbar',value:function createToolbar(){var items=this.getItems();this.toolbar=new Toolbar({items:items,clicked:this.toolbarClickHandler.bind(this),enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl});var viewStr='viewContainerRef';var registerTemp='registeredTemplate';if(this.parent[viewStr]){this.toolbar[registerTemp]={};this.toolbar[viewStr]=this.parent[viewStr];}this.element=createElement('div',{id:this.gridID+'_toolbarItems'});if(this.parent.toolbarTemplate){if(typeof this.parent.toolbarTemplate==='string'){this.toolbar.appendTo(this.parent.toolbarTemplate);this.element=this.toolbar.element;}else{appendChildren(this.element,templateCompiler(this.parent.toolbarTemplate)({},this.parent,'toolbarTemplate'));}}else{this.toolbar.appendTo(this.element);}this.parent.element.insertBefore(this.element,this.parent.getHeaderContent());this.searchElement=this.element.querySelector('#'+this.gridID+'_searchbar');this.wireEvent();this.refreshToolbarItems();if(this.parent.searchSettings){this.updateSearchBox();}}},{key:'refreshToolbarItems',value:function refreshToolbarItems(args){var gObj=this.parent;var enableItems=[];var disableItems=[];var edit=gObj.editSettings;var hasData=gObj.currentViewData&&gObj.currentViewData.length;edit.allowAdding?enableItems.push(this.gridID+'_add'):disableItems.push(this.gridID+'_add');edit.allowEditing&&hasData?enableItems.push(this.gridID+'_edit'):disableItems.push(this.gridID+'_edit');edit.allowDeleting&&hasData?enableItems.push(this.gridID+'_delete'):disableItems.push(this.gridID+'_delete');if(gObj.editSettings.mode==='Batch'){if(gObj.element.querySelectorAll('.e-updatedtd').length&&(edit.allowAdding||edit.allowEditing)){enableItems.push(this.gridID+'_update');enableItems.push(this.gridID+'_cancel');}else{disableItems.push(this.gridID+'_update');disableItems.push(this.gridID+'_cancel');}}else{if(gObj.isEdit&&(edit.allowAdding||edit.allowEditing)){enableItems=[this.gridID+'_update',this.gridID+'_cancel'];disableItems=[this.gridID+'_add',this.gridID+'_edit',this.gridID+'_delete'];}else{disableItems.push(this.gridID+'_update');disableItems.push(this.gridID+'_cancel');}}this.enableItems(enableItems,true);this.enableItems(disableItems,false);}},{key:'getItems',value:function getItems(){var items=[];var toolbarItems=this.parent.toolbar||[];if(typeof this.parent.toolbar==='string'){return[];}var _iteratorNormalCompletion46=true;var _didIteratorError46=false;var _iteratorError46=undefined;try{for(var _iterator46=toolbarItems[Symbol.iterator](),_step46;!(_iteratorNormalCompletion46=(_step46=_iterator46.next()).done);_iteratorNormalCompletion46=true){var item=_step46.value;switch(typeof item==='undefined'?'undefined':_typeof(item)){case'number':items.push(this.getItemObject(this.items[item]));break;case'string':items.push(this.getItemObject(item));break;default:items.push(this.getItem(item));}}}catch(err){_didIteratorError46=true;_iteratorError46=err;}finally{try{if(!_iteratorNormalCompletion46&&_iterator46.return){_iterator46.return();}}finally{if(_didIteratorError46){throw _iteratorError46;}}}return items;}},{key:'getItem',value:function getItem(itemObject){var item=this.predefinedItems[itemObject.text];return item?extend(item,item,itemObject):itemObject;}},{key:'getItemObject',value:function getItemObject(itemName){return this.predefinedItems[itemName]||{text:itemName,id:this.gridID+'_'+itemName};}},{key:'enableItems',value:function enableItems(items,isEnable){var _iteratorNormalCompletion47=true;var _didIteratorError47=false;var _iteratorError47=undefined;try{for(var _iterator47=items[Symbol.iterator](),_step47;!(_iteratorNormalCompletion47=(_step47=_iterator47.next()).done);_iteratorNormalCompletion47=true){var item=_step47.value;var element=this.element.querySelector('#'+item);if(element){this.toolbar.enableItems(element.parentElement,isEnable);}}}catch(err){_didIteratorError47=true;_iteratorError47=err;}finally{try{if(!_iteratorNormalCompletion47&&_iterator47.return){_iterator47.return();}}finally{if(_didIteratorError47){throw _iteratorError47;}}}}},{key:'toolbarClickHandler',value:function toolbarClickHandler(args){var gObj=this.parent;var gID=this.gridID;extend(args,{cancel:false});gObj.trigger(toolbarClick,args);if(args.cancel){return;}switch(!isNullOrUndefined(args.item)&&args.item.id){case gID+'_print':gObj.print();break;case gID+'_edit':gObj.startEdit();break;case gID+'_update':gObj.endEdit();break;case gID+'_cancel':gObj.closeEdit();break;case gID+'_add':gObj.addRecord();break;case gID+'_delete':gObj.deleteRecord();break;case gID+'_search':if(args.originalEvent.target.id===gID+'_searchbutton'){this.search();}break;case gID+'_columnchooser':var tarElement=this.parent.element.querySelector('.e-ccdiv');var y=tarElement.getBoundingClientRect().top;var x=tarElement.getBoundingClientRect().left;var targetEle=args.originalEvent.target;y=tarElement.getBoundingClientRect().top+tarElement.offsetTop;gObj.createColumnchooser(x,y,targetEle);break;}}},{key:'modelChanged',value:function modelChanged(e){if(e.module==='edit'){this.refreshToolbarItems();}}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()||!this.parent.toolbar){return;}if(this.element){remove(this.element);}this.render();}},{key:'keyUpHandler',value:function keyUpHandler(e){if(e.keyCode===13){this.search();}}},{key:'search',value:function search(){this.parent.search(this.searchElement.value);}},{key:'updateSearchBox',value:function updateSearchBox(){if(this.searchElement){this.searchElement.value=this.parent.searchSettings.key;}}},{key:'wireEvent',value:function wireEvent(){if(this.searchElement){this.searchBoxObj=new SearchBox(this.searchElement);EventHandler.add(this.searchElement,'keyup',this.keyUpHandler,this);this.searchBoxObj.wireEvent();}}},{key:'unWireEvent',value:function unWireEvent(){if(this.searchElement){EventHandler.remove(this.searchElement,'keyup',this.keyUpHandler);this.searchBoxObj.unWireEvent();}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(initialEnd,this.render,this);this.parent.on(uiUpdate,this.onPropertyChanged,this);this.parent.on(inBoundModelChanged,this.updateSearchBox.bind(this));this.parent.on(modelChanged,this.refreshToolbarItems,this);this.parent.on(toolbarRefresh,this.refreshToolbarItems,this);this.parent.on(inBoundModelChanged,this.modelChanged,this);this.parent.on(dataBound,this.refreshToolbarItems,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialEnd,this.render);this.parent.off(uiUpdate,this.onPropertyChanged);this.parent.off(inBoundModelChanged,this.updateSearchBox);this.parent.off(modelChanged,this.refreshToolbarItems);this.parent.off(toolbarRefresh,this.refreshToolbarItems);this.parent.off(inBoundModelChanged,this.modelChanged);this.parent.off(dataBound,this.refreshToolbarItems);}},{key:'getModuleName',value:function getModuleName(){return'toolbar';}}]);return Toolbar$1;}());FooterRenderer=function(_ContentRender){_inherits(FooterRenderer,_ContentRender);function FooterRenderer(gridModule,serviceLocator){_classCallCheck(this,FooterRenderer);var _this96=_possibleConstructorReturn(this,(FooterRenderer.__proto__||Object.getPrototypeOf(FooterRenderer)).call(this,gridModule,serviceLocator));_this96.aggregates={};_this96.parent=gridModule;_this96.locator=serviceLocator;_this96.modelGenerator=new SummaryModelGenerator(_this96.parent);_this96.addEventListener();return _this96;}/**
     * The function is used to render grid footer div
     */_createClass(FooterRenderer,[{key:'renderPanel',value:function renderPanel(){var div=createElement('div',{className:'e-gridfooter'});var innerDiv=createElement('div',{className:'e-summarycontent'});var movableContent=innerDiv;if(this.parent.getFrozenColumns()){var fDiv=createElement('div',{className:'e-frozenfootercontent'});var mDiv=createElement('div',{className:'e-movablefootercontent'});innerDiv.appendChild(fDiv);innerDiv.appendChild(mDiv);this.frozenContent=fDiv;this.movableContent=mDiv;movableContent=mDiv;}if(Browser.isDevice){movableContent.style.overflowX='scroll';}div.appendChild(innerDiv);this.setPanel(div);if(this.parent.getPager()!=null){this.parent.element.insertBefore(div,this.parent.getPager());}else{this.parent.element.appendChild(div);}}},{key:'renderTable',value:function renderTable(){var contentDiv=this.getPanel();var innerDiv=this.createContentTable('_footer_table');var table=innerDiv.querySelector('.e-table');var tFoot=createElement('tfoot');table.appendChild(tFoot);if(this.parent.getFrozenColumns()){var freezeTable=table.cloneNode(true);this.frozenContent.appendChild(freezeTable);this.freezeTable=freezeTable;this.movableContent.appendChild(table);remove(table.querySelector('colgroup'));var colGroup=this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup').cloneNode(true);table.insertBefore(colGroup,table.querySelector('tbody'));this.setColGroup(colGroup);}this.setTable(table);}},{key:'renderSummaryContent',value:function renderSummaryContent(e,table,cStart,cEnd){var input=this.parent.dataSource instanceof Array?this.parent.dataSource:this.parent.currentViewData;var summaries=this.modelGenerator.getData();var dummies=isNullOrUndefined(cStart)?this.modelGenerator.getColumns():this.modelGenerator.getColumns(cStart,cEnd);var rows=isNullOrUndefined(cStart)?this.modelGenerator.generateRows(input,e||this.aggregates):this.modelGenerator.generateRows(input,e||this.aggregates,cStart,cEnd);var fragment=document.createDocumentFragment();var rowrenderer=new RowRenderer(this.locator,null,this.parent);rowrenderer.element=createElement('TR',{className:'e-summaryrow'});for(var srow=0,len=summaries.length;srow<len;srow++){var row=rows[srow];if(!row){continue;}var tr=rowrenderer.render(row,dummies);fragment.appendChild(tr);}table.tFoot.appendChild(fragment);this.aggregates=e;}},{key:'refresh',value:function refresh(e){if(this.parent.getFrozenColumns()){remove(this.getPanel());this.renderPanel();this.renderTable();this.freezeTable.tFoot.innerHTML='';this.renderSummaryContent(e,this.freezeTable,0,this.parent.getFrozenColumns());}this.getTable().tFoot.innerHTML='';this.renderSummaryContent(e,this.getTable(),this.parent.getFrozenColumns());// check freeze content have no row case
if(this.parent.getFrozenColumns()){var frozenDiv=this.frozenContent;if(!frozenDiv.offsetHeight){frozenDiv.style.height=this.getTable().offsetHeight+'px';}}this.onScroll();}},{key:'refreshCol',value:function refreshCol(){// frozen table 
var mheaderCol=void 0;var fheaderCol=mheaderCol=this.parent.element.querySelector('.e-gridheader').querySelector('colgroup').cloneNode(true);if(this.parent.getFrozenColumns()){mheaderCol=renderMovable(fheaderCol,this.parent.getFrozenColumns());this.freezeTable.replaceChild(fheaderCol,this.freezeTable.querySelector('colGroup'));}this.getTable().replaceChild(mheaderCol,this.getColGroup());this.setColGroup(mheaderCol);}},{key:'onWidthChange',value:function onWidthChange(args){this.getColFromIndex(args.index).style.width=formatUnit(args.width);if(this.parent.allowResizing&&args.module==='resize'){this.updateFooterTableWidth(this.getTable());}}},{key:'onScroll',value:function onScroll(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{left:this.parent.getContent().firstChild.scrollLeft};this.getTable().parentElement.scrollLeft=e.left;}},{key:'getColFromIndex',value:function getColFromIndex(index){var fCol=this.parent.getFrozenColumns();if(fCol&&fCol>index){return this.freezeTable.querySelector('colGroup').children[index];}return this.getColGroup().children[index-fCol];}},{key:'columnVisibilityChanged',value:function columnVisibilityChanged(){this.refresh();}},{key:'addEventListener',value:function addEventListener(){this.parent.on(colGroupRefresh,this.refreshCol,this);this.parent.on(columnWidthChanged,this.onWidthChange,this);this.parent.on(scroll,this.onScroll,this);this.parent.on(columnVisibilityChanged,this.columnVisibilityChanged,this);}},{key:'removeEventListener',value:function removeEventListener(){this.parent.off(colGroupRefresh,this.refreshCol);this.parent.off(columnWidthChanged,this.onWidthChange);this.parent.off(scroll,this.onScroll);this.parent.off(columnVisibilityChanged,this.columnVisibilityChanged);}},{key:'updateFooterTableWidth',value:function updateFooterTableWidth(tFoot){var tHead=this.parent.getHeaderTable();if(tHead&&tFoot){tFoot.style.width=tHead.style.width;}}}]);return FooterRenderer;}(ContentRender);SummaryCellRenderer=function(_CellRenderer10){_inherits(SummaryCellRenderer,_CellRenderer10);function SummaryCellRenderer(){_classCallCheck(this,SummaryCellRenderer);var _this97=_possibleConstructorReturn(this,(SummaryCellRenderer.__proto__||Object.getPrototypeOf(SummaryCellRenderer)).apply(this,arguments));_this97.element=createElement('TD',{className:'e-summarycell',attrs:{role:'gridcell',tabindex:'-1'}});return _this97;}_createClass(SummaryCellRenderer,[{key:'getValue',value:function getValue(field,data,column){var key=void 0;key=!isNullOrUndefined(column.type)?column.field+' - '+(typeof column.type==='string'?column.type.toLowerCase():''):column.columnName;return data[column.columnName]?data[column.columnName][key]:'';}},{key:'evaluate',value:function evaluate(node,cell,data,attributes$$1){var column=cell.column;if(!(column.footerTemplate||column.groupFooterTemplate||column.groupCaptionTemplate)){return true;}var tempObj=column.getTemplate(cell.cellType);appendChildren(node,tempObj.fn(data[column.columnName],this.parent,tempObj.property));return false;}}]);return SummaryCellRenderer;}(CellRenderer);_export('Aggregate',Aggregate=function(){function Aggregate(parent,locator){_classCallCheck(this,Aggregate);this.parent=parent;this.locator=locator;this.addEventListener();}_createClass(Aggregate,[{key:'getModuleName',value:function getModuleName(){return'aggregate';}},{key:'initiateRender',value:function initiateRender(){var _this98=this;var cellFac=this.locator.getService('cellRendererFactory');var instance=new SummaryCellRenderer(this.parent,this.locator);[CellType.Summary,CellType.CaptionSummary,CellType.GroupSummary].forEach(function(type){return cellFac.addCellRenderer(type,instance);});this.footerRenderer=new FooterRenderer(this.parent,this.locator);this.footerRenderer.renderPanel();this.footerRenderer.renderTable();this.locator.register('footerRenderer',this.footerRenderer);var fn=function fn(){_this98.prepareSummaryInfo();_this98.parent.off(dataReady,fn);};this.parent.on(dataReady,fn,this);this.parent.on(dataReady,this.footerRenderer.refresh,this.footerRenderer);}},{key:'prepareSummaryInfo',value:function prepareSummaryInfo(){var _this99=this;summaryIterator(this.parent.aggregates,function(column){var dataColumn=_this99.parent.getColumnByField(column.field)||{};var type=dataColumn.type;column.setPropertiesSilent({format:_this99.getFormatFromType(column.format,type)});column.setFormatter();column.setPropertiesSilent({columnName:column.columnName||column.field});});}},{key:'getFormatFromType',value:function getFormatFromType(format,type){if(isNullOrUndefined(type)||typeof format!=='string'){return format;}var obj=void 0;switch(type){case'number':obj={format:format};break;case'date':obj={type:type,skeleton:format};break;case'datetime':obj={type:'dateTime',skeleton:format};break;}return obj;}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}if(isNullOrUndefined(this.footerRenderer)){this.initiateRender();}this.prepareSummaryInfo();this.footerRenderer.refresh();var cModel=new CaptionSummaryModelGenerator(this.parent);var gModel=new GroupSummaryModelGenerator(this.parent);if(gModel.getData().length!==0||!cModel.isEmpty()){this.parent.notify(modelChanged,{});}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(initialEnd,this.initiateRender,this);this.parent.on(uiUpdate,this.onPropertyChanged,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.footerRenderer.removeEventListener();this.parent.off(initialEnd,this.initiateRender);this.parent.off(dataReady,this.footerRenderer.refresh);this.parent.off(uiUpdate,this.onPropertyChanged);}},{key:'destroy',value:function destroy(){this.removeEventListener();remove(this.parent.element.querySelector('.e-gridfooter'));}}]);return Aggregate;}());InterSectionObserver=function(){function InterSectionObserver(element,options){var _this100=this;_classCallCheck(this,InterSectionObserver);this.fromWheel=false;this.touchMove=false;this.options={};this.sentinelInfo={'up':{check:function check(rect,info){var top=rect.top-_this100.containerRect.top;info.entered=top>=0;return top+_this100.options.pageHeight/2>=0;},axis:'Y'},'down':{check:function check(rect,info){var cHeight=_this100.options.container.clientHeight;var top=rect.bottom;info.entered=rect.bottom<=_this100.containerRect.bottom;return top-_this100.options.pageHeight/2<=_this100.options.pageHeight/2;},axis:'Y'},'right':{check:function check(rect,info){var right=rect.right;info.entered=right<_this100.containerRect.right;return right-_this100.containerRect.width<=_this100.containerRect.right;},axis:'X'},'left':{check:function check(rect,info){var left=rect.left;info.entered=left>0;return left+_this100.containerRect.width>=_this100.containerRect.left;},axis:'X'}};this.element=element;this.options=options;}_createClass(InterSectionObserver,[{key:'observe',value:function observe(callback,onEnterCallback){var _this101=this;this.containerRect=this.options.container.getBoundingClientRect();EventHandler.add(this.options.container,'wheel',function(){return _this101.fromWheel=true;},this);EventHandler.add(this.options.container,'scroll',this.virtualScrollHandler(callback,onEnterCallback),this);}},{key:'check',value:function check(direction){var info=this.sentinelInfo[direction];return info.check(this.element.getBoundingClientRect(),info);}},{key:'virtualScrollHandler',value:function virtualScrollHandler(callback,onEnterCallback){var _this102=this;var prevTop=0;var prevLeft=0;var debounced100=debounce(callback,100);var debounced50=debounce(callback,50);return function(e){var top=e.target.scrollTop;var left=e.target.scrollLeft;var direction=prevTop<top?'down':'up';direction=prevLeft===left?direction:prevLeft<left?'right':'left';prevTop=top;prevLeft=left;var current=_this102.sentinelInfo[direction];if(_this102.options.axes.indexOf(current.axis)===-1){return;}var check=_this102.check(direction);if(current.entered){onEnterCallback(_this102.element,current,direction,{top:top,left:left});}if(check){var fn=_this102.fromWheel?_this102.options.debounceEvent?debounced100:callback:debounced100;if(current.axis==='X'){fn=debounced50;}fn({direction:direction,sentinel:current,offset:{top:top,left:left}});}_this102.fromWheel=false;};}},{key:'setPageHeight',value:function setPageHeight(value){this.options.pageHeight=value;}}]);return InterSectionObserver;}();VirtualRowModelGenerator=function(){function VirtualRowModelGenerator(parent){_classCallCheck(this,VirtualRowModelGenerator);this.cOffsets={};this.cache={};this.data={};this.groups={};this.parent=parent;this.model=this.parent.pageSettings;this.rowModelGenerator=this.parent.allowGrouping?new GroupModelGenerator(this.parent):new RowModelGenerator(this.parent);}_createClass(VirtualRowModelGenerator,[{key:'generateRows',value:function generateRows(data,notifyArgs){var _this103=this;var info=notifyArgs.virtualInfo=notifyArgs.virtualInfo||this.getData();var xAxis=info.sentinelInfo&&info.sentinelInfo.axis==='X';var page=!xAxis&&info.loadNext&&!info.loadSelf?info.nextInfo.page:info.page;var result=[];var center=~~(this.model.pageSize/2);var indexes=this.getBlockIndexes(page);var loadedBlocks=[];this.checkAndResetCache(notifyArgs.requestType);if(this.parent.enableColumnVirtualization){info.blockIndexes.forEach(function(value){if(_this103.isBlockAvailable(value)){_this103.cache[value]=_this103.rowModelGenerator.refreshRows(_this103.cache[value]);}});}info.blockIndexes.forEach(function(value){if(!_this103.isBlockAvailable(value)){var rows=_this103.rowModelGenerator.generateRows(data,{virtualInfo:info,startIndex:_this103.getStartIndex(value,data)});var median=~~Math.max(rows.length,_this103.model.pageSize)/2;if(!_this103.isBlockAvailable(indexes[0])){_this103.cache[indexes[0]]=rows.slice(0,median);}if(!_this103.isBlockAvailable(indexes[1])){_this103.cache[indexes[1]]=rows.slice(median);}}if(_this103.parent.groupSettings.columns.length&&!xAxis&&_this103.cache[value]){_this103.cache[value]=_this103.updateGroupRow(_this103.cache[value],value);}result.push.apply(result,_toConsumableArray(_this103.cache[value]));if(_this103.isBlockAvailable(value)){loadedBlocks.push(value);}});info.blockIndexes=loadedBlocks;var grouping='records';if(this.parent.allowGrouping){this.parent.currentViewData[grouping]=result.map(function(m){return m.data;});}else{this.parent.currentViewData=result.map(function(m){return m.data;});}return result;}},{key:'getBlockIndexes',value:function getBlockIndexes(page){return[page+(page-1),page*2];}},{key:'getPage',value:function getPage(block){return block%2===0?block/2:(block+1)/2;}},{key:'isBlockAvailable',value:function isBlockAvailable(value){return value in this.cache;}},{key:'getData',value:function getData(){return{page:this.model.currentPage,blockIndexes:this.getBlockIndexes(this.model.currentPage),direction:'down',columnIndexes:this.parent.getColumnIndexesInView()};}},{key:'getStartIndex',value:function getStartIndex(blk,data){var full=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var page=this.getPage(blk);var even=blk%2===0;var index=(page-1)*this.model.pageSize;return full||!even?index:index+~~(this.model.pageSize/2);}},{key:'getColumnIndexes',value:function getColumnIndexes(){var _this104=this;var content=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.parent.getHeaderContent().firstChild;var indexes=[];var sLeft=content.scrollLeft|0;var keys=Object.keys(this.cOffsets);var cWidth=content.getBoundingClientRect().width;sLeft=Math.min(this.cOffsets[keys.length-1]-cWidth,sLeft);var calWidth=Browser.isDevice?2*cWidth:cWidth/2;var left=sLeft+cWidth+(sLeft===0?calWidth:0);keys.some(function(offset,indx,input){var iOffset=Number(offset);var offsetVal=_this104.cOffsets[offset];var border=sLeft-calWidth<=offsetVal&&left+calWidth>=offsetVal;if(border){indexes.push(iOffset);}return left+calWidth<offsetVal;});return indexes;}},{key:'checkAndResetCache',value:function checkAndResetCache(action){var clear=['paging','refresh','sorting','filtering','searching','grouping','ungrouping','reorder'].some(function(value){return action===value;});if(clear){this.cache={};this.data={};this.groups={};}return clear;}},{key:'refreshColOffsets',value:function refreshColOffsets(){var _this105=this;var col=0;this.cOffsets={};var gLen=this.parent.groupSettings.columns.length;var cols=this.parent.columns;var cLen=cols.length;var isVisible=function isVisible(column){return column.visible&&(!_this105.parent.groupSettings.showGroupedColumn?_this105.parent.groupSettings.columns.indexOf(column.field)<0:column.visible);};this.parent.groupSettings.columns.forEach(function(c,n){return _this105.cOffsets[n]=(_this105.cOffsets[n-1]|0)+30;});Array.apply(null,Array(cLen)).map(function(){return col++;}).forEach(function(block,i){block=block+gLen;_this105.cOffsets[block]=(_this105.cOffsets[block-1]|0)+(isVisible(cols[i])?parseInt(cols[i].width,10):0);});}},{key:'updateGroupRow',value:function updateGroupRow(current,block){var _this106=this;var currentFirst=current[0];var rows=[];Object.keys(this.cache).forEach(function(key){if(Number(key)<block){rows=[].concat(_toConsumableArray(rows),_toConsumableArray(_this106.cache[key]));}});if(currentFirst&&currentFirst.isDataRow||block%2===0){return current;}return this.iterateGroup(current,rows);}},{key:'iterateGroup',value:function iterateGroup(current,rows){var currentFirst=current[0];var offset=0;if(currentFirst&&currentFirst.isDataRow){return current;}var isPresent=current.some(function(row){return rows.some(function(oRow,index){var res=oRow&&oRow.data.field!==undefined&&oRow.data.field===row.data.field&&oRow.data.key===row.data.key;if(res){offset=index;}return res;});});if(isPresent){current.shift();current=this.iterateGroup(current,rows.slice(offset));}return current;}},{key:'getRows',value:function getRows(){var _this107=this;var rows=[];Object.keys(this.cache).forEach(function(key){return rows=[].concat(_toConsumableArray(rows),_toConsumableArray(_this107.cache[key]));});return rows;}}]);return VirtualRowModelGenerator;}();VirtualContentRenderer=function(_ContentRender2){_inherits(VirtualContentRenderer,_ContentRender2);function VirtualContentRenderer(parent,locator){_classCallCheck(this,VirtualContentRenderer);var _this108=_possibleConstructorReturn(this,(VirtualContentRenderer.__proto__||Object.getPrototypeOf(VirtualContentRenderer)).call(this,parent,locator));_this108.prevHeight=0;_this108.preventEvent=false;_this108.actions=['filtering','searching','grouping','ungrouping'];_this108.offsets={};_this108.tmpOffsets={};_this108.virtualEle=new VirtualElementHandler();_this108.offsetKeys=[];_this108.isFocused=false;_this108.locator=locator;_this108.eventListener('on');_this108.vgenerator=_this108.generator;return _this108;}_createClass(VirtualContentRenderer,[{key:'renderTable',value:function renderTable(){this.header=this.locator.getService('rendererFactory').getRenderer(RenderType.Header);_get(VirtualContentRenderer.prototype.__proto__||Object.getPrototypeOf(VirtualContentRenderer.prototype),'renderTable',this).call(this);this.virtualEle.table=this.getTable();this.virtualEle.content=this.content=this.getPanel().firstChild;this.virtualEle.renderWrapper();this.virtualEle.renderPlaceHolder();this.virtualEle.wrapper.style.position='absolute';var debounceEvent=this.parent.dataSource instanceof DataManager&&!this.parent.dataSource.dataSource.offline;var opt={container:this.content,pageHeight:this.getBlockHeight()*2,debounceEvent:debounceEvent,axes:this.parent.enableColumnVirtualization?['X','Y']:['Y']};this.observer=new InterSectionObserver(this.virtualEle.wrapper,opt);}},{key:'renderEmpty',value:function renderEmpty(tbody){this.getTable().appendChild(tbody);this.virtualEle.adjustTable(0,0);}},{key:'scrollListener',value:function scrollListener(scrollArgs){if(this.preventEvent||this.parent.isDestroyed){this.preventEvent=false;return;}this.isFocused=this.content===closest(document.activeElement,'.e-content')||this.content===document.activeElement;var info=scrollArgs.sentinel;var viewInfo=this.getInfoFromView(scrollArgs.direction,info,scrollArgs.offset);if(this.prevInfo&&(info.axis==='Y'&&this.prevInfo.blockIndexes.toString()===viewInfo.blockIndexes.toString()||info.axis==='X'&&this.prevInfo.columnIndexes.toString()===viewInfo.columnIndexes.toString())){return;}this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization?viewInfo.columnIndexes:[]);this.parent.pageSettings.currentPage=viewInfo.loadNext&&!viewInfo.loadSelf?viewInfo.nextInfo.page:viewInfo.page;this.parent.notify(viewInfo.event,{requestType:'virtualscroll',virtualInfo:viewInfo});}},{key:'block',value:function block(blk){return this.vgenerator.isBlockAvailable(blk);}},{key:'getInfoFromView',value:function getInfoFromView(direction,info,e){var tempBlocks=[];var infoType={direction:direction,sentinelInfo:info,offsets:e};infoType.page=this.getPageFromTop(e.top,infoType);infoType.blockIndexes=tempBlocks=this.vgenerator.getBlockIndexes(infoType.page);infoType.loadSelf=!this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);var blocks=this.ensureBlocks(infoType);infoType.blockIndexes=blocks;infoType.loadNext=!blocks.filter(function(val){return tempBlocks.indexOf(val)===-1;}).every(this.block.bind(this));infoType.event=infoType.loadNext||infoType.loadSelf?modelChanged:refreshVirtualBlock;infoType.nextInfo=infoType.loadNext?{page:Math.max(1,infoType.page+(direction==='down'?1:-1))}:{};infoType.columnIndexes=info.axis==='X'?this.vgenerator.getColumnIndexes():this.parent.getColumnIndexesInView();if(this.parent.enableColumnVirtualization&&info.axis==='X'){infoType.event=refreshVirtualBlock;}return infoType;}},{key:'ensureBlocks',value:function ensureBlocks(info){var _this109=this;var index=info.blockIndexes[info.block];var mIdx=void 0;var old=index;var max=Math.max;var indexes=info.direction==='down'?[max(index,1),++index,++index]:[max(index-1,1),index,index+1];indexes=indexes.filter(function(val,ind){return indexes.indexOf(val)===ind;});if(this.prevInfo.blockIndexes.toString()===indexes.toString()){return indexes;}if(info.loadSelf||info.direction==='down'&&this.isEndBlock(old)){indexes=this.vgenerator.getBlockIndexes(info.page);}indexes.some(function(val,ind){var result=val===_this109.getTotalBlocks();if(result){mIdx=ind;}return result;});if(mIdx!==undefined){indexes=indexes.slice(0,mIdx+1);if(info.block===0&&indexes.length===1&&this.vgenerator.isBlockAvailable(indexes[0]-1)){indexes=[indexes[0]-1,indexes[0]];}}return indexes;}},{key:'appendContent',value:function appendContent(target,newChild,e){var info=e.virtualInfo;this.prevInfo=this.prevInfo||e.virtualInfo;var cBlock=info.columnIndexes[0]-1;var cOffset=this.getColumnOffset(cBlock);var width=void 0;var blocks=info.blockIndexes;if(this.parent.groupSettings.columns.length){this.refreshOffsets();}var translate=this.getTranslateY(this.content.scrollTop,this.content.getBoundingClientRect().height,info);this.virtualEle.adjustTable(cOffset,translate);if(this.parent.enableColumnVirtualization){this.header.virtualEle.adjustTable(cOffset,0);}if(this.parent.enableColumnVirtualization){var cIndex=info.columnIndexes;width=this.getColumnOffset(cIndex[cIndex.length-1])-this.getColumnOffset(cIndex[0]-1)+'';this.header.virtualEle.setWrapperWidth(width);}this.virtualEle.setWrapperWidth(width,this.parent.enableColumnVirtualization||Browser.isIE);target.appendChild(newChild);this.getTable().appendChild(target);if(this.parent.groupSettings.columns.length){if(info.direction==='up'){var blk=this.offsets[this.getTotalBlocks()]-this.prevHeight;this.preventEvent=true;var sTop=this.content.scrollTop;this.content.scrollTop=sTop+blk;}this.setVirtualHeight();this.observer.setPageHeight(this.getOffset(blocks[blocks.length-1])-this.getOffset(blocks[0]-1));}this.prevInfo=info;if(this.isFocused){this.content.focus();}}},{key:'onDataReady',value:function onDataReady(e){if(!isNullOrUndefined(e.count)){this.count=e.count;this.maxPage=Math.ceil(e.count/this.parent.pageSettings.pageSize);}this.vgenerator.checkAndResetCache(e.requestType);this.refreshOffsets();this.setVirtualHeight();this.resetScrollPosition(e.requestType);}},{key:'setVirtualHeight',value:function setVirtualHeight(){var width=this.parent.enableColumnVirtualization?this.getColumnOffset(this.parent.columns.length+this.parent.groupSettings.columns.length-1)+'px':'100%';this.virtualEle.setVirtualHeight(this.offsets[this.getTotalBlocks()],width);if(this.parent.enableColumnVirtualization){this.header.virtualEle.setVirtualHeight(1,width);}}},{key:'getPageFromTop',value:function getPageFromTop(sTop,info){var _this110=this;var total=this.getTotalBlocks();var page=0;var extra=this.offsets[total]-this.prevHeight;this.offsetKeys.some(function(offset){var iOffset=Number(offset);var border=sTop<_this110.offsets[offset]||iOffset===total&&sTop>_this110.offsets[offset];if(border){info.block=iOffset%2===0?1:0;page=Math.max(1,Math.min(_this110.vgenerator.getPage(iOffset),_this110.maxPage));}return border;});return page;}},{key:'getTranslateY',value:function getTranslateY(sTop,cHeight,info){if(info===undefined){info={page:this.getPageFromTop(sTop,{})};info.blockIndexes=this.vgenerator.getBlockIndexes(info.page);}var block=(info.blockIndexes[0]||1)-1;var translate=this.getOffset(block);var endTranslate=this.getOffset(info.blockIndexes[info.blockIndexes.length-1]);return translate>sTop?this.getOffset(block-1):endTranslate<sTop+cHeight?this.getOffset(block+1):translate;}},{key:'getOffset',value:function getOffset(block){return Math.min(this.offsets[block]|0,this.offsets[this.maxBlock]);}},{key:'onEntered',value:function onEntered(){var _this111=this;return function(element,current,direction,e){var xAxis=current.axis==='X';var top=_this111.prevInfo.offsets?_this111.prevInfo.offsets.top:null;var height=_this111.content.getBoundingClientRect().height;var x=_this111.getColumnOffset(xAxis?_this111.vgenerator.getColumnIndexes()[0]-1:_this111.prevInfo.columnIndexes[0]-1);var y=_this111.getTranslateY(e.top,height,xAxis&&top===e.top?_this111.prevInfo:undefined);_this111.virtualEle.adjustTable(x,Math.min(y,_this111.offsets[_this111.maxBlock]));if(_this111.parent.enableColumnVirtualization){_this111.header.virtualEle.adjustTable(x,0);}};}},{key:'eventListener',value:function eventListener(action){var _this112=this;this.parent[action](dataReady,this.onDataReady,this);this.parent[action](refreshVirtualBlock,this.refreshContentRows,this);this.actions.forEach(function(event){return _this112.parent[action](event+'-begin',_this112.onActionBegin,_this112);});var fn=function fn(){_this112.observer.observe(function(scrollArgs){return _this112.scrollListener(scrollArgs);},_this112.onEntered());_this112.parent.off(contentReady,fn);};this.parent.on(contentReady,fn,this);}},{key:'getBlockSize',value:function getBlockSize(){return this.parent.pageSettings.pageSize>>1;}},{key:'getBlockHeight',value:function getBlockHeight(){return this.getBlockSize()*this.getRowHeight();}},{key:'isEndBlock',value:function isEndBlock(index){var totalBlocks=this.getTotalBlocks();return index>=totalBlocks||index===totalBlocks-1;}},{key:'getRowHeight',value:function getRowHeight(){return this.parent.rowHeight?this.parent.rowHeight:_getRowHeight();}},{key:'getTotalBlocks',value:function getTotalBlocks(){return Math.ceil(this.count/this.getBlockSize());}},{key:'getColumnOffset',value:function getColumnOffset(block){return this.vgenerator.cOffsets[block]|0;}},{key:'getModelGenerator',value:function getModelGenerator(){return new VirtualRowModelGenerator(this.parent);}},{key:'resetScrollPosition',value:function resetScrollPosition(action){if(this.actions.some(function(value){return value===action;})){this.preventEvent=this.content.scrollTop!==0;this.content.scrollTop=0;}}},{key:'onActionBegin',value:function onActionBegin(e){//Update property silently..
this.parent.setProperties({pageSettings:{currentPage:1}},true);}},{key:'getRows',value:function getRows(){return this.vgenerator.getRows();}},{key:'getRowByIndex',value:function getRowByIndex(index){var prev=this.prevInfo.blockIndexes;var startIdx=(prev[0]-1)*this.getBlockSize();return this.parent.getDataRows()[index-startIdx];}},{key:'getVirtualRowIndex',value:function getVirtualRowIndex(index){var prev=this.prevInfo.blockIndexes;var startIdx=(prev[0]-1)*this.getBlockSize();return startIdx+index;}},{key:'refreshOffsets',value:function refreshOffsets(){var _this113=this;var row=0;var bSize=this.getBlockSize();var total=this.getTotalBlocks();this.prevHeight=this.offsets[total];this.maxBlock=total%2===0?total-2:total-1;this.offsets={};//Row offset update
Array.apply(null,Array(total)).map(function(){return++row;}).forEach(function(block){var tmp=(_this113.vgenerator.cache[block]||[]).length;var rem=_this113.count%bSize;var size=block in _this113.vgenerator.cache?tmp*_this113.getRowHeight():rem&&block===total?rem*_this113.getRowHeight():_this113.getBlockHeight();// let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?
// tmp * getRowHeight() : this.getBlockHeight();
_this113.offsets[block]=(_this113.offsets[block-1]|0)+size;_this113.tmpOffsets[block]=_this113.offsets[block-1]|0;});this.offsetKeys=Object.keys(this.offsets);//Column offset update
if(this.parent.enableColumnVirtualization){this.vgenerator.refreshColOffsets();}}},{key:'refreshVirtualElement',value:function refreshVirtualElement(){this.vgenerator.refreshColOffsets();this.setVirtualHeight();}}]);return VirtualContentRenderer;}(ContentRender);VirtualHeaderRenderer=function(_HeaderRender){_inherits(VirtualHeaderRenderer,_HeaderRender);function VirtualHeaderRenderer(parent,locator){_classCallCheck(this,VirtualHeaderRenderer);var _this114=_possibleConstructorReturn(this,(VirtualHeaderRenderer.__proto__||Object.getPrototypeOf(VirtualHeaderRenderer)).call(this,parent,locator));_this114.virtualEle=new VirtualElementHandler();_this114.gen=new VirtualRowModelGenerator(_this114.parent);_this114.parent.on(refreshVirtualBlock,function(e){return e.virtualInfo.sentinelInfo.axis==='X'?_this114.refreshUI():null;},_this114);return _this114;}_createClass(VirtualHeaderRenderer,[{key:'renderTable',value:function renderTable(){this.gen.refreshColOffsets();this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().firstChild));_get(VirtualHeaderRenderer.prototype.__proto__||Object.getPrototypeOf(VirtualHeaderRenderer.prototype),'renderTable',this).call(this);this.virtualEle.table=this.getTable();this.virtualEle.content=this.getPanel().firstChild;this.virtualEle.content.style.position='relative';this.virtualEle.renderWrapper();this.virtualEle.renderPlaceHolder('absolute');}},{key:'appendContent',value:function appendContent(table){this.virtualEle.wrapper.appendChild(table);}},{key:'refreshUI',value:function refreshUI(){this.gen.refreshColOffsets();this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().firstChild));_get(VirtualHeaderRenderer.prototype.__proto__||Object.getPrototypeOf(VirtualHeaderRenderer.prototype),'refreshUI',this).call(this);}}]);return VirtualHeaderRenderer;}(HeaderRender);VirtualElementHandler=function(){function VirtualElementHandler(){_classCallCheck(this,VirtualElementHandler);}_createClass(VirtualElementHandler,[{key:'renderWrapper',value:function renderWrapper(){this.wrapper=createElement('div',{className:'e-virtualtable'});this.wrapper.appendChild(this.table);this.content.appendChild(this.wrapper);}},{key:'renderPlaceHolder',value:function renderPlaceHolder(){var position=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'relative';this.placeholder=createElement('div',{className:'e-virtualtrack',styles:'position:'+position});this.content.appendChild(this.placeholder);}},{key:'adjustTable',value:function adjustTable(xValue,yValue){this.wrapper.style.transform='translate('+xValue+'px, '+yValue+'px)';}},{key:'setWrapperWidth',value:function setWrapperWidth(width,full){this.wrapper.style.width=width?width+'px':full?'100%':'';}},{key:'setVirtualHeight',value:function setVirtualHeight(height,width){this.placeholder.style.height=height+'px';this.placeholder.style.width=width;}}]);return VirtualElementHandler;}();_export('VirtualScroll',VirtualScroll=function(){function VirtualScroll(parent,locator){_classCallCheck(this,VirtualScroll);this.parent=parent;this.locator=locator;this.addEventListener();}_createClass(VirtualScroll,[{key:'getModuleName',value:function getModuleName(){return'virtualscroll';}},{key:'instantiateRenderer',value:function instantiateRenderer(){var renderer=this.locator.getService('rendererFactory');if(this.parent.enableColumnVirtualization){renderer.addRenderer(RenderType.Header,new VirtualHeaderRenderer(this.parent,this.locator));}renderer.addRenderer(RenderType.Content,new VirtualContentRenderer(this.parent,this.locator));this.ensurePageSize();}},{key:'ensurePageSize',value:function ensurePageSize(){var rowHeight=_getRowHeight(this.parent.element);this.blockSize=~~(this.parent.height/rowHeight);var height=this.blockSize*2;var size=this.parent.pageSettings.pageSize;this.parent.setProperties({pageSettings:{pageSize:size<height?height:size}},true);}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(initialLoad,this.instantiateRenderer,this);this.parent.on(columnWidthChanged,this.refreshVirtualElement,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialLoad,this.instantiateRenderer);this.parent.off(columnWidthChanged,this.refreshVirtualElement);}},{key:'refreshVirtualElement',value:function refreshVirtualElement(args){if(this.parent.enableColumnVirtualization&&args.module==='resize'){var renderer=this.locator.getService('rendererFactory');renderer.getRenderer(RenderType.Content).refreshVirtualElement();}}},{key:'destroy',value:function destroy(){this.removeEventListener();}}]);return VirtualScroll;}());_export('InlineEditRender',InlineEditRender=function(){/**
     * Constructor for render module
     */function InlineEditRender(parent){_classCallCheck(this,InlineEditRender);this.parent=parent;}_createClass(InlineEditRender,[{key:'addNew',value:function addNew(elements,args){var mTbody=void 0;var tbody=void 0;if(this.parent.frozenRows){tbody=this.parent.getHeaderContent().querySelector('tbody');}else{tbody=this.parent.getContentTable().querySelector('tbody');}args.row=createElement('tr',{className:'e-row e-addedrow'});if(tbody.querySelector('.e-emptyrow')){tbody.querySelector('.e-emptyrow').classList.add('e-hide');}tbody.insertBefore(args.row,tbody.firstChild);args.row.appendChild(this.getEditElement(elements,false));if(this.parent.getFrozenColumns()){var mEle=this.renderMovableform(args.row);if(this.parent.frozenRows){mTbody=this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');}else{mTbody=this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');}mTbody.insertBefore(mEle,mTbody.firstChild);args.row.querySelector('.e-normaledit').setAttribute('colspan',this.parent.getFrozenColumns()+'');mEle.setAttribute('colspan',''+(this.parent.getColumns().length-this.parent.getFrozenColumns()));}}},{key:'renderMovableform',value:function renderMovableform(ele){var mEle=ele.cloneNode(true);this.renderMovable(ele,mEle);mEle.querySelector('colgroup').innerHTML=this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup').innerHTML;return mEle;}},{key:'updateFreezeEdit',value:function updateFreezeEdit(row,td){if(this.parent.getFrozenColumns()){var idx=parseInt(row.getAttribute('aria-rowindex'),10);var fCont=this.parent.getContent().querySelector('.e-frozencontent').querySelector('tbody');var mCont=this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');var fHdr=this.parent.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody');var mHdr=this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');if(this.parent.frozenRows&&idx>=this.parent.frozenRows){idx-=this.parent.frozenRows;}if(fCont.contains(row)){td=td.concat([].slice.call(mCont.children[idx].querySelectorAll('td.e-rowcell')));}else if(mCont.contains(row)){td=td.concat([].slice.call(fCont.children[idx].querySelectorAll('td.e-rowcell')));}else if(fHdr.contains(row)){td=td.concat([].slice.call(mHdr.children[idx].querySelectorAll('td.e-rowcell')));}else if(mHdr.contains(row)){td=td.concat([].slice.call(fHdr.children[idx].querySelectorAll('td.e-rowcell')));}}return td;}},{key:'update',value:function update(elements,args){var tdElement=[].slice.call(args.row.querySelectorAll('td.e-rowcell'));args.row.innerHTML='';tdElement=this.updateFreezeEdit(args.row,tdElement);args.row.appendChild(this.getEditElement(elements,true,tdElement));args.row.classList.add('e-editedrow');this.refreshFreezeEdit(args.row);}},{key:'refreshFreezeEdit',value:function refreshFreezeEdit(row){var td=row.firstChild;var fCls=void 0;var cont=void 0;var idx=parseInt(row.getAttribute('aria-rowindex'),10);if(this.parent.getFrozenColumns()){if(idx<this.parent.frozenRows){cont=this.parent.getHeaderContent();fCls='.e-frozenheader';}else{cont=this.parent.getContent();fCls='.e-frozencontent';}var mTd=td.cloneNode(true);var fRows=void 0;if(cont.querySelector(fCls).contains(row)){fRows=this.parent.getMovableRowByIndex(idx);this.updateFrozenCont(fRows,td,mTd);}else{fRows=this.parent.getRowByIndex(idx);this.updateFrozenCont(fRows,mTd,td);}fRows.appendChild(mTd);fRows.classList.add('e-editedrow');}}},{key:'updateFrozenCont',value:function updateFrozenCont(row,ele,mEle){row.innerHTML='';this.renderMovable(ele,mEle);mEle.querySelector('colgroup').innerHTML=this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup').innerHTML;ele.setAttribute('colspan',this.parent.getFrozenColumns()+'');mEle.setAttribute('colspan',this.parent.getColumns().length-this.parent.getFrozenColumns()+'');}},{key:'renderMovable',value:function renderMovable(ele,mEle){var frzCols=this.parent.getFrozenColumns();for(var i=0;i<frzCols;i++){mEle.querySelector('tr').removeChild(mEle.querySelector('tr').children[0]);}for(var _i15=frzCols,len=ele.querySelector('tr').childElementCount;_i15<len;_i15++){ele.querySelector('tr').removeChild(ele.querySelector('tr').children[ele.querySelector('tr').childElementCount-1]);}}},{key:'getEditElement',value:function getEditElement(elements,isEdit,tdElement){var gObj=this.parent;var gLen=0;var isDetail=!isNullOrUndefined(gObj.detailTemplate)||!isNullOrUndefined(gObj.childGrid)?1:0;if(gObj.allowGrouping){gLen=gObj.groupSettings.columns.length;}var td=createElement('td',{className:'e-editcell e-normaledit',attrs:{colspan:(gObj.getVisibleColumns().length+gLen+isDetail).toString()}});var form=createElement('form',{id:gObj.element.id+'EditForm',className:'e-gridform'});var table=createElement('table',{className:'e-table e-inline-edit',attrs:{cellspacing:'0.25'}});table.appendChild(gObj.getContentTable().querySelector('colgroup').cloneNode(true));var tbody=createElement('tbody');var tr=createElement('tr');var i=0;if(isDetail){tr.insertBefore(createElement('td',{className:'e-detailrowcollapse'}),tr.firstChild);}while(i<gLen){tr.appendChild(createElement('td',{className:'e-indentcell'}));i++;}var m=0;i=0;while(isEdit&&m<tdElement.length&&i<gObj.getColumns().length||i<gObj.getColumns().length){var span=isEdit?tdElement[m].getAttribute('colspan'):null;var col=gObj.getColumns()[i];var _td=createElement('td',{className:'e-rowcell',attrs:{style:'text-align:'+(col.textAlign?col.textAlign:''),'colspan':span?span:''}});if(col.visible){_td.appendChild(elements[col.uid]);if(col.editType==='booleanedit'){_td.classList.add('e-boolcell');}else if(col.commands||col.commandsTemplate){addClass([_td],'e-unboundcell');}}else{_td.classList.add('e-hide');}tr.appendChild(_td);i=span?i+parseInt(span,10):i+1;m++;}tbody.appendChild(tr);table.appendChild(tbody);form.appendChild(table);td.appendChild(form);return td;}},{key:'removeEventListener',value:function removeEventListener(){//To destroy the renderer
}}]);return InlineEditRender;}());_export('BatchEditRender',BatchEditRender=function(){/**
     * Constructor for render module
     */function BatchEditRender(parent){_classCallCheck(this,BatchEditRender);this.parent=parent;}_createClass(BatchEditRender,[{key:'update',value:function update(elements,args){args.cell.innerHTML='';args.cell.appendChild(this.getEditElement(elements,args));args.cell.classList.add('e-editedbatchcell');classList(args.row,['e-editedrow','e-batchrow'],[]);}},{key:'getEditElement',value:function getEditElement(elements,args){var gObj=this.parent;var form=createElement('form',{id:gObj.element.id+'EditForm',className:'e-gridform'});form.appendChild(elements[args.columnObject.uid]);if(args.columnObject.editType==='booleanedit'){args.cell.classList.add('e-boolcell');}if(!args.columnObject.editType){args.cell.classList.add('e-inputbox');}return form;}},{key:'removeEventListener',value:function removeEventListener(){//To destroy the renderer
}}]);return BatchEditRender;}());_export('DialogEditRender',DialogEditRender=function(){/**
     * Constructor for render module
     */function DialogEditRender(parent,serviceLocator){_classCallCheck(this,DialogEditRender);this.parent=parent;this.serviceLocator=serviceLocator;if(this.parent.isDestroyed){return;}this.parent.on(dialogDestroy,this.destroy,this);this.parent.on(_destroy,this.destroy,this);}_createClass(DialogEditRender,[{key:'setLocaleObj',value:function setLocaleObj(){this.l10n=this.serviceLocator.getService('localization');}},{key:'addNew',value:function addNew(elements,args){this.isEdit=false;this.createDialog(elements,args);}},{key:'update',value:function update(elements,args){this.isEdit=true;this.createDialog(elements,args);}},{key:'createDialog',value:function createDialog(elements,args){var gObj=this.parent;this.dialog=createElement('div',{id:gObj.element.id+'_dialogEdit_wrapper'});gObj.element.appendChild(this.dialog);this.setLocaleObj();var position=this.parent.element.getBoundingClientRect().height<400?{X:'center',Y:'top'}:{X:'center',Y:'center'};this.dialogObj=new Dialog({header:this.isEdit?this.l10n.getConstant('EditFormTitle')+'  '+args.primaryKeyValue[0]:this.l10n.getConstant('AddFormTitle'),isModal:true,visible:true,cssClass:'e-edit-dialog',content:this.getEditElement(elements),showCloseIcon:true,allowDragging:true,position:position,close:this.dialogClose.bind(this),closeOnEscape:true,width:'330px',target:gObj.element,animationSettings:{effect:'None'},buttons:[{click:this.btnClick.bind(this),buttonModel:{content:this.l10n.getConstant('SaveButton'),cssClass:'e-primary',isPrimary:true}},{click:this.btnClick.bind(this),buttonModel:{cssClass:'e-flat',content:this.l10n.getConstant('CancelButton')}}]});this.dialogObj.appendTo(this.dialog);changeButtonType(this.dialogObj.element);}},{key:'btnClick',value:function btnClick(e){if(this.l10n.getConstant('CancelButton').toLowerCase()===e.target.innerText.toLowerCase()){this.dialogClose();}else{this.parent.endEdit();}}},{key:'dialogClose',value:function dialogClose(){this.parent.closeEdit();this.destroy();}},{key:'destroy',value:function destroy(args){this.parent.notify(destroyForm,{});this.parent.isEdit=false;this.parent.notify(toolbarRefresh,{});if(this.dialog&&!this.dialogObj.isDestroyed){this.dialogObj.destroy();remove(this.dialog);}}},{key:'getEditElement',value:function getEditElement(elements){var gObj=this.parent;var div=createElement('div',{className:this.isEdit?'e-editedrow':'e-insertedrow'});var form=createElement('form',{id:gObj.element.id+'EditForm',className:'e-gridform'});var table=createElement('table',{className:'e-table',attrs:{cellspacing:'6px'}});var tbody=createElement('tbody');var cols=gObj.getColumns();for(var i=0;i<cols.length;i++){if(!cols[i].visible||cols[i].commands||cols[i].commandsTemplate){continue;}var tr=createElement('tr');var dataCell=createElement('td',{className:'e-rowcell',attrs:{style:'text-align:'+(this.parent.enableRtl?'right':'left')+';width:190px'}});var label=createElement('label',{innerHTML:cols[i].field});elements[cols[i].uid].classList.remove('e-input');dataCell.appendChild(elements[cols[i].uid]);tr.appendChild(dataCell);tbody.appendChild(tr);}table.appendChild(tbody);form.appendChild(table);div.appendChild(form);return div;}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(dialogDestroy,this.destroy);this.parent.off(_destroy,this.destroy);}}]);return DialogEditRender;}());_export('EditRender',EditRender=function(){/**
     * Constructor for render module
     */function EditRender(parent,serviceLocator){_classCallCheck(this,EditRender);//Internal variables               
this.editType={'Inline':InlineEditRender,'Normal':InlineEditRender,'Batch':BatchEditRender,'Dialog':DialogEditRender};this.parent=parent;this.serviceLocator=serviceLocator;this.renderer=new this.editType[this.parent.editSettings.mode](parent,serviceLocator);this.focus=serviceLocator.getService('focus');}_createClass(EditRender,[{key:'addNew',value:function addNew(args){this.renderer.addNew(this.getEditElements(args),args);this.convertWidget(args);}},{key:'update',value:function update(args){this.renderer.update(this.getEditElements(args),args);this.convertWidget(args);}},{key:'convertWidget',value:function convertWidget(args){var gObj=this.parent;var isFocused=void 0;var cell=void 0;var value=void 0;var fForm=void 0;var frzCols=gObj.getFrozenColumns();var form=gObj.element.querySelector('.e-gridform');if(frzCols&&gObj.editSettings.mode==='Normal'){var rowIndex=parseInt(args.row.getAttribute('aria-rowindex'),10);if(gObj.frozenRows&&(args.requestType==='add'||rowIndex<gObj.frozenRows)){fForm=gObj.element.querySelector('.e-movableheader').querySelector('.e-gridform');}else{fForm=gObj.element.querySelector('.e-movablecontent').querySelector('.e-gridform');}}var cols=gObj.editSettings.mode!=='Batch'?gObj.getColumns():[gObj.getColumnByField(args.columnName)];var _iteratorNormalCompletion48=true;var _didIteratorError48=false;var _iteratorError48=undefined;try{for(var _iterator48=cols[Symbol.iterator](),_step48;!(_iteratorNormalCompletion48=(_step48=_iterator48.next()).done);_iteratorNormalCompletion48=true){var col=_step48.value;if(!col.visible||col.commands){continue;}value=col.valueAccessor(col.field,args.rowData,col);if(frzCols&&cols.indexOf(col)>=frzCols&&gObj.editSettings.mode==='Normal'){cell=fForm.querySelector('[e-mappinguid='+col.uid+']');}else{cell=form.querySelector('[e-mappinguid='+col.uid+']');}var temp=col.edit.write;if(!isNullOrUndefined(cell)){col.edit.write({rowData:args.rowData,element:cell,column:col,requestType:args.requestType,row:args.row,foreignKeyData:col.isForeignColumn()&&getValue(col.field,args.foreignKeyData)});if(!isFocused&&!cell.getAttribute('disabled')){this.focusElement(cell,args.type);isFocused=true;}}}}catch(err){_didIteratorError48=true;_iteratorError48=err;}finally{try{if(!_iteratorNormalCompletion48&&_iterator48.return){_iterator48.return();}}finally{if(_didIteratorError48){throw _iteratorError48;}}}}},{key:'focusElement',value:function focusElement(elem,type){var chkBox=this.parent.element.querySelector('.e-edit-checkselect');if(!isNullOrUndefined(chkBox)){chkBox.nextElementSibling.classList.add('e-focus');}if(this.parent.editSettings.mode==='Batch'){this.focus.onClick({target:closest(elem,'td')},true);}else{elem.focus();}if(elem.classList.contains('e-defaultcell')){elem.setSelectionRange(elem.value.length,elem.value.length);}}},{key:'getEditElements',value:function getEditElements(args){var gObj=this.parent;var elements={};var cols=gObj.editSettings.mode!=='Batch'?gObj.getColumns():[gObj.getColumnByField(args.columnName)];for(var i=0,len=cols.length;i<len;i++){var col=cols[i];if(!col.visible){continue;}if(col.commands||col.commandsTemplate){var cellRendererFact=this.serviceLocator.getService('cellRendererFactory');var model=new RowModelGenerator(this.parent);var cellRenderer=cellRendererFact.getCellRenderer(CellType.CommandColumn);var cells=model.generateRows(args.rowData)[0].cells;var td=cellRenderer.render(cells[i],args.rowData,{'index':args.row?args.row.getAttribute('aria-rowindex'):0});var div=td.firstElementChild;div.setAttribute('textAlign',td.getAttribute('textAlign'));elements[col.uid]=div;continue;}var value=col.valueAccessor(col.field,args.rowData,col);var tArgs={column:col,value:value,type:args.requestType,data:args.rowData};var temp=col.edit.create;var input=void 0;input=col.edit.create(tArgs);if(typeof input==='string'){var _div=createElement('div');_div.innerHTML=input;input=_div.firstChild;}var isInput=input.tagName!=='input'&&input.querySelectorAll('input').length;attributes(isInput?input.querySelector('input'):input,{name:col.field,'e-mappinguid':col.uid,id:gObj.element.id+col.field});classList(input,['e-input','e-field'],[]);if(col.textAlign==='Right'){input.classList.add('e-ralign');}if((col.isPrimaryKey||col.isIdentity)&&args.requestType==='beginEdit'||col.isIdentity&&args.requestType==='add'){input.setAttribute('disabled','true');}elements[col.uid]=input;}return elements;}},{key:'destroy',value:function destroy(){this.renderer.removeEventListener();}}]);return EditRender;}());_export('BooleanEditCell',BooleanEditCell=function(){function BooleanEditCell(parent){_classCallCheck(this,BooleanEditCell);this.activeClasses=['e-selectionbackground','e-active'];this.parent=parent;}_createClass(BooleanEditCell,[{key:'create',value:function create(args){var col=args.column;var classNames='e-field e-boolcell';if(col.type==='checkbox'){classNames='e-field e-boolcell e-edit-checkselect';}return createElement('input',{className:classNames,attrs:{type:'checkbox',value:args.value,'e-mappinguid':col.uid,id:this.parent.element.id+col.field,name:col.field}});}},{key:'read',value:function read(element){return element.checked;}},{key:'write',value:function write(args){var selectChkBox=void 0;var chkState=void 0;if(!isNullOrUndefined(args.row)){selectChkBox=args.row.querySelector('.e-edit-checkselect');}if(args.rowData[args.column.field]){chkState=JSON.parse(args.rowData[args.column.field].toString().toLowerCase());}if(!isNullOrUndefined(selectChkBox)){this.editType=this.parent.editSettings.mode;this.editRow=args.row;if(args.requestType!=='add'){var row=this.parent.getRowObjectFromUID(args.row.getAttribute('data-uid'));chkState=row?row.isSelected:false;}addRemoveActiveClasses.apply(undefined,[[].slice.call(args.row.querySelectorAll('.e-rowcell')),chkState].concat(_toConsumableArray(this.activeClasses)));}this.obj=new CheckBox(extend({label:this.parent.editSettings.mode!=='Dialog'?'':args.column.headerText,checked:chkState,disabled:!isEditable(args.column,args.requestType,args.element),enableRtl:this.parent.enableRtl,change:this.checkBoxChange.bind(this)},args.column.edit.params));this.obj.appendTo(args.element);}},{key:'checkBoxChange',value:function checkBoxChange(args){if(this.editRow&&this.editType!=='Dialog'){var add=false;if(!args.checked){this.editRow.removeAttribute('aria-selected');}else{add=true;this.editRow.setAttribute('aria-selected',add.toString());}addRemoveActiveClasses.apply(undefined,[[].slice.call(this.editRow.querySelectorAll('.e-rowcell')),add].concat(_toConsumableArray(this.activeClasses)));}}},{key:'destroy',value:function destroy(){if(this.obj){this.obj.destroy();}}}]);return BooleanEditCell;}());_export('DropDownEditCell',DropDownEditCell=function(){function DropDownEditCell(parent){_classCallCheck(this,DropDownEditCell);//constructor
this.parent=parent;}_createClass(DropDownEditCell,[{key:'create',value:function create(args){//create
return createElement('input',{className:'e-field',attrs:{id:this.parent.element.id+args.column.field,name:args.column.field,type:'text','e-mappinguid':args.column.uid}});}},{key:'write',value:function write(args){this.column=args.column;var isInline=this.parent.editSettings.mode!=='Dialog';this.obj=new DropDownList(extend({dataSource:this.parent.dataSource instanceof DataManager?this.parent.dataSource:new DataManager(this.parent.dataSource),query:new Query().select(args.column.field),enabled:isEditable(args.column,args.requestType,args.element),fields:{value:args.column.field},value:args.rowData[args.column.field],enableRtl:this.parent.enableRtl,actionComplete:this.ddActionComplete.bind(this),placeholder:isInline?'':args.column.headerText,popupHeight:'200px',floatLabelType:isInline?'Never':'Always',open:this.dropDownOpen.bind(this),sortOrder:'Ascending'},args.column.edit.params));this.obj.appendTo(args.element);args.element.setAttribute('name',args.column.field);}},{key:'read',value:function read(element){return element.ej2_instances[0].value;}},{key:'ddActionComplete',value:function ddActionComplete(e){e.result=DataUtil.distinct(e.result,this.column.isForeignColumn()?this.column.foreignKeyField:this.column.field,true);if(this.column.dataSource){this.column.dataSource.dataSource.json=e.result;}}},{key:'dropDownOpen',value:function dropDownOpen(args){var dlgElement=parentsUntil(this.obj.element,'e-dialog');if(!isNullOrUndefined(dlgElement)){var dlgObj=this.parent.element.querySelector('#'+dlgElement.id).ej2_instances[0];args.popup.element.style.zIndex=(dlgObj.zIndex+1).toString();}}},{key:'destroy',value:function destroy(){if(this.obj){this.obj.destroy();}}}]);return DropDownEditCell;}());_export('NumericEditCell',NumericEditCell=function(){function NumericEditCell(parent){_classCallCheck(this,NumericEditCell);this.parent=parent;}_createClass(NumericEditCell,[{key:'create',value:function create(args){return createElement('input',{className:'e-field',attrs:{id:this.parent.element.id+args.column.field,name:args.column.field,'e-mappinguid':args.column.uid}});}},{key:'read',value:function read(element){element.blur();return element.ej2_instances[0].value;}},{key:'write',value:function write(args){var col=args.column;var isInline=this.parent.editSettings.mode!=='Dialog';this.obj=new NumericTextBox(extend({value:parseFloat(args.rowData[col.field]),enableRtl:this.parent.enableRtl,placeholder:isInline?'':args.column.headerText,enabled:isEditable(args.column,args.requestType,args.element),floatLabelType:this.parent.editSettings.mode!=='Dialog'?'Never':'Always'},col.edit.params));this.obj.appendTo(args.element);args.element.setAttribute('name',col.field);}},{key:'destroy',value:function destroy(){if(this.obj&&!this.obj.isDestroyed){this.obj.destroy();}}}]);return NumericEditCell;}());_export('DefaultEditCell',DefaultEditCell=function(){function DefaultEditCell(parent){_classCallCheck(this,DefaultEditCell);this.parent=parent;}_createClass(DefaultEditCell,[{key:'create',value:function create(args){var col=args.column;var input=createElement('input',{className:'e-field e-input e-defaultcell',attrs:{type:'text',value:!isNullOrUndefined(args.value)?args.value:'','e-mappinguid':col.uid,id:this.parent.element.id+col.field,name:col.field,style:'text-align:'+col.textAlign}});return input;}},{key:'read',value:function read(element){return element.value;}},{key:'write',value:function write(args){var col=args.column;var isInline=this.parent.editSettings.mode!=='Dialog';Input.createInput({element:args.element,floatLabelType:this.parent.editSettings.mode!=='Dialog'?'Never':'Always',properties:{enableRtl:this.parent.enableRtl,enabled:isEditable(args.column,args.requestType,args.element),placeholder:isInline?'':args.column.headerText}});}}]);return DefaultEditCell;}());_export('NormalEdit',NormalEdit=function(){function NormalEdit(parent,serviceLocator,renderer){_classCallCheck(this,NormalEdit);this.parent=parent;this.renderer=renderer;this.serviceLocator=serviceLocator;this.addEventListener();}_createClass(NormalEdit,[{key:'clickHandler',value:function clickHandler(e){var target=e.target;var gObj=this.parent;if((parentsUntil(target,'e-gridcontent')&&parentsUntil(parentsUntil(target,'e-gridcontent'),'e-grid').id===gObj.element.id||gObj.frozenRows&&parentsUntil(target,'e-headercontent'))&&!parentsUntil(target,'e-unboundcelldiv')){this.rowIndex=parentsUntil(target,'e-rowcell')?parseInt(target.parentElement.getAttribute('aria-rowindex'),10):-1;if(gObj.isEdit){gObj.editModule.endEdit();}}}},{key:'dblClickHandler',value:function dblClickHandler(e){if(parentsUntil(e.target,'e-rowcell')&&this.parent.editSettings.allowEditOnDblClick){this.parent.editModule.startEdit(parentsUntil(e.target,'e-row'));}}},{key:'editComplete',value:function editComplete(e){this.parent.isEdit=false;switch(e.requestType){case'save':if(!(this.parent.isCheckBoxSelection||this.parent.selectionSettings.type==='Multiple')||!this.parent.isPersistSelection){this.parent.selectRow(0);}this.parent.trigger(actionComplete,extend(e,{requestType:'save',type:actionComplete}));break;case'delete':this.parent.selectRow(this.editRowIndex);this.parent.trigger(actionComplete,extend(e,{requestType:'delete',type:actionComplete}));break;}}},{key:'startEdit',value:function startEdit(tr){var gObj=this.parent;var primaryKeys=gObj.getPrimaryKeyFieldNames();var primaryKeyValues=[];this.rowIndex=this.editRowIndex=parseInt(tr.getAttribute('aria-rowindex'),10);this.previousData=gObj.getCurrentViewRecords()[this.rowIndex];for(var i=0;i<primaryKeys.length;i++){primaryKeyValues.push(this.previousData[primaryKeys[i]]);}this.uid=tr.getAttribute('data-uid');var rowObj=gObj.getRowObjectFromUID(this.uid);var args={row:tr,primaryKey:primaryKeys,primaryKeyValue:primaryKeyValues,requestType:'beginEdit',rowData:this.previousData,rowIndex:this.rowIndex,type:'edit',cancel:false,foreignKeyData:rowObj&&rowObj.foreignKeyData};gObj.trigger(beginEdit,args);args.type='actionBegin';gObj.trigger(actionBegin,args);if(args.cancel){return;}gObj.isEdit=true;gObj.clearSelection();if(gObj.editSettings.mode==='Dialog'){args.row.classList.add('e-dlgeditrow');}this.renderer.update(args);this.uid=tr.getAttribute('data-uid');gObj.editModule.applyFormValidation();args.type='actionComplete';gObj.trigger(actionComplete,args);if(this.parent.allowTextWrap){this.parent.notify(freezeRender,{case:'textwrap'});}}},{key:'updateRow',value:function updateRow(index,data){var gObj=this.parent;var args={requestType:'save',type:actionBegin,data:data,cancel:false,previousData:gObj.getCurrentViewRecords()[index]};gObj.showSpinner();gObj.notify(updateData,args);gObj.refresh();}},{key:'endEdit',value:function endEdit(){var gObj=this.parent;if(!this.parent.isEdit||!gObj.editModule.formObj.validate()||gObj.editModule.mFormObj&&!gObj.editModule.mFormObj.validate()){return;}var editedData=extend({},this.previousData);var args={requestType:'save',type:actionBegin,data:editedData,cancel:false,previousData:this.previousData,selectedRow:gObj.selectedRowIndex,foreignKeyData:{}};editedData=gObj.editModule.getCurrentEditedData(gObj.element.querySelector('.e-gridform'),editedData);if(gObj.getFrozenColumns()&&gObj.editSettings.mode==='Normal'){var mForm=gObj.element.querySelector('.e-movableheader').querySelector('.e-gridform');if(gObj.frozenRows&&mForm){editedData=gObj.editModule.getCurrentEditedData(mForm,editedData);}else{editedData=gObj.editModule.getCurrentEditedData(gObj.element.querySelector('.e-movablecontent').querySelector('.e-gridform'),editedData);}}if(gObj.element.querySelectorAll('.e-editedrow').length){args.action='edit';gObj.trigger(actionBegin,args);if(args.cancel){return;}gObj.showSpinner();this.destroyElements();gObj.notify(updateData,args);}else{args.action='add';args.selectedRow=0;args.index=this.addedRowIndex;gObj.notify(modelChanged,args);this.addedRowIndex=null;if(args.cancel){return;}this.destroyElements();}this.stopEditStatus();if(gObj.editSettings.mode==='Dialog'&&args.action!=='add'){gObj.element.querySelector('.e-dlgeditrow').classList.remove('e-dlgeditrow');}}},{key:'destroyElements',value:function destroyElements(){var gObj=this.parent;gObj.editModule.destroyWidgets();gObj.editModule.destroyForm();gObj.notify(dialogDestroy,{});}},{key:'editHandler',value:function editHandler(args){var _this115=this;if(args.promise){args.promise.then(function(e){return _this115.edSucc(e,args);}).catch(function(e){return _this115.edFail(e);});}else{this.editSuccess(args.data,args);}}},{key:'edSucc',value:function edSucc(e,args){this.editSuccess(e,args);}},{key:'edFail',value:function edFail(e){this.editFailure(e);}},{key:'updateCurrentViewData',value:function updateCurrentViewData(data){this.parent.getCurrentViewRecords()[this.editRowIndex]=data;}},{key:'editSuccess',value:function editSuccess(e,args){if(!isNullOrUndefined(e)){args.data=e;}this.parent.trigger(beforeDataBound,args);args.type=actionComplete;this.parent.isEdit=false;this.refreshRow(args.data);this.updateCurrentViewData(args.data);this.parent.trigger(actionComplete,args);if(!(this.parent.isCheckBoxSelection||this.parent.selectionSettings.type==='Multiple')||!this.parent.isPersistSelection){this.parent.selectRow(this.rowIndex>-1?this.rowIndex:this.editRowIndex);}this.parent.hideSpinner();}},{key:'editFailure',value:function editFailure(e){this.parent.trigger(actionFailure,e);}},{key:'refreshRow',value:function refreshRow(data){var frzCols=this.parent.getFrozenColumns();var row=new RowRenderer(this.serviceLocator,null,this.parent);var rowObj=this.parent.getRowObjectFromUID(this.uid);if(rowObj){rowObj.changes=data;refreshForeignData(rowObj,this.parent.getForeignKeyColumns(),rowObj.changes);row.refresh(rowObj,this.parent.getColumns(),true);if(frzCols){var _uid3=void 0;if(rowObj.cells.length===frzCols){_uid3=this.parent.getMovableRows()[rowObj.index].getAttribute('data-uid');}else{_uid3=this.parent.getRows()[rowObj.index].getAttribute('data-uid');}rowObj=this.parent.getRowObjectFromUID(_uid3);rowObj.changes=data;row.refresh(rowObj,this.parent.columns,true);}}}},{key:'closeEdit',value:function closeEdit(){if(!this.parent.isEdit){return;}var gObj=this.parent;var args={requestType:'cancel',type:actionBegin,data:this.previousData,selectedRow:gObj.selectedRowIndex};gObj.trigger(actionBegin,args);if(this.parent.editSettings.mode==='Dialog'){this.parent.notify(dialogDestroy,{});}gObj.isEdit=false;this.stopEditStatus();args.type=actionComplete;if(gObj.editSettings.mode!=='Dialog'){this.refreshRow(args.data);}if(gObj.getContentTable().querySelector('tr.e-emptyrow')&&!gObj.getContentTable().querySelector('tr.e-row')){gObj.getContentTable().querySelector('tr.e-emptyrow').classList.remove('e-hide');}gObj.selectRow(this.rowIndex);gObj.trigger(actionComplete,args);}},{key:'addRecord',value:function addRecord(data,index){var gObj=this.parent;this.addedRowIndex=!isNullOrUndefined(index)?index:0;if(data){gObj.notify(modelChanged,{requestType:'save',type:actionBegin,data:data,selectedRow:0,action:'add',index:index});return;}if(gObj.isEdit){return;}this.previousData={};this.uid='';var _iteratorNormalCompletion49=true;var _didIteratorError49=false;var _iteratorError49=undefined;try{for(var _iterator49=gObj.getColumns()[Symbol.iterator](),_step49;!(_iteratorNormalCompletion49=(_step49=_iterator49.next()).done);_iteratorNormalCompletion49=true){var col=_step49.value;this.previousData[col.field]=data&&data[col.field]?data[col.field]:col.defaultValue;}}catch(err){_didIteratorError49=true;_iteratorError49=err;}finally{try{if(!_iteratorNormalCompletion49&&_iterator49.return){_iterator49.return();}}finally{if(_didIteratorError49){throw _iteratorError49;}}}var args={cancel:false,foreignKeyData:{},requestType:'add',data:this.previousData,type:actionBegin,index:index};gObj.trigger(actionBegin,args);if(args.cancel){return;}gObj.isEdit=true;gObj.clearSelection();this.renderer.addNew({rowData:args.data,requestType:'add'});gObj.editModule.applyFormValidation();args.type=actionComplete;args.row=gObj.element.querySelector('.e-addedrow');gObj.trigger(actionComplete,args);}},{key:'deleteRecord',value:function deleteRecord(fieldname,data){this.editRowIndex=this.parent.selectedRowIndex;this.parent.notify(modelChanged,{requestType:'delete',type:actionBegin,foreignKeyData:{},data:data?[data]:this.parent.getSelectedRecords(),tr:this.parent.getSelectedRows(),cancel:false});}},{key:'stopEditStatus',value:function stopEditStatus(){var gObj=this.parent;var elem=gObj.element.querySelector('.e-addedrow');var mElem=void 0;var editMElem=void 0;if(gObj.getFrozenColumns()){mElem=gObj.element.querySelectorAll('.e-addedrow')[1];editMElem=gObj.element.querySelectorAll('.e-editedrow')[1];if(mElem){remove(mElem);}if(editMElem){editMElem.classList.remove('e-editedrow');}}if(elem){remove(elem);}elem=gObj.element.querySelector('.e-editedrow');if(elem){elem.classList.remove('e-editedrow');}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(crudAction,this.editHandler,this);this.parent.on(doubleTap,this.dblClickHandler,this);this.parent.on(click,this.clickHandler,this);this.parent.on(dblclick,this.dblClickHandler,this);this.parent.on(deleteComplete,this.editComplete,this);this.parent.on(saveComplete,this.editComplete,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(crudAction,this.editHandler);this.parent.off(doubleTap,this.dblClickHandler);this.parent.off(click,this.clickHandler);this.parent.off(dblclick,this.dblClickHandler);this.parent.off(deleteComplete,this.editComplete);this.parent.off(saveComplete,this.editComplete);}},{key:'destroy',value:function destroy(){this.removeEventListener();this.renderer.destroy();}}]);return NormalEdit;}());_export('InlineEdit',InlineEdit=function(_NormalEdit){_inherits(InlineEdit,_NormalEdit);function InlineEdit(parent,serviceLocator,renderer){_classCallCheck(this,InlineEdit);var _this116=_possibleConstructorReturn(this,(InlineEdit.__proto__||Object.getPrototypeOf(InlineEdit)).call(this,parent,serviceLocator));_this116.parent=parent;_this116.serviceLocator=serviceLocator;_this116.renderer=renderer;return _this116;}_createClass(InlineEdit,[{key:'closeEdit',value:function closeEdit(){_get(InlineEdit.prototype.__proto__||Object.getPrototypeOf(InlineEdit.prototype),'closeEdit',this).call(this);}},{key:'addRecord',value:function addRecord(data,index){_get(InlineEdit.prototype.__proto__||Object.getPrototypeOf(InlineEdit.prototype),'addRecord',this).call(this,data,index);}},{key:'endEdit',value:function endEdit(){_get(InlineEdit.prototype.__proto__||Object.getPrototypeOf(InlineEdit.prototype),'endEdit',this).call(this);}},{key:'updateRow',value:function updateRow(index,data){_get(InlineEdit.prototype.__proto__||Object.getPrototypeOf(InlineEdit.prototype),'updateRow',this).call(this,index,data);}},{key:'deleteRecord',value:function deleteRecord(fieldname,data){_get(InlineEdit.prototype.__proto__||Object.getPrototypeOf(InlineEdit.prototype),'deleteRecord',this).call(this,fieldname,data);}},{key:'startEdit',value:function startEdit(tr){_get(InlineEdit.prototype.__proto__||Object.getPrototypeOf(InlineEdit.prototype),'startEdit',this).call(this,tr);}}]);return InlineEdit;}(NormalEdit));_export('BatchEdit',BatchEdit=function(){function BatchEdit(parent,serviceLocator,renderer){_classCallCheck(this,BatchEdit);this.cellDetails={};this.parent=parent;this.serviceLocator=serviceLocator;this.renderer=renderer;this.focus=serviceLocator.getService('focus');this.addEventListener();}/**
     * @hidden
     */_createClass(BatchEdit,[{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(click,this.clickHandler,this);this.parent.on(dblclick,this.dblClickHandler,this);this.parent.on(beforeCellFocused,this.onBeforeCellFocused,this);this.parent.on(cellFocused,this.onCellFocused,this);this.dataBoundFunction=this.dataBound.bind(this);this.parent.addEventListener(dataBound,this.dataBoundFunction);this.parent.on(doubleTap,this.dblClickHandler,this);this.parent.on(keyPressed,this.keyDownHandler,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(click,this.clickHandler);this.parent.off(dblclick,this.dblClickHandler);this.parent.off(beforeCellFocused,this.onBeforeCellFocused);this.parent.off(cellFocused,this.onCellFocused);this.parent.removeEventListener(dataBound,this.dataBoundFunction);this.parent.off(doubleTap,this.dblClickHandler);this.parent.off(keyPressed,this.keyDownHandler);}},{key:'dataBound',value:function dataBound(){this.parent.notify(toolbarRefresh,{});}},{key:'destroy',value:function destroy(){this.removeEventListener();}},{key:'clickHandler',value:function clickHandler(e){if(!parentsUntil(e.target,this.parent.element.id+'_add',true)){this.saveCell();if(parentsUntil(e.target,'e-rowcell')&&!this.parent.isEdit){this.setCellIdx(e.target);}}}},{key:'dblClickHandler',value:function dblClickHandler(e){var target=parentsUntil(e.target,'e-rowcell');var tr=parentsUntil(e.target,'e-row');if(target&&tr&&!isNaN(parseInt(target.getAttribute('aria-colindex'),10))){this.editCell(parseInt(tr.getAttribute('aria-rowindex'),10),this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'),10)].field);}}},{key:'onBeforeCellFocused',value:function onBeforeCellFocused(e){if(this.parent.isEdit&&this.validateFormObj()&&(e.byClick||['tab','shiftTab','enter','shiftEnter'].indexOf(e.keyArgs.action)>-1)){e.cancel=true;if(e.byClick){e.clickArgs.preventDefault();}else{e.keyArgs.preventDefault();}}}},{key:'onCellFocused',value:function onCellFocused(e){var frzCols=this.parent.getFrozenColumns();var mCont=this.parent.getContent().querySelector('.e-movablecontent');var mHdr=this.parent.getHeaderContent().querySelector('.e-movableheader');var clear=(!e.container.isContent||!e.container.isDataCell)&&!(this.parent.frozenRows&&e.container.isHeader);if(!e.byKey||clear){return;}var _e$container$indexes=_slicedToArray(e.container.indexes,2),rowIndex=_e$container$indexes[0],cellIndex=_e$container$indexes[1];if(frzCols&&(mCont.contains(e.element)||this.parent.frozenRows&&mHdr.contains(e.element))){cellIndex+=frzCols;}if(this.parent.frozenRows&&e.container.isContent){rowIndex+=this.parent.frozenRows;}var isEdit=this.parent.isEdit;if(!document.querySelectorAll('.e-popup-open').length){isEdit=isEdit&&!this.validateFormObj();switch(e.keyArgs.action){case'tab':case'shiftTab':if(isEdit){this.editCellFromIndex(rowIndex,cellIndex);}break;case'enter':case'shiftEnter':e.keyArgs.preventDefault();if(isEdit){this.editCell(rowIndex,this.cellDetails.column.field);}break;case'f2':this.editCellFromIndex(rowIndex,cellIndex);this.focus.focus();break;}}}},{key:'isAddRow',value:function isAddRow(index){return this.parent.getDataRows()[index].classList.contains('e-insertedrow');}},{key:'editCellFromIndex',value:function editCellFromIndex(rowIdx,cellIdx){this.cellDetails.rowIndex=rowIdx;this.cellDetails.cellIndex=cellIdx;this.editCell(rowIdx,this.parent.getColumns()[cellIdx].field);}},{key:'closeEdit',value:function closeEdit(){var gObj=this.parent;var rows=this.parent.getRowsObject();var rowRenderer=new RowRenderer(this.serviceLocator,null,this.parent);var tr=void 0;var mTr=void 0;if(gObj.isEdit){this.saveCell(true);}gObj.clearSelection();for(var i=0;i<rows.length;i++){if(rows[i].isDirty){tr=gObj.getContentTable().querySelector('[data-uid='+rows[i].uid+']');if(gObj.frozenRows){tr=gObj.getHeaderContent().querySelector('[data-uid='+rows[i].uid+']');}if(gObj.frozenColumns){if(gObj.frozenRows){mTr=gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('[data-uid='+rows[i].uid+']');}else{mTr=gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid='+rows[i].uid+']');}}if(tr){if(tr.classList.contains('e-insertedrow')){remove(tr);if(gObj.frozenRows&&mTr){remove(mTr);}this.removeRowObjectFromUID(rows[i].uid);i--;}else{delete rows[i].changes;rows[i].isDirty=false;classList(tr,[],['e-hiddenrow','e-updatedtd']);rowRenderer.refresh(rows[i],gObj.getColumns(),false);}}}}if(gObj.getContentTable().querySelector('tr.e-emptyrow')&&!gObj.getContentTable().querySelector('tr.e-row')){gObj.getContentTable().querySelector('tr.e-emptyrow').classList.remove('e-hide');}gObj.notify(batchCancel,{rows:this.parent.getRowsObject()});gObj.selectRow(this.cellDetails.rowIndex);this.refreshRowIdx();gObj.notify(toolbarRefresh,{});this.parent.notify(tooltipDestroy,{});}},{key:'deleteRecord',value:function deleteRecord(fieldname,data){this.saveCell();if(this.validateFormObj()){this.saveCell(true);}this.bulkDelete(fieldname,data);}},{key:'addRecord',value:function addRecord(data){this.bulkAddRow(data);}},{key:'endEdit',value:function endEdit(data){if(this.parent.isEdit&&this.validateFormObj()){return;}this.batchSave();}},{key:'validateFormObj',value:function validateFormObj(){return this.parent.editModule.formObj&&!this.parent.editModule.formObj.validate();}},{key:'batchSave',value:function batchSave(){var gObj=this.parent;this.saveCell();if(gObj.isEdit){return;}var changes=this.getBatchChanges();var args={batchChanges:changes,cancel:false};gObj.trigger(beforeBatchSave,args);if(args.cancel){return;}gObj.showSpinner();gObj.notify(bulkSave,{changes:changes});}},{key:'getBatchChanges',value:function getBatchChanges(){var changes={addedRecords:[],deletedRecords:[],changedRecords:[]};var rows=this.parent.getRowsObject();var mRows=this.parent.getMovableRowsObject();var frzCols=this.parent.getFrozenColumns();var _iteratorNormalCompletion50=true;var _didIteratorError50=false;var _iteratorError50=undefined;try{for(var _iterator50=rows[Symbol.iterator](),_step50;!(_iteratorNormalCompletion50=(_step50=_iterator50.next()).done);_iteratorNormalCompletion50=true){var row=_step50.value;if(frzCols){this.mergeBatchChanges(row,mRows[row.index],frzCols);}if(row.isDirty){switch(row.edit){case'add':changes.addedRecords.push(row.changes);break;case'delete':changes.deletedRecords.push(row.data);break;default:changes.changedRecords.push(row.changes);}}}}catch(err){_didIteratorError50=true;_iteratorError50=err;}finally{try{if(!_iteratorNormalCompletion50&&_iterator50.return){_iterator50.return();}}finally{if(_didIteratorError50){throw _iteratorError50;}}}return changes;}},{key:'mergeBatchChanges',value:function mergeBatchChanges(row,mRow,frzCols){if(row.isDirty){if(mRow.isDirty){var i=0;Object.keys(mRow.changes).forEach(function(key){if(i<frzCols){delete mRow.changes[key];}i++;});extend(row.changes,mRow.changes);}}else if(mRow.isDirty){extend(row,mRow);}}},{key:'removeRowObjectFromUID',value:function removeRowObjectFromUID(uid){var rows=this.parent.getRowsObject();var i=0;for(var len=rows.length;i<len;i++){if(rows[i].uid===uid){break;}}rows.splice(i,1);}},{key:'addRowObject',value:function addRowObject(row){this.parent.getRowsObject().unshift(row);}},{key:'bulkDelete',value:function bulkDelete(fieldname,data){var gObj=this.parent;var index=data?this.getIndexFromData(data):gObj.selectedRowIndex;var selectedRows=gObj.getSelectedRows();var args={primaryKey:this.parent.getPrimaryKeyFieldNames(),rowIndex:index,rowData:data?data:gObj.getSelectedRecords()[0],row:data?gObj.getRows()[index]:selectedRows[0],cancel:false};if(!args.row){return;}gObj.trigger(beforeBatchDelete,args);if(args.cancel){return;}gObj.clearSelection();var uid=args.row.getAttribute('data-uid');if(args.row.classList.contains('e-insertedrow')){this.removeRowObjectFromUID(uid);remove(args.row);}else{var rowObj=gObj.getRowObjectFromUID(uid);rowObj.isDirty=true;rowObj.edit='delete';classList(args.row,['e-hiddenrow','e-updatedtd'],[]);if(gObj.getFrozenColumns()){classList(data?gObj.getMovableRows()[index]:selectedRows[1],['e-hiddenrow','e-updatedtd'],[]);if(gObj.frozenRows&&index<gObj.frozenRows){gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').appendChild(gObj.getMovableRowByIndex(gObj.frozenRows-1));gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows-1));}}else if(gObj.frozenRows&&index<gObj.frozenRows){gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows-1));}}this.refreshRowIdx();gObj.selectRow(index);delete args.row;gObj.trigger(batchDelete,args);gObj.notify(batchDelete,{rows:this.parent.getRowsObject()});gObj.notify(toolbarRefresh,{});}},{key:'refreshRowIdx',value:function refreshRowIdx(){var rows=[];var mRows=[];var nonMovableRows=[];var frzCols=this.parent.getFrozenColumns();if(this.parent.frozenRows){rows=[].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);if(frzCols){mRows=[].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);for(var i=0;i<mRows.length;i++){nonMovableRows[i]=createElement('tr',{className:'emptynonmv'});}}}if(frzCols){mRows=mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));nonMovableRows=nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));}rows=rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));for(var _i16=0,j=0,len=rows.length;_i16<len;_i16++){if(rows[_i16].classList.contains('e-row')&&!rows[_i16].classList.contains('e-hiddenrow')){rows[_i16].setAttribute('aria-rowindex',j.toString());if(frzCols){mRows[_i16].setAttribute('aria-rowindex',j.toString());if(nonMovableRows[_i16].classList.contains('e-row')){nonMovableRows[_i16].setAttribute('aria-rowindex',j.toString());}}j++;}else{rows[_i16].removeAttribute('aria-rowindex');if(frzCols){mRows[_i16].removeAttribute('aria-rowindex');}}}}},{key:'getIndexFromData',value:function getIndexFromData(data){return inArray(data,this.parent.getCurrentViewRecords());}},{key:'bulkAddRow',value:function bulkAddRow(data){var gObj=this.parent;if(!gObj.editSettings.allowAdding){return;}if(gObj.isEdit){this.saveCell();}if(gObj.isEdit){return;}var defaultData=data?data:this.getDefaultData();var args={defaultData:defaultData,primaryKey:gObj.getPrimaryKeyFieldNames(),cancel:false};gObj.trigger(beforeBatchAdd,args);if(args.cancel){return;}gObj.clearSelection();var mTr=void 0;var mTbody=void 0;var row=new RowRenderer(this.serviceLocator,null,this.parent);var model=new RowModelGenerator(this.parent);var modelData=model.generateRows([args.defaultData]);var tr=row.render(modelData[0],gObj.getColumns());var col=void 0;var index=void 0;for(var i=0;i<this.parent.groupSettings.columns.length;i++){tr.insertBefore(createElement('td',{className:'e-indentcell'}),tr.firstChild);modelData[0].cells.unshift(new Cell({cellType:CellType.Indent}));}var tbody=gObj.getContentTable().querySelector('tbody');tr.classList.add('e-insertedrow');if(tbody.querySelector('.e-emptyrow')){tbody.querySelector('.e-emptyrow').classList.add('e-hide');}if(gObj.getFrozenColumns()){mTr=this.renderMovable(tr);if(gObj.frozenRows){mTbody=gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');}else{mTbody=gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');}mTbody.insertBefore(mTr,mTbody.firstChild);addClass(mTr.querySelectorAll('.e-rowcell'),['e-updatedtd']);}if(gObj.frozenRows){tbody=gObj.getHeaderContent().querySelector('tbody');}tbody.insertBefore(tr,tbody.firstChild);addClass(tr.querySelectorAll('.e-rowcell'),['e-updatedtd']);modelData[0].isDirty=true;modelData[0].changes=extend({},modelData[0].data);modelData[0].edit='add';this.addRowObject(modelData[0]);this.refreshRowIdx();this.focus.forgetPrevious();gObj.notify(batchAdd,{rows:this.parent.getRowsObject()});gObj.selectRow(0);if(!data){index=this.findNextEditableCell(0,true);col=gObj.getColumns()[index];this.editCell(0,col.field,true);}var args1={defaultData:args.defaultData,row:tr,columnObject:col,columnIndex:index,primaryKey:args.primaryKey,cell:tr.cells[index]};gObj.trigger(batchAdd,args1);}},{key:'renderMovable',value:function renderMovable(ele){var mEle=ele.cloneNode(true);for(var i=0;i<this.parent.frozenColumns;i++){mEle.removeChild(mEle.children[0]);}for(var _i17=this.parent.frozenColumns,len=ele.childElementCount;_i17<len;_i17++){ele.removeChild(ele.children[ele.childElementCount-1]);}return mEle;}},{key:'findNextEditableCell',value:function findNextEditableCell(columnIndex,isAdd){var cols=this.parent.getColumns();var endIndex=cols.length;for(var i=columnIndex;i<endIndex;i++){if(!isAdd&&this.checkNPCell(cols[i])){return i;}else if(isAdd&&!cols[i].template&&cols[i].visible&&cols[i].allowEditing&&!(cols[i].isIdentity&&cols[i].isPrimaryKey)){return i;}}return-1;}},{key:'checkNPCell',value:function checkNPCell(col){return!col.template&&col.visible&&!col.isPrimaryKey&&!col.isIdentity&&col.allowEditing;}},{key:'getDefaultData',value:function getDefaultData(){var gObj=this.parent;var data={};var dValues={'number':0,'string':null,'boolean':false,'date':null,'datetime':null};var _iteratorNormalCompletion51=true;var _didIteratorError51=false;var _iteratorError51=undefined;try{for(var _iterator51=gObj.getColumns()[Symbol.iterator](),_step51;!(_iteratorNormalCompletion51=(_step51=_iterator51.next()).done);_iteratorNormalCompletion51=true){var col=_step51.value;data[col.field]=col.defaultValue?col.defaultValue:dValues[col.type];}}catch(err){_didIteratorError51=true;_iteratorError51=err;}finally{try{if(!_iteratorNormalCompletion51&&_iterator51.return){_iterator51.return();}}finally{if(_didIteratorError51){throw _iteratorError51;}}}return data;}},{key:'setCellIdx',value:function setCellIdx(target){var gLen=0;if(this.parent.allowGrouping){gLen=this.parent.groupSettings.columns.length;}this.cellDetails.cellIndex=target.cellIndex-gLen;this.cellDetails.rowIndex=parseInt(target.parentElement.getAttribute('aria-rowindex'),10);}},{key:'editCell',value:function editCell(index,field,isAdd){var gObj=this.parent;var col=gObj.getColumnByField(field);var keys=gObj.getPrimaryKeyFieldNames();if(gObj.editSettings.allowEditing&&col.allowEditing){if(gObj.isEdit&&!(this.cellDetails.column.field===field&&this.cellDetails.rowIndex===index&&this.parent.getDataRows().length-1!==index)){this.saveCell();if(this.cellDetails.rowIndex===index&&this.cellDetails.column.field===field){return;}}if(gObj.isEdit){return;}var row=void 0;var colIdx=gObj.getColumnIndexByField(field);var frzCols=gObj.getFrozenColumns();if(frzCols&&colIdx>=frzCols){row=gObj.getMovableDataRows()[index];}else{row=gObj.getDataRows()[index];}if(keys[0]===col.field&&!row.classList.contains('e-insertedrow')||col.template||col.columns||col.isPrimaryKey&&col.isIdentity){return;}var rowObj=gObj.getRowObjectFromUID(row.getAttribute('data-uid'));var rowData=extend({},this.getDataByIndex(index));var cells=[].slice.apply(row.cells);var args={cell:cells[this.getColIndex(cells,this.getCellIdx(col.uid))],row:row,columnName:col.field,columnObject:col,isForeignKey:!isNullOrUndefined(col.foreignKeyValue),primaryKey:keys,rowData:rowData,validationRules:extend({},col.validationRules?col.validationRules:{}),value:rowData[col.field],type:!isAdd?'edit':'add',cancel:false,foreignKeyData:rowObj&&rowObj.foreignKeyData};if(!args.cell){return;}gObj.trigger(cellEdit,args);if(args.cancel){return;}this.cellDetails={rowData:rowData,column:col,value:args.value,isForeignKey:args.isForeignKey,rowIndex:index,cellIndex:parseInt(args.cell.getAttribute('aria-colindex'),10),foreignKeyData:args.foreignKeyData};if(args.cell.classList.contains('e-updatedtd')){this.isColored=true;args.cell.classList.remove('e-updatedtd');}gObj.isEdit=true;gObj.clearSelection();if(!gObj.isCheckBoxSelection||!gObj.isPersistSelection){gObj.selectRow(this.cellDetails.rowIndex,true);}this.renderer.update(args);this.form=gObj.element.querySelector('#'+gObj.element.id+'EditForm');gObj.editModule.applyFormValidation([col]);this.parent.element.querySelector('.e-gridpopup').style.display='none';}}},{key:'updateCell',value:function updateCell(rowIndex,field,value){var col=this.parent.getColumnByField(field);if(col&&!col.isPrimaryKey){var td=this.parent.getDataRows()[rowIndex].cells[this.parent.getColumnIndexByField(field)];var rowObj=this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));this.refreshTD(td,col,rowObj,value);this.parent.trigger(queryCellInfo,{cell:td,column:col,data:rowObj.changes});}}},{key:'setChanges',value:function setChanges(rowObj,field,value){if(!rowObj.changes){rowObj.changes=extend({},rowObj.data);}rowObj.changes[field]=value;if(rowObj.data[field]!==value){rowObj.isDirty=true;}}},{key:'updateRow',value:function updateRow(index,data){var keys=Object.keys(data);var _iteratorNormalCompletion52=true;var _didIteratorError52=false;var _iteratorError52=undefined;try{for(var _iterator52=keys[Symbol.iterator](),_step52;!(_iteratorNormalCompletion52=(_step52=_iterator52.next()).done);_iteratorNormalCompletion52=true){var col=_step52.value;this.updateCell(index,col,data[col]);}}catch(err){_didIteratorError52=true;_iteratorError52=err;}finally{try{if(!_iteratorNormalCompletion52&&_iterator52.return){_iterator52.return();}}finally{if(_didIteratorError52){throw _iteratorError52;}}}}},{key:'getCellIdx',value:function getCellIdx(uid){var cIdx=this.parent.getColumnIndexByUid(uid)+this.parent.groupSettings.columns.length;if(!isNullOrUndefined(this.parent.detailTemplate)||!isNullOrUndefined(this.parent.childGrid)){cIdx++;}return cIdx;}},{key:'refreshTD',value:function refreshTD(td,column,rowObj,value){var cell=new CellRenderer(this.parent,this.serviceLocator);this.setChanges(rowObj,column.field,value);var frzCols=this.parent.getFrozenColumns();refreshForeignData(rowObj,this.parent.getForeignKeyColumns(),rowObj.changes);cell.refreshTD(td,rowObj.cells[this.getCellIdx(column.uid)-(this.getCellIdx(column.uid)>=frzCols?frzCols:0)],rowObj.changes);td.classList.add('e-updatedtd');this.parent.notify(toolbarRefresh,{});}},{key:'getColIndex',value:function getColIndex(cells,index){var cIdx=0;if(this.parent.allowGrouping&&this.parent.groupSettings.columns){cIdx=this.parent.groupSettings.columns.length;}if(!isNullOrUndefined(this.parent.detailTemplate)||!isNullOrUndefined(this.parent.childGrid)){cIdx++;}for(var m=0;m<cells.length;m++){var colIndex=parseInt(cells[m].getAttribute('aria-colindex'),10);if(colIndex===index-cIdx){return m;}}return-1;}},{key:'saveCell',value:function saveCell(isForceSave){var gObj=this.parent;if(!isForceSave&&(!gObj.isEdit||this.validateFormObj())){return;}var tr=parentsUntil(this.form,'e-row');var column=this.cellDetails.column;var editedData=gObj.editModule.getCurrentEditedData(this.form,{});editedData=extend(this.cellDetails.rowData,editedData);var args={columnName:column.field,value:editedData[column.field],rowData:this.cellDetails.rowData,previousValue:this.cellDetails.value,columnObject:column,cell:this.form.parentElement,isForeignKey:this.cellDetails.isForeignKey,cancel:false};if(!isForceSave){gObj.trigger(cellSave,args);}if(args.cancel){return;}gObj.editModule.destroyForm();gObj.isEdit=false;gObj.editModule.destroyWidgets([column]);this.parent.notify(tooltipDestroy,{});this.refreshTD(args.cell,column,gObj.getRowObjectFromUID(tr.getAttribute('data-uid')),args.value);removeClass([tr],['e-editedrow','e-batchrow']);removeClass([args.cell],['e-editedbatchcell','e-boolcell']);if(!isNullOrUndefined(args.value)&&args.value.toString()===(!isNullOrUndefined(this.cellDetails.value)?this.cellDetails.value:'').toString()&&!this.isColored){args.cell.classList.remove('e-updatedtd');}gObj.notify(toolbarRefresh,{});this.isColored=false;}},{key:'getDataByIndex',value:function getDataByIndex(index){var row=this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));return row.changes?row.changes:row.data;}},{key:'keyDownHandler',value:function keyDownHandler(e){if(e.action==='tab'&&this.parent.isEdit){var rowcell=parentsUntil(e.target,'e-rowcell');if(rowcell){var cell=rowcell.querySelector('.e-field');if(cell){var visibleColumns=this.parent.getVisibleColumns();if(visibleColumns[visibleColumns.length-1].field===cell.getAttribute('name')){this.saveCell();}}}}}}]);return BatchEdit;}());_export('DialogEdit',DialogEdit=function(_NormalEdit2){_inherits(DialogEdit,_NormalEdit2);function DialogEdit(parent,serviceLocator,renderer){_classCallCheck(this,DialogEdit);var _this117=_possibleConstructorReturn(this,(DialogEdit.__proto__||Object.getPrototypeOf(DialogEdit)).call(this,parent,serviceLocator));_this117.parent=parent;_this117.serviceLocator=serviceLocator;_this117.renderer=renderer;return _this117;}_createClass(DialogEdit,[{key:'closeEdit',value:function closeEdit(){//closeEdit
_get(DialogEdit.prototype.__proto__||Object.getPrototypeOf(DialogEdit.prototype),'closeEdit',this).call(this);}},{key:'addRecord',value:function addRecord(data,index){//addRecord
_get(DialogEdit.prototype.__proto__||Object.getPrototypeOf(DialogEdit.prototype),'addRecord',this).call(this,data,index);}},{key:'endEdit',value:function endEdit(){//endEdit
_get(DialogEdit.prototype.__proto__||Object.getPrototypeOf(DialogEdit.prototype),'endEdit',this).call(this);}},{key:'updateRow',value:function updateRow(index,data){_get(DialogEdit.prototype.__proto__||Object.getPrototypeOf(DialogEdit.prototype),'updateRow',this).call(this,index,data);}},{key:'deleteRecord',value:function deleteRecord(fieldname,data){//deleteRecord
_get(DialogEdit.prototype.__proto__||Object.getPrototypeOf(DialogEdit.prototype),'deleteRecord',this).call(this,fieldname,data);}},{key:'startEdit',value:function startEdit(tr){_get(DialogEdit.prototype.__proto__||Object.getPrototypeOf(DialogEdit.prototype),'startEdit',this).call(this,tr);}}]);return DialogEdit;}(NormalEdit));_export('DatePickerEditCell',DatePickerEditCell=function(){function DatePickerEditCell(parent){_classCallCheck(this,DatePickerEditCell);this.parent=parent;}_createClass(DatePickerEditCell,[{key:'create',value:function create(args){return createElement('input',{className:'e-field',attrs:{id:this.parent.element.id+args.column.field,name:args.column.field,type:'text','e-mappinguid':args.column.uid}});}},{key:'read',value:function read(element){return element.ej2_instances[0].value;}},{key:'write',value:function write(args){var isInline=this.parent.editSettings.mode!=='Dialog';this.obj=new DatePicker(extend({floatLabelType:isInline?'Never':'Always',value:new Date(args.rowData[args.column.field]),placeholder:isInline?'':args.column.headerText,enableRtl:this.parent.enableRtl,enabled:isEditable(args.column,args.type,args.element)},args.column.edit.params));this.obj.appendTo(args.element);}},{key:'destroy',value:function destroy(){if(this.obj){this.obj.destroy();}}}]);return DatePickerEditCell;}());_export('Edit',Edit=function(){/**
     * Constructor for the Grid editing module
     * @hidden
     */function Edit(parent,serviceLocator){_classCallCheck(this,Edit);this.editCellType={'dropdownedit':DropDownEditCell,'numericedit':NumericEditCell,'datepickeredit':DatePickerEditCell,'booleanedit':BooleanEditCell,'defaultedit':DefaultEditCell};this.editType={'Inline':InlineEdit,'Normal':InlineEdit,'Batch':BatchEdit,'Dialog':DialogEdit};this.parent=parent;this.serviceLocator=serviceLocator;this.l10n=this.serviceLocator.getService('localization');this.addEventListener();this.updateEditObj();this.createAlertDlg();this.createConfirmDlg();}_createClass(Edit,[{key:'updateColTypeObj',value:function updateColTypeObj(){var _iteratorNormalCompletion53=true;var _didIteratorError53=false;var _iteratorError53=undefined;try{for(var _iterator53=this.parent.getColumns()[Symbol.iterator](),_step53;!(_iteratorNormalCompletion53=(_step53=_iterator53.next()).done);_iteratorNormalCompletion53=true){var col=_step53.value;col.edit=extend(new this.editCellType[col.editType&&this.editCellType[col.editType]?col.editType:'defaultedit'](this.parent,this.serviceLocator),col.edit||{});}}catch(err){_didIteratorError53=true;_iteratorError53=err;}finally{try{if(!_iteratorNormalCompletion53&&_iterator53.return){_iterator53.return();}}finally{if(_didIteratorError53){throw _iteratorError53;}}}}},{key:'getModuleName',value:function getModuleName(){return'edit';}},{key:'onPropertyChanged',value:function onPropertyChanged(e){if(e.module!==this.getModuleName()){return;}var gObj=this.parent;var newProp=e.properties;var _iteratorNormalCompletion54=true;var _didIteratorError54=false;var _iteratorError54=undefined;try{for(var _iterator54=Object.keys(e.properties)[Symbol.iterator](),_step54;!(_iteratorNormalCompletion54=(_step54=_iterator54.next()).done);_iteratorNormalCompletion54=true){var prop=_step54.value;switch(prop){case'allowAdding':case'allowDeleting':case'allowEditing':if(gObj.editSettings.allowAdding||gObj.editSettings.allowEditing||gObj.editSettings.allowDeleting){this.initialEnd();}break;case'mode':this.updateEditObj();gObj.isEdit=false;gObj.refresh();break;}}}catch(err){_didIteratorError54=true;_iteratorError54=err;}finally{try{if(!_iteratorNormalCompletion54&&_iterator54.return){_iterator54.return();}}finally{if(_didIteratorError54){throw _iteratorError54;}}}}},{key:'updateEditObj',value:function updateEditObj(){if(this.editModule){this.editModule.destroy();}this.renderer=new EditRender(this.parent,this.serviceLocator);this.editModule=new this.editType[this.parent.editSettings.mode](this.parent,this.serviceLocator,this.renderer);}},{key:'initialEnd',value:function initialEnd(){this.updateColTypeObj();}},{key:'wireEvents',value:function wireEvents(){EventHandler.add(this.parent.getContent(),'touchstart',this.tapEvent,this);}},{key:'unwireEvents',value:function unwireEvents(){EventHandler.remove(this.parent.getContent(),'touchstart',this.tapEvent);}},{key:'tapEvent',value:function tapEvent(e){if(this.getUserAgent()){if(!Global.timer){Global.timer=setTimeout(function(){Global.timer=null;},300);}else{clearTimeout(Global.timer);Global.timer=null;this.parent.notify(doubleTap,e);}}}},{key:'getUserAgent',value:function getUserAgent(){var userAgent=window.navigator.userAgent.toLowerCase();return /iphone|ipod|ipad/.test(userAgent);}},{key:'startEdit',value:function startEdit(tr){var gObj=this.parent;if(!gObj.editSettings.allowEditing||gObj.isEdit||gObj.editSettings.mode==='Batch'){return;}if(!gObj.getSelectedRows().length){if(!tr){this.showDialog('EditOperationAlert',this.alertDObj);return;}}else if(!tr){tr=gObj.getSelectedRows()[0];}if(tr.style.display==='none'){return;}this.editModule.startEdit(tr);this.refreshToolbar();gObj.element.querySelector('.e-gridpopup').style.display='none';this.parent.notify('start-edit',{});}},{key:'closeEdit',value:function closeEdit(){if(this.parent.editSettings.mode==='Batch'&&this.parent.editSettings.showConfirmDialog&&this.parent.element.querySelectorAll('.e-updatedtd').length){this.showDialog('CancelEdit',this.dialogObj);return;}this.editModule.closeEdit();this.refreshToolbar();this.parent.notify('close-edit',{});}},{key:'refreshToolbar',value:function refreshToolbar(){this.parent.notify(toolbarRefresh,{});}},{key:'addRecord',value:function addRecord(data,index){if(!this.parent.editSettings.allowAdding){return;}this.editModule.addRecord(data,index);this.refreshToolbar();this.parent.notify('start-add',{});}},{key:'deleteRecord',value:function deleteRecord(fieldname,data){var gObj=this.parent;if(!gObj.editSettings.allowDeleting){return;}if(!data){if(isNullOrUndefined(gObj.selectedRowIndex)||gObj.selectedRowIndex===-1){this.showDialog('DeleteOperationAlert',this.alertDObj);return;}}if(gObj.editSettings.showDeleteConfirmDialog){this.showDialog('ConfirmDelete',this.dialogObj);return;}this.editModule.deleteRecord(fieldname,data);}},{key:'deleteRow',value:function deleteRow(tr){this.deleteRecord(null,this.parent.getCurrentViewRecords()[parseInt(tr.getAttribute('aria-rowindex'),10)]);}},{key:'endEdit',value:function endEdit(){if(this.parent.editSettings.mode==='Batch'&&this.parent.editSettings.showConfirmDialog&&(isNullOrUndefined(this.formObj)||this.formObj.validate())){this.showDialog('BatchSaveConfirm',this.dialogObj);return;}this.endEditing();}},{key:'updateCell',value:function updateCell(rowIndex,field,value){this.editModule.updateCell(rowIndex,field,value);}},{key:'updateRow',value:function updateRow(index,data){this.editModule.updateRow(index,data);}},{key:'batchCancel',value:function batchCancel(){this.closeEdit();}},{key:'batchSave',value:function batchSave(){this.endEdit();}},{key:'editCell',value:function editCell(index,field){this.editModule.editCell(index,field);}},{key:'editFormValidate',value:function editFormValidate(){if(this.formObj){return this.formObj.validate();}return false;}},{key:'getBatchChanges',value:function getBatchChanges(){return this.editModule.getBatchChanges?this.editModule.getBatchChanges():{};}},{key:'getCurrentEditCellData',value:function getCurrentEditCellData(){var obj=this.getCurrentEditedData(this.formObj.element,{});return obj[Object.keys(obj)[0]];}},{key:'saveCell',value:function saveCell(){this.editModule.saveCell();}},{key:'endEditing',value:function endEditing(){this.editModule.endEdit();this.refreshToolbar();}},{key:'showDialog',value:function showDialog(content,obj){obj.content='<div>'+this.l10n.getConstant(content)+'</div>';obj.dataBind();obj.show();}},{key:'getValueFromType',value:function getValueFromType(col,value){var val=value;switch(col.type){case'number':val=!isNaN(parseFloat(value))?parseFloat(value):null;break;case'boolean':if(col.editType!=='booleanedit'){val=value===this.l10n.getConstant('True')?true:false;}break;case'date':case'datetime':if(col.editType!=='datepicker'&&value&&value.length){val=new Date(value);}break;}return val;}},{key:'destroyToolTip',value:function destroyToolTip(){var elements=[].slice.call(this.parent.element.querySelectorAll('.e-griderror'));var _iteratorNormalCompletion55=true;var _didIteratorError55=false;var _iteratorError55=undefined;try{for(var _iterator55=elements[Symbol.iterator](),_step55;!(_iteratorNormalCompletion55=(_step55=_iterator55.next()).done);_iteratorNormalCompletion55=true){var elem=_step55.value;remove(elem);}}catch(err){_didIteratorError55=true;_iteratorError55=err;}finally{try{if(!_iteratorNormalCompletion55&&_iterator55.return){_iterator55.return();}}finally{if(_didIteratorError55){throw _iteratorError55;}}}this.parent.getContent().firstElementChild.style.position='relative';}},{key:'createConfirmDlg',value:function createConfirmDlg(){this.dialogObj=this.dlgWidget([{click:this.dlgOk.bind(this),buttonModel:{content:this.l10n.getConstant('OKButton'),cssClass:'e-primary',isPrimary:true}},{click:this.dlgCancel.bind(this),buttonModel:{cssClass:'e-flat',content:this.l10n.getConstant('CancelButton')}}],'EditConfirm');}},{key:'createAlertDlg',value:function createAlertDlg(){this.alertDObj=this.dlgWidget([{click:this.alertClick.bind(this),buttonModel:{content:this.l10n.getConstant('OKButton'),cssClass:'e-flat',isPrimary:true}}],'EditAlert');}},{key:'alertClick',value:function alertClick(){this.alertDObj.hide();}},{key:'dlgWidget',value:function dlgWidget(btnOptions,name){var div=createElement('div',{id:this.parent.element.id+name});this.parent.element.appendChild(div);var options={showCloseIcon:false,isModal:true,visible:false,closeOnEscape:true,target:this.parent.element,width:'320px',animationSettings:{effect:'None'}};options.buttons=btnOptions;var obj=new Dialog(options);obj.appendTo(div);changeButtonType(obj.element);return obj;}},{key:'dlgCancel',value:function dlgCancel(){this.dialogObj.hide();}},{key:'dlgOk',value:function dlgOk(e){switch(this.dialogObj.element.querySelector('.e-dlg-content').firstElementChild.innerText){case this.l10n.getConstant('ConfirmDelete'):this.editModule.deleteRecord();break;case this.l10n.getConstant('CancelEdit'):this.editModule.closeEdit();break;case this.l10n.getConstant('BatchSaveConfirm'):this.endEditing();break;case this.l10n.getConstant('BatchSaveLostChanges'):this.executeAction();break;}this.dlgCancel();}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(inBoundModelChanged,this.onPropertyChanged,this);this.parent.on(initialEnd,this.initialEnd,this);this.parent.on(keyPressed,this.keyPressHandler,this);this.parent.on(autoCol,this.updateColTypeObj,this);this.parent.on(tooltipDestroy,this.destroyToolTip,this);this.parent.on(preventBatch,this.preventBatch,this);this.parent.on(destroyForm,this.destroyForm,this);this.actionBeginFunction=this.onActionBegin.bind(this);this.actionCompleteFunction=this.actionComplete.bind(this);this.parent.addEventListener(actionBegin,this.actionBeginFunction);this.parent.addEventListener(actionComplete,this.actionCompleteFunction);this.parent.on(initialEnd,this.wireEvents,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(inBoundModelChanged,this.onPropertyChanged);this.parent.off(initialEnd,this.initialEnd);this.parent.off(keyPressed,this.keyPressHandler);this.parent.off(autoCol,this.updateColTypeObj);this.parent.off(tooltipDestroy,this.destroyToolTip);this.parent.off(preventBatch,this.preventBatch);this.parent.off(destroyForm,this.destroyForm);this.parent.removeEventListener(actionComplete,this.actionCompleteFunction);this.parent.removeEventListener(actionBegin,this.actionBeginFunction);this.parent.off(initialEnd,this.unwireEvents);}},{key:'actionComplete',value:function actionComplete(e){var actions=['add','beginEdit','save','delete','cancel'];if(actions.indexOf(e.requestType)<0){this.parent.isEdit=false;}this.refreshToolbar();}},{key:'getCurrentEditedData',value:function getCurrentEditedData(form,editedData){var gObj=this.parent;var inputs=[].slice.call(form.querySelectorAll('.e-field'));for(var i=0,len=inputs.length;i<len;i++){var col=gObj.getColumnByUid(inputs[i].getAttribute('e-mappinguid'));var value=void 0;if(col&&col.field){var temp=col.edit.read;if(typeof temp==='string'){temp=getValue(temp,window);}if(col.type!=='checkbox'){value=gObj.editModule.getValueFromType(col,col.edit.read(inputs[i]));}else{value=inputs[i].checked;}setValue(col.field,value,editedData);}}return editedData;}},{key:'onActionBegin',value:function onActionBegin(e){var restrictedRequestTypes=['filterafteropen','filterbeforeopen','filterchoicerequest','save'];if(this.parent.editSettings.mode!=='Batch'&&this.formObj&&!this.formObj.isDestroyed&&restrictedRequestTypes.indexOf(e.requestType)===-1){this.destroyForm();this.destroyWidgets();}}},{key:'destroyWidgets',value:function destroyWidgets(cols){cols=cols?cols:this.parent.getColumns();var _iteratorNormalCompletion56=true;var _didIteratorError56=false;var _iteratorError56=undefined;try{for(var _iterator56=cols[Symbol.iterator](),_step56;!(_iteratorNormalCompletion56=(_step56=_iterator56.next()).done);_iteratorNormalCompletion56=true){var col=_step56.value;if(col.edit.destroy){col.edit.destroy();}}}catch(err){_didIteratorError56=true;_iteratorError56=err;}finally{try{if(!_iteratorNormalCompletion56&&_iterator56.return){_iterator56.return();}}finally{if(_didIteratorError56){throw _iteratorError56;}}}}},{key:'destroyForm',value:function destroyForm(){this.destroyToolTip();if(this.formObj&&!this.formObj.isDestroyed){this.formObj.destroy();}this.destroyToolTip();}},{key:'destroy',value:function destroy(){this.destroyForm();this.removeEventListener();var elem=this.dialogObj.element;this.dialogObj.destroy();remove(elem);elem=this.alertDObj.element;this.alertDObj.destroy();remove(elem);this.unwireEvents();}},{key:'keyPressHandler',value:function keyPressHandler(e){switch(e.action){case'insert':this.addRecord();break;case'delete':if(e.target.tagName!=='INPUT'&&!document.querySelector('.e-popup-open')){this.deleteRecord();}break;case'f2':this.startEdit();break;case'enter':if(!parentsUntil(e.target,'.e-unboundcelldiv')&&this.parent.editSettings.mode!=='Batch'&&(parentsUntil(e.target,'e-gridcontent')||this.parent.frozenRows&&parentsUntil(e.target,'e-headercontent'))&&!document.querySelectorAll('.e-popup-open').length){e.preventDefault();this.endEdit();}break;case'escape':this.closeEdit();break;}}},{key:'preventBatch',value:function preventBatch(args){this.preventObj=args;this.showDialog('BatchSaveLostChanges',this.dialogObj);}},{key:'executeAction',value:function executeAction(){this.preventObj.handler.call(this.preventObj.instance,this.preventObj.arg1,this.preventObj.arg2,this.preventObj.arg3,this.preventObj.arg4,this.preventObj.arg5,this.preventObj.arg6,this.preventObj.arg7);}},{key:'applyFormValidation',value:function applyFormValidation(cols){var gObj=this.parent;var frzCols=gObj.getFrozenColumns();var form=gObj.element.querySelector('.e-gridform');var mForm=gObj.element.querySelectorAll('.e-gridform')[1];var rules={};var mRules={};cols=cols?cols:gObj.columns;var _iteratorNormalCompletion57=true;var _didIteratorError57=false;var _iteratorError57=undefined;try{for(var _iterator57=cols[Symbol.iterator](),_step57;!(_iteratorNormalCompletion57=(_step57=_iterator57.next()).done);_iteratorNormalCompletion57=true){var col=_step57.value;if(col.validationRules&&form.querySelectorAll('#'+gObj.element.id+col.field).length){rules[col.field]=col.validationRules;}else if(frzCols&&col.validationRules&&mForm.querySelectorAll('#'+gObj.element.id+col.field).length){mRules[col.field]=col.validationRules;}}}catch(err){_didIteratorError57=true;_iteratorError57=err;}finally{try{if(!_iteratorNormalCompletion57&&_iterator57.return){_iterator57.return();}}finally{if(_didIteratorError57){throw _iteratorError57;}}}this.parent.editModule.formObj=this.createFormObj(form,rules);if(frzCols&&this.parent.editSettings.mode!=='Dialog'){this.parent.editModule.mFormObj=this.createFormObj(mForm,mRules);}}},{key:'createFormObj',value:function createFormObj(form,rules){var _this118=this;return new FormValidator(form,{rules:rules,validationComplete:function validationComplete(args){_this118.validationComplete(args);},customPlacement:function customPlacement(inputElement,error){_this118.valErrorPlacement(inputElement,error);}});}},{key:'valErrorPlacement',value:function valErrorPlacement(inputElement,error){if(this.parent.isEdit){var id=error.getAttribute('for');var elem=this.getElemTable(inputElement).querySelector('#'+id+'_Error');if(!elem){this.createTooltip(inputElement,error,id,'');}else{elem.querySelector('.e-tip-content').innerHTML=error.innerHTML;}}}},{key:'getElemTable',value:function getElemTable(inputElement){var isFHdr=void 0;if(this.parent.editSettings.mode!=='Dialog'){isFHdr=this.parent.frozenRows&&this.parent.frozenRows>(parseInt(closest(inputElement,'.e-row').getAttribute('aria-rowindex'),10)||0);}return this.parent.editSettings.mode!=='Dialog'?isFHdr?this.parent.getHeaderTable():this.parent.getContentTable():this.parent.element.querySelector('#'+this.parent.element.id+'_dialogEdit_wrapper');}},{key:'validationComplete',value:function validationComplete(args){if(this.parent.isEdit){var elem=this.getElemTable(args.element).querySelector('#'+args.inputName+'_Error');if(elem){if(args.status==='failure'){elem.style.display='';}else{elem.style.display='none';}}}}},{key:'createTooltip',value:function createTooltip(element,error,name,display){var gcontent=this.parent.getContent().firstElementChild;var isScroll=gcontent.scrollHeight>gcontent.clientHeight;var isInline=this.parent.editSettings.mode!=='Dialog';var isFHdr=void 0;if(isInline){isFHdr=this.parent.frozenRows&&this.parent.frozenRows>(parseInt(closest(element,'.e-row').getAttribute('aria-rowindex'),10)||0);}var fCont=this.parent.getContent().querySelector('.e-frozencontent');var table=isInline?isFHdr?this.parent.getHeaderTable():this.parent.getContentTable():this.parent.element.querySelector('#'+this.parent.element.id+'_dialogEdit_wrapper').querySelector('.e-dlg-content');var client=table.getBoundingClientRect();var left=isInline?this.parent.element.getBoundingClientRect().left:client.left;var input=parentsUntil(element,'e-rowcell');var inputClient=input.getBoundingClientRect();var td=closest(element,'td').getBoundingClientRect();var div=createElement('div',{className:'e-tooltip-wrap e-control e-popup e-griderror',id:name+'_Error',styles:'display:'+display+';top:'+((isFHdr?inputClient.top+inputClient.height:inputClient.bottom-client.top-(this.parent.getFrozenColumns()?fCont.scrollTop:0))+table.scrollTop+9)+'px;left:'+(inputClient.left-left+table.scrollLeft+inputClient.width/2)+'px;'+'max-width:'+td.width+'px;text-align:center;'});var content=createElement('div',{className:'e-tip-content'});content.appendChild(error);var arrow=createElement('div',{className:'e-arrow-tip e-tip-top'});arrow.appendChild(createElement('div',{className:'e-arrow-tip-outer e-tip-top'}));arrow.appendChild(createElement('div',{className:'e-arrow-tip-inner e-tip-top'}));div.appendChild(content);div.appendChild(arrow);table.appendChild(div);var lineHeight=parseInt(document.defaultView.getComputedStyle(div,null).getPropertyValue('font-size'),10);if(div.getBoundingClientRect().width<td.width&&div.querySelector('label').getBoundingClientRect().height/(lineHeight*1.2)>=2){div.style.width=div.style.maxWidth;}div.style.left=parseInt(div.style.left,10)-div.offsetWidth/2+'px';if(!isScroll&&isInline&&!this.parent.allowPaging){gcontent.style.position='static';var pos=calculateRelativeBasedPosition(input,div);div.style.top=pos.top+inputClient.height+9+'px';}}}]);return Edit;}());(function(Global){Global.timer=null;})(Global||_export('Global',Global={}));/**
 * The `ColumnChooser` module is used to show or hide columns dynamically.
 */_export('ColumnChooser',ColumnChooser=function(){/**
     * Constructor for the Grid ColumnChooser module
     * @hidden
     */function ColumnChooser(parent,serviceLocator){_classCallCheck(this,ColumnChooser);this.showColumn=[];this.hideColumn=[];this.isDlgOpen=false;this.dlghide=false;this.initialOpenDlg=true;this.stateChangeColumns=[];this.isInitialOpen=false;this.isCustomizeOpenCC=false;this.cBoxTrue=createCheckBox(true,{checked:true,label:' '});this.cBoxFalse=createCheckBox(true,{checked:false,label:' '});this.parent=parent;this.serviceLocator=serviceLocator;this.addEventListener();this.cBoxTrue.insertBefore(createElement('input',{className:'e-chk-hidden e-cc e-cc-chbox',attrs:{type:'checkbox'}}),this.cBoxTrue.firstChild);this.cBoxFalse.insertBefore(createElement('input',{className:'e-chk-hidden e-cc e-cc-chbox',attrs:{'type':'checkbox'}}),this.cBoxFalse.firstChild);this.cBoxFalse.querySelector('.e-frame').classList.add('e-uncheck');if(this.parent.enableRtl){addClass([this.cBoxTrue,this.cBoxFalse],['e-rtl']);}}_createClass(ColumnChooser,[{key:'destroy',value:function destroy(){this.removeEventListener();this.unWireEvents();if(!isNullOrUndefined(this.dlgObj)&&this.dlgObj.element&&!this.dlgObj.isDestroyed){this.dlgObj.destroy();}}},{key:'rtlUpdate',value:function rtlUpdate(){if(this.parent.enableRtl){addClass(this.innerDiv.querySelectorAll('.e-checkbox-wrapper'),['e-rtl']);}else{removeClass(this.innerDiv.querySelectorAll('.e-checkbox-wrapper'),['e-rtl']);}}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(click,this.clickHandler,this);this.parent.on(uiUpdate,this.enableAfterRenderEle,this);this.parent.on(initialEnd,this.render,this);this.parent.addEventListener(dataBound,this.hideDialog.bind(this));this.parent.on(_destroy,this.destroy,this);this.parent.on(rtlUpdated,this.rtlUpdate,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(click,this.clickHandler);this.parent.off(initialEnd,this.render);this.parent.off(_destroy,this.destroy);this.parent.off(uiUpdate,this.enableAfterRenderEle);this.parent.off(rtlUpdated,this.rtlUpdate);}},{key:'render',value:function render(){this.l10n=this.serviceLocator.getService('localization');this.renderDlgContent();this.getShowHideService=this.serviceLocator.getService('showHideService');}},{key:'clickHandler',value:function clickHandler(e){var targetElement=e.target;if(!this.isCustomizeOpenCC){if(!isNullOrUndefined(closest(targetElement,'.e-cc'))||!isNullOrUndefined(closest(targetElement,'.e-cc-toolbar'))){if(targetElement.classList.contains('e-columnchooser-btn')||targetElement.classList.contains('e-cc-toolbar')){if(this.initialOpenDlg&&this.dlgObj.visible||!this.isDlgOpen){this.isDlgOpen=true;return;}}else if(targetElement.classList.contains('e-cc-cancel')){targetElement.parentElement.querySelector('.e-ccsearch').value='';this.columnChooserSearch('');this.removeCancelIcon();}}else{if(!isNullOrUndefined(this.dlgObj)&&this.dlgObj.visible&&!targetElement.classList.contains('e-toolbar-items')){this.dlgObj.hide();this.refreshCheckboxState();// this.unWireEvents();
this.isDlgOpen=false;}}}}},{key:'hideDialog',value:function hideDialog(){if(!isNullOrUndefined(this.dlgObj)&&this.dlgObj.visible){this.dlgObj.hide();// this.unWireEvents();
this.isDlgOpen=false;}}},{key:'renderColumnChooser',value:function renderColumnChooser(x,y,target){if(!this.dlgObj.visible){var args1={requestType:'beforeOpenColumnChooser',element:this.parent.element,columns:this.getColumns(),cancel:false};this.parent.trigger(beforeOpenColumnChooser,args1);if(args1.cancel){return;}this.refreshCheckboxState();this.dlgObj.dataBind();this.dlgObj.element.style.maxHeight='430px';var elementVisible=this.dlgObj.element.style.display;this.dlgObj.element.style.display='block';var newpos=calculateRelativeBasedPosition(closest(target,'.e-toolbar-item'),this.dlgObj.element);this.dlgObj.element.style.display=elementVisible;this.dlgObj.element.style.top=newpos.top+closest(target,'.e-cc-toolbar').getBoundingClientRect().height+'px';var dlgWidth=250;if(!isNullOrUndefined(closest(target,'.e-bigger'))){this.dlgObj.width=258;}if(Browser.isDevice){this.dlgObj.target=document.body;this.dlgObj.position={X:'center',Y:'center'};this.dlgObj.refreshPosition();this.dlgObj.open=this.mOpenDlg.bind(this);}else{if(this.parent.enableRtl){this.dlgObj.element.style.left=target.offsetLeft+'px';}else{this.dlgObj.element.style.left=newpos.left-dlgWidth+closest(target,'.e-cc-toolbar').clientWidth+2+'px';}}this.removeCancelIcon();this.dlgObj.show();}else{// this.unWireEvents();
this.hideDialog();this.addcancelIcon();}}},{key:'openColumnChooser',value:function openColumnChooser(X,Y){this.isCustomizeOpenCC=true;if(this.dlgObj.visible){this.hideDialog();return;}if(!this.isInitialOpen){this.dlgObj.content=this.renderChooserList();}else{this.refreshCheckboxState();}this.dlgObj.dataBind();this.dlgObj.position={X:'center',Y:'center'};if(isNullOrUndefined(X)){this.dlgObj.position={X:'center',Y:'center'};this.dlgObj.refreshPosition();}else{this.dlgObj.element.style.top='';this.dlgObj.element.style.left='';this.dlgObj.element.style.top=Y+'px';this.dlgObj.element.style.left=X+'px';}this.dlgObj.beforeOpen=this.customDialogOpen.bind(this);this.dlgObj.show();this.isInitialOpen=true;this.dlgObj.beforeClose=this.customDialogClose.bind(this);}},{key:'enableAfterRenderEle',value:function enableAfterRenderEle(e){if(e.module===this.getModuleName()&&e.enable){this.render();}}},{key:'customDialogOpen',value:function customDialogOpen(){var searchElement=this.dlgObj.content.querySelector('input.e-ccsearch');EventHandler.add(searchElement,'keyup',this.columnChooserManualSearch,this);}},{key:'customDialogClose',value:function customDialogClose(){var searchElement=this.dlgObj.content.querySelector('input.e-ccsearch');EventHandler.remove(searchElement,'keyup',this.columnChooserManualSearch);}},{key:'getColumns',value:function getColumns(){var columns=this.parent.getColumns().filter(function(column){return column.type!=='checkbox'||column.type==='checkbox'&&column.field!==undefined;});return columns;}},{key:'renderDlgContent',value:function renderDlgContent(){var y=void 0;this.dlgDiv=createElement('div',{className:'e-ccdlg e-cc',id:this.parent.element.id+'_ccdlg'});this.parent.element.appendChild(this.dlgDiv);var xpos=this.parent.element.getBoundingClientRect().width-250;var dialoPos=this.parent.enableRtl?'left':'right';var tarElement=this.parent.element.querySelector('.e-ccdiv');if(!isNullOrUndefined(tarElement)){y=tarElement.getBoundingClientRect().top;}this.dlgObj=new Dialog({header:this.l10n.getConstant('ChooseColumns'),showCloseIcon:false,closeOnEscape:false,locale:this.parent.locale,visible:false,enableRtl:this.parent.enableRtl,target:document.getElementById(this.parent.element.id),buttons:[{click:this.confirmDlgBtnClick.bind(this),buttonModel:{content:this.l10n.getConstant('OKButton'),isPrimary:true,cssClass:'e-cc e-cc_okbtn'}},{click:this.clearActions.bind(this),buttonModel:{cssClass:'e-flat e-cc e-cc-cnbtn',content:this.l10n.getConstant('CancelButton')}}],content:this.renderChooserList(),width:250,cssClass:'e-cc',animationSettings:{effect:'None'}});this.dlgObj.appendTo(this.dlgDiv);changeButtonType(this.dlgObj.element);this.wireEvents();}},{key:'renderChooserList',value:function renderChooserList(){this.mainDiv=createElement('div',{className:'e-main-div e-cc'});var searchDiv=createElement('div',{className:'e-cc-searchdiv e-cc e-input-group'});var ccsearchele=createElement('input',{className:'e-ccsearch e-cc e-input',attrs:{placeholder:this.l10n.getConstant('Search')}});var ccsearchicon=createElement('span',{className:'e-ccsearch-icon e-icons e-cc e-input-group-icon'});var conDiv=createElement('div',{className:'e-cc-contentdiv'});this.innerDiv=createElement('div',{className:'e-innerdiv e-cc'});searchDiv.appendChild(ccsearchele);searchDiv.appendChild(ccsearchicon);this.searchBoxObj=new SearchBox(ccsearchele);var innerDivContent=this.refreshCheckboxList(this.parent.getColumns());this.innerDiv.appendChild(innerDivContent);conDiv.appendChild(this.innerDiv);this.mainDiv.appendChild(searchDiv);this.mainDiv.appendChild(conDiv);return this.mainDiv;}},{key:'confirmDlgBtnClick',value:function confirmDlgBtnClick(args){this.stateChangeColumns=[];if(!isNullOrUndefined(args)){if(this.hideColumn.length){this.columnStateChange(this.hideColumn,false);}if(this.showColumn.length){this.columnStateChange(this.showColumn,true);}var params={requestType:'columnstate',element:this.parent.element,columns:this.stateChangeColumns,dialogInstance:this.dlgObj};this.parent.trigger(actionComplete,params);this.getShowHideService.setVisible(this.stateChangeColumns);this.clearActions();this.parent.notify(tooltipDestroy,{module:'edit'});}}},{key:'columnStateChange',value:function columnStateChange(stateColumns,state){for(var index=0;index<stateColumns.length;index++){var colUid=stateColumns[index];var currentCol=this.parent.getColumnByUid(colUid);currentCol.visible=state;this.stateChangeColumns.push(currentCol);}}},{key:'clearActions',value:function clearActions(){this.hideColumn=[];this.showColumn=[];// this.unWireEvents();
this.hideDialog();this.addcancelIcon();}},{key:'checkstatecolumn',value:function checkstatecolumn(isChecked,coluid){if(isChecked){if(this.hideColumn.indexOf(coluid)!==-1){this.hideColumn.splice(this.hideColumn.indexOf(coluid),1);}if(this.showColumn.indexOf(coluid)===-1){this.showColumn.push(coluid);}}else{if(this.showColumn.indexOf(coluid)!==-1){this.showColumn.splice(this.showColumn.indexOf(coluid),1);}if(this.hideColumn.indexOf(coluid)===-1){this.hideColumn.push(coluid);}}}},{key:'columnChooserSearch',value:function columnChooserSearch(searchVal){var clearSearch=false;var fltrCol=void 0;if(searchVal===''){this.removeCancelIcon();fltrCol=this.getColumns();clearSearch=true;}else{fltrCol=new DataManager(this.getColumns()).executeLocal(new Query().where('headerText','startswith',searchVal,true));}if(fltrCol.length){this.innerDiv.innerHTML=' ';this.innerDiv.classList.remove('e-ccnmdiv');this.innerDiv.appendChild(this.refreshCheckboxList(fltrCol,searchVal));if(!clearSearch){this.addcancelIcon();}}else{var nMatchele=createElement('span',{className:'e-cc e-nmatch'});nMatchele.innerHTML=this.l10n.getConstant('Matchs');this.innerDiv.innerHTML=' ';this.innerDiv.appendChild(nMatchele);this.innerDiv.classList.add('e-ccnmdiv');}this.flag=true;this.stopTimer();}},{key:'wireEvents',value:function wireEvents(){EventHandler.add(this.dlgObj.element,'click',this.checkBoxClickHandler,this);EventHandler.add(this.searchBoxObj.searchBox,'keyup',this.columnChooserManualSearch,this);this.searchBoxObj.wireEvent();}},{key:'unWireEvents',value:function unWireEvents(){if(this.parent.isDestroyed){return;}if(this.dlgObj.element){EventHandler.remove(this.dlgObj.element,'click',this.checkBoxClickHandler);}EventHandler.remove(this.searchBoxObj.searchBox,'keyup',this.columnChooserManualSearch);this.searchBoxObj.unWireEvent();}},{key:'checkBoxClickHandler',value:function checkBoxClickHandler(e){var checkstate=void 0;var elem=parentsUntil(e.target,'e-checkbox-wrapper');if(elem){toogleCheckbox(elem.parentElement);elem.querySelector('.e-chk-hidden').focus();if(elem.querySelector('.e-check')){checkstate=true;}else if(elem.querySelector('.e-uncheck')){checkstate=false;}else{return;}var columnUid=parentsUntil(elem,'e-ccheck').getAttribute('uid');this.checkstatecolumn(checkstate,columnUid);}}},{key:'refreshCheckboxList',value:function refreshCheckboxList(gdCol,searchVal){this.ulElement=createElement('ul',{className:'e-ccul-ele e-cc'});for(var i=0;i<gdCol.length;i++){var columns=gdCol[i];this.renderCheckbox(columns);}return this.ulElement;}},{key:'refreshCheckboxState',value:function refreshCheckboxState(){this.dlgObj.element.querySelector('.e-cc.e-input').value='';this.columnChooserSearch('');for(var i=0;i<this.parent.element.querySelectorAll('.e-cc-chbox').length;i++){var element=this.parent.element.querySelectorAll('.e-cc-chbox')[i];var columnUID=parentsUntil(element,'e-ccheck').getAttribute('uid');var column=this.parent.getColumnByUid(columnUID);if(column.visible){element.checked=true;this.checkState(element.parentElement.querySelector('.e-icons'),true);}else{element.checked=false;this.checkState(element.parentElement.querySelector('.e-icons'),false);}}}},{key:'checkState',value:function checkState(element,state){state?classList(element,['e-check'],['e-uncheck']):classList(element,['e-uncheck'],['e-check']);}},{key:'createCheckBox',value:function createCheckBox(label,checked,uid){var cbox=checked?this.cBoxTrue.cloneNode(true):this.cBoxFalse.cloneNode(true);cbox.querySelector('.e-label').innerHTML=label;return createCboxWithWrap(uid,cbox,'e-ccheck');}},{key:'renderCheckbox',value:function renderCheckbox(column){var cclist=void 0;var hideColState=void 0;var showColState=void 0;if(column.showInColumnChooser){cclist=createElement('li',{className:'e-cclist e-cc',styles:'list-style:None',id:'e-ccli_'+column.uid});hideColState=this.hideColumn.indexOf(column.uid)===-1?false:true;showColState=this.showColumn.indexOf(column.uid)===-1?false:true;var cccheckboxlist=this.createCheckBox(column.headerText,column.visible&&!hideColState||showColState,column.uid);cclist.appendChild(cccheckboxlist);this.ulElement.appendChild(cclist);}}},{key:'columnChooserManualSearch',value:function columnChooserManualSearch(e){this.addcancelIcon();this.searchValue=e.target.value;this.stopTimer();this.startTimer(e);}},{key:'startTimer',value:function startTimer(e){var proxy=this;var interval=!proxy.flag&&e.keyCode!==13?500:0;this.timer=window.setInterval(function(){proxy.columnChooserSearch(proxy.searchValue);},interval);}},{key:'stopTimer',value:function stopTimer(){window.clearInterval(this.timer);}},{key:'addcancelIcon',value:function addcancelIcon(){this.dlgDiv.querySelector('.e-cc.e-ccsearch-icon').classList.add('e-cc-cancel');}},{key:'removeCancelIcon',value:function removeCancelIcon(){this.dlgDiv.querySelector('.e-cc.e-ccsearch-icon').classList.remove('e-cc-cancel');}},{key:'mOpenDlg',value:function mOpenDlg(){if(Browser.isDevice){this.dlgObj.element.querySelector('.e-cc-searchdiv').classList.remove('e-input-focus');this.dlgObj.element.querySelectorAll('.e-cc-chbox')[0].focus();}}},{key:'getModuleName',value:function getModuleName(){return'columnChooser';}}]);return ColumnChooser;}());_export('ExportHelper',ExportHelper=function(){function ExportHelper(parent){_classCallCheck(this,ExportHelper);this.hideColumnInclude=false;this.foreignKeyData={};this.parent=parent;}_createClass(ExportHelper,[{key:'getFData',value:function getFData(value,column){var foreignKeyData=getForeignData(column,{},value,this.foreignKeyData[column.field])[0];return foreignKeyData;}},{key:'getColumnData',value:function getColumnData(gridObj){var _this119=this;var columnPromise=[];var promise=void 0;var fColumns=gridObj.getForeignKeyColumns();if(fColumns.length){fColumns.forEach(function(col){columnPromise.push(col.dataSource.executeQuery(new Query()));});promise=Promise.all(columnPromise).then(function(e){fColumns.forEach(function(col,index){_this119.foreignKeyData[col.field]=e[index].result;});// tslint:disable-next-line:no-any
});}return promise;}},{key:'getHeaders',value:function getHeaders(column,isHideColumnInclude){if(isHideColumnInclude){this.hideColumnInclude=true;}else{this.hideColumnInclude=false;}var cols=column;this.colDepth=this.measureColumnDepth(cols);var rows=[];var actualColumns=[];for(var i=0;i<this.colDepth;i++){rows[i]=new Row({});rows[i].cells=[];}rows=this.processColumns(rows);rows=this.processHeaderCells(rows);var _iteratorNormalCompletion58=true;var _didIteratorError58=false;var _iteratorError58=undefined;try{for(var _iterator58=rows[Symbol.iterator](),_step58;!(_iteratorNormalCompletion58=(_step58=_iterator58.next()).done);_iteratorNormalCompletion58=true){var row=_step58.value;for(var _i19=0;_i19<row.cells.length;_i19++){var cell=row.cells[_i19];if(cell.visible===undefined&&cell.cellType!==CellType.StackedHeader){row.cells=this.removeCellFromRow(row.cells,_i19);_i19=_i19-1;}if(!isHideColumnInclude&&cell.visible!==undefined&&!cell.visible){row.cells=this.removeCellFromRow(row.cells,_i19);_i19=_i19-1;}}}}catch(err){_didIteratorError58=true;_iteratorError58=err;}finally{try{if(!_iteratorNormalCompletion58&&_iterator58.return){_iterator58.return();}}finally{if(_didIteratorError58){throw _iteratorError58;}}}for(var _i18=0;_i18<cols.length;_i18++){this.generateActualColumns(cols[_i18],actualColumns);}return{rows:rows,columns:actualColumns};}},{key:'getConvertedWidth',value:function getConvertedWidth(input){var value=parseFloat(input);/* tslint:disable-next-line:max-line-length */return input.indexOf('%')!==-1?this.parent.element.getBoundingClientRect().width*value/100:value;}},{key:'generateActualColumns',value:function generateActualColumns(column,actualColumns){if(!column.columns){if(column.visible||this.hideColumnInclude){actualColumns.push(column);}}else{if(column.visible||this.hideColumnInclude){var colSpan=this.getCellCount(column,0);if(colSpan!==0){for(var i=0;i<column.columns.length;i++){/* tslint:disable-next-line:max-line-length */this.generateActualColumns(column.columns[i],actualColumns);}}}}}},{key:'removeCellFromRow',value:function removeCellFromRow(cells,cellIndex){var resultCells=[];for(var i=0;i<cellIndex;i++){resultCells.push(cells[i]);}for(var _i20=cellIndex+1;_i20<cells.length;_i20++){resultCells.push(cells[_i20]);}return resultCells;}},{key:'processHeaderCells',value:function processHeaderCells(rows){var columns=this.parent.enableColumnVirtualization?this.parent.getColumns():this.parent.columns;for(var i=0;i<columns.length;i++){rows=this.appendGridCells(columns[i],rows,0,i===0,false,i===columns.length-1);}return rows;}},{key:'appendGridCells',value:function appendGridCells(cols,gridRows,index,isFirstObj,isFirstColumn,isLastColumn){/* tslint:enable */var lastCol=isLastColumn?'e-lastcell':'';if(!cols.columns){gridRows[index].cells.push(this.generateCell(cols,CellType.Header,this.colDepth-index,(isFirstObj?'':isFirstColumn?'e-firstcell':'')+lastCol,index,this.parent.getColumnIndexByUid(cols.uid)));}else{var colSpan=this.getCellCount(cols,0);if(colSpan){gridRows[index].cells.push(new Cell({cellType:CellType.StackedHeader,column:cols,colSpan:colSpan}));}var isIgnoreFirstCell=void 0;for(var i=0,len=cols.columns.length;i<len;i++){if(cols.columns[i].visible&&!isIgnoreFirstCell){isIgnoreFirstCell=true;}/* tslint:disable-next-line:max-line-length */gridRows=this.appendGridCells(cols.columns[i],gridRows,index+1,isFirstObj,i===0,i===len-1&&isLastColumn);}}return gridRows;}},{key:'generateCell',value:function generateCell(gridColumn,cellType,rowSpan,className,rowIndex,columnIndex){var option={'visible':gridColumn.visible,'isDataCell':false,'isTemplate':!isNullOrUndefined(gridColumn.headerTemplate),'rowID':'','column':gridColumn,'cellType':cellType,'rowSpan':rowSpan,'className':className,'index':rowIndex,'colIndex':columnIndex};if(!option.rowSpan||option.rowSpan<2){delete option.rowSpan;}return new Cell(option);}},{key:'processColumns',value:function processColumns(rows){//TODO: generate dummy column for group, detail, stacked row here; ensureColumns here
var gridObj=this.parent;var columnIndexes=this.parent.getColumnIndexesInView();for(var i=0,len=rows.length;i<len;i++){if(gridObj.allowGrouping){for(var j=0,_len12=gridObj.groupSettings.columns.length;j<_len12;j++){if(this.parent.enableColumnVirtualization&&columnIndexes.indexOf(j)===-1){continue;}rows[i].cells.push(this.generateCell({},CellType.HeaderIndent));}}if(gridObj.detailTemplate||gridObj.childGrid){rows[i].cells.push(this.generateCell({},CellType.DetailHeader));}}return rows;}},{key:'getCellCount',value:function getCellCount(column,count){if(column.columns){for(var i=0;i<column.columns.length;i++){count=this.getCellCount(column.columns[i],count);}}else{if(column.visible||this.hideColumnInclude){count++;}}return count;}},{key:'measureColumnDepth',value:function measureColumnDepth(column){var max=0;for(var i=0;i<column.length;i++){var depth=this.checkDepth(column[i],0);if(max<depth){max=depth;}}return max+1;}},{key:'checkDepth',value:function checkDepth(col,index){if(col.columns){index++;for(var i=0;i<col.columns.length;i++){index=this.checkDepth(col.columns[i],index);}}return index;}}],[{key:'getQuery',value:function getQuery(parent,data){return data.isRemote()?data.generateQuery(true).requiresCount().take(parent.pageSettings.totalRecordsCount):data.generateQuery(true).requiresCount();}}]);return ExportHelper;}());_export('ExportValueFormatter',ExportValueFormatter=function(){function ExportValueFormatter(){_classCallCheck(this,ExportValueFormatter);this.valueFormatter=new ValueFormatter();this.internationalization=new Internationalization();}/* tslint:disable-next-line:no-any */_createClass(ExportValueFormatter,[{key:'returnFormattedValue',value:function returnFormattedValue(args,customFormat){if(!isNullOrUndefined(args.value)&&args.value){return this.valueFormatter.getFormatFunction(customFormat)(args.value);}else{return'';}}},{key:'formatCellValue',value:function formatCellValue(args){if(args.isForeignKey){args.value=getValue(args.column.foreignKeyValue,getForeignData(args.column,{},args.value)[0]);}if(args.column.type==='number'&&args.column.format!==undefined&&args.column.format!==''){return args.value?this.internationalization.getNumberFormat({format:args.column.format})(args.value):'';}else if(args.column.type==='boolean'){return args.value?'true':'false';/* tslint:disable-next-line:max-line-length */}else if((args.column.type==='date'||args.column.type==='datetime'||args.column.type==='time')&&args.column.format!==undefined){if(typeof args.column.format==='string'){var format=void 0;if(args.column.type==='date'){format={type:'date',skeleton:args.column.format};}else if(args.column.type==='time'){format={type:'time',skeleton:args.column.format};}else{format={type:'dateTime',skeleton:args.column.format};}return this.returnFormattedValue(args,format);}else{if(args.column.format instanceof Object&&args.column.format.type===undefined){return args.value.toString();}else{/* tslint:disable-next-line:max-line-length */var customFormat=void 0;if(args.column.type==='date'){/* tslint:disable-next-line:max-line-length */customFormat={type:args.column.format.type,format:args.column.format.format,skeleton:args.column.format.skeleton};}else if(args.column.type==='time'){customFormat={type:'time',format:args.column.format.format,skeleton:args.column.format.skeleton};}else{customFormat={type:'dateTime',format:args.column.format.format,skeleton:args.column.format.skeleton};}return this.returnFormattedValue(args,customFormat);}}}else{if(args.column.type===undefined||args.column.type===null){return'';}else{return args.value.toString();}}}}]);return ExportValueFormatter;}());_export('ExcelExport',ExcelExport=function(){/**
     * Constructor for the Grid Excel Export module.
     * @hidden
     */function ExcelExport(parent){_classCallCheck(this,ExcelExport);/* tslint:disable-next-line:no-any */this.book={};/* tslint:disable-next-line:no-any */this.workSheet=[];/* tslint:disable-next-line:no-any */this.rows=[];/* tslint:disable-next-line:no-any */this.columns=[];/* tslint:disable-next-line:no-any */this.styles=[];this.rowLength=1;this.expType='AppendToSheet';this.includeHiddenColumn=false;this.isCsvExport=false;this.isElementIdChanged=false;this.foreignKeyData={};this.parent=parent;this.helper=new ExportHelper(parent);}/**
     * For internal use only - Get the module name.
     */_createClass(ExcelExport,[{key:'getModuleName',value:function getModuleName(){return'ExcelExport';}},{key:'init',value:function init(gObj){if(gObj.element!==null&&gObj.element.id===''){gObj.element.id=new Date().toISOString();this.isElementIdChanged=true;}this.parent=gObj;if(this.parent.isDestroyed){return;}this.isExporting=undefined;this.book={};/* tslint:disable-next-line:no-any */this.workSheet=[];/* tslint:disable-next-line:no-any */this.rows=[];/* tslint:disable-next-line:no-any */this.columns=[];/* tslint:disable-next-line:no-any */this.styles=[];this.rowLength=1;/* tslint:disable-next-line:no-any */this.footer=undefined;this.expType='AppendToSheet';this.includeHiddenColumn=false;this.exportValueFormatter=new ExportValueFormatter();}},{key:'Map',value:function Map(grid,exportProperties,isMultipleExport,workbook,isCsv,isBlob){var gObj=grid;gObj.trigger(beforeExcelExport);this.data=new Data(gObj);this.isExporting=true;this.isBlob=isBlob;if(isCsv){this.isCsvExport=isCsv;}else{this.isCsvExport=false;}return this.processRecords(gObj,exportProperties,isMultipleExport,workbook);}},{key:'processRecords',value:function processRecords(gObj,exportProperties,isMultipleExport,workbook){var _this120=this;if(!isNullOrUndefined(exportProperties)&&!isNullOrUndefined(exportProperties.dataSource)&&exportProperties.dataSource instanceof DataManager){/* tslint:disable-next-line:no-any */var promise=void 0;return promise=new Promise(function(resolve,reject){/* tslint:disable-next-line:max-line-length *//* tslint:disable-next-line:no-any */var dataManager=exportProperties.dataSource.executeQuery(new Query());dataManager.then(function(r){_this120.init(gObj);_this120.processInnerRecords(gObj,exportProperties,isMultipleExport,workbook,r);resolve(_this120.book);});});}else{/* tslint:disable-next-line:no-any */var allPromise=[];allPromise.push(this.data.getData({},ExportHelper.getQuery(gObj,this.data)));allPromise.push(this.helper.getColumnData(gObj));var bool=true;return Promise.all(allPromise).then(function(e){if(bool){_this120.init(gObj);_this120.processInnerRecords(gObj,exportProperties,isMultipleExport,workbook,e[0]);bool=false;}}).catch(function(e){_this120.parent.trigger(actionFailure,e);});}}},{key:'processInnerRecords',value:function processInnerRecords(gObj,exportProperties,isMultipleExport,workbook,r){var blankRows=5;if(!isNullOrUndefined(exportProperties)&&!isNullOrUndefined(exportProperties.multipleExport)){/* tslint:disable-next-line:max-line-length */this.expType=!isNullOrUndefined(exportProperties.multipleExport.type)?exportProperties.multipleExport.type:'AppendToSheet';if(!isNullOrUndefined(exportProperties.multipleExport.blankRows)){blankRows=exportProperties.multipleExport.blankRows;}}if(isNullOrUndefined(workbook)){this.workSheet=[];this.rows=[];this.columns=[];this.styles=[];}else if(this.expType==='NewSheet'){this.workSheet=workbook.worksheets;this.rows=[];this.columns=[];this.styles=workbook.styles;}else{this.workSheet=[];this.rows=workbook.worksheets[0].rows;this.columns=workbook.worksheets[0].columns;this.styles=workbook.styles;this.rowLength=this.rows[this.rows.length-1].index+blankRows;this.rowLength++;}if(!isNullOrUndefined(exportProperties)){if(!isNullOrUndefined(isMultipleExport)){if(!isNullOrUndefined(exportProperties.header)&&(isMultipleExport||this.expType==='NewSheet')){this.processExcelHeader(JSON.parse(JSON.stringify(exportProperties.header)));}if(!isNullOrUndefined(exportProperties.footer)){if(this.expType==='AppendToSheet'){if(!isMultipleExport){this.footer=JSON.parse(JSON.stringify(exportProperties.footer));}}else{this.footer=JSON.parse(JSON.stringify(exportProperties.footer));}}}else{if(!isNullOrUndefined(exportProperties.header)){this.processExcelHeader(JSON.parse(JSON.stringify(exportProperties.header)));}if(!isNullOrUndefined(exportProperties.footer)){this.footer=JSON.parse(JSON.stringify(exportProperties.footer));}}}this.includeHiddenColumn=!isNullOrUndefined(exportProperties)?exportProperties.includeHiddenColumn:false;/* tslint:disable-next-line:max-line-length *//* tslint:disable-next-line:no-any */var headerRow=this.helper.getHeaders(gObj.columns,this.includeHiddenColumn);var groupIndent=0;/* tslint:disable:no-any */if(!isNullOrUndefined(r.result.level)){groupIndent+=r.result.level;groupIndent+=r.result.childLevels;}/* tslint:enable:no-any */this.processHeaderContent(gObj,headerRow,exportProperties,groupIndent);/* tslint:disable-next-line:max-line-length */if(!isNullOrUndefined(exportProperties)&&!isNullOrUndefined(exportProperties.dataSource)&&!(exportProperties.dataSource instanceof DataManager)){this.processRecordContent(gObj,r,headerRow,isMultipleExport,exportProperties.dataSource);}else if(!isNullOrUndefined(exportProperties)&&exportProperties.exportType==='CurrentPage'){this.processRecordContent(gObj,r,headerRow,isMultipleExport,gObj.getCurrentViewRecords());}else{this.processRecordContent(gObj,r,headerRow,isMultipleExport);}this.isExporting=false;gObj.trigger(excelExportComplete,this.isBlob?{promise:this.blobPromise}:{});}},{key:'processRecordContent',value:function processRecordContent(gObj,returnType,headerRow,isMultipleExport,currentViewRecords){/* tslint:disable-next-line:no-any */var column=gObj.columns;/* tslint:disable-next-line:no-any */var record=undefined;if(!isNullOrUndefined(currentViewRecords)){record=currentViewRecords;}else{record=returnType.result;}if(!isNullOrUndefined(record.level)){this.processGroupedRows(gObj,record,headerRow,record.level);}else{this.processRecordRows(gObj,record,headerRow,0);}if(!isNullOrUndefined(returnType.aggregates)){if(!isNullOrUndefined(currentViewRecords)){this.processAggregates(gObj,returnType.result,currentViewRecords);}else{this.processAggregates(gObj,returnType.result);}}//footer template add
if(!isNullOrUndefined(this.footer)){if(this.expType==='AppendToSheet'&&!isMultipleExport||this.expType==='NewSheet'){this.processExcelFooter(this.footer);}}/* tslint:disable-next-line:no-any */var sheet={};if(this.columns.length>0){sheet.columns=this.columns;}sheet.rows=this.rows;this.workSheet.push(sheet);this.book.worksheets=this.workSheet;this.book.styles=this.styles;if(!isMultipleExport){if(this.isCsvExport){var book=new Workbook(this.book,'csv');if(!this.isBlob){book.save('Export.csv');}else{this.blobPromise=book.saveAsBlob('text/csv');}}else{var _book=new Workbook(this.book,'xlsx');if(!this.isBlob){_book.save('Export.xlsx');}else{this.blobPromise=_book.saveAsBlob('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');}}if(this.isElementIdChanged){gObj.element.id='';}}}},{key:'processGroupedRows',value:function processGroupedRows(gObj,dataSource,headerRow,level){var _iteratorNormalCompletion59=true;var _didIteratorError59=false;var _iteratorError59=undefined;try{for(var _iterator59=dataSource[Symbol.iterator](),_step59;!(_iteratorNormalCompletion59=(_step59=_iterator59.next()).done);_iteratorNormalCompletion59=true){var item=_step59.value;/* tslint:disable-next-line:no-any */var cells=[];var index=1;/* tslint:disable-next-line:no-any */var cell={};cell.index=index+level;var col=gObj.getColumnByField(item.field);/* tslint:disable-next-line:no-any */var args={value:item.key,column:col,style:undefined,isForeignKey:col.isForeignColumn()};cell.value=item.field+': '+this.exportValueFormatter.formatCellValue(args)+' - ';if(item.count>1){cell.value+=item.count+' items';}else{cell.value+=item.count+' item';}cell.style=this.getCaptionThemeStyle(this.theme);var captionModelGen=new CaptionSummaryModelGenerator(gObj);var groupCaptionSummaryRows=captionModelGen.generateRows(item);this.fillAggregates(gObj,groupCaptionSummaryRows,dataSource.level+dataSource.childLevels,this.rowLength);cells.push(cell);if(this.rows[this.rows.length-1].cells.length>0){var lIndex=dataSource.level+dataSource.childLevels+groupCaptionSummaryRows[0].cells.length;var hIndex=0;var _iteratorNormalCompletion60=true;var _didIteratorError60=false;var _iteratorError60=undefined;try{for(var _iterator60=this.rows[this.rows.length-1].cells[Symbol.iterator](),_step60;!(_iteratorNormalCompletion60=(_step60=_iterator60.next()).done);_iteratorNormalCompletion60=true){var tCell=_step60.value;if(tCell.index<lIndex){lIndex=tCell.index;}if(tCell.index>hIndex){hIndex=tCell.index;}tCell.style=this.getCaptionThemeStyle(this.theme);if(cells[cells.length-1].index!==tCell.index){cells.push(tCell);}}}catch(err){_didIteratorError60=true;_iteratorError60=err;}finally{try{if(!_iteratorNormalCompletion60&&_iterator60.return){_iterator60.return();}}finally{if(_didIteratorError60){throw _iteratorError60;}}}if(lIndex-cell.index>1){cell.colSpan=lIndex-cell.index;}while(hIndex<headerRow.columns.length+level){/* tslint:disable-next-line:no-any */var sCell={};if(dataSource.childLevels===0){sCell.index=hIndex;}else{sCell.index=hIndex+1;}sCell.style=this.getCaptionThemeStyle(this.theme);cells.push(sCell);hIndex++;}}else{var span=0;//Calculation for column span when group caption dont have aggregates
var _iteratorNormalCompletion61=true;var _didIteratorError61=false;var _iteratorError61=undefined;try{for(var _iterator61=headerRow.columns[Symbol.iterator](),_step61;!(_iteratorNormalCompletion61=(_step61=_iterator61.next()).done);_iteratorNormalCompletion61=true){var _col4=_step61.value;if(_col4.visible){span++;}}}catch(err){_didIteratorError61=true;_iteratorError61=err;}finally{try{if(!_iteratorNormalCompletion61&&_iterator61.return){_iterator61.return();}}finally{if(_didIteratorError61){throw _iteratorError61;}}}cell.colSpan=dataSource.childLevels+span;}this.rows[this.rows.length-1].cells=cells;this.rowLength++;if(!isNullOrUndefined(dataSource.childLevels)&&dataSource.childLevels>0){this.processGroupedRows(gObj,item.items,headerRow,item.items.level);}else{this.processRecordRows(gObj,item.items,headerRow,level);this.processAggregates(gObj,item,undefined,level,true);}}}catch(err){_didIteratorError59=true;_iteratorError59=err;}finally{try{if(!_iteratorNormalCompletion59&&_iterator59.return){_iterator59.return();}}finally{if(_didIteratorError59){throw _iteratorError59;}}}}},{key:'processRecordRows',value:function processRecordRows(gObj,record,headerRow,level){var rLen=Object.keys(record).length;var index=1;/* tslint:disable-next-line:no-any */var cells=[];for(var r=0;r<rLen;r++){cells=[];index=1;for(var c=0,len=headerRow.columns.length;c<len;c++){/* tslint:disable-next-line:no-any */var value=!isNullOrUndefined(headerRow.columns[c].field)?getValue(headerRow.columns[c].field,record[r]):'';var column=headerRow.columns[c];var foreignKeyData$$1=void 0;// tslint:disable-next-line:max-line-length
if(column.isForeignColumn&&column.isForeignColumn()){foreignKeyData$$1=this.helper.getFData(value,column);value=getValue(column.foreignKeyValue,foreignKeyData$$1);}if(!isNullOrUndefined(value)){/* tslint:disable-next-line:no-any */var excelCellArgs={data:record[r],column:headerRow.columns[c],foreignKeyData:foreignKeyData$$1};gObj.trigger(excelQueryCellInfo,extend(excelCellArgs,{column:headerRow.columns[c],data:record[r],value:value,style:undefined,colSpan:1}));/* tslint:disable-next-line:no-any */var cell={};cell.index=index+level;cell.value=excelCellArgs.value;if(excelCellArgs.colSpan>1){cell.colSpan=excelCellArgs.colSpan;}if(!isNullOrUndefined(excelCellArgs.style)){var styleIndex=this.getColumnStyle(gObj,index+level);cell.style=this.mergeOptions(this.styles[styleIndex],excelCellArgs.style);}else{cell.style={name:gObj.element.id+'column'+(index+level)};}cells.push(cell);}index++;}this.rows.push({index:this.rowLength++,cells:cells});}}},{key:'processAggregates',value:function processAggregates(gObj,rec,currentViewRecords,indent,byGroup){var summaryModel=new SummaryModelGenerator(gObj);/* tslint:disable-next-line:no-any */var data=undefined;if(!isNullOrUndefined(currentViewRecords)){data=currentViewRecords;}else{data=rec;}if(indent===undefined){indent=0;}if(gObj.groupSettings.columns.length>0&&byGroup){var groupSummaryModel=new GroupSummaryModelGenerator(gObj);var groupSummaryRows=groupSummaryModel.generateRows(data,{level:data.level});if(groupSummaryRows.length>0){this.fillAggregates(gObj,groupSummaryRows,indent);}}else{indent=gObj.groupSettings.columns.length>0&&!byGroup?gObj.groupSettings.columns.length:indent;var sRows=summaryModel.generateRows(data,rec.aggregates);if(sRows.length>0&&!byGroup){this.fillAggregates(gObj,sRows,indent);}}}},{key:'fillAggregates',value:function fillAggregates(gObj,cells,indent,customIndex){var _iteratorNormalCompletion62=true;var _didIteratorError62=false;var _iteratorError62=undefined;try{for(var _iterator62=cells[Symbol.iterator](),_step62;!(_iteratorNormalCompletion62=(_step62=_iterator62.next()).done);_iteratorNormalCompletion62=true){var row=_step62.value;/* tslint:disable-next-line:no-any */var _cells2=[];var index=0;var _iteratorNormalCompletion63=true;var _didIteratorError63=false;var _iteratorError63=undefined;try{for(var _iterator63=row.cells[Symbol.iterator](),_step63;!(_iteratorNormalCompletion63=(_step63=_iterator63.next()).done);_iteratorNormalCompletion63=true){var cell=_step63.value;/* tslint:disable-next-line:no-any */var eCell={};if(cell.visible||this.includeHiddenColumn){index++;if(cell.isDataCell){eCell.index=index+indent;if(!isNullOrUndefined(cell.column.footerTemplate)){eCell.value=this.getAggreateValue(CellType.Summary,cell.column.footerTemplate,cell,row);}else if(!isNullOrUndefined(cell.column.groupFooterTemplate)){eCell.value=this.getAggreateValue(CellType.GroupSummary,cell.column.groupFooterTemplate,cell,row);}else if(!isNullOrUndefined(cell.column.groupCaptionTemplate)){eCell.value=this.getAggreateValue(CellType.CaptionSummary,cell.column.groupCaptionTemplate,cell,row);}else{var _iteratorNormalCompletion64=true;var _didIteratorError64=false;var _iteratorError64=undefined;try{for(var _iterator64=Object.keys(row.data[cell.column.field])[Symbol.iterator](),_step64;!(_iteratorNormalCompletion64=(_step64=_iterator64.next()).done);_iteratorNormalCompletion64=true){var key=_step64.value;if(key===cell.column.type){if(!isNullOrUndefined(row.data[cell.column.field].Sum)){eCell.value=row.data[cell.column.field].Sum;}else if(!isNullOrUndefined(row.data[cell.column.field].Average)){eCell.value=row.data[cell.column.field].Average;}else if(!isNullOrUndefined(row.data[cell.column.field].Max)){eCell.value=row.data[cell.column.field].Max;}else if(!isNullOrUndefined(row.data[cell.column.field].Min)){eCell.value=row.data[cell.column.field].Min;}else if(!isNullOrUndefined(row.data[cell.column.field].Count)){eCell.value=row.data[cell.column.field].Count;}else if(!isNullOrUndefined(row.data[cell.column.field].TrueCount)){eCell.value=row.data[cell.column.field].TrueCount;}else if(!isNullOrUndefined(row.data[cell.column.field].FalseCount)){eCell.value=row.data[cell.column.field].FalseCount;}else if(!isNullOrUndefined(row.data[cell.column.field].Custom)){eCell.value=row.data[cell.column.field].Custom;}}}}catch(err){_didIteratorError64=true;_iteratorError64=err;}finally{try{if(!_iteratorNormalCompletion64&&_iterator64.return){_iterator64.return();}}finally{if(_didIteratorError64){throw _iteratorError64;}}}}eCell.style=this.getCaptionThemeStyle(this.theme);//{ name: gObj.element.id + 'column' + index };
if(cell.attributes.style.textAlign){eCell.style.hAlign=cell.attributes.style.textAlign;}_cells2.push(eCell);}else{if(customIndex===undefined){eCell.index=index+indent;eCell.style=this.getCaptionThemeStyle(this.theme);//{ name: gObj.element.id + 'column' + index };
_cells2.push(eCell);}}}}}catch(err){_didIteratorError63=true;_iteratorError63=err;}finally{try{if(!_iteratorNormalCompletion63&&_iterator63.return){_iterator63.return();}}finally{if(_didIteratorError63){throw _iteratorError63;}}}if(!isNullOrUndefined(customIndex)){this.rows.push({index:customIndex,cells:_cells2});}else{this.rows.push({index:this.rowLength++,cells:_cells2});}}}catch(err){_didIteratorError62=true;_iteratorError62=err;}finally{try{if(!_iteratorNormalCompletion62&&_iterator62.return){_iterator62.return();}}finally{if(_didIteratorError62){throw _iteratorError62;}}}}},{key:'getAggreateValue',value:function getAggreateValue(cellType,template,cell,row){var templateFn={};templateFn[getEnumValue(CellType,cell.cellType)]=_compile(template);/* tslint:disable-next-line:max-line-length */var txt=templateFn[getEnumValue(CellType,cell.cellType)](row.data[cell.column.field?cell.column.field:cell.column.columnName]);return txt[0].wholeText;}},{key:'mergeOptions',value:function mergeOptions(JSON1,JSON2){/* tslint:disable-next-line:no-any */var result={};/* tslint:disable-next-line:no-any */var attrname=Object.keys(JSON1);for(var index=0;index<attrname.length;index++){if(attrname[index]!=='name'){result[attrname[index]]=JSON1[attrname[index]];}}attrname=Object.keys(JSON2);for(var _index=0;_index<attrname.length;_index++){if(attrname[_index]!=='name'){result[attrname[_index]]=JSON2[attrname[_index]];}}return result;}},{key:'getColumnStyle',value:function getColumnStyle(gObj,columnIndex){var index=0;var _iteratorNormalCompletion65=true;var _didIteratorError65=false;var _iteratorError65=undefined;try{for(var _iterator65=this.styles[Symbol.iterator](),_step65;!(_iteratorNormalCompletion65=(_step65=_iterator65.next()).done);_iteratorNormalCompletion65=true){var style=_step65.value;if(style.name===gObj.element.id+'column'+columnIndex){return index;}index++;}}catch(err){_didIteratorError65=true;_iteratorError65=err;}finally{try{if(!_iteratorNormalCompletion65&&_iterator65.return){_iterator65.return();}}finally{if(_didIteratorError65){throw _iteratorError65;}}}return undefined;}},{key:'processHeaderContent',value:function processHeaderContent(gObj,headerRow,exportProperties,indent){/* tslint:disable-next-line:no-any */var column=gObj.columns;var rowIndex=1;/* tslint:disable-next-line:no-any */var returnValue=headerRow;/* tslint:enable:no-any */var gridRows=returnValue.rows;// Column collection with respect to the records in the grid
var gridColumns=returnValue.columns;/* tslint:disable-next-line:no-any */var spannedCells=[];if(indent>0){var index=0;while(index!==indent){this.columns.push({index:index+1,width:30});index++;}}for(var row=0;row<gridRows.length;row++){var currentCellIndex=1+indent;/* tslint:disable-next-line:no-any */var cells=[];for(var _column3=0;_column3<gridRows[row].cells.length;_column3++){/* tslint:disable-next-line:no-any */var style={};/* tslint:disable-next-line:no-any */var cell={};/* tslint:disable-next-line:no-any */var gridCell=gridRows[row].cells[_column3];/* tslint:disable-next-line:no-any */var result={contains:true,index:1};while(result.contains){result=this.getIndex(spannedCells,rowIndex,currentCellIndex);currentCellIndex=result.index;if(!result.contains){cell.index=result.index;break;}}if(!isNullOrUndefined(gridCell.rowSpan)&&gridCell.rowSpan!==1){cell.rowSpan=gridCell.rowSpan;for(var i=rowIndex;i<gridCell.rowSpan+rowIndex;i++){/* tslint:disable-next-line:no-any */var spannedCell={rowIndex:0,columnIndex:0};spannedCell.rowIndex=i;spannedCell.columnIndex=currentCellIndex;spannedCells.push(spannedCell);}}if(!isNullOrUndefined(gridCell.colSpan)&&gridCell.colSpan!==1){cell.colSpan=gridCell.colSpan;currentCellIndex=currentCellIndex+cell.colSpan-1;}cell.value=gridCell.column.headerText;if(!isNullOrUndefined(exportProperties)&&!isNullOrUndefined(exportProperties.theme)){this.theme=exportProperties.theme;}style=this.getHeaderThemeStyle(this.theme);if(!isNullOrUndefined(gridCell.column.textAlign)){style.hAlign=gridCell.column.textAlign;}if(!isNullOrUndefined(gridCell.column.headerTextAlign)){style.hAlign=gridCell.column.headerTextAlign;}cell.style=style;cells.push(cell);currentCellIndex++;}this.rows.push({index:this.rowLength++,cells:cells});}for(var col=0;col<gridColumns.length;col++){this.parseStyles(gObj,gridColumns[col],this.getRecordThemeStyle(this.theme),indent+col+1);}}},{key:'getHeaderThemeStyle',value:function getHeaderThemeStyle(theme){/* tslint:disable-next-line:no-any */var style={};style.fontSize=12;style.borders={color:'#E0E0E0'};if(!isNullOrUndefined(theme)&&!isNullOrUndefined(theme.header)){style=this.updateThemeStyle(theme.header,style);}return style;}},{key:'updateThemeStyle',value:function updateThemeStyle(themestyle,style){if(!isNullOrUndefined(themestyle.fontColor)){style.fontColor=themestyle.fontColor;}if(!isNullOrUndefined(themestyle.fontName)){style.fontName=themestyle.fontName;}if(!isNullOrUndefined(themestyle.fontSize)){style.fontSize=themestyle.fontSize;}if(!isNullOrUndefined(themestyle.borders)){if(!isNullOrUndefined(themestyle.borders.color)){style.borders.color=themestyle.borders.color;}if(!isNullOrUndefined(themestyle.borders.lineStyle)){style.borders.lineStyle=themestyle.borders.lineStyle;}}if(themestyle.bold!==false){style.bold=themestyle.bold;}return style;}},{key:'getCaptionThemeStyle',value:function getCaptionThemeStyle(theme){/* tslint:disable-next-line:no-any */var style={};style.fontSize=13;style.backColor='#F6F6F6';if(!isNullOrUndefined(theme)&&!isNullOrUndefined(theme.caption)){style=this.updateThemeStyle(theme.caption,style);}return style;}},{key:'getRecordThemeStyle',value:function getRecordThemeStyle(theme){/* tslint:disable-next-line:no-any */var style={};style.fontSize=13;style.borders={color:'#E0E0E0'};if(!isNullOrUndefined(theme)&&!isNullOrUndefined(theme.record)){style=this.updateThemeStyle(theme.record,style);}return style;}},{key:'processExcelHeader',value:function processExcelHeader(header){if(!isNullOrUndefined(header.rows)&&(this.expType==='NewSheet'||this.rowLength===1)){var noRows=void 0;if(header.headerRows===undefined){this.rowLength=header.rows.length;}else{this.rowLength=header.headerRows;}if(this.rowLength<header.rows.length){noRows=this.rowLength;}else{noRows=header.rows.length;}this.rowLength++;for(var row=0;row<noRows;row++){/* tslint:disable-next-line:no-any */var json=header.rows[row];//Row index
if(!(json.index!==null&&!isNullOrUndefined(json.index))){json.index=row+1;}this.updatedCellIndex(json);}}}},{key:'updatedCellIndex',value:function updatedCellIndex(json){var cellsLength=json.cells.length;for(var cellId=0;cellId<cellsLength;cellId++){/* tslint:disable-next-line:no-any */var jsonCell=json.cells[cellId];//cell index
if(!(jsonCell.index!==null&&!isNullOrUndefined(jsonCell.index))){jsonCell.index=cellId+1;}}this.rows.push(json);}},{key:'processExcelFooter',value:function processExcelFooter(footer){if(!isNullOrUndefined(footer.rows)){var noRows=void 0;if(footer.footerRows===undefined){this.rowLength+=footer.rows.length;}else{if(footer.footerRows>footer.rows.length){this.rowLength+=footer.footerRows-footer.rows.length;noRows=footer.rows.length;}else{noRows=footer.footerRows;}}for(var row=0;row<noRows;row++){/* tslint:disable-next-line:no-any */var json=footer.rows[row];//Row index
if(json.index===null||json.index===undefined){json.index=this.rowLength++;}else{json.index+=this.rowLength;}this.updatedCellIndex(json);}}}},{key:'getIndex',value:function getIndex(spannedCells,rowIndex,columnIndex){var _iteratorNormalCompletion66=true;var _didIteratorError66=false;var _iteratorError66=undefined;try{for(var _iterator66=spannedCells[Symbol.iterator](),_step66;!(_iteratorNormalCompletion66=(_step66=_iterator66.next()).done);_iteratorNormalCompletion66=true){var spannedCell=_step66.value;if(spannedCell.rowIndex===rowIndex&&spannedCell.columnIndex===columnIndex){columnIndex=columnIndex+1;return{contains:true,index:columnIndex};}}}catch(err){_didIteratorError66=true;_iteratorError66=err;}finally{try{if(!_iteratorNormalCompletion66&&_iterator66.return){_iterator66.return();}}finally{if(_didIteratorError66){throw _iteratorError66;}}}return{contains:false,index:columnIndex};}},{key:'parseStyles',value:function parseStyles(gObj,col,style,index){if(!isNullOrUndefined(col.format)){if(!isNullOrUndefined(col.format.skeleton)){style.numberFormat=col.format.skeleton;if(!isNullOrUndefined(col.format.type)){style.type=col.format.type;}}else{style.numberFormat=col.format;style.type=col.type;}}if(!isNullOrUndefined(col.textAlign)){style.hAlign=col.textAlign;}if(Object.keys(style).length>0){style.name=gObj.element.id+'column'+index;this.styles.push(style);}if(!isNullOrUndefined(col.width)){/* tslint:disable-next-line:max-line-length */this.columns.push({index:index,width:typeof col.width==='number'?col.width:this.helper.getConvertedWidth(col.width)});}}},{key:'destroy',value:function destroy(){//destroy for exporting
}}]);return ExcelExport;}());_export('PdfExport',PdfExport=function(){/**
     * Constructor for the Grid PDF Export module
     * @hidden
     */function PdfExport(parent){_classCallCheck(this,PdfExport);this.hideColumnInclude=false;this.currentViewData=false;this.customDataSource=false;this.isGrouping=false;this.parent=parent;this.helper=new ExportHelper(parent);}/**
     * For internal use only - Get the module name.
     */_createClass(PdfExport,[{key:'getModuleName',value:function getModuleName(){return'PdfExport';}},{key:'init',value:function init(parent){this.exportValueFormatter=new ExportValueFormatter();this.pdfDocument=undefined;this.hideColumnInclude=false;this.currentViewData=false;this.parent=parent;var gObj=parent;this.isGrouping=false;this.isExporting=true;gObj.trigger(beforePdfExport);}},{key:'Map',value:function Map(parent,pdfExportProperties,isMultipleExport,pdfDoc,isBlob){var _this121=this;this.data=new Data(this.parent);this.isBlob=isBlob;/* tslint:disable-next-line:max-line-length */if(!isNullOrUndefined(pdfExportProperties)&&!isNullOrUndefined(pdfExportProperties.dataSource)&&pdfExportProperties.dataSource instanceof DataManager){var promise=void 0;return promise=new Promise(function(resolve,reject){/* tslint:disable-next-line:no-any *//* tslint:disable-next-line:max-line-length */new DataManager({url:pdfExportProperties.dataSource.dataSource.url,adaptor:pdfExportProperties.dataSource.adaptor}).executeQuery(new Query()).then(function(returnType){_this121.init(parent);if(!isNullOrUndefined(pdfDoc)){_this121.pdfDocument=pdfDoc;}else{_this121.pdfDocument=new PdfDocument();}_this121.processExport(parent,returnType,pdfExportProperties,isMultipleExport);_this121.isExporting=false;parent.trigger(pdfExportComplete,_this121.isBlob?{promise:_this121.blobPromise}:{});resolve(_this121.pdfDocument);});});}else{var allPromise=[];allPromise.push(this.data.getData({},ExportHelper.getQuery(parent,this.data)));allPromise.push(this.helper.getColumnData(parent));var bool=true;return Promise.all(allPromise).then(function(e){if(bool){_this121.init(parent);if(!isNullOrUndefined(pdfDoc)){_this121.pdfDocument=pdfDoc;}else{_this121.pdfDocument=new PdfDocument();}_this121.processExport(parent,e[0],pdfExportProperties,isMultipleExport);_this121.isExporting=false;parent.trigger(pdfExportComplete,_this121.isBlob?{promise:_this121.blobPromise}:{});bool=false;}// tslint:disable-next-line:no-any
});}}},{key:'processExport',value:function processExport(gObj,returnType,pdfExportProperties,isMultipleExport){if(!isNullOrUndefined(pdfExportProperties)){this.gridTheme=pdfExportProperties.theme;}var columns=gObj.columns;var dataSource=returnType.result;/* tslint:enable:no-any */var section=this.pdfDocument.sections.add();/* tslint:disable-next-line:no-any */var result=this.processExportProperties(pdfExportProperties,dataSource,section);dataSource=result.dataSource;/* tslint:disable-next-line:no-any */if(!isNullOrUndefined(dataSource.GroupGuid)){this.isGrouping=true;}section=result.section;var pdfPage=section.pages.add();// create a grid
var pdfGrid=new PdfGrid();// get header theme style
/* tslint:disable-next-line:no-any */var headerThemeStyle=this.getHeaderThemeStyle();var border=headerThemeStyle.border;var headerFont=headerThemeStyle.font;var headerBrush=headerThemeStyle.brush;/* tslint:disable-next-line:no-any */var returnValue=this.helper.getHeaders(columns,this.hideColumnInclude);var rows=returnValue.rows;// Column collection with respect to the records in the grid
var gridColumns=returnValue.columns;// process grid header content
pdfGrid=this.processGridHeaders(dataSource.childLevels,pdfGrid,rows,gridColumns,border,headerFont,headerBrush);// set alignment, width and type of the values of the column
this.setColumnProperties(gridColumns,pdfGrid);/* tslint:disable-next-line:no-any */var captionThemeStyle=this.getSummaryCaptionThemeStyle();if(!isNullOrUndefined(dataSource)&&dataSource.length>0){if(this.isGrouping){/* tslint:disable-next-line:max-line-length */this.processGroupedRecords(pdfGrid,dataSource,gridColumns,gObj,border,0,captionThemeStyle.font,captionThemeStyle.brush,captionThemeStyle.backgroundBrush,returnType);}else{this.processRecord(border,gridColumns,gObj,dataSource,pdfGrid);}if(!isNullOrUndefined(returnType.aggregates)){var summaryModel=new SummaryModelGenerator(gObj);var sRows=void 0;if(this.customDataSource){sRows=summaryModel.generateRows(dataSource,returnType.aggregates);}else if(this.currentViewData){sRows=summaryModel.generateRows(this.parent.getCurrentViewRecords(),returnType.aggregates);}else if(this.isGrouping){sRows=summaryModel.generateRows(dataSource.records,returnType.aggregates);}else{sRows=summaryModel.generateRows(returnType.result,returnType.aggregates);}/* tslint:disable-next-line:max-line-length */this.processAggregates(sRows,pdfGrid,border,captionThemeStyle.font,captionThemeStyle.brush,captionThemeStyle.backgroundBrush,false);}}else{var row=pdfGrid.rows.addRow();row.style.setBorder(border);}// draw the grid
pdfGrid.draw(pdfPage,20,20);if(!isMultipleExport){// save the PDF
if(!this.isBlob){this.pdfDocument.save('Export.pdf');}else{this.blobPromise=this.pdfDocument.save();}this.pdfDocument.destroy();}}},{key:'getSummaryCaptionThemeStyle',value:function getSummaryCaptionThemeStyle(){if(!isNullOrUndefined(this.gridTheme)&&!isNullOrUndefined(this.gridTheme.caption)&&this.gridTheme.caption!==null){var fontSize=!isNullOrUndefined(this.gridTheme.caption.fontSize)?this.gridTheme.caption.fontSize:9.75;var pdfColor=new PdfColor();if(!isNullOrUndefined(this.gridTheme.caption.fontColor)){var penBrushColor=this.hexToRgb(this.gridTheme.caption.fontColor);pdfColor=new PdfColor(penBrushColor.r,penBrushColor.g,penBrushColor.b);}/* tslint:disable-next-line:max-line-length */return{font:new PdfStandardFont(PdfFontFamily.Helvetica,10.5),brush:new PdfSolidBrush(new PdfColor(pdfColor)),backgroundBrush:new PdfSolidBrush(new PdfColor(246,246,246))};}else{//Material theme
/* tslint:disable-next-line:max-line-length */return{font:new PdfStandardFont(PdfFontFamily.Helvetica,9.75),brush:new PdfSolidBrush(new PdfColor(0,0,0)),backgroundBrush:new PdfSolidBrush(new PdfColor(246,246,246))};}}},{key:'getHeaderThemeStyle',value:function getHeaderThemeStyle(){var border=new PdfBorders();if(!isNullOrUndefined(this.gridTheme)&&!isNullOrUndefined(this.gridTheme.header)){if(!isNullOrUndefined(this.gridTheme.header.borders)&&!isNullOrUndefined(this.gridTheme.header.borders.color)){var borderColor=this.hexToRgb(this.gridTheme.header.borders.color);border.all=new PdfPen(new PdfColor(borderColor.r,borderColor.g,borderColor.b));}var fontSize=!isNullOrUndefined(this.gridTheme.header.fontSize)?this.gridTheme.header.fontSize:10.5;var pdfColor=new PdfColor();if(!isNullOrUndefined(this.gridTheme.header.fontColor)){var penBrushColor=this.hexToRgb(this.gridTheme.header.fontColor);pdfColor=new PdfColor(penBrushColor.r,penBrushColor.g,penBrushColor.b);}/* tslint:disable-next-line:max-line-length */return{border:border,font:new PdfStandardFont(PdfFontFamily.Helvetica,fontSize),brush:new PdfSolidBrush(pdfColor)};}else{//Material theme
border.all=new PdfPen(new PdfColor(234,234,234));/* tslint:disable-next-line:max-line-length */return{border:border,font:new PdfStandardFont(PdfFontFamily.Helvetica,10.5),brush:new PdfSolidBrush(new PdfColor(102,102,102))};}}},{key:'processGroupedRecords',value:function processGroupedRecords(pdfGrid,dataSource,gridColumns,gObj,border,level,font,brush,backgroundBrush,returnType){var groupIndex=level;var _iteratorNormalCompletion67=true;var _didIteratorError67=false;var _iteratorError67=undefined;try{for(var _iterator67=dataSource[Symbol.iterator](),_step67;!(_iteratorNormalCompletion67=(_step67=_iterator67.next()).done);_iteratorNormalCompletion67=true){var dataSourceItems=_step67.value;var row=pdfGrid.rows.addRow();var col=gObj.getColumnByField(dataSourceItems.field);/* tslint:disable-next-line:no-any */var args={value:dataSourceItems.key,column:col,style:undefined,isForeignKey:col.isForeignColumn()};/* tslint:disable-next-line:max-line-length */var value=dataSourceItems.field+': '+this.exportValueFormatter.formatCellValue(args)+' - '+dataSourceItems.count+(dataSource.count>1?' items':' item');row.cells.getCell(groupIndex).value=value;row.cells.getCell(groupIndex+1).style.stringFormat=new PdfStringFormat(PdfTextAlignment.Left);row.style.setBorder(border);row.style.setFont(font);row.style.setTextBrush(brush);row.style.setBackgroundBrush(backgroundBrush);var sRows=void 0;var captionSummaryModel=new CaptionSummaryModelGenerator(gObj);if(!isNullOrUndefined(dataSourceItems.items.records)){sRows=captionSummaryModel.generateRows(dataSourceItems.items.records,returnType.aggregates);}else{sRows=captionSummaryModel.generateRows(dataSourceItems.items,returnType.aggregates);}if(!isNullOrUndefined(sRows)&&sRows.length===0){row.cells.getCell(groupIndex+1).columnSpan=pdfGrid.columns.count-(groupIndex+1);}if(!isNullOrUndefined(dataSource.childLevels)&&dataSource.childLevels>0){this.processAggregates(sRows,pdfGrid,border,font,brush,backgroundBrush,true,row,groupIndex);/* tslint:disable-next-line:max-line-length */this.processGroupedRecords(pdfGrid,dataSourceItems.items,gridColumns,gObj,border,groupIndex+1,font,brush,backgroundBrush,returnType);var groupSummaryModel=new GroupSummaryModelGenerator(gObj);sRows=groupSummaryModel.generateRows(dataSourceItems.items.records,returnType.aggregates);this.processAggregates(sRows,pdfGrid,border,font,brush,backgroundBrush,false);}else{this.processAggregates(sRows,pdfGrid,border,font,brush,backgroundBrush,true,row,groupIndex);this.processRecord(border,gridColumns,gObj,dataSourceItems.items,pdfGrid,groupIndex+1);var _groupSummaryModel=new GroupSummaryModelGenerator(gObj);sRows=_groupSummaryModel.generateRows(dataSourceItems.items,returnType.aggregates);this.processAggregates(sRows,pdfGrid,border,font,brush,backgroundBrush,false);}}}catch(err){_didIteratorError67=true;_iteratorError67=err;}finally{try{if(!_iteratorNormalCompletion67&&_iterator67.return){_iterator67.return();}}finally{if(_didIteratorError67){throw _iteratorError67;}}}}},{key:'processGridHeaders',value:function processGridHeaders(childLevels,pdfGrid,rows,gridColumns,border,headerFont,headerBrush){var columnCount=gridColumns.length;if(this.isGrouping){columnCount+=childLevels+1;}// add columns
pdfGrid.columns.add(columnCount);if(this.isGrouping){for(var i=0;i<childLevels+1;i++){pdfGrid.columns.getColumn(i).width=20;}}// add header
pdfGrid.headers.add(rows.length);// set cell values of each rows in the header
for(var _i21=0;_i21<rows.length;_i21++){var gridHeader=pdfGrid.headers.getHeader(_i21);gridHeader.style.setBorder(border);gridHeader.style.setFont(headerFont);gridHeader.style.setTextBrush(headerBrush);var cellIndex=this.isGrouping?childLevels+1:0;if(rows[_i21].cells.length===0){for(var j=0;j<gridHeader.cells.count;j++){var cell=gridHeader.cells.getCell(j);cell.value='';}}else{for(var _j2=0;_j2<cellIndex;_j2++){var _cell=gridHeader.cells.getCell(_j2);_cell.value='';}for(var _j3=0;_j3<rows[_i21].cells.length;_j3++){var _cell2=gridHeader.cells.getCell(cellIndex);if(_cell2.value!==null){_cell2.value=rows[_i21].cells[_j3].column.headerText;if(!isNullOrUndefined(rows[_i21].cells[_j3].column.headerTextAlign)){_cell2.style.stringFormat=this.getHorizontalAlignment(rows[_i21].cells[_j3].column.headerTextAlign);}if(!isNullOrUndefined(rows[_i21].cells[_j3].rowSpan)){_cell2.rowSpan=rows[_i21].cells[_j3].rowSpan;/* tslint:disable-next-line:max-line-length */_cell2.style.stringFormat=this.getVerticalAlignment('Bottom',_cell2.style.stringFormat,rows[_i21].cells[_j3].column.textAlign);for(var k=1;k<rows[_i21].cells[_j3].rowSpan;k++){pdfGrid.headers.getHeader(_i21+k).cells.getCell(cellIndex).value=null;}}if(!isNullOrUndefined(rows[_i21].cells[_j3].colSpan)){_cell2.columnSpan=rows[_i21].cells[_j3].colSpan;}cellIndex+=_cell2.columnSpan;}else{_cell2.value='';cellIndex+=_cell2.columnSpan;_j3=_j3-1;}}}}if(pdfGrid.columns.count>=6){pdfGrid.style.allowHorizontalOverflow=true;}return pdfGrid;}},{key:'processExportProperties',value:function processExportProperties(pdfExportProperties,dataSource,section){if(!isNullOrUndefined(pdfExportProperties)){if(!isNullOrUndefined(pdfExportProperties.theme)){this.gridTheme=pdfExportProperties.theme;}if(!isNullOrUndefined(pdfExportProperties.pageOrientation)||!isNullOrUndefined(pdfExportProperties.pageSize)){var pdfPageSettings=new PdfPageSettings();/* tslint:disable-next-line:max-line-length */pdfPageSettings.orientation=pdfExportProperties.pageOrientation==='Landscape'?PdfPageOrientation.Landscape:PdfPageOrientation.Portrait;pdfPageSettings.size=this.getPageSize(pdfExportProperties.pageSize);section.setPageSettings(pdfPageSettings);}var clientSize=this.pdfDocument.pageSettings.size;if(!isNullOrUndefined(pdfExportProperties.header)){/* tslint:disable-next-line:no-any */var header=pdfExportProperties.header;var position=new PointF(0,header.fromTop);var size=new SizeF(clientSize.width-80,header.height*0.75);var bounds=new RectangleF(position,size);this.pdfDocument.template.top=this.drawPageTemplate(new PdfPageTemplateElement(bounds),header);}if(!isNullOrUndefined(pdfExportProperties.footer)){/* tslint:disable-next-line:no-any */var footer=pdfExportProperties.footer;var _position=new PointF(0,clientSize.width-80-footer.fromBottom*0.75);var _size=new SizeF(clientSize.width-80,footer.height*0.75);var _bounds=new RectangleF(_position,_size);this.pdfDocument.template.bottom=this.drawPageTemplate(new PdfPageTemplateElement(_bounds),footer);}if(!isNullOrUndefined(pdfExportProperties.includeHiddenColumn)&&!this.isGrouping){this.hideColumnInclude=pdfExportProperties.includeHiddenColumn;}if(!isNullOrUndefined(pdfExportProperties.dataSource)){if(!(pdfExportProperties.dataSource instanceof DataManager)){dataSource=pdfExportProperties.dataSource;}this.customDataSource=true;this.currentViewData=false;}else if(!isNullOrUndefined(pdfExportProperties.exportType)){if(pdfExportProperties.exportType==='CurrentPage'){dataSource=this.parent.getCurrentViewRecords();this.currentViewData=true;this.customDataSource=false;}else{this.currentViewData=false;this.customDataSource=false;}}else{this.currentViewData=false;this.customDataSource=false;}}else{this.currentViewData=false;this.customDataSource=false;}return{dataSource:dataSource,section:section};}},{key:'drawPageTemplate',value:function drawPageTemplate(template,element){var _iteratorNormalCompletion68=true;var _didIteratorError68=false;var _iteratorError68=undefined;try{for(var _iterator68=element.contents[Symbol.iterator](),_step68;!(_iteratorNormalCompletion68=(_step68=_iterator68.next()).done);_iteratorNormalCompletion68=true){var content=_step68.value;this.processContentValidation(content);switch(content.type){case'Text':/* tslint:disable-next-line:max-line-length */if(content.value===''||content.value===undefined||content.value===null||typeof content.value!=='string'){throw new Error('please enter the valid input value in text content...');}this.drawText(template,content);break;case'PageNumber':this.drawPageNumber(template,content);break;case'Image':if(content.src===undefined||content.src===null||content.src===''){throw new Error('please enter the valid base64 string in image content...');}this.drawImage(template,content);break;case'Line':this.drawLine(template,content);break;default:throw new Error('Please set valid content type...');}}}catch(err){_didIteratorError68=true;_iteratorError68=err;}finally{try{if(!_iteratorNormalCompletion68&&_iterator68.return){_iterator68.return();}}finally{if(_didIteratorError68){throw _iteratorError68;}}}return template;}},{key:'processContentValidation',value:function processContentValidation(content){if(content.type===undefined||content.type===null){throw new Error('please set valid content type...');}else{if(content.type==='Line'){if(content.points===undefined||content.points===null){throw new Error('please enter valid points in '+content.type+' content...');}else{if(content.points.x1===undefined||content.points.x1===null||typeof content.points.x1!=='number'){throw new Error('please enter valid x1 co-ordinate in '+content.type+' points...');}if(content.points.y1===undefined||content.points.y1===null||typeof content.points.y1!=='number'){throw new Error('please enter valid y1 co-ordinate in '+content.type+' points...');}if(content.points.x2===undefined||content.points.x2===null||typeof content.points.x2!=='number'){throw new Error('please enter valid x2 co-ordinate in '+content.type+' points...');}if(content.points.y2===undefined||content.points.y2===null||typeof content.points.y2!=='number'){throw new Error('please enter valid y2 co-ordinate in '+content.type+' points...');}}}else{if(content.position===undefined||content.position===null){throw new Error('please enter valid position in '+content.type+' content...');}else{if(content.position.x===undefined||content.position.x===null||typeof content.position.x!=='number'){throw new Error('please enter valid x co-ordinate in '+content.type+' position...');}if(content.position.y===undefined||content.position.y===null||typeof content.position.y!=='number'){throw new Error('please enter valid y co-ordinate in '+content.type+' position...');}}}}}},{key:'drawText',value:function drawText(pageTemplate,content){var font=this.getFont(content);var brush=this.getBrushFromContent(content);var pen=null;if(!isNullOrUndefined(content.style.textPenColor)){var penColor=this.hexToRgb(content.style.textPenColor);pen=new PdfPen(new PdfColor(penColor.r,penColor.g,penColor.b));}if(brush==null&&pen==null){brush=new PdfSolidBrush(new PdfColor(0,0,0));}var value=content.value.toString();var x=content.position.x*0.75;var y=content.position.y*0.75;var format=void 0;var result=this.setContentFormat(content,format);if(result!==null&&!isNullOrUndefined(result.format)&&!isNullOrUndefined(result.size)){pageTemplate.graphics.drawString(value,font,pen,brush,x,y,result.size.width,result.size.height,result.format);}else{pageTemplate.graphics.drawString(value,font,pen,brush,x,y,format);}}},{key:'drawPageNumber',value:function drawPageNumber(documentHeader,content){var font=this.getFont(content);var brush=null;if(!isNullOrUndefined(content.style.textBrushColor)){/* tslint:disable-next-line:max-line-length */var brushColor=this.hexToRgb(content.style.textBrushColor);brush=new PdfSolidBrush(new PdfColor(brushColor.r,brushColor.g,brushColor.b));}else{brush=new PdfSolidBrush(new PdfColor(0,0,0));}var pageNumber=new PdfPageNumberField(font,brush);pageNumber.numberStyle=this.getPageNumberStyle(content.pageNumberType);var compositeField=void 0;var format=void 0;if(!isNullOrUndefined(content.format)){if(content.format.indexOf('$total')!==-1&&content.format.indexOf('$current')!==-1){var pageCount=new PdfPageCountField(font);if(content.format.indexOf('$total')>content.format.indexOf('$current')){format=content.format.replace('$current','0');format=format.replace('$total','1');}else{format=content.format.replace('$current','1');format=format.replace('$total','0');}compositeField=new PdfCompositeField(font,brush,format,pageNumber,pageCount);}else if(content.format.indexOf('$current')!==-1&&content.format.indexOf('$total')===-1){format=content.format.replace('$current','0');compositeField=new PdfCompositeField(font,brush,format,pageNumber);}else{var _pageCount=new PdfPageCountField(font);format=content.format.replace('$total','0');compositeField=new PdfCompositeField(font,brush,format,_pageCount);}}else{format='{0}';compositeField=new PdfCompositeField(font,brush,format,pageNumber);}var x=content.position.x*0.75;var y=content.position.y*0.75;var result=this.setContentFormat(content,compositeField.stringFormat);if(result!==null&&!isNullOrUndefined(result.format)&&!isNullOrUndefined(result.size)){compositeField.stringFormat=result.format;compositeField.bounds=new RectangleF(x,y,result.size.width,result.size.height);}compositeField.draw(documentHeader.graphics,x,y);}},{key:'drawImage',value:function drawImage(documentHeader,content){var x=content.position.x*0.75;var y=content.position.y*0.75;var width=!isNullOrUndefined(content.size)?content.size.width*0.75:undefined;var height=!isNullOrUndefined(content.size)?content.size.height*0.75:undefined;var image=new PdfBitmap(content.src);if(!isNullOrUndefined(width)){documentHeader.graphics.drawImage(image,x,y,width,height);}else{documentHeader.graphics.drawImage(image,x,y);}}},{key:'drawLine',value:function drawLine(documentHeader,content){var x1=content.points.x1*0.75;var y1=content.points.y1*0.75;var x2=content.points.x2*0.75;var y2=content.points.y2*0.75;var pen=this.getPenFromContent(content);if(!isNullOrUndefined(content.style)&&content.style!==null){if(!isNullOrUndefined(content.style.penSize)&&content.style.penSize!==null&&typeof content.style.penSize==='number'){pen.width=content.style.penSize*0.75;}pen.dashStyle=this.getDashStyle(content.style.dashStyle);}documentHeader.graphics.drawLine(pen,x1,y1,x2,y2);}},{key:'processAggregates',value:function processAggregates(sRows,pdfGrid,border,font,brush,backgroundBrush,isCaption,captionRow,groupIndex){var _iteratorNormalCompletion69=true;var _didIteratorError69=false;var _iteratorError69=undefined;try{for(var _iterator69=sRows[Symbol.iterator](),_step69;!(_iteratorNormalCompletion69=(_step69=_iterator69.next()).done);_iteratorNormalCompletion69=true){var row=_step69.value;var leastCaptionSummaryIndex=-1;var index=0;var isEmpty=true;/* tslint:disable-next-line:no-any */var value=[];for(var i=0;i<pdfGrid.columns.count;i++){/* tslint:disable-next-line:no-any */var cell=row.cells[index];if(!this.hideColumnInclude){while(cell.visible===undefined){if(!isNullOrUndefined(captionRow)){if(!isNullOrUndefined(captionRow.cells.getCell(i).value)){value.push('');value.push(captionRow.cells.getCell(i).value);isEmpty=false;i+=1;}else{value.push('');}}else{value.push('');}i+=1;index=index+1;cell=row.cells[index];}while(!isNullOrUndefined(cell.visible)&&!cell.visible){index=index+1;cell=row.cells[index];}}if(cell.isDataCell){var templateFn={};/* tslint:disable-next-line:max-line-length */if(!isNullOrUndefined(cell.column.footerTemplate)||!isNullOrUndefined(cell.column.groupCaptionTemplate)||!isNullOrUndefined(cell.column.groupFooterTemplate)){/* tslint:disable-next-line:no-any */var result=this.getTemplateFunction(templateFn,i,leastCaptionSummaryIndex,cell.column);templateFn=result.templateFunction;leastCaptionSummaryIndex=result.leastCaptionSummaryIndex;/* tslint:disable-next-line:max-line-length */var txt=templateFn[getEnumValue(CellType,cell.cellType)](row.data[cell.column.field?cell.column.field:cell.column.columnName]);value.push(txt[0].wholeText);isEmpty=false;}else{/* tslint:disable-next-line:no-any */var _result=this.getSummaryWithoutTemplate(row.data[cell.column.field]);if(!isNullOrUndefined(_result)){value.push(_result);}}}else{value.push('');}if(isEmpty&&value[i]!==''&&!isNullOrUndefined(value[i])&&value[i]!==null){isEmpty=false;}index+=1;}if(!isEmpty){if(!isCaption){var gridRow=pdfGrid.rows.addRow();gridRow.style.setBorder(border);gridRow.style.setFont(font);gridRow.style.setTextBrush(brush);gridRow.style.setBackgroundBrush(backgroundBrush);for(var _i22=0;_i22<pdfGrid.columns.count;_i22++){gridRow.cells.getCell(_i22).value=value[_i22].toString();}}else{for(var _i23=0;_i23<pdfGrid.columns.count;_i23++){captionRow.cells.getCell(_i23).value=value[_i23].toString();if(_i23===groupIndex+1&&leastCaptionSummaryIndex!==-1){captionRow.cells.getCell(_i23).columnSpan=leastCaptionSummaryIndex-(groupIndex+1);}else if(_i23===groupIndex+1&&leastCaptionSummaryIndex===-1){captionRow.cells.getCell(_i23).columnSpan=pdfGrid.columns.count-(groupIndex+1);}}}}}}catch(err){_didIteratorError69=true;_iteratorError69=err;}finally{try{if(!_iteratorNormalCompletion69&&_iterator69.return){_iterator69.return();}}finally{if(_didIteratorError69){throw _iteratorError69;}}}}},{key:'getTemplateFunction',value:function getTemplateFunction(templateFn,index,leastCaptionSummaryIndex,column){if(!isNullOrUndefined(column.footerTemplate)){templateFn[getEnumValue(CellType,CellType.Summary)]=_compile(column.footerTemplate);}else if(!isNullOrUndefined(column.groupCaptionTemplate)){if(leastCaptionSummaryIndex===-1){leastCaptionSummaryIndex=index;}templateFn[getEnumValue(CellType,CellType.CaptionSummary)]=_compile(column.groupCaptionTemplate);}else{templateFn[getEnumValue(CellType,CellType.GroupSummary)]=_compile(column.groupFooterTemplate);}return{templateFunction:templateFn,leastCaptionSummaryIndex:leastCaptionSummaryIndex};}},{key:'getSummaryWithoutTemplate',value:function getSummaryWithoutTemplate(data){if(!isNullOrUndefined(data.Sum)){return data.Sum;}else if(!isNullOrUndefined(data.Average)){return data.Average;}else if(!isNullOrUndefined(data.Max)){return data.Max;}else if(!isNullOrUndefined(data.Min)){return data.Min;}else if(!isNullOrUndefined(data.Count)){return data.Count;}else if(!isNullOrUndefined(data.TrueCount)){return data.TrueCount;}else if(!isNullOrUndefined(data.FalseCount)){return data.FalseCount;}else if(!isNullOrUndefined(data.Custom)){return data.Custom;}}},{key:'setColumnProperties',value:function setColumnProperties(gridColumns,pdfGrid){var startIndex=this.isGrouping?pdfGrid.columns.count-gridColumns.length:0;for(var i=0;i<gridColumns.length;i++){if(!isNullOrUndefined(gridColumns[i].textAlign)){pdfGrid.columns.getColumn(i+startIndex).format=this.getHorizontalAlignment(gridColumns[i].textAlign);}// Need to add width consideration with % value
if(pdfGrid.style.allowHorizontalOverflow&&!isNullOrUndefined(gridColumns[i].width)){/* tslint:disable-next-line:max-line-length */pdfGrid.columns.getColumn(i+startIndex).width=typeof gridColumns[i].width==='number'?gridColumns[i].width*0.75:this.helper.getConvertedWidth(gridColumns[i].width)*0.75;}}}},{key:'setRecordThemeStyle',value:function setRecordThemeStyle(row,border){if(!isNullOrUndefined(this.gridTheme)&&!isNullOrUndefined(this.gridTheme.record)&&this.gridTheme.record!==null){var pdfColor=new PdfColor();if(!isNullOrUndefined(this.gridTheme.record.fontColor)){var penBrushColor=this.hexToRgb(this.gridTheme.record.fontColor);pdfColor=new PdfColor(penBrushColor.r,penBrushColor.g,penBrushColor.b);}row.style.setTextBrush(new PdfSolidBrush(pdfColor));}else{row.style.setTextBrush(new PdfSolidBrush(new PdfColor(0,0,0)));}row.style.setBorder(border);return row;}},{key:'processRecord',value:function processRecord(border,columns,gObj,dataSource,pdfGrid,groupIndex){var startIndex=this.isGrouping?groupIndex:0;var _iteratorNormalCompletion70=true;var _didIteratorError70=false;var _iteratorError70=undefined;try{for(var _iterator70=dataSource[Symbol.iterator](),_step70;!(_iteratorNormalCompletion70=(_step70=_iterator70.next()).done);_iteratorNormalCompletion70=true){var items=_step70.value;// create a new row and set default style properties
var gridRow=this.setRecordThemeStyle(pdfGrid.rows.addRow(),border);for(var j=0;j<columns.length;j++){/* tslint:disable:no-any */var value=!isNullOrUndefined(columns[j].field)&&getValue(columns[j].field,items)||'';var column=columns[j];var foreignKeyData$$1=void 0;if(column.isForeignColumn&&column.isForeignColumn()){foreignKeyData$$1=this.helper.getFData(value,column);value=getValue(column.foreignKeyValue,foreignKeyData$$1);}var data=items;var args={data:data,value:value,column:column,style:undefined,colSpan:1};/* tslint:enable:no-any */gObj.trigger(pdfQueryCellInfo,args);var cell=gridRow.cells.getCell(j+startIndex);cell.value=this.exportValueFormatter.formatCellValue(args);if(!isNullOrUndefined(args.style)){this.processCellStyle(cell,args);}if(args.colSpan>1){if(j+startIndex+1+args.colSpan>gridRow.cells.count){args.colSpan=gridRow.cells.count-(j+startIndex+1);}cell.columnSpan=args.colSpan;for(var i=1;i<cell.columnSpan;i++){var spanCell=gridRow.cells.getCell(j+startIndex+i);spanCell.value='';}j+=args.colSpan-1;}}}}catch(err){_didIteratorError70=true;_iteratorError70=err;}finally{try{if(!_iteratorNormalCompletion70&&_iterator70.return){_iterator70.return();}}finally{if(_didIteratorError70){throw _iteratorError70;}}}}},{key:'processCellStyle',value:function processCellStyle(cell,args){if(!isNullOrUndefined(args.style.backgroundColor)){/* tslint:disable-next-line:max-line-length */var backColor=this.hexToRgb(args.style.backgroundColor);cell.style.backgroundBrush=new PdfSolidBrush(new PdfColor(backColor.r,backColor.g,backColor.b));}if(!isNullOrUndefined(args.style.textAlignment)){cell.style.stringFormat=this.getHorizontalAlignment(args.style.textAlignment);}if(!isNullOrUndefined(args.style.verticalAlignment)){cell.style.stringFormat=this.getVerticalAlignment(args.style.verticalAlignment,cell.style.stringFormat);}if(!isNullOrUndefined(args.style.textBrushColor)){var textBrushColor=this.hexToRgb(args.style.textBrushColor);cell.style.textBrush=new PdfSolidBrush(new PdfColor(textBrushColor.r,textBrushColor.g,textBrushColor.b));}if(!isNullOrUndefined(args.style.textPenColor)){var textPenColor=this.hexToRgb(args.style.textPenColor);cell.style.textPen=new PdfPen(new PdfColor(textPenColor.r,textPenColor.g,textPenColor.b));}/* tslint:disable-next-line:max-line-length */if(!isNullOrUndefined(args.style.fontFamily)||!isNullOrUndefined(args.style.fontSize)||!isNullOrUndefined(args.style.bold)||!isNullOrUndefined(args.style.italic)||!isNullOrUndefined(args.style.underline)||!isNullOrUndefined(args.style.strikeout)){cell.style.font=this.getFont(args);}if(!isNullOrUndefined(args.style.border)){var border=new PdfBorders();var borderWidth=args.style.border.width;// set border width
var width=!isNullOrUndefined(borderWidth)&&typeof borderWidth==='number'?borderWidth*0.75:undefined;// set border color
var color=new PdfColor(196,196,196);if(!isNullOrUndefined(args.style.border.color)){var borderColor=this.hexToRgb(args.style.border.color);color=new PdfColor(borderColor.r,borderColor.g,borderColor.b);}var pen=new PdfPen(color,width);// set border dashStyle 'Solid <default>, Dash, Dot, DashDot, DashDotDot'
if(!isNullOrUndefined(args.style.border.dashStyle)){pen.dashStyle=this.getDashStyle(args.style.border.dashStyle);}border.all=pen;cell.style.borders=border;}}},{key:'getHorizontalAlignment',value:function getHorizontalAlignment(textAlign,format){if(format===undefined){format=new PdfStringFormat();}switch(textAlign){case'Right':format.alignment=PdfTextAlignment.Right;break;case'Center':format.alignment=PdfTextAlignment.Center;break;case'Justify':format.alignment=PdfTextAlignment.Justify;break;case'Left':format.alignment=PdfTextAlignment.Left;break;}return format;}},{key:'getVerticalAlignment',value:function getVerticalAlignment(verticalAlign,format,textAlign){if(format===undefined){format=new PdfStringFormat();format=this.getHorizontalAlignment(textAlign,format);}switch(verticalAlign){case'Bottom':format.lineAlignment=PdfVerticalAlignment.Bottom;break;case'Middle':format.lineAlignment=PdfVerticalAlignment.Middle;break;case'Top':format.lineAlignment=PdfVerticalAlignment.Top;break;}return format;}},{key:'getFontFamily',value:function getFontFamily(fontFamily){switch(fontFamily){case'TimesRoman':return 2;case'Courier':return 1;case'Symbol':return 3;case'ZapfDingbats':return 4;default:return 0;}}},{key:'getFont',value:function getFont(content){var fontSize=!isNullOrUndefined(content.style.fontSize)?content.style.fontSize*0.75:9.75;/* tslint:disable-next-line:max-line-length */var fontFamily=!isNullOrUndefined(content.style.fontFamily)?this.getFontFamily(content.style.fontFamily):PdfFontFamily.Helvetica;var fontStyle=PdfFontStyle.Regular;if(!isNullOrUndefined(content.style.bold)&&content.style.bold){fontStyle|=PdfFontStyle.Bold;}if(!isNullOrUndefined(content.style.italic)&&content.style.italic){fontStyle|=PdfFontStyle.Italic;}if(!isNullOrUndefined(content.style.underline)&&content.style.underline){fontStyle|=PdfFontStyle.Underline;}if(!isNullOrUndefined(content.style.strikeout)&&content.style.strikeout){fontStyle|=PdfFontStyle.Strikeout;}return new PdfStandardFont(fontFamily,fontSize,fontStyle);}},{key:'getPageNumberStyle',value:function getPageNumberStyle(pageNumberType){switch(pageNumberType){case'LowerLatin':return 2;case'LowerRoman':return 3;case'UpperLatin':return 4;case'UpperRoman':return 5;default:return 1;}}},{key:'setContentFormat',value:function setContentFormat(content,format){if(!isNullOrUndefined(content.size)){var width=content.size.width*0.75;var height=content.size.height*0.75;format=new PdfStringFormat(PdfTextAlignment.Left,PdfVerticalAlignment.Middle);if(!isNullOrUndefined(content.style.hAlign)){switch(content.style.hAlign){case'Right':format.alignment=PdfTextAlignment.Right;break;case'Center':format.alignment=PdfTextAlignment.Center;break;case'Justify':format.alignment=PdfTextAlignment.Justify;break;default:format.alignment=PdfTextAlignment.Left;}}if(!isNullOrUndefined(content.style.vAlign)){format=this.getVerticalAlignment(content.style.vAlign,format);}return{format:format,size:new SizeF(width,height)};}return null;}},{key:'getPageSize',value:function getPageSize(pageSize){switch(pageSize){case'Letter':return new SizeF(612,792);case'Note':return new SizeF(540,720);case'Legal':return new SizeF(612,1008);case'A0':return new SizeF(2380,3368);case'A1':return new SizeF(1684,2380);case'A2':return new SizeF(1190,1684);case'A3':return new SizeF(842,1190);case'A5':return new SizeF(421,595);case'A6':return new SizeF(297,421);case'A7':return new SizeF(210,297);case'A8':return new SizeF(148,210);case'A9':return new SizeF(105,148);// case 'A10':
//     return new SizeF(74, 105);
case'B0':return new SizeF(2836,4008);case'B1':return new SizeF(2004,2836);case'B2':return new SizeF(1418,2004);case'B3':return new SizeF(1002,1418);case'B4':return new SizeF(709,1002);case'B5':return new SizeF(501,709);case'Archa':return new SizeF(648,864);case'Archb':return new SizeF(864,1296);case'Archc':return new SizeF(1296,1728);case'Archd':return new SizeF(1728,2592);case'Arche':return new SizeF(2592,3456);case'Flsa':return new SizeF(612,936);case'HalfLetter':return new SizeF(396,612);case'Letter11x17':return new SizeF(792,1224);case'Ledger':return new SizeF(1224,792);default:return new SizeF(595,842);}}},{key:'getDashStyle',value:function getDashStyle(dashStyle){switch(dashStyle){case'Dash':return 1;case'Dot':return 2;case'DashDot':return 3;case'DashDotDot':return 4;default:return 0;}}},{key:'getPenFromContent',value:function getPenFromContent(content){var pen=new PdfPen(new PdfColor(0,0,0));if(!isNullOrUndefined(content.style)&&content.style!==null&&!isNullOrUndefined(content.style.penColor)){var penColor=this.hexToRgb(content.style.penColor);pen=new PdfPen(new PdfColor(penColor.r,penColor.g,penColor.b));}return pen;}},{key:'getBrushFromContent',value:function getBrushFromContent(content){var brush=null;if(!isNullOrUndefined(content.style.textBrushColor)){/* tslint:disable-next-line:max-line-length */var brushColor=this.hexToRgb(content.style.textBrushColor);brush=new PdfSolidBrush(new PdfColor(brushColor.r,brushColor.g,brushColor.b));}return brush;}},{key:'hexToRgb',value:function hexToRgb(hex){if(hex===null||hex===''||hex.length!==7){throw new Error('please set valid hex value for color...');}hex=hex.substring(1);var bigint=parseInt(hex,16);var r=bigint>>16&255;var g=bigint>>8&255;var b=bigint&255;return{r:r,g:g,b:b};}},{key:'destroy',value:function destroy(){//destroy for exporting
}}]);return PdfExport;}());_export('CommandColumnRenderer',CommandColumnRenderer=function(_CellRenderer11){_inherits(CommandColumnRenderer,_CellRenderer11);function CommandColumnRenderer(parent,locator){_classCallCheck(this,CommandColumnRenderer);var _this122=_possibleConstructorReturn(this,(CommandColumnRenderer.__proto__||Object.getPrototypeOf(CommandColumnRenderer)).call(this,parent,locator));_this122.buttonElement=createElement('button',{});_this122.unbounDiv=createElement('div',{className:'e-unboundcelldiv',styles:'display: inline-block'});_this122.element=createElement('TD',{className:'e-rowcell e-unboundcell',attrs:{role:'gridcell',tabindex:'-1'}});return _this122;}/**
     * Function to render the cell content based on Column object.
     * @param  {Column} column
     * @param  {Object} data
     * @param  {{[x:string]:Object}} attributes?
     * @param  {Element}
     */_createClass(CommandColumnRenderer,[{key:'render',value:function render(cell,data,attributes$$1){var node=this.element.cloneNode();node.appendChild(this.unbounDiv.cloneNode());node.setAttribute('aria-label','is Command column column header '+cell.column.headerText);if(cell.column.commandsTemplate){appendChildren(node.firstElementChild,cell.column.getColumnTemplate()(data));}else{var _iteratorNormalCompletion71=true;var _didIteratorError71=false;var _iteratorError71=undefined;try{for(var _iterator71=cell.commands[Symbol.iterator](),_step71;!(_iteratorNormalCompletion71=(_step71=_iterator71.next()).done);_iteratorNormalCompletion71=true){var command=_step71.value;node=this.renderButton(node,command,attributes$$1.index);}}catch(err){_didIteratorError71=true;_iteratorError71=err;}finally{try{if(!_iteratorNormalCompletion71&&_iterator71.return){_iterator71.return();}}finally{if(_didIteratorError71){throw _iteratorError71;}}}}this.setAttributes(node,cell,attributes$$1);if(this.parent.isEdit){addClass(node.querySelectorAll('.e-edit-delete'),'e-hide');removeClass(node.querySelectorAll('.e-save-cancel'),'e-hide');}else{addClass(node.querySelectorAll('.e-save-cancel'),'e-hide');removeClass(node.querySelectorAll('.e-edit-delete'),'e-hide');}return node;}},{key:'renderButton',value:function renderButton(node,buttonOption,index){var button=this.buttonElement.cloneNode();attributes(button,{'id':this.parent.element.id+(buttonOption.type||'')+'_'+index,'type':'button',title:buttonOption.buttonOption.content||buttonOption.type});button.onclick=buttonOption.buttonOption.click;var buttonObj=new Button(buttonOption.buttonOption,button);buttonObj.commandType=buttonOption.type;node.firstElementChild.appendChild(buttonObj.element);switch(buttonOption.type){case'Edit':case'Delete':addClass([button],['e-edit-delete','e-'+buttonOption.type.toLowerCase()+'button']);break;case'Cancel':case'Save':addClass([button],['e-save-cancel','e-'+buttonOption.type.toLowerCase()+'button']);break;}return node;}}]);return CommandColumnRenderer;}(CellRenderer));_export('CommandColumn',CommandColumn=function(){function CommandColumn(parent,locator){_classCallCheck(this,CommandColumn);this.parent=parent;this.locator=locator;this.addEventListener();}_createClass(CommandColumn,[{key:'initiateRender',value:function initiateRender(){var cellFac=this.locator.getService('cellRendererFactory');cellFac.addCellRenderer(CellType.CommandColumn,new CommandColumnRenderer(this.parent,this.locator));}},{key:'commandClickHandler',value:function commandClickHandler(e){var gObj=this.parent;var gID=gObj.element.id;var target=closest(e.target,'button');if(!target||!gObj.editModule||!closest(e.target,'.e-unboundcell')){return;}var buttonObj=target.ej2_instances[0];var type=buttonObj.commandType;if(buttonObj.disabled){return;}switch(type){case'Edit':gObj.editModule.endEdit();gObj.editModule.startEdit(closest(target,'tr'));break;case'Cancel':gObj.editModule.closeEdit();break;case'Save':gObj.editModule.endEdit();break;case'Delete':gObj.editModule.endEdit();gObj.clearSelection();//for toogle issue when dbl click
gObj.selectRow(parseInt(closest(target,'tr').getAttribute('aria-rowindex'),10),false);gObj.editModule.deleteRecord();break;}}},{key:'getModuleName',value:function getModuleName(){return'commandColumn';}},{key:'destroy',value:function destroy(){if(this.parent.isDestroyed){return;}this.removeEventListener();}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(click,this.commandClickHandler);this.parent.off(initialEnd,this.initiateRender);this.parent.off(keyPressed,this.keyPressHandler);}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(click,this.commandClickHandler,this);this.parent.on(initialEnd,this.initiateRender,this);this.parent.on(keyPressed,this.keyPressHandler,this);}},{key:'keyPressHandler',value:function keyPressHandler(e){if(e.action==='enter'&&closest(e.target,'.e-unboundcelldiv')){this.commandClickHandler(e);e.preventDefault();}}}]);return CommandColumn;}());_export('menuClass',menuClass={header:'.e-gridheader',content:'.e-gridcontent',edit:'.e-inline-edit',batchEdit:'.e-editedbatchcell',editIcon:'e-edit',pager:'.e-gridpager',delete:'e-delete',save:'e-save',cancel:'e-cancel',copy:'e-copy',pdf:'e-pdfexport',group:'e-icon-group',ungroup:'e-icon-ungroup',csv:'e-csvexport',excel:'e-excelexport',fPage:'e-icon-first',nPage:'e-icon-next',lPage:'e-icon-last',pPage:'e-icon-prev',ascending:'e-icon-ascending',descending:'e-icon-descending',groupHeader:'e-groupdroparea',touchPop:'e-gridpopup'});_export('ContextMenu',ContextMenu$1=function(){function ContextMenu$1(parent,serviceLocator){_classCallCheck(this,ContextMenu$1);this.defaultItems={};this.disableItems=[];this.hiddenItems=[];this.localeText=this.setLocaleKey();this.parent=parent;this.gridID=parent.element.id;this.serviceLocator=serviceLocator;this.addEventListener();}/**
     * @hidden
     */_createClass(ContextMenu$1,[{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(uiUpdate,this.enableAfterRenderMenu,this);this.parent.on(initialLoad,this.render,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialLoad,this.render);this.parent.off(uiUpdate,this.enableAfterRenderMenu);EventHandler.remove(this.element,'keydown',this.keyDownHandler.bind(this));}},{key:'keyDownHandler',value:function keyDownHandler(e){if(e.code==='Tab'||e.which===9){this.contextMenu.close();}}},{key:'render',value:function render(){this.parent.element.classList.add('e-noselect');this.l10n=this.serviceLocator.getService('localization');this.element=createElement('ul',{id:this.gridID+'_cmenu'});EventHandler.add(this.element,'keydown',this.keyDownHandler.bind(this));this.parent.element.appendChild(this.element);var target='#'+this.gridID;this.contextMenu=new ContextMenu({items:this.getMenuItems(),enableRtl:this.parent.enableRtl,enablePersistence:this.parent.enablePersistence,locale:this.parent.locale,target:target,select:this.contextMenuItemClick.bind(this),beforeOpen:this.contextMenuBeforeOpen.bind(this),onOpen:this.contextMenuOpen.bind(this),onClose:this.contextMenuOnClose.bind(this),cssClass:'e-grid-menu'});this.contextMenu.appendTo(this.element);}},{key:'enableAfterRenderMenu',value:function enableAfterRenderMenu(e){if(e.module===this.getModuleName()&&e.enable){if(this.contextMenu){this.contextMenu.destroy();remove(this.element);this.parent.element.classList.remove('e-noselect');}this.render();}}},{key:'getMenuItems',value:function getMenuItems(){var menuItems=[];var exportItems=[];var _iteratorNormalCompletion72=true;var _didIteratorError72=false;var _iteratorError72=undefined;try{for(var _iterator72=this.parent.contextMenuItems[Symbol.iterator](),_step72;!(_iteratorNormalCompletion72=(_step72=_iterator72.next()).done);_iteratorNormalCompletion72=true){var item=_step72.value;if(typeof item==='string'&&this.getDefaultItems().indexOf(item)!==-1){if(item.toLocaleLowerCase().indexOf('export')!==-1){exportItems.push(this.buildDefaultItems(item));}else{menuItems.push(this.buildDefaultItems(item));}}else if(typeof item!=='string'){menuItems.push(item);}}}catch(err){_didIteratorError72=true;_iteratorError72=err;}finally{try{if(!_iteratorNormalCompletion72&&_iterator72.return){_iterator72.return();}}finally{if(_didIteratorError72){throw _iteratorError72;}}}if(exportItems.length>0){var exportGroup=this.buildDefaultItems('export');exportGroup.items=exportItems;menuItems.push(exportGroup);}return menuItems;}},{key:'getLastPage',value:function getLastPage(){var totalpage=Math.floor(this.parent.pageSettings.totalRecordsCount/this.parent.pageSettings.pageSize);if(this.parent.pageSettings.totalRecordsCount%this.parent.pageSettings.pageSize){totalpage+=1;}return totalpage;}},{key:'contextMenuOpen',value:function contextMenuOpen(){this.isOpen=true;}},{key:'contextMenuItemClick',value:function contextMenuItemClick(args){var item=this.getKeyFromId(args.item.id);switch(item){case'AutoFitAll':this.parent.autoFitColumns([]);break;case'AutoFit':this.parent.autoFitColumns(this.targetColumn.field);break;case'Group':this.parent.groupColumn(this.targetColumn.field);break;case'Ungroup':this.parent.ungroupColumn(this.targetColumn.field);break;case'Edit':if(this.parent.editSettings.mode==='Batch'){if(this.row&&this.cell&&!isNaN(parseInt(this.cell.getAttribute('aria-colindex'),10))){this.parent.editModule.editCell(parseInt(this.row.getAttribute('aria-rowindex'),10),this.parent.getColumns()[parseInt(this.cell.getAttribute('aria-colindex'),10)].field);}}else{this.parent.editModule.endEdit();this.parent.editModule.startEdit(this.row);}break;case'Delete':if(this.parent.editSettings.mode!=='Batch'){this.parent.editModule.endEdit();}this.parent.editModule.deleteRow(this.row);break;case'Save':this.parent.editModule.endEdit();break;case'Cancel':this.parent.editModule.closeEdit();break;case'Copy':this.parent.copy();break;case'PdfExport':this.parent.pdfExport();break;case'ExcelExport':this.parent.excelExport();break;case'CsvExport':this.parent.csvExport();break;case'SortAscending':this.isOpen=false;this.parent.sortColumn(this.targetColumn.field,'Ascending');break;case'SortDescending':this.isOpen=false;this.parent.sortColumn(this.targetColumn.field,'Descending');break;case'FirstPage':this.parent.goToPage(1);break;case'PrevPage':this.parent.goToPage(this.parent.pageSettings.currentPage-1);break;case'LastPage':this.parent.goToPage(this.getLastPage());break;case'NextPage':this.parent.goToPage(this.parent.pageSettings.currentPage+1);break;}args.column=this.targetColumn;this.parent.trigger(contextMenuClick,args);}},{key:'contextMenuOnClose',value:function contextMenuOnClose(args){var parent='parentObj';if(args.items.length>0&&args.items[0][parent]instanceof ContextMenu){this.updateItemStatus();}}},{key:'getLocaleText',value:function getLocaleText(item){return this.l10n.getConstant(this.localeText[item]);}},{key:'updateItemStatus',value:function updateItemStatus(){this.contextMenu.showItems(this.hiddenItems);this.contextMenu.enableItems(this.disableItems);this.hiddenItems=[];this.disableItems=[];this.isOpen=false;}},{key:'contextMenuBeforeOpen',value:function contextMenuBeforeOpen(args){var changedRecords='changedRecords';var addedRecords='addedRecords';var deletedRecords='deletedRecords';var closestGrid=closest(args.event.target,'.e-grid');if(args.event&&closestGrid&&closestGrid!==this.parent.element){args.cancel=true;}else if(args.event&&(closest(args.event.target,'.'+menuClass.groupHeader)||closest(args.event.target,'.'+menuClass.touchPop)||closest(args.event.target,'.e-summarycell')||closest(args.event.target,'.e-groupcaption')||closest(args.event.target,'.e-filterbarcell'))){args.cancel=true;}else{this.targetColumn=this.getColumn(args.event);this.selectRow(args.event,this.parent.selectionSettings.type!=='Multiple');var _iteratorNormalCompletion73=true;var _didIteratorError73=false;var _iteratorError73=undefined;try{for(var _iterator73=args.items[Symbol.iterator](),_step73;!(_iteratorNormalCompletion73=(_step73=_iterator73.next()).done);_iteratorNormalCompletion73=true){var item=_step73.value;var key=this.getKeyFromId(item.id);var dItem=this.defaultItems[key];if(this.getDefaultItems().indexOf(key)!==-1){if(this.ensureDisabledStatus(key)){this.disableItems.push(item.text);}if(args.event&&(this.ensureTarget(args.event.target,menuClass.edit)||this.ensureTarget(args.event.target,menuClass.batchEdit))){if(key!=='Save'&&key!=='Cancel'){this.hiddenItems.push(item.text);}}else if(this.parent.editSettings.mode==='Batch'&&(closest(args.event.target,'.e-gridform')||this.parent.editModule.getBatchChanges()[changedRecords].length||this.parent.editModule.getBatchChanges()[addedRecords].length||this.parent.editModule.getBatchChanges()[deletedRecords].length)&&(key==='Save'||key==='Cancel')){continue;}else if(isNullOrUndefined(args.parentItem)&&args.event&&!this.ensureTarget(args.event.target,dItem.target)){this.hiddenItems.push(item.text);}}else if(item.target&&args.event&&!this.ensureTarget(args.event.target,item.target)){this.hiddenItems.push(item.text);}}}catch(err){_didIteratorError73=true;_iteratorError73=err;}finally{try{if(!_iteratorNormalCompletion73&&_iterator73.return){_iterator73.return();}}finally{if(_didIteratorError73){throw _iteratorError73;}}}this.contextMenu.enableItems(this.disableItems,false);this.contextMenu.hideItems(this.hiddenItems);this.eventArgs=args.event;args.column=this.targetColumn;this.parent.trigger(contextMenuOpen,args);if(this.hiddenItems.length===args.items.length){this.updateItemStatus();args.cancel=true;}}}},{key:'ensureTarget',value:function ensureTarget(targetElement,selector){var target=targetElement;if(this.ensureFrozenHeader(targetElement)&&(selector===menuClass.header||selector===menuClass.content)){target=closest(targetElement,selector===menuClass.header?'thead':'tbody');}else if(selector===menuClass.content||selector===menuClass.header){target=parentsUntil(closest(targetElement,'.e-table'),selector.substr(1,selector.length));}else{target=closest(targetElement,selector);}return target&&parentsUntil(target,'e-grid')===this.parent.element;}},{key:'ensureFrozenHeader',value:function ensureFrozenHeader(targetElement){return(this.parent.getFrozenColumns()||this.parent.frozenRows)&&closest(targetElement,menuClass.header)?true:false;}},{key:'ensureDisabledStatus',value:function ensureDisabledStatus(item){var _this123=this;var status=false;switch(item){case'AutoFitAll':case'AutoFit':status=!(this.parent.ensureModuleInjected(Resize)&&!this.parent.isEdit);break;case'Group':if(!this.parent.allowGrouping||this.parent.ensureModuleInjected(Group)&&this.targetColumn&&this.parent.groupSettings.columns.indexOf(this.targetColumn.field)>=0){status=true;}break;case'Ungroup':if(!this.parent.allowGrouping||!this.parent.ensureModuleInjected(Group)||this.parent.ensureModuleInjected(Group)&&this.targetColumn&&this.parent.groupSettings.columns.indexOf(this.targetColumn.field)<0){status=true;}break;case'Edit':case'Delete':case'Save':case'Cancel':if(!this.parent.editModule||this.parent.getDataRows().length===0){status=true;}break;case'Copy':if(this.parent.getSelectedRowIndexes().length===0||this.parent.getCurrentViewRecords().length===0){status=true;}break;case'export':if(!this.parent.allowExcelExport||!this.parent.excelExport||!this.parent.ensureModuleInjected(PdfExport)&&!this.parent.ensureModuleInjected(ExcelExport)){status=true;}break;case'PdfExport':if(!this.parent.allowPdfExport||!this.parent.ensureModuleInjected(PdfExport)){status=true;}break;case'ExcelExport':case'CsvExport':if(!this.parent.allowExcelExport||!this.parent.ensureModuleInjected(ExcelExport)){status=true;}break;case'SortAscending':case'SortDescending':if(!this.parent.allowSorting||!this.parent.ensureModuleInjected(Sort)){status=true;}else if(this.parent.ensureModuleInjected(Sort)&&this.parent.sortSettings.columns.length>0&&this.targetColumn){this.parent.sortSettings.columns.forEach(function(element){if(element.field===_this123.targetColumn.field&&element.direction.toLowerCase()===item.toLowerCase().replace('sort','').toLocaleLowerCase()){status=true;}});}break;case'FirstPage':case'PrevPage':if(!this.parent.allowPaging||!this.parent.ensureModuleInjected(Page)||this.parent.getCurrentViewRecords().length===0||this.parent.ensureModuleInjected(Page)&&this.parent.pageSettings.currentPage===1){status=true;}break;case'LastPage':case'NextPage':if(!this.parent.allowPaging||!this.parent.ensureModuleInjected(Page)||this.parent.getCurrentViewRecords().length===0||this.parent.ensureModuleInjected(Page)&&this.parent.pageSettings.currentPage===this.getLastPage()){status=true;}break;}return status;}},{key:'getContextMenu',value:function getContextMenu(){return this.element;}},{key:'destroy',value:function destroy(){this.contextMenu.destroy();remove(this.element);this.removeEventListener();this.parent.element.classList.remove('e-noselect');}},{key:'getModuleName',value:function getModuleName(){return'contextMenu';}},{key:'generateID',value:function generateID(item){return this.gridID+'_cmenu_'+item;}},{key:'getKeyFromId',value:function getKeyFromId(id){return id.replace(this.gridID+'_cmenu_','');}},{key:'buildDefaultItems',value:function buildDefaultItems(item){var menuItem=void 0;switch(item){case'AutoFitAll':case'AutoFit':menuItem={target:menuClass.header};break;case'Group':menuItem={target:menuClass.header,iconCss:menuClass.group};break;case'Ungroup':menuItem={target:menuClass.header,iconCss:menuClass.ungroup};break;case'Edit':menuItem={target:menuClass.content,iconCss:menuClass.editIcon};break;case'Delete':menuItem={target:menuClass.content,iconCss:menuClass.delete};break;case'Save':menuItem={target:menuClass.edit,iconCss:menuClass.save};break;case'Cancel':menuItem={target:menuClass.edit,iconCss:menuClass.cancel};break;case'Copy':menuItem={target:menuClass.content,iconCss:menuClass.copy};break;case'export':menuItem={target:menuClass.content};break;case'PdfExport':menuItem={target:menuClass.content,iconCss:menuClass.pdf};break;case'ExcelExport':menuItem={target:menuClass.content,iconCss:menuClass.excel};break;case'CsvExport':menuItem={target:menuClass.content,iconCss:menuClass.csv};break;case'SortAscending':menuItem={target:menuClass.header,iconCss:menuClass.ascending};break;case'SortDescending':menuItem={target:menuClass.header,iconCss:menuClass.descending};break;case'FirstPage':menuItem={target:menuClass.pager,iconCss:menuClass.fPage};break;case'PrevPage':menuItem={target:menuClass.pager,iconCss:menuClass.pPage};break;case'LastPage':menuItem={target:menuClass.pager,iconCss:menuClass.lPage};break;case'NextPage':menuItem={target:menuClass.pager,iconCss:menuClass.nPage};break;}this.defaultItems[item]={text:this.getLocaleText(item),id:this.generateID(item),target:menuItem.target,iconCss:menuItem.iconCss?'e-icons '+menuItem.iconCss:''};return this.defaultItems[item];}},{key:'getDefaultItems',value:function getDefaultItems(){return['AutoFitAll','AutoFit','Group','Ungroup','Edit','Delete','Save','Cancel','Copy','export','PdfExport','ExcelExport','CsvExport','SortAscending','SortDescending','FirstPage','PrevPage','LastPage','NextPage'];}},{key:'setLocaleKey',value:function setLocaleKey(){return{'AutoFitAll':'autoFitAll','AutoFit':'autoFit','Copy':'Copy','Group':'Group','Ungroup':'Ungroup','Edit':'EditRecord','Delete':'DeleteRecord','Save':'Save','Cancel':'CancelButton','PdfExport':'Pdfexport','ExcelExport':'Excelexport','CsvExport':'Csvexport','export':'Export','SortAscending':'SortAscending','SortDescending':'SortDescending','FirstPage':'FirstPage','LastPage':'LastPage','PrevPage':'PreviousPage','NextPage':'NextPage'};}},{key:'getColumn',value:function getColumn(e){var cell=closest(e.target,'th.e-headercell');if(cell){cell.classList.add('e-resized');var _uid4=cell.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');return this.parent.getColumnByUid(_uid4);}return null;}},{key:'selectRow',value:function selectRow(e,isSelectable){this.cell=e.target;this.row=closest(e.target,'tr.e-row')||this.row;if(this.row&&isSelectable){this.parent.selectRow(parseInt(this.row.getAttribute('aria-rowindex'),10));}}}]);return ContextMenu$1;}());_export('FreezeRowModelGenerator',FreezeRowModelGenerator=function(){function FreezeRowModelGenerator(parent){_classCallCheck(this,FreezeRowModelGenerator);this.isFrzLoad=1;this.parent=parent;this.rowModelGenerator=new RowModelGenerator(this.parent);}_createClass(FreezeRowModelGenerator,[{key:'generateRows',value:function generateRows(data,notifyArgs){var frzCols=this.parent.getFrozenColumns();var row=this.rowModelGenerator.generateRows(data,notifyArgs);for(var i=0,len=row.length;i<len;i++){if(this.isFrzLoad%2===0){row[i].cells=row[i].cells.slice(frzCols,row[i].cells.length);}else{row[i].cells=row[i].cells.slice(0,frzCols);}}this.isFrzLoad++;return row;}}]);return FreezeRowModelGenerator;}());_export('FreezeContentRender',FreezeContentRender=function(_ContentRender3){_inherits(FreezeContentRender,_ContentRender3);function FreezeContentRender(parent,locator){_classCallCheck(this,FreezeContentRender);return _possibleConstructorReturn(this,(FreezeContentRender.__proto__||Object.getPrototypeOf(FreezeContentRender)).call(this,parent,locator));}_createClass(FreezeContentRender,[{key:'renderPanel',value:function renderPanel(){_get(FreezeContentRender.prototype.__proto__||Object.getPrototypeOf(FreezeContentRender.prototype),'renderPanel',this).call(this);var fDiv=createElement('div',{className:'e-frozencontent'});var mDiv=createElement('div',{className:'e-movablecontent'});this.getPanel().firstChild.appendChild(fDiv);this.getPanel().firstChild.appendChild(mDiv);this.setFrozenContent(fDiv);this.setMovableContent(mDiv);}},{key:'renderEmpty',value:function renderEmpty(tbody){_get(FreezeContentRender.prototype.__proto__||Object.getPrototypeOf(FreezeContentRender.prototype),'renderEmpty',this).call(this,tbody);this.getMovableContent().querySelector('tbody').innerHTML='<tr><td></td></tr>';this.getFrozenContent().querySelector('.e-emptyrow').querySelector('td').colSpan=this.parent.getFrozenColumns();this.getFrozenContent().style.borderRightWidth='0px';if(this.parent.frozenRows){this.parent.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody').innerHTML='';this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').innerHTML='';}}},{key:'setFrozenContent',value:function setFrozenContent(ele){this.frozenContent=ele;}},{key:'setMovableContent',value:function setMovableContent(ele){this.movableContent=ele;}},{key:'getFrozenContent',value:function getFrozenContent(){return this.frozenContent;}},{key:'getMovableContent',value:function getMovableContent(){return this.movableContent;}},{key:'getModelGenerator',value:function getModelGenerator(){return new FreezeRowModelGenerator(this.parent);}},{key:'renderTable',value:function renderTable(){_get(FreezeContentRender.prototype.__proto__||Object.getPrototypeOf(FreezeContentRender.prototype),'renderTable',this).call(this);this.getFrozenContent().appendChild(this.getTable());var mTbl=this.getTable().cloneNode(true);this.getMovableContent().appendChild(mTbl);remove(this.getMovableContent().querySelector('colgroup'));var colGroup=this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup').cloneNode(true);mTbl.insertBefore(colGroup,mTbl.querySelector('tbody'));}}]);return FreezeContentRender;}(ContentRender));_export('FreezeRender',FreezeRender=function(_HeaderRender2){_inherits(FreezeRender,_HeaderRender2);function FreezeRender(parent,locator){_classCallCheck(this,FreezeRender);var _this125=_possibleConstructorReturn(this,(FreezeRender.__proto__||Object.getPrototypeOf(FreezeRender)).call(this,parent,locator));_this125.addEventListener();return _this125;}_createClass(FreezeRender,[{key:'addEventListener',value:function addEventListener(){this.parent.on(freezeRender,this.refreshFreeze,this);}},{key:'renderTable',value:function renderTable(){_get(FreezeRender.prototype.__proto__||Object.getPrototypeOf(FreezeRender.prototype),'renderTable',this).call(this);this.rfshMovable();this.updateColgroup();this.initializeHeaderDrag();this.initializeHeaderDrop();this.parent.notify(headerRefreshed,{rows:this.rows,args:{isFrozen:false}});}},{key:'renderPanel',value:function renderPanel(){_get(FreezeRender.prototype.__proto__||Object.getPrototypeOf(FreezeRender.prototype),'renderPanel',this).call(this);var fDiv=createElement('div',{className:'e-frozenheader'});var mDiv=createElement('div',{className:'e-movableheader'});this.getPanel().firstChild.appendChild(fDiv);this.getPanel().firstChild.appendChild(mDiv);this.setFrozenHeader(fDiv);this.setMovableHeader(mDiv);}},{key:'refreshUI',value:function refreshUI(){var tbody=this.getMovableHeader().querySelector('tbody');remove(this.getMovableHeader().querySelector('table'));_get(FreezeRender.prototype.__proto__||Object.getPrototypeOf(FreezeRender.prototype),'refreshUI',this).call(this);this.rfshMovable();this.getMovableHeader().querySelector('tbody').innerHTML=tbody.innerHTML;this.updateColgroup();renderMovable(this.parent.getContentTable().querySelector('colgroup'),this.parent.getFrozenColumns());this.initializeHeaderDrag();this.parent.notify(headerRefreshed,{rows:this.rows,args:{isFrozen:false}});}},{key:'rfshMovable',value:function rfshMovable(){this.getFrozenHeader().appendChild(this.getTable());this.getMovableHeader().appendChild(this.createTable());this.refreshStackedHdrHgt();}},{key:'refreshFreeze',value:function refreshFreeze(obj){if(obj.case==='filter'){var filterRow=this.getTable().querySelector('.e-filterbar');if(this.parent.allowFiltering&&filterRow&&this.getMovableHeader().querySelector('thead')){this.getMovableHeader().querySelector('thead').appendChild(renderMovable(filterRow,this.parent.getFrozenColumns()));}}else if(obj.case==='textwrap'){var fRows=void 0;var mRows=void 0;var fHdr=this.getFrozenHeader();var mHdr=this.getMovableHeader();var cont=this.parent.getContent();var wrapMode=this.parent.textWrapSettings.wrapMode;var hdrClassList=this.parent.getHeaderContent().firstChild.classList;if(wrapMode!=='Header'||obj.isModeChg){fRows=cont.querySelector('.e-frozencontent').querySelectorAll('tr');mRows=cont.querySelector('.e-movablecontent').querySelectorAll('tr');this.setWrapHeight(fRows,mRows,obj.isModeChg,true);}if(wrapMode==='Content'&&this.parent.allowTextWrap){hdrClassList.add('e-wrap');}else{hdrClassList.remove('e-wrap');}if(wrapMode==='Both'||obj.isModeChg){fRows=fHdr.querySelectorAll('tr');mRows=mHdr.querySelectorAll('tr');}else{fRows=fHdr.querySelector(wrapMode==='Content'?'tbody':'thead').querySelectorAll('tr');mRows=mHdr.querySelector(wrapMode==='Content'?'tbody':'thead').querySelectorAll('tr');}this.setWrapHeight(fRows,mRows,obj.isModeChg,false,this.colDepth>1);this.refreshStackedHdrHgt();}}},{key:'updateResizeHandler',value:function updateResizeHandler(){[].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-rhandler')).forEach(function(ele){ele.style.height=ele.parentElement.offsetHeight+'px';});}},{key:'setWrapHeight',value:function setWrapHeight(fRows,mRows,isModeChg,isContReset,isStackedHdr){var fRowHgt=void 0;var mRowHgt=void 0;var isWrap=this.parent.allowTextWrap;var wrapMode=this.parent.textWrapSettings.wrapMode;var tHead=this.parent.getHeaderContent().querySelector('thead');var tBody=this.parent.getHeaderContent().querySelector('tbody');for(var i=0,len=fRows.length;i<len;i++){if(isModeChg&&(wrapMode==='Header'&&isContReset||wrapMode==='Content'&&tHead.contains(fRows[i])||wrapMode==='Header'&&tBody.contains(fRows[i]))||isStackedHdr){fRows[i].style.height=null;mRows[i].style.height=null;}fRowHgt=fRows[i].offsetHeight;mRowHgt=mRows[i].offsetHeight;if(fRows[i].childElementCount&&(isWrap&&fRowHgt<mRowHgt||!isWrap&&fRowHgt>mRowHgt)){fRows[i].style.height=mRowHgt+'px';}else if(mRows[i].childElementCount&&(isWrap&&fRowHgt>mRowHgt||!isWrap&&fRowHgt<mRowHgt)){mRows[i].style.height=fRowHgt+'px';}}}},{key:'refreshStackedHdrHgt',value:function refreshStackedHdrHgt(){var fRowSpan=void 0;var mRowSpan=void 0;var fTr=this.getFrozenHeader().querySelectorAll('.e-columnheader');var mTr=this.getMovableHeader().querySelectorAll('.e-columnheader');for(var i=0,len=fTr.length;i<len;i++){fRowSpan=this.getRowSpan(fTr[i]);mRowSpan=this.getRowSpan(mTr[i]);if(fRowSpan.min>1){this.updateStackedHdrRowHgt(i,fRowSpan.max,fTr[i],mTr);}else if(mRowSpan.min>1){this.updateStackedHdrRowHgt(i,mRowSpan.max,mTr[i],fTr);}}if(this.parent.allowResizing){this.updateResizeHandler();}}},{key:'getRowSpan',value:function getRowSpan(row){var rSpan=void 0;var minRowSpan=void 0;var maxRowSpan=void 0;for(var i=0,len=row.childElementCount;i<len;i++){if(i===0){minRowSpan=row.children[0].rowSpan;}rSpan=row.children[i].rowSpan;minRowSpan=Math.min(rSpan,minRowSpan);maxRowSpan=Math.max(rSpan,minRowSpan);}return{min:minRowSpan,max:maxRowSpan};}},{key:'updateStackedHdrRowHgt',value:function updateStackedHdrRowHgt(idx,maxRowSpan,row,rows){var height=0;for(var i=0;i<maxRowSpan;i++){height+=rows[idx+i].offsetHeight;}row.style.height=height+'px';}},{key:'setFrozenHeader',value:function setFrozenHeader(ele){this.frozenHeader=ele;}},{key:'setMovableHeader',value:function setMovableHeader(ele){this.movableHeader=ele;}},{key:'getFrozenHeader',value:function getFrozenHeader(){return this.frozenHeader;}},{key:'getMovableHeader',value:function getMovableHeader(){return this.movableHeader;}},{key:'updateColgroup',value:function updateColgroup(){var mTable=this.getMovableHeader().querySelector('table');remove(this.getMovableHeader().querySelector('colgroup'));mTable.insertBefore(renderMovable(this.getFrozenHeader().querySelector('colgroup'),this.parent.getFrozenColumns()),mTable.querySelector('thead'));}}]);return FreezeRender;}(HeaderRender));_export('Freeze',Freeze=function(){function Freeze(parent,locator){_classCallCheck(this,Freeze);this.parent=parent;this.locator=locator;this.addEventListener();}_createClass(Freeze,[{key:'getModuleName',value:function getModuleName(){return'freeze';}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(initialLoad,this.instantiateRenderer,this);this.parent.on(initialEnd,this.wireEvents,this);}},{key:'wireEvents',value:function wireEvents(){if(this.parent.frozenRows){EventHandler.add(this.parent.getHeaderContent(),'dblclick',this.dblClickHandler,this);}}},{key:'dblClickHandler',value:function dblClickHandler(e){if(parentsUntil(e.target,'e-grid').id!==this.parent.element.id){return;}this.parent.notify(dblclick,e);}},{key:'instantiateRenderer',value:function instantiateRenderer(){var renderer=this.locator.getService('rendererFactory');if(this.parent.getFrozenColumns()){renderer.addRenderer(RenderType.Header,new FreezeRender(this.parent,this.locator));renderer.addRenderer(RenderType.Content,new FreezeContentRender(this.parent,this.locator));}}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(initialLoad,this.instantiateRenderer);}},{key:'destroy',value:function destroy(){this.removeEventListener();}}]);return Freeze;}());_export('ColumnMenu',ColumnMenu=function(){function ColumnMenu(parent,serviceLocator){_classCallCheck(this,ColumnMenu);this.defaultItems={};this.localeText=this.setLocaleKey();this.disableItems=[];this.hiddenItems=[];this.isOpen=false;// default class names
this.GROUP='e-icon-group';this.UNGROUP='e-icon-ungroup';this.ASCENDING='e-icon-ascending';this.DESCENDING='e-icon-descending';this.ROOT='e-columnmenu';this.FILTER='e-icon-filter';this.POP='e-filter-popup';this.WRAP='e-col-menu';this.CHOOSER='_chooser_';this.parent=parent;this.gridID=parent.element.id;this.serviceLocator=serviceLocator;this.addEventListener();}_createClass(ColumnMenu,[{key:'wireEvents',value:function wireEvents(){var _this126=this;this.getColumnMenuHandlers().forEach(function(ele){EventHandler.add(ele,'mousedown',_this126.columnMenuHandlerDown,_this126);});}},{key:'unwireEvents',value:function unwireEvents(){var _this127=this;this.getColumnMenuHandlers().forEach(function(ele){EventHandler.remove(ele,'mousedown',_this127.columnMenuHandlerDown);});}},{key:'destroy',value:function destroy(){this.columnMenu.destroy();this.removeEventListener();this.unwireFilterEvents();this.unwireEvents();remove(this.element);}},{key:'columnMenuHandlerClick',value:function columnMenuHandlerClick(e){if(e.target.classList.contains('e-columnmenu')){if(this.isOpen&&this.headerCell!==this.getHeaderCell(e)||document.querySelector('.e-grid-menu .e-menu-parent.e-ul')){this.columnMenu.close();this.openColumnMenu(e);}else if(!this.isOpen){this.openColumnMenu(e);}else{this.columnMenu.close();}}}},{key:'openColumnMenu',value:function openColumnMenu(e){var pos={top:0,left:0};this.element.style.cssText='display:block;visibility:hidden';var elePos=this.element.getBoundingClientRect();this.element.style.cssText='display:none;visibility:visible';this.headerCell=this.getHeaderCell(e);if(Browser.isDevice){pos.top=window.innerHeight/2-elePos.height/2;pos.left=window.innerWidth/2-elePos.width/2;}else{if(this.parent.enableRtl){pos=calculatePosition(this.headerCell,'left','bottom');}else{pos=calculatePosition(this.headerCell,'right','bottom');pos.left-=elePos.width;}}this.columnMenu.open(pos.top,pos.left);e.preventDefault();}},{key:'columnMenuHandlerDown',value:function columnMenuHandlerDown(e){this.isOpen=!(this.element.style.display==='none'||this.element.style.display==='');}},{key:'getColumnMenuHandlers',value:function getColumnMenuHandlers(){return[].slice.call(this.parent.getHeaderTable().querySelectorAll('.'+this.ROOT));}},{key:'addEventListener',value:function addEventListener(){if(this.parent.isDestroyed){return;}this.parent.on(headerRefreshed,this.wireEvents,this);this.parent.on(uiUpdate,this.enableAfterRenderMenu,this);this.parent.on(initialEnd,this.render,this);if(this.isFilterItemAdded()){this.parent.on(filterDialogCreated,this.filterPosition,this);}this.parent.on(click,this.columnMenuHandlerClick,this);}},{key:'removeEventListener',value:function removeEventListener(){if(this.parent.isDestroyed){return;}this.parent.off(headerRefreshed,this.unwireEvents);this.parent.off(uiUpdate,this.enableAfterRenderMenu);this.parent.off(initialEnd,this.render);if(this.isFilterItemAdded()){this.parent.off(filterDialogCreated,this.filterPosition);}this.parent.off(click,this.columnMenuHandlerClick);}},{key:'enableAfterRenderMenu',value:function enableAfterRenderMenu(e){if(e.module===this.getModuleName()&&e.enable){if(this.columnMenu){this.columnMenu.destroy();remove(this.element);}this.render();}}},{key:'render',value:function render(){this.l10n=this.serviceLocator.getService('localization');this.element=createElement('ul',{id:this.gridID+'_columnmenu',className:'e-colmenu'});this.parent.element.appendChild(this.element);this.columnMenu=new ContextMenu({cssClass:'e-grid-menu',enableRtl:this.parent.enableRtl,enablePersistence:this.parent.enablePersistence,locale:this.parent.locale,items:this.getItems(),select:this.columnMenuItemClick.bind(this),beforeOpen:this.columnMenuBeforeOpen.bind(this),onClose:this.columnMenuOnClose.bind(this),beforeItemRender:this.beforeMenuItemRender.bind(this),beforeClose:this.columnMenuBeforeClose.bind(this)});this.columnMenu.appendTo(this.element);this.wireFilterEvents();}},{key:'wireFilterEvents',value:function wireFilterEvents(){if(!Browser.isDevice&&this.isFilterItemAdded()){EventHandler.add(this.element,'mouseover',this.appendFilter,this);}}},{key:'unwireFilterEvents',value:function unwireFilterEvents(){if(!Browser.isDevice&&this.isFilterItemAdded()){EventHandler.remove(this.element,'mouseover',this.appendFilter);}}},{key:'beforeMenuItemRender',value:function beforeMenuItemRender(args){if(this.isChooserItem(args.item)){var field=this.getKeyFromId(args.item.id,this.CHOOSER);var column=this.parent.getColumnByField(field);var check=createCheckBox(false,{label:args.item.text,checked:column.visible});if(this.parent.enableRtl){check.classList.add('e-rtl');}args.element.innerHTML='';args.element.appendChild(check);}else if(args.item.id&&this.getKeyFromId(args.item.id)==='Filter'){args.element.appendChild(createElement('span',{className:'e-icons e-caret'}));args.element.className+='e-filter-item e-menu-caret-icon';}}},{key:'columnMenuBeforeClose',value:function columnMenuBeforeClose(args){var colChooser=args.event?closest(args.event.target,'.e-menu-item'):null;if(!isNullOrUndefined(args.parentItem)&&this.getKeyFromId(args.parentItem.id)==='ColumnChooser'&&colChooser&&this.isChooserItem(colChooser)){args.cancel=true;}else if(args.event&&(closest(args.event.target,'.'+this.POP)||parentsUntil(args.event.target,'e-popup')||parentsUntil(args.event.target,'e-popup-wrapper'))){args.cancel=true;}}},{key:'isChooserItem',value:function isChooserItem(item){return item.id&&item.id.indexOf('_colmenu_')>=0&&this.getKeyFromId(item.id,this.CHOOSER).indexOf('_colmenu_')===-1;}},{key:'columnMenuBeforeOpen',value:function columnMenuBeforeOpen(args){args.column=this.targetColumn=this.getColumn();this.parent.trigger(columnMenuOpen,args);var _iteratorNormalCompletion74=true;var _didIteratorError74=false;var _iteratorError74=undefined;try{for(var _iterator74=args.items[Symbol.iterator](),_step74;!(_iteratorNormalCompletion74=(_step74=_iterator74.next()).done);_iteratorNormalCompletion74=true){var item=_step74.value;var key=this.getKeyFromId(item.id);var dItem=this.defaultItems[key];if(this.getDefaultItems().indexOf(key)!==-1){if(this.ensureDisabledStatus(key)&&!dItem.hide){this.disableItems.push(item.text);}else if(item.hide){this.hiddenItems.push(item.text);}}}}catch(err){_didIteratorError74=true;_iteratorError74=err;}finally{try{if(!_iteratorNormalCompletion74&&_iterator74.return){_iterator74.return();}}finally{if(_didIteratorError74){throw _iteratorError74;}}}this.columnMenu.enableItems(this.disableItems,false);this.columnMenu.hideItems(this.hiddenItems);}},{key:'ensureDisabledStatus',value:function ensureDisabledStatus(item){var _this128=this;var status=false;switch(item){case'Group':if(!this.parent.allowGrouping||this.parent.ensureModuleInjected(Group)&&this.targetColumn&&this.parent.groupSettings.columns.indexOf(this.targetColumn.field)>=0){status=true;}break;case'AutoFitAll':case'AutoFit':status=!this.parent.ensureModuleInjected(Resize);break;case'Ungroup':if(!this.parent.ensureModuleInjected(Group)||this.parent.ensureModuleInjected(Group)&&this.targetColumn&&this.parent.groupSettings.columns.indexOf(this.targetColumn.field)<0){status=true;}break;case'SortDescending':case'SortAscending':if(this.parent.allowSorting&&this.parent.ensureModuleInjected(Sort)&&this.parent.sortSettings.columns.length>0&&this.targetColumn){this.parent.sortSettings.columns.forEach(function(ele){if(ele.field===_this128.targetColumn.field&&ele.direction.toLocaleLowerCase()===item.toLocaleLowerCase().replace('sort','')){status=true;}});}else if(!this.parent.allowSorting||!this.parent.ensureModuleInjected(Sort)){status=true;}break;case'Filter':status=!(this.parent.allowFiltering&&this.parent.filterSettings.type!=='FilterBar'&&this.parent.ensureModuleInjected(Filter));}return status;}},{key:'columnMenuItemClick',value:function columnMenuItemClick(args){var item=this.isChooserItem(args.item)?'ColumnChooser':this.getKeyFromId(args.item.id);switch(item){case'AutoFit':this.parent.autoFitColumns(this.targetColumn.field);break;case'AutoFitAll':this.parent.autoFitColumns([]);break;case'Ungroup':this.parent.ungroupColumn(this.targetColumn.field);break;case'Group':this.parent.groupColumn(this.targetColumn.field);break;case'SortAscending':this.parent.sortColumn(this.targetColumn.field,'Ascending');break;case'SortDescending':this.parent.sortColumn(this.targetColumn.field,'Descending');break;case'ColumnChooser':var key=this.getKeyFromId(args.item.id,this.CHOOSER);var checkbox=args.element.querySelector('.e-checkbox-wrapper .e-frame');if(checkbox&&checkbox.classList.contains('e-check')){checkbox.classList.remove('e-check');this.parent.hideColumns(key,'field');}else if(checkbox){this.parent.showColumns(key,'field');checkbox.classList.add('e-check');}break;case'Filter':this.getFilter(args.element,args.item.id);break;}args.column=this.targetColumn;this.parent.trigger(columnMenuClick,args);}},{key:'columnMenuOnClose',value:function columnMenuOnClose(args){var parent='parentObj';if(args.items.length>0&&args.items[0][parent]instanceof ContextMenu){this.columnMenu.enableItems(this.disableItems);this.disableItems=[];this.columnMenu.showItems(this.hiddenItems);this.hiddenItems=[];if(this.isFilterPopupOpen()){this.getFilter(args.element,args.element.id,true);}}}},{key:'getDefaultItems',value:function getDefaultItems(){return['AutoFitAll','AutoFit','SortAscending','SortDescending','Group','Ungroup','ColumnChooser','Filter'];}},{key:'getItems',value:function getItems(){var items=[];var defultItems=this.parent.columnMenuItems?this.parent.columnMenuItems:this.getDefault();var _iteratorNormalCompletion75=true;var _didIteratorError75=false;var _iteratorError75=undefined;try{for(var _iterator75=defultItems[Symbol.iterator](),_step75;!(_iteratorNormalCompletion75=(_step75=_iterator75.next()).done);_iteratorNormalCompletion75=true){var item=_step75.value;if(typeof item==='string'){if(item==='ColumnChooser'){var col=this.getDefaultItem(item);col.items=this.createChooserItems();items.push(col);}else{items.push(this.getDefaultItem(item));}}else{items.push(item);}}}catch(err){_didIteratorError75=true;_iteratorError75=err;}finally{try{if(!_iteratorNormalCompletion75&&_iterator75.return){_iterator75.return();}}finally{if(_didIteratorError75){throw _iteratorError75;}}}return items;}},{key:'getDefaultItem',value:function getDefaultItem(item){var menuItem={};switch(item){case'SortAscending':menuItem={iconCss:this.ASCENDING};break;case'SortDescending':menuItem={iconCss:this.DESCENDING};break;case'Group':menuItem={iconCss:this.GROUP};break;case'Ungroup':menuItem={iconCss:this.UNGROUP};break;case'Filter':menuItem={iconCss:this.FILTER};break;}this.defaultItems[item]={text:this.getLocaleText(item),id:this.generateID(item),iconCss:menuItem.iconCss?'e-icons '+menuItem.iconCss:null};return this.defaultItems[item];}},{key:'getLocaleText',value:function getLocaleText(item){return this.l10n.getConstant(this.localeText[item]);}},{key:'generateID',value:function generateID(item,append$$1){return this.gridID+'_colmenu_'+(append$$1?append$$1+item:item);}},{key:'getKeyFromId',value:function getKeyFromId(id,append$$1){return id.indexOf('_colmenu_')>0&&id.replace(this.gridID+'_colmenu_'+(append$$1?append$$1:''),'');}},{key:'getColumnMenu',value:function getColumnMenu(){return this.element;}},{key:'getModuleName',value:function getModuleName(){return'columnMenu';}},{key:'setLocaleKey',value:function setLocaleKey(){return{'AutoFitAll':'autoFitAll','AutoFit':'autoFit','Group':'Group','Ungroup':'Ungroup','SortAscending':'SortAscending','SortDescending':'SortDescending','ColumnChooser':'Columnchooser','Filter':'FilterMenu'};}},{key:'getHeaderCell',value:function getHeaderCell(e){return closest(e.target,'th.e-headercell');}},{key:'getColumn',value:function getColumn(){if(this.headerCell){var _uid5=this.headerCell.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');return this.parent.getColumnByUid(_uid5);}return null;}},{key:'createChooserItems',value:function createChooserItems(){var items=[];var _iteratorNormalCompletion76=true;var _didIteratorError76=false;var _iteratorError76=undefined;try{for(var _iterator76=this.parent.getColumns()[Symbol.iterator](),_step76;!(_iteratorNormalCompletion76=(_step76=_iterator76.next()).done);_iteratorNormalCompletion76=true){var col=_step76.value;if(col.showInColumnChooser&&col.field){items.push({id:this.generateID(col.field,this.CHOOSER),text:col.headerText?col.headerText:col.field});}}}catch(err){_didIteratorError76=true;_iteratorError76=err;}finally{try{if(!_iteratorNormalCompletion76&&_iterator76.return){_iterator76.return();}}finally{if(_didIteratorError76){throw _iteratorError76;}}}return items;}},{key:'appendFilter',value:function appendFilter(e){var filter='Filter';if(!this.defaultItems[filter]){return;}else{var key=this.defaultItems[filter].id;if(closest(e.target,'#'+key)&&!this.isFilterPopupOpen()){this.getFilter(e.target,key);}else if(!closest(e.target,'#'+key)&&this.isFilterPopupOpen()){this.getFilter(e.target,key,true);}}}},{key:'getFilter',value:function getFilter(target,id,isClose){var filterPopup=this.getFilterPop();if(filterPopup){filterPopup.style.display=!Browser.isDevice&&isClose?'none':'block';}else{this.parent.notify(filterOpen,{col:this.targetColumn,target:target,isClose:isClose,id:id});}}},{key:'setPosition',value:function setPosition(li,ul){var gridPos=this.parent.element.getBoundingClientRect();var liPos=li.getBoundingClientRect();var left=liPos.left-gridPos.left;var top=liPos.top-gridPos.top;if(gridPos.height<top){top=top-ul.offsetHeight+liPos.height;}else if(gridPos.height<top+ul.offsetHeight){top=gridPos.height-ul.offsetHeight;}if(window.innerHeight<ul.offsetHeight+top+gridPos.top){top=window.innerHeight-ul.offsetHeight-gridPos.top;}left+=this.parent.enableRtl?-ul.offsetWidth:liPos.width;if(gridPos.width<=left+ul.offsetWidth){left-=liPos.width+ul.offsetWidth;}else if(left<0){left+=ul.offsetWidth+liPos.width;}ul.style.top=top+'px';ul.style.left=left+'px';}},{key:'filterPosition',value:function filterPosition(e){var filterPopup=this.getFilterPop();filterPopup.classList.add(this.WRAP);if(!Browser.isDevice){var disp=filterPopup.style.display;filterPopup.style.cssText+='display:block;visibility:hidden';var li=this.element.querySelector('.'+this.FILTER);if(li){this.setPosition(li.parentElement,filterPopup);filterPopup.style.cssText+='display:'+disp+';visibility:visible';}}}},{key:'getDefault',value:function getDefault(){var items=[];if(this.parent.ensureModuleInjected(Resize)){items.push('AutoFitAll');items.push('AutoFit');}if(this.parent.allowGrouping&&this.parent.ensureModuleInjected(Group)){items.push('Group');items.push('Ungroup');}if(this.parent.allowSorting&&this.parent.ensureModuleInjected(Sort)){items.push('SortAscending');items.push('SortDescending');}items.push('ColumnChooser');if(this.parent.allowFiltering&&this.parent.filterSettings.type!=='FilterBar'&&this.parent.ensureModuleInjected(Filter)){items.push('Filter');}return items;}},{key:'isFilterPopupOpen',value:function isFilterPopupOpen(){var filterPopup=this.getFilterPop();return filterPopup&&filterPopup.style.display!=='none';}},{key:'getFilterPop',value:function getFilterPop(){return this.parent.element.querySelector('.'+this.POP);}},{key:'isFilterItemAdded',value:function isFilterItemAdded(){return this.parent.columnMenuItems&&this.parent.columnMenuItems.indexOf('Filter')>=0||!this.parent.columnMenuItems;}}]);return ColumnMenu;}());_export('ForeignKey',ForeignKey=function(_Data){_inherits(ForeignKey,_Data);function ForeignKey(parent,serviceLocator){_classCallCheck(this,ForeignKey);var _this129=_possibleConstructorReturn(this,(ForeignKey.__proto__||Object.getPrototypeOf(ForeignKey)).call(this,parent,serviceLocator));_this129.parent=parent;_this129.serviceLocator=serviceLocator;_this129.initEvent();return _this129;}_createClass(ForeignKey,[{key:'initEvent',value:function initEvent(){if(this.parent.isDestroyed){return;}this.parent.on(initForeignKeyColumn,this.initForeignKeyColumns,this);this.parent.on(getForeignKeyData,this.getForeignKeyData,this);this.parent.on(generateQuery,this.generateQueryFormData,this);}},{key:'initForeignKeyColumns',value:function initForeignKeyColumns(columns){columns.forEach(function(column){column.dataSource=column.dataSource instanceof DataManager?column.dataSource:isNullOrUndefined(column.dataSource)?new DataManager():new DataManager(column.dataSource);});}},{key:'getForeignKeyData',value:function getForeignKeyData(args){var _this130=this;var foreignColumns=args.column?[args.column]:this.parent.getForeignKeyColumns();var allPromise=[];foreignColumns.forEach(function(col){var promise=void 0;var query=args.isComplex?_this130.genarateColumnQuery(col):_this130.genarateQuery(col,args.result.result,false,true);var dataSource=col.dataSource;if(!dataSource.ready||dataSource.dataSource.offline){promise=dataSource.executeQuery(query);}else{promise=dataSource.ready.then(function(){return dataSource.executeQuery(query);});}allPromise.push(promise);});Promise.all(allPromise).then(function(responses){responses.forEach(function(data,index){foreignColumns[index].columnData=data.result;});args.promise.resolve(args.result);}).catch(function(e){if(args.promise&&args.promise.reject){args.promise.reject(e);}return e;});}},{key:'generateQueryFormData',value:function generateQueryFormData(args){args.predicate.predicate=this.genarateQuery(args.column,args.column.columnData,true);}},{key:'genarateQuery',value:function genarateQuery(column,e,fromData,needQuery){var gObj=this.parent;var predicates=[];var predicate=void 0;var query=new Query();if(gObj.allowPaging||gObj.enableVirtualization||fromData){e=new DataManager(gObj.allowGrouping&&gObj.groupSettings.columns.length?e.records:e).executeLocal(new Query().select(column.field));var filteredValue=DataUtil.distinct(e,column.field,false);filteredValue.forEach(function(obj){if(obj.getDay){predicates.push(getDatePredicate({field:column.field,operator:'equal',value:obj,matchCase:false}));}else{predicates.push(new Predicate(column.field,'equal',obj,false));}});}if(needQuery){return predicates.length?query.where(Predicate.or(predicates)):query;}predicate=predicates.length?Predicate.or(predicates):{predicates:[]};return predicate;}},{key:'genarateColumnQuery',value:function genarateColumnQuery(column){var gObj=this.parent;var query=gObj.query.clone();var queryColumn=this.isFiltered(column);if(queryColumn.isTrue){query=this.filterQuery(query,queryColumn.column,true);}if(gObj.searchSettings.key.length){var sSettings=gObj.searchSettings;query.search(sSettings.key,column.foreignKeyValue,sSettings.operator,sSettings.ignoreCase);}return query;}},{key:'isFiltered',value:function isFiltered(column){var filterColumn=this.parent.filterSettings.columns.filter(function(fColumn){return fColumn.field===column.foreignKeyValue;});return{column:filterColumn,isTrue:!!filterColumn.length};}},{key:'getModuleName',value:function getModuleName(){return'foreignKey';}},{key:'destroy',value:function destroy(){_get(ForeignKey.prototype.__proto__||Object.getPrototypeOf(ForeignKey.prototype),'destroy',this).call(this);this.destroyEvent();}},{key:'destroyEvent',value:function destroyEvent(){if(this.parent.isDestroyed){return;}this.parent.off(initForeignKeyColumn,this.initForeignKeyColumns);this.parent.off(getForeignKeyData,this.getForeignKeyData);this.parent.off(generateQuery,this.generateQueryFormData);}}]);return ForeignKey;}(Data));_export('SortDescriptor',SortDescriptor);_export('SortSettings',SortSettings);_export('Predicate',Predicate$1);_export('FilterSettings',FilterSettings);_export('SelectionSettings',SelectionSettings);_export('SearchSettings',SearchSettings);_export('RowDropSettings',RowDropSettings);_export('TextWrapSettings',TextWrapSettings);_export('GroupSettings',GroupSettings);_export('EditSettings',EditSettings);_export('Grid',Grid);_export('CellType',CellType);_export('RenderType',RenderType);_export('ToolbarItem',ToolbarItem);_export('doesImplementInterface',doesImplementInterface);_export('valueAccessor',valueAccessor);_export('getUpdateUsingRaf',getUpdateUsingRaf);_export('iterateArrayOrObject',iterateArrayOrObject);_export('templateCompiler',templateCompiler);_export('setStyleAndAttributes',setStyleAndAttributes);_export('extend',extend$1);_export('prepareColumns',prepareColumns);_export('setCssInGridPopUp',setCssInGridPopUp);_export('getActualProperties',getActualProperties);_export('parentsUntil',parentsUntil);_export('getElementIndex',getElementIndex);_export('inArray',inArray);_export('getActualPropFromColl',getActualPropFromColl);_export('removeElement',removeElement);_export('getPosition',getPosition);_export('getUid',getUid);_export('appendChildren',appendChildren);_export('parents',parents);_export('calculateAggregate',calculateAggregate);_export('getScrollBarWidth',_getScrollBarWidth);_export('getRowHeight',_getRowHeight);_export('isEditable',isEditable);_export('isActionPrevent',_isActionPrevent);_export('wrap',wrap);_export('changeButtonType',changeButtonType);_export('setFormatter',setFormatter);_export('addRemoveActiveClasses',addRemoveActiveClasses);_export('distinctStringValues',distinctStringValues);_export('getFilterMenuPostion',getFilterMenuPostion);_export('getZIndexCalcualtion',getZIndexCalcualtion);_export('toogleCheckbox',toogleCheckbox);_export('createCboxWithWrap',createCboxWithWrap);_export('removeAddCboxClasses',removeAddCboxClasses);_export('refreshForeignData',refreshForeignData);_export('getForeignData',getForeignData);_export('getColumnByForeignKeyValue',getColumnByForeignKeyValue);_export('getDatePredicate',getDatePredicate);_export('renderMovable',renderMovable);_export('created',created);_export('destroyed',destroyed);_export('load',load);_export('rowDataBound',rowDataBound);_export('queryCellInfo',queryCellInfo);_export('actionBegin',actionBegin);_export('actionComplete',actionComplete);_export('actionFailure',actionFailure);_export('dataBound',dataBound);_export('rowSelecting',rowSelecting);_export('rowSelected',rowSelected);_export('rowDeselecting',rowDeselecting);_export('rowDeselected',rowDeselected);_export('cellSelecting',cellSelecting);_export('cellSelected',cellSelected);_export('cellDeselecting',cellDeselecting);_export('cellDeselected',cellDeselected);_export('columnDragStart',columnDragStart);_export('columnDrag',columnDrag);_export('columnDrop',columnDrop);_export('rowDragStart',rowDragStart);_export('rowDrag',rowDrag);_export('rowDrop',rowDrop);_export('beforePrint',beforePrint);_export('printComplete',printComplete);_export('detailDataBound',detailDataBound);_export('toolbarClick',toolbarClick);_export('batchAdd',batchAdd);_export('batchCancel',batchCancel);_export('batchDelete',batchDelete);_export('beforeBatchAdd',beforeBatchAdd);_export('beforeBatchDelete',beforeBatchDelete);_export('beforeBatchSave',beforeBatchSave);_export('beginEdit',beginEdit);_export('cellEdit',cellEdit);_export('cellSave',cellSave);_export('endAdd',endAdd);_export('endDelete',endDelete);_export('endEdit',endEdit);_export('recordDoubleClick',recordDoubleClick);_export('recordClick',recordClick);_export('beforeDataBound',beforeDataBound);_export('beforeOpenColumnChooser',beforeOpenColumnChooser);_export('resizeStart',_resizeStart);_export('onResize',onResize);_export('resizeStop',resizeStop);_export('checkBoxChange',checkBoxChange);_export('beforeCopy',beforeCopy);_export('filterChoiceRequest',filterChoiceRequest);_export('filterAfterOpen',filterAfterOpen);_export('filterBeforeOpen',filterBeforeOpen);_export('initialLoad',initialLoad);_export('initialEnd',initialEnd);_export('dataReady',dataReady);_export('contentReady',contentReady);_export('uiUpdate',uiUpdate);_export('onEmpty',onEmpty);_export('inBoundModelChanged',inBoundModelChanged);_export('modelChanged',modelChanged);_export('colGroupRefresh',colGroupRefresh);_export('headerRefreshed',headerRefreshed);_export('pageBegin',pageBegin);_export('pageComplete',pageComplete);_export('sortBegin',sortBegin);_export('sortComplete',sortComplete);_export('filterBegin',filterBegin);_export('filterComplete',filterComplete);_export('searchBegin',searchBegin);_export('searchComplete',searchComplete);_export('reorderBegin',reorderBegin);_export('reorderComplete',reorderComplete);_export('rowDragAndDropBegin',rowDragAndDropBegin);_export('rowDragAndDropComplete',rowDragAndDropComplete);_export('groupBegin',groupBegin);_export('groupComplete',groupComplete);_export('ungroupBegin',ungroupBegin);_export('ungroupComplete',ungroupComplete);_export('rowSelectionBegin',rowSelectionBegin);_export('rowSelectionComplete',rowSelectionComplete);_export('columnSelectionBegin',columnSelectionBegin);_export('columnSelectionComplete',columnSelectionComplete);_export('cellSelectionBegin',cellSelectionBegin);_export('cellSelectionComplete',cellSelectionComplete);_export('beforeCellFocused',beforeCellFocused);_export('cellFocused',cellFocused);_export('keyPressed',keyPressed);_export('click',click);_export('destroy',_destroy);_export('columnVisibilityChanged',columnVisibilityChanged);_export('scroll',scroll);_export('columnWidthChanged',columnWidthChanged);_export('columnPositionChanged',columnPositionChanged);_export('rowDragAndDrop',rowDragAndDrop);_export('rowsAdded',rowsAdded);_export('rowsRemoved',rowsRemoved);_export('columnDragStop',columnDragStop);_export('headerDrop',headerDrop);_export('dataSourceModified',dataSourceModified);_export('refreshComplete',refreshComplete);_export('refreshVirtualBlock',refreshVirtualBlock);_export('dblclick',dblclick);_export('toolbarRefresh',toolbarRefresh);_export('bulkSave',bulkSave);_export('autoCol',autoCol);_export('tooltipDestroy',tooltipDestroy);_export('updateData',updateData);_export('editBegin',editBegin);_export('editComplete',editComplete);_export('addBegin',addBegin);_export('addComplete',addComplete);_export('saveComplete',saveComplete);_export('deleteBegin',deleteBegin);_export('deleteComplete',deleteComplete);_export('preventBatch',preventBatch);_export('dialogDestroy',dialogDestroy);_export('crudAction',crudAction);_export('addDeleteAction',addDeleteAction);_export('destroyForm',destroyForm);_export('doubleTap',doubleTap);_export('beforeExcelExport',beforeExcelExport);_export('excelExportComplete',excelExportComplete);_export('excelQueryCellInfo',excelQueryCellInfo);_export('beforePdfExport',beforePdfExport);_export('pdfExportComplete',pdfExportComplete);_export('pdfQueryCellInfo',pdfQueryCellInfo);_export('accessPredicate',accessPredicate);_export('contextMenuClick',contextMenuClick);_export('freezeRender',freezeRender);_export('freezeRefresh',freezeRefresh);_export('contextMenuOpen',contextMenuOpen);_export('columnMenuClick',columnMenuClick);_export('columnMenuOpen',columnMenuOpen);_export('filterOpen',filterOpen);_export('filterDialogCreated',filterDialogCreated);_export('filterMenuClose',filterMenuClose);_export('initForeignKeyColumn',initForeignKeyColumn);_export('getForeignKeyData',getForeignKeyData);_export('generateQuery',generateQuery);_export('showEmptyGrid',showEmptyGrid);_export('foreignKeyData',foreignKeyData);_export('dataStateChange',dataStateChange);_export('dataSourceChanged',dataSourceChanged);_export('rtlUpdated',rtlUpdated);_export('Data',Data);_export('Sort',Sort);_export('Page',Page);_export('Selection',Selection);_export('Filter',Filter);_export('Search',Search);_export('Scroll',Scroll);_export('resizeClassList',resizeClassList);_export('Resize',Resize);_export('Reorder',Reorder);_export('RowDD',RowDD);_export('Group',Group);_export('Print',Print);_export('DetailRow',DetailRow);_export('Toolbar',Toolbar$1);_export('Aggregate',Aggregate);_export('summaryIterator',summaryIterator);_export('VirtualScroll',VirtualScroll);_export('Edit',Edit);_export('Global',Global);_export('BatchEdit',BatchEdit);_export('InlineEdit',InlineEdit);_export('NormalEdit',NormalEdit);_export('DialogEdit',DialogEdit);_export('ColumnChooser',ColumnChooser);_export('ExcelExport',ExcelExport);_export('PdfExport',PdfExport);_export('ExportHelper',ExportHelper);_export('ExportValueFormatter',ExportValueFormatter);_export('Clipboard',Clipboard);_export('CommandColumn',CommandColumn);_export('CheckBoxFilter',CheckBoxFilter);_export('menuClass',menuClass);_export('ContextMenu',ContextMenu$1);_export('Freeze',Freeze);_export('ColumnMenu',ColumnMenu);_export('ExcelFilter',ExcelFilter);_export('ForeignKey',ForeignKey);_export('Column',Column);_export('HeaderRender',HeaderRender);_export('ContentRender',ContentRender);_export('RowRenderer',RowRenderer);_export('CellRenderer',CellRenderer);_export('HeaderCellRenderer',HeaderCellRenderer);_export('FilterCellRenderer',FilterCellRenderer);_export('StackedHeaderCellRenderer',StackedHeaderCellRenderer);_export('Render',Render);_export('IndentCellRenderer',IndentCellRenderer);_export('GroupCaptionCellRenderer',GroupCaptionCellRenderer);_export('GroupCaptionEmptyCellRenderer',GroupCaptionEmptyCellRenderer);_export('BatchEditRender',BatchEditRender);_export('DialogEditRender',DialogEditRender);_export('InlineEditRender',InlineEditRender);_export('EditRender',EditRender);_export('BooleanEditCell',BooleanEditCell);_export('DefaultEditCell',DefaultEditCell);_export('DropDownEditCell',DropDownEditCell);_export('NumericEditCell',NumericEditCell);_export('DatePickerEditCell',DatePickerEditCell);_export('CommandColumnRenderer',CommandColumnRenderer);_export('FreezeContentRender',FreezeContentRender);_export('FreezeRender',FreezeRender);_export('StringFilterUI',StringFilterUI);_export('NumberFilterUI',NumberFilterUI);_export('DateFilterUI',DateFilterUI);_export('BooleanFilterUI',BooleanFilterUI);_export('FlMenuOptrUI',FlMenuOptrUI);_export('CellRendererFactory',CellRendererFactory);_export('ServiceLocator',ServiceLocator);_export('RowModelGenerator',RowModelGenerator);_export('GroupModelGenerator',GroupModelGenerator);_export('FreezeRowModelGenerator',FreezeRowModelGenerator);_export('Pager',Pager);_export('ExternalMessage',ExternalMessage);_export('NumericContainer',NumericContainer);_export('PagerMessage',PagerMessage);}};});

//# sourceMappingURL=ej2-grids.es2015-compiled.js.map